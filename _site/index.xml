<?xml version="1.0" encoding="UTF-8"?>
<rss  xmlns:atom="http://www.w3.org/2005/Atom" 
      xmlns:media="http://search.yahoo.com/mrss/" 
      xmlns:content="http://purl.org/rss/1.0/modules/content/" 
      xmlns:dc="http://purl.org/dc/elements/1.1/" 
      version="2.0">
<channel>
<title>tomorrow-lab</title>
<link>https://tomorrow-lab.github.io/</link>
<atom:link href="https://tomorrow-lab.github.io/index.xml" rel="self" type="application/rss+xml"/>
<description>Thi</description>
<generator>quarto-1.4.549</generator>
<lastBuildDate>Mon, 25 Mar 2024 15:00:00 GMT</lastBuildDate>
<item>
  <title>RDS to mtx</title>
  <dc:creator>Taeyoon kim</dc:creator>
  <link>https://tomorrow-lab.github.io/posts/scRNAseq/R_scRNA_RDS_mtx.html</link>
  <description><![CDATA[ 




<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://tomorrow-lab.github.io/posts/scRNAseq/Seurat_logo.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:50.0%"></p>
</figure>
</div>
<section id="들어가며" class="level1">
<h1>들어가며</h1>
<p>이전 <a href="https://tomorrow-lab.github.io/posts/scRNAseq/python_scRNA_AnnData_mtx.html">글</a>에서는 <code>Scanpy</code>를 사용해 <code>10x genomics</code> 포멧의 원시데이터를 불러오고 다시 <code>mtx</code>형식으로 내보내는 내용을 살펴봤습니다. 이번에는 <code>Seurat</code>을 사용해 동일한 작업을 해보도록 하죠.</p>
</section>
<section id="예시-데이터" class="level1">
<h1>예시 데이터</h1>
<p><code>10X genomics</code>의 <code>Cell Ranger</code> 결과물인 PBMC3k를 사용합니다. 자세한 것은 <a href="https://support.10xgenomics.com/single-cell-gene-expression/datasets/1.1.0/pbmc3k">링크</a>를 확인해주세요.</p>
</section>
<section id="mtx-to-rds" class="level1">
<h1>mtx to RDS</h1>
<p><code>Seurat</code>은 <code>Scanpy</code>와는 다르게 <code>R</code>언어로 만들어졌습니다. 그래서 기본적으로 범용적인 <code>RDS</code>형식으로 데이터를 저장합니다. <code>mtx</code>파일을 불러와서 <code>Seurat</code> 객체를 만들고 <code>RDS</code>파일로 저장해보겠습니다.</p>
<div id="cell-2" class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 경고 메시지를 출력하지 않도록 설정합니다. </span></span>
<span id="cb1-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 기본값은 warn=0 입니다.</span></span>
<span id="cb1-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">options</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">warn=</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb1-4"></span>
<span id="cb1-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 패키지 로드 시 충돌 경고 메시지를 숨깁니다.</span></span>
<span id="cb1-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">suppressPackageStartupMessages</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(tidyverse))</span>
<span id="cb1-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">suppressPackageStartupMessages</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(Seurat))</span>
<span id="cb1-8"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">suppressPackageStartupMessages</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(Matrix))</span></code></pre></div>
</div>
<div id="cell-3" class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># PBMC 데이터셋 로드</span></span>
<span id="cb2-2">expression_matrix <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">Read10X</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data.dir =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"../input/filtered_gene_bc_matrices/hg19/"</span>)</span>
<span id="cb2-3"></span>
<span id="cb2-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Seurat 객체를 초기화합니다. </span></span>
<span id="cb2-5">seurat_obj <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">CreateSeuratObject</span>(</span>
<span id="cb2-6">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">counts =</span> expression_matrix,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 발현 행렬을 입력으로 사용합니다.</span></span>
<span id="cb2-7">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">project =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pbmc3k"</span>           <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 프로젝트 이름을 지정합니다.</span></span>
<span id="cb2-8">)</span>
<span id="cb2-9"></span>
<span id="cb2-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Seurat 객체를 반환합니다.</span></span>
<span id="cb2-11">seurat_obj</span></code></pre></div>
<div class="cell-output cell-output-display">
<pre><code>An object of class Seurat 
32738 features across 2700 samples within 1 assay 
Active assay: RNA (32738 features, 0 variable features)
 1 layer present: counts</code></pre>
</div>
</div>
<p>위 결과를 통해 pbmc3k의 원시 데이터에는 2,700개의 세포와 32,738개의 <code>feature</code>(유전자 정보)가 포함되어있다는 것을 알 수 있습니다.</p>
</section>
<section id="기본적인-전처리" class="level1">
<h1>기본적인 전처리</h1>
<p>최소한의 전처리를 통해 불필요한 데이터는 제거하도록 하겠습니다.</p>
<div id="cell-5" class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-execution_count="3">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># min.cells 및 min.features 매개변수를 사용하여 </span></span>
<span id="cb4-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 최소 세포 및 최소 특징을 지정할 수 있습니다.</span></span>
<span id="cb4-3">seurat_obj <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">CreateSeuratObject</span>(</span>
<span id="cb4-4">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">counts =</span> expression_matrix,  </span>
<span id="cb4-5">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">project =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pbmc3k"</span>,          <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 프로젝트 이름을 지정합니다.</span></span>
<span id="cb4-6">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">min.cells =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,               <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 각 특징이 포함된 최소 세포 수를 지정합니다.</span></span>
<span id="cb4-7">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">min.features =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">200</span>           <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 각 세포에 대한 최소 특징 수를 지정합니다.</span></span>
<span id="cb4-8">)</span>
<span id="cb4-9"></span>
<span id="cb4-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Seurat 객체를 반환합니다.</span></span>
<span id="cb4-11">seurat_obj</span></code></pre></div>
<div class="cell-output cell-output-display">
<pre><code>An object of class Seurat 
13714 features across 2700 samples within 1 assay 
Active assay: RNA (13714 features, 0 variable features)
 1 layer present: counts</code></pre>
</div>
</div>
<p>이제 <code>feature</code>가 많이 감소하였습니다. 추가로 미토콘드리아 유전자 비율과 세포당 <code>feature</code> 비율로 이상한 세포들을 제거합니다.</p>
<div id="cell-7" class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-execution_count="4">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Seurat 객체에 미토콘드리아 유전자 백분율 정보를 추가합니다.</span></span>
<span id="cb6-2">seurat_obj[[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"percent.mt"</span>]] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">PercentageFeatureSet</span>(seurat_obj, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pattern =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"^MT-"</span>)</span>
<span id="cb6-3"></span>
<span id="cb6-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Seurat 객체를 필터링하여 원시 데이터셋에서 특정 조건을 만족하는 세포들만 선택합니다.</span></span>
<span id="cb6-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># nFeature_RNA: RNA 발현 특징의 수</span></span>
<span id="cb6-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># percent.mt: MT 유전자 백분율</span></span>
<span id="cb6-7">seurat_obj <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">subset</span>(</span>
<span id="cb6-8">    seurat_obj,</span>
<span id="cb6-9">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">subset =</span> nFeature_RNA <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">200</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> nFeature_RNA <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2500</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> percent.mt <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span></span>
<span id="cb6-10">)</span>
<span id="cb6-11"></span>
<span id="cb6-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 필터링된 Seurat 객체를 반환합니다.</span></span>
<span id="cb6-13">seurat_obj</span></code></pre></div>
<div class="cell-output cell-output-display">
<pre><code>An object of class Seurat 
13714 features across 2638 samples within 1 assay 
Active assay: RNA (13714 features, 0 variable features)
 1 layer present: counts</code></pre>
</div>
</div>
<section id="umap-그리기" class="level2">
<h2 class="anchored" data-anchor-id="umap-그리기">UMAP 그리기</h2>
<p>UMAP을 그리기 위해 아래 코드들을 실행합니다.</p>
<div id="cell-9" class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-execution_count="5">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 데이터 정규화</span></span>
<span id="cb8-2">seurat_obj <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">NormalizeData</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">object =</span> seurat_obj, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">verbose =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>)</span>
<span id="cb8-3"></span>
<span id="cb8-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 변수 특징 찾기</span></span>
<span id="cb8-5">seurat_obj <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">FindVariableFeatures</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">object =</span> seurat_obj, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">verbose =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>)</span>
<span id="cb8-6"></span>
<span id="cb8-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 데이터 스케일링</span></span>
<span id="cb8-8">seurat_obj <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ScaleData</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">object =</span> seurat_obj, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">verbose =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>)</span>
<span id="cb8-9"></span>
<span id="cb8-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 주성분 분석 실행</span></span>
<span id="cb8-11">seurat_obj <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">RunPCA</span>(</span>
<span id="cb8-12">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">object =</span> seurat_obj,</span>
<span id="cb8-13">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">features =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">VariableFeatures</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">object =</span> seurat_obj),</span>
<span id="cb8-14">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">verbose =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span></span>
<span id="cb8-15">)</span>
<span id="cb8-16"></span>
<span id="cb8-17"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 이웃 찾기</span></span>
<span id="cb8-18">seurat_obj <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">FindNeighbors</span>(</span>
<span id="cb8-19">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">object =</span> seurat_obj, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">dims =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">verbose =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span></span>
<span id="cb8-20">)</span>
<span id="cb8-21"></span>
<span id="cb8-22"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 클러스터 찾기</span></span>
<span id="cb8-23">seurat_obj <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">FindClusters</span>(</span>
<span id="cb8-24">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">object =</span> seurat_obj, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">resolution =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">verbose =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span></span>
<span id="cb8-25">)</span>
<span id="cb8-26"></span>
<span id="cb8-27"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># UMAP 실행</span></span>
<span id="cb8-28">seurat_obj <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">RunUMAP</span>(</span>
<span id="cb8-29">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">object =</span> seurat_obj, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">dims =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">verbose =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span></span>
<span id="cb8-30">)</span></code></pre></div>
</div>
<div id="cell-10" class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-execution_count="6">
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">DimPlot</span>(</span>
<span id="cb9-2">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">object =</span> seurat_obj,</span>
<span id="cb9-3">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>,          <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 각 데이터 포인트에 레이블 표시 여부</span></span>
<span id="cb9-4">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">reduction =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"umap"</span>    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># UMAP 데이터 사용</span></span>
<span id="cb9-5">) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">NoLegend</span>()            <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 범례 숨기기</span></span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://tomorrow-lab.github.io/posts/scRNAseq/R_scRNA_RDS_mtx_files/figure-html/cell-7-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>메타 데이터도 살펴봅니다.</p>
<div id="cell-12" class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-execution_count="7">
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(seurat_obj[[]])</span></code></pre></div>
<div class="cell-output cell-output-display">
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true">
<caption>A data.frame: 6 × 6</caption>
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th" scope="col">orig.ident</th>
<th data-quarto-table-cell-role="th" scope="col">nCount_RNA</th>
<th data-quarto-table-cell-role="th" scope="col">nFeature_RNA</th>
<th data-quarto-table-cell-role="th" scope="col">percent.mt</th>
<th data-quarto-table-cell-role="th" scope="col">RNA_snn_res.0.5</th>
<th data-quarto-table-cell-role="th" scope="col">seurat_clusters</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th" scope="col">&lt;fct&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;int&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;fct&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;fct&gt;</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th" scope="row">AAACATACAACCAC-1</td>
<td>pbmc3k</td>
<td>2419</td>
<td>779</td>
<td>3.0177759</td>
<td>2</td>
<td>2</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th" scope="row">AAACATTGAGCTAC-1</td>
<td>pbmc3k</td>
<td>4903</td>
<td>1352</td>
<td>3.7935958</td>
<td>3</td>
<td>3</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th" scope="row">AAACATTGATCAGC-1</td>
<td>pbmc3k</td>
<td>3147</td>
<td>1129</td>
<td>0.8897363</td>
<td>2</td>
<td>2</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th" scope="row">AAACCGTGCTTCCG-1</td>
<td>pbmc3k</td>
<td>2639</td>
<td>960</td>
<td>1.7430845</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th" scope="row">AAACCGTGTATGCG-1</td>
<td>pbmc3k</td>
<td>980</td>
<td>521</td>
<td>1.2244898</td>
<td>6</td>
<td>6</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th" scope="row">AAACGCACTGGTAC-1</td>
<td>pbmc3k</td>
<td>2163</td>
<td>781</td>
<td>1.6643551</td>
<td>2</td>
<td>2</td>
</tr>
</tbody>
</table>
</div>
</div>
<p><code>seurat_clusters</code>들이 숫자로 되어 있습니다. 이것을 <code>cell type annotation</code>작을 통해 아래와 같이 값을 바꿔줍니다.</p>
<div id="cell-14" class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-execution_count="8">
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 클러스터 이름 재할당</span></span>
<span id="cb11-2">seurat_obj[[]] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> seurat_obj[[]] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb11-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">seurat_clusters =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">recode</span>(</span>
<span id="cb11-4">    seurat_clusters,</span>
<span id="cb11-5">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">0</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Naive CD4 T"</span>,</span>
<span id="cb11-6">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">1</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"CD14+ Mono"</span>,</span>
<span id="cb11-7">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">2</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Memory CD4 T"</span>,</span>
<span id="cb11-8">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">3</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"B"</span>,</span>
<span id="cb11-9">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">4</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"CD8 T"</span>,</span>
<span id="cb11-10">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">5</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"FCGR3A+ Mono"</span>,</span>
<span id="cb11-11">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">6</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"NK"</span>,</span>
<span id="cb11-12">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">7</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"DC"</span>,</span>
<span id="cb11-13">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">8</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Platelet"</span></span>
<span id="cb11-14">  ))</span>
<span id="cb11-15"></span>
<span id="cb11-16"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 수정된 클러스터 정보 확인</span></span>
<span id="cb11-17"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(seurat_obj[[]])</span></code></pre></div>
<div class="cell-output cell-output-display">
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true">
<caption>A data.frame: 6 × 6</caption>
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th" scope="col">orig.ident</th>
<th data-quarto-table-cell-role="th" scope="col">nCount_RNA</th>
<th data-quarto-table-cell-role="th" scope="col">nFeature_RNA</th>
<th data-quarto-table-cell-role="th" scope="col">percent.mt</th>
<th data-quarto-table-cell-role="th" scope="col">RNA_snn_res.0.5</th>
<th data-quarto-table-cell-role="th" scope="col">seurat_clusters</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th" scope="col">&lt;fct&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;int&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;fct&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;fct&gt;</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th" scope="row">AAACATACAACCAC-1</td>
<td>pbmc3k</td>
<td>2419</td>
<td>779</td>
<td>3.0177759</td>
<td>2</td>
<td>Memory CD4 T</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th" scope="row">AAACATTGAGCTAC-1</td>
<td>pbmc3k</td>
<td>4903</td>
<td>1352</td>
<td>3.7935958</td>
<td>3</td>
<td>B</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th" scope="row">AAACATTGATCAGC-1</td>
<td>pbmc3k</td>
<td>3147</td>
<td>1129</td>
<td>0.8897363</td>
<td>2</td>
<td>Memory CD4 T</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th" scope="row">AAACCGTGCTTCCG-1</td>
<td>pbmc3k</td>
<td>2639</td>
<td>960</td>
<td>1.7430845</td>
<td>1</td>
<td>CD14+ Mono</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th" scope="row">AAACCGTGTATGCG-1</td>
<td>pbmc3k</td>
<td>980</td>
<td>521</td>
<td>1.2244898</td>
<td>6</td>
<td>NK</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th" scope="row">AAACGCACTGGTAC-1</td>
<td>pbmc3k</td>
<td>2163</td>
<td>781</td>
<td>1.6643551</td>
<td>2</td>
<td>Memory CD4 T</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>다시 UMAP을 그려보겠습니다.</p>
<div id="cell-16" class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-execution_count="9">
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">DimPlot</span>(</span>
<span id="cb12-2">  seurat_obj,</span>
<span id="cb12-3">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">reduction =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"umap"</span>,</span>
<span id="cb12-4">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>,</span>
<span id="cb12-5">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">group.by=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"seurat_clusters"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">NoLegend</span>()</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://tomorrow-lab.github.io/posts/scRNAseq/R_scRNA_RDS_mtx_files/figure-html/cell-10-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>이제 <code>RDS</code>파일로 객체를 저장합니다.</p>
<div id="cell-18" class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-execution_count="10">
<div class="sourceCode cell-code" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1">output_path <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"../output/pbmc3k/"</span></span>
<span id="cb13-2"></span>
<span id="cb13-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Seurat 객체를 RDS 파일로 저장</span></span>
<span id="cb13-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">saveRDS</span>(</span>
<span id="cb13-5">    seurat_obj,</span>
<span id="cb13-6">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">file =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(output_path, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pbmc3k.rds"</span>)</span>
<span id="cb13-7">)</span></code></pre></div>
</div>
</section>
</section>
<section id="rds-to-mtx-format" class="level1">
<h1>RDS to <code>mtx</code> format</h1>
<p>다시 <code>RDS</code>파일을 불러와서 <code>Seurat</code> 객체를 만들어 봅니다.</p>
<div id="cell-20" class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-execution_count="11">
<div class="sourceCode cell-code" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1">seurat_obj <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">readRDS</span>(</span>
<span id="cb14-2">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(output_path, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pbmc3k.rds"</span>)</span>
<span id="cb14-3">)</span>
<span id="cb14-4"></span>
<span id="cb14-5">seurat_obj</span></code></pre></div>
<div class="cell-output cell-output-display">
<pre><code>An object of class Seurat 
13714 features across 2638 samples within 1 assay 
Active assay: RNA (13714 features, 2000 variable features)
 3 layers present: counts, data, scale.data
 2 dimensional reductions calculated: pca, umap</code></pre>
</div>
</div>
<p>이제 아래와 같이 <code>mtx</code>, <code>tsv</code> 형식으로 데이터를 저장합니다.</p>
<div class="call-out:note">
<p><code>Seurat</code>은 유전자의 이름을 객체의 <code>rownames()</code>로 저장하기 때문에 <code>Scanpy</code>와는 달리 <code>ENSEMBL_ID</code> 정보가 소실되었습니다. 이 부분은 원시 데이터를 다시 불러와서 우회할 수 있습니다.</p>
</div>
<div id="cell-22" class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-execution_count="12">
<div class="sourceCode cell-code" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># RNA 발현 행렬 데이터 추출</span></span>
<span id="cb16-2">counts <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> seurat_obj[[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"RNA"</span>]]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>counts</span>
<span id="cb16-3"></span>
<span id="cb16-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 발현 행렬을 Matrix Market 형식의 파일로 저장</span></span>
<span id="cb16-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">writeMM</span>(counts, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">file =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(output_path,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"matrix.mtx"</span>))</span>
<span id="cb16-6"></span>
<span id="cb16-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 세포 식별자(barcodes)를 추출</span></span>
<span id="cb16-8">barcodes <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(seurat_obj)</span>
<span id="cb16-9"></span>
<span id="cb16-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 세포 식별자를 TSV 파일로 저장</span></span>
<span id="cb16-11"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">write.table</span>(barcodes, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">file =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(output_path,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"barcodes.tsv"</span>),</span>
<span id="cb16-12">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">row.names =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col.names =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">quote =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sep =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\t</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb16-13"></span>
<span id="cb16-14"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 유전자 정보를 추출</span></span>
<span id="cb16-15">genes <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(seurat_obj)</span>
<span id="cb16-16"></span>
<span id="cb16-17"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 유전자 정보를 TSV 파일로 저장</span></span>
<span id="cb16-18"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">write.table</span>(genes, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">file =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(output_path, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"genes.tsv"</span>), </span>
<span id="cb16-19">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">row.names =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col.names =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">quote =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sep =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\t</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb16-20"></span>
<span id="cb16-21"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 메타데이터 추출 (Seurat 객체의 meta.data에 저장됨)</span></span>
<span id="cb16-22">meta_data <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> seurat_obj[[]]</span>
<span id="cb16-23"></span>
<span id="cb16-24"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 메타데이터를 TSV 파일로 저장</span></span>
<span id="cb16-25"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">write.table</span>(meta_data, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">file =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(output_path, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"metadata.tsv"</span>), </span>
<span id="cb16-26">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">row.names =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col.names =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">quote =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sep =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\t</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb16-27"></span>
<span id="cb16-28"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># UMAP 좌표 추출</span></span>
<span id="cb16-29">umap <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">Embeddings</span>(seurat_obj, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">reduction =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"umap"</span>)</span>
<span id="cb16-30"></span>
<span id="cb16-31"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># UMAP 좌표를 TSV 파일로 저장</span></span>
<span id="cb16-32"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">write.table</span>(umap, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">file =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(output_path, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"UMAP.coords.tsv"</span>), </span>
<span id="cb16-33">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">row.names =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col.names =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">quote =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sep =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\t</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb16-34"></span>
<span id="cb16-35"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># UMAP 좌표의 첫 번째 몇 개 행을 확인</span></span>
<span id="cb16-36"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(umap)</span></code></pre></div>
<div class="cell-output cell-output-display">
<pre><code>NULL</code></pre>
</div>
<div class="cell-output cell-output-display">
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true">
<caption>A matrix: 6 × 2 of type dbl</caption>
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th" scope="col">umap_1</th>
<th data-quarto-table-cell-role="th" scope="col">umap_2</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th" scope="row">AAACATACAACCAC-1</td>
<td>2.864640</td>
<td>4.076900</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th" scope="row">AAACATTGAGCTAC-1</td>
<td>5.019568</td>
<td>-12.472298</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th" scope="row">AAACATTGATCAGC-1</td>
<td>4.590423</td>
<td>6.898579</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th" scope="row">AAACCGTGCTTCCG-1</td>
<td>-6.713953</td>
<td>-4.744311</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th" scope="row">AAACCGTGTATGCG-1</td>
<td>5.818774</td>
<td>-1.113903</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th" scope="row">AAACGCACTGGTAC-1</td>
<td>2.456097</td>
<td>6.181250</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="mtx-to-rds-1" class="level1">
<h1><code>mtx</code> to RDS</h1>
<p>위에서 저장한 파일들을 불러와 <code>Seurat</code> 객체를 만들어봅니다.</p>
<div id="cell-24" class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-execution_count="16">
<div class="sourceCode cell-code" id="cb18" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Matrix Market 형식의 파일로부터 발현 행렬, 유전자 정보, 세포 식별자를 읽어옵니다.</span></span>
<span id="cb18-2">expression_matrix <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ReadMtx</span>(</span>
<span id="cb18-3">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mtx =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(output_path, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"matrix.mtx"</span>),      <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 발현 행렬 파일 경로</span></span>
<span id="cb18-4">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">features =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(output_path, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"genes.tsv"</span>),  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 유전자 정보 파일 경로</span></span>
<span id="cb18-5">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cells =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(output_path, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"barcodes.tsv"</span>),  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 세포 식별자 파일 경로</span></span>
<span id="cb18-6">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">feature.column =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>                            <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 유전자 정보 파일에서 사용할 열 인덱스</span></span>
<span id="cb18-7">)</span>
<span id="cb18-8"></span>
<span id="cb18-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Seurat 객체를 생성하고 발현 행렬을 입력 데이터로 사용합니다.</span></span>
<span id="cb18-10">seurat_obj <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">CreateSeuratObject</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">counts =</span> expression_matrix)</span>
<span id="cb18-11"></span>
<span id="cb18-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 메타데이터 파일을 읽어와 Seurat 객체의 메타데이터로 설정합니다.</span></span>
<span id="cb18-13">seurat_obj[[]] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read.table</span>(</span>
<span id="cb18-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(output_path, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"metadata.tsv"</span>),           <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 메타데이터 파일 경로</span></span>
<span id="cb18-15">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">stringsAsFactors =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>,                      <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 문자열을 팩터로 변환하지 않음</span></span>
<span id="cb18-16">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">header =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>,                                 <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 헤더가 있음</span></span>
<span id="cb18-17">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sep =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\t</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>,                                    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 탭으로 구분됨</span></span>
<span id="cb18-18">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">row.names =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>                                  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 행 이름 사용</span></span>
<span id="cb18-19">)</span>
<span id="cb18-20"></span>
<span id="cb18-21"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># UMAP 좌표를 파일에서 읽어와 데이터 프레임으로 저장합니다.</span></span>
<span id="cb18-22">UMAP_coordinates <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read.table</span>(</span>
<span id="cb18-23">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(output_path, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"UMAP.coords.tsv"</span>),        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># UMAP 좌표 파일 경로</span></span>
<span id="cb18-24">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">stringsAsFactors =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>,                      <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 문자열을 팩터로 변환하지 않음</span></span>
<span id="cb18-25">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">header =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>,                                 <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 헤더가 있음</span></span>
<span id="cb18-26">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">row.names =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>                                  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 행 이름 사용</span></span>
<span id="cb18-27">)</span>
<span id="cb18-28"></span>
<span id="cb18-29"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># UMAP 좌표를 행렬로 변환합니다.</span></span>
<span id="cb18-30">UMAP_coordinates_mat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as</span>(UMAP_coordinates, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"matrix"</span>)</span>
<span id="cb18-31"></span>
<span id="cb18-32"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># DimReducObject를 생성하여 Seurat 객체에 UMAP 좌표를 추가합니다.</span></span>
<span id="cb18-33">seurat_obj[[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'umap'</span>]] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">CreateDimReducObject</span>(</span>
<span id="cb18-34">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">embeddings =</span> UMAP_coordinates_mat,             <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># UMAP 좌표 행렬</span></span>
<span id="cb18-35">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">key =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"UMAP_"</span>,                                 <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># UMAP 좌표 키</span></span>
<span id="cb18-36">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">global =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>,</span>
<span id="cb18-37">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">assay =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"RNA"</span></span>
<span id="cb18-38">)</span>
<span id="cb18-39"></span>
<span id="cb18-40"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 수정된 Seurat 객체를 반환합니다.</span></span>
<span id="cb18-41">seurat_obj</span></code></pre></div>
<div class="cell-output cell-output-display">
<pre><code>An object of class Seurat 
13714 features across 2638 samples within 1 assay 
Active assay: RNA (13714 features, 0 variable features)
 1 layer present: counts
 1 dimensional reduction calculated: umap</code></pre>
</div>
</div>
<p>일부 데이터는 소실되었지만 <code>Seurat</code> 객체가 잘 만들어졌습니다. 메타데이터도 살펴보겠습니다.</p>
<div id="cell-26" class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-execution_count="17">
<div class="sourceCode cell-code" id="cb20" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(seurat_obj[[]])</span></code></pre></div>
<div class="cell-output cell-output-display">
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true">
<caption>A data.frame: 6 × 6</caption>
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th" scope="col">orig.ident</th>
<th data-quarto-table-cell-role="th" scope="col">nCount_RNA</th>
<th data-quarto-table-cell-role="th" scope="col">nFeature_RNA</th>
<th data-quarto-table-cell-role="th" scope="col">percent.mt</th>
<th data-quarto-table-cell-role="th" scope="col">RNA_snn_res.0.5</th>
<th data-quarto-table-cell-role="th" scope="col">seurat_clusters</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;int&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;int&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;int&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th" scope="row">AAACATACAACCAC-1</td>
<td>pbmc3k</td>
<td>2419</td>
<td>779</td>
<td>3.0177759</td>
<td>2</td>
<td>Memory CD4 T</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th" scope="row">AAACATTGAGCTAC-1</td>
<td>pbmc3k</td>
<td>4903</td>
<td>1352</td>
<td>3.7935958</td>
<td>3</td>
<td>B</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th" scope="row">AAACATTGATCAGC-1</td>
<td>pbmc3k</td>
<td>3147</td>
<td>1129</td>
<td>0.8897363</td>
<td>2</td>
<td>Memory CD4 T</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th" scope="row">AAACCGTGCTTCCG-1</td>
<td>pbmc3k</td>
<td>2639</td>
<td>960</td>
<td>1.7430845</td>
<td>1</td>
<td>CD14+ Mono</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th" scope="row">AAACCGTGTATGCG-1</td>
<td>pbmc3k</td>
<td>980</td>
<td>521</td>
<td>1.2244898</td>
<td>6</td>
<td>NK</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th" scope="row">AAACGCACTGGTAC-1</td>
<td>pbmc3k</td>
<td>2163</td>
<td>781</td>
<td>1.6643551</td>
<td>2</td>
<td>Memory CD4 T</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="cell-27" class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}">
<div class="sourceCode cell-code" id="cb21" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1">UMAP을 다시 그려 클러스터링 결과도 확인 해봅니다.</span></code></pre></div>
</div>
<div id="cell-28" class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-execution_count="18">
<div class="sourceCode cell-code" id="cb22" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">DimPlot</span>(</span>
<span id="cb22-2">  seurat_obj,</span>
<span id="cb22-3">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">reduction =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"umap"</span>,</span>
<span id="cb22-4">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>,</span>
<span id="cb22-5">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">group.by=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"seurat_clusters"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">NoLegend</span>()</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://tomorrow-lab.github.io/posts/scRNAseq/R_scRNA_RDS_mtx_files/figure-html/cell-17-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="마치며" class="level1">
<h1>마치며</h1>
<p>scRNA-seq 데이터 분석을 하다보면 분석 도구들이 <code>python</code> 혹은 <code>R</code>로 작성되어 있어, 사용자가 데이터를 이리 저리 변환해야 할 때가 많습니다. 그런 작업을 위해서는 여러 방법이 있지만 가장 간단한 <code>mtx</code> 형식으로 저장하는 것이 아무래도 가장 손이 덜가고 오류 가능성이 적다고 생각합니다.</p>


</section>

 ]]></description>
  <category>R</category>
  <category>scRNA</category>
  <category>seurat</category>
  <category>cellranger</category>
  <category>10x genomics</category>
  <guid>https://tomorrow-lab.github.io/posts/scRNAseq/R_scRNA_RDS_mtx.html</guid>
  <pubDate>Mon, 25 Mar 2024 15:00:00 GMT</pubDate>
</item>
<item>
  <title>AnnData 객체를 mtx 형식으로 저장하기</title>
  <dc:creator>Taeyoon kim</dc:creator>
  <link>https://tomorrow-lab.github.io/posts/scRNAseq/python_scRNA_AnnData_mtx.html</link>
  <description><![CDATA[ 




<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://tomorrow-lab.github.io/posts/scRNAseq/Scanpy_logo.svg" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:50.0%"></p>
</figure>
</div>
<section id="들어가며" class="level1">
<h1>들어가며</h1>
<p>단일세포 RNA 시퀀싱(scRNA-seq) 데이터 분석의 양대 산맥인 <code>Scanpy</code>와 <code>Seurat</code>은 서로 다른 파일 형식으로 데이터를 저장합니다. 더구나 프로그래밍 언어도 다르다 보니, 서로 데이터 변환이 쉽지 않습니다.</p>
<p>그래서 이미 데이터 변환을 위한 여러가지 도구(<code>sceasy</code> 등)들이 개발되어 왔지만 제대로 작동 하지 않는 경우가 너무 많아서 이 글을 쓰게 되었습니다.</p>
<section id="anndata-객체에-대하여" class="level2">
<h2 class="anchored" data-anchor-id="anndata-객체에-대하여">AnnData 객체에 대하여</h2>
<p><code>Scanpy</code>는 고차원 단일세포 RNA 시퀀싱 데이터를 다루기 위한 파이썬 라이브러리입니다. 이 라이브러리는 데이터를 저장하고 관리하기 위해 <code>AnnData</code> 객체를 활용합니다. 이번 포스트는 <code>Scanpy</code>를 사용하여 <code>10x Genomics</code> 에서 제공하는 텍스트 형식의 데이터를 먼저 불러오고 UMAP을 그린다음 다시 텍스트 형식의 데이터로 내보내는 작업을 해보겠습니다. 이런 방법을 알게 되면 <code>Seurat</code>으로 데이터를 변환하는 작업도 훨씬 쉬워집니다.</p>
</section>
<section id="mtx-형식에-대하여" class="level2">
<h2 class="anchored" data-anchor-id="mtx-형식에-대하여">mtx 형식에 대하여</h2>
<p>scRNA-seq count 데이터는 희소 행렬입니다. 다시 말해 대부분의 데이터가 0인 형태입니다. 이런 형태의 데이터를 효율적으로 저장하기 위해서 우리는 <a href="https://math.nist.gov/MatrixMarket/formats.html">MEX</a>(Market Exchange Format)을 사용합니다.</p>
<blockquote class="blockquote">
<p>MEX 형식은 행렬 데이터의 교환을 쉽게 할 수 있도록 고안되었습니다. 가능한 쉽게 분석할 수 있도록 최소한의 ASCII 형식을 가진 파일로 구성 됩니다.</p>
</blockquote>
<p>공개된 scRNA-seq 데이터에서 mtx로 저장되어 있는 것을 많이 볼 수 있습니다. 간략하게 설명하자면 <code>matrix.mtx</code>파일은 생성된 유전자 x 세포 count 행렬을 나타내며, 각 유전자의 발현 수준을 담고 있습니다.</p>
<p>추가로 각 행과 열 인덱스에 해당하는 유전자 및 바코드 시퀀스가 TSV(Tab separated values) 형식 파일로 포함됩니다. TSV파일은 가장 단순하고 범용적인 파일 형식으로, 각 유전자의 이름과 세포 데이터가 텝으로 구분되어 저장되어 있습니다.</p>
</section>
</section>
<section id="예시-데이터" class="level1">
<h1>예시 데이터</h1>
<p><code>10x Genomics</code>에서 무료로 제공하는 pbmc3k 데이터를 사용합니다. 직접 <a href="http://cf.10xgenomics.com/samples/cell-exp/1.1.0/pbmc3k/pbmc3k_filtered_gene_bc_matrices.tar.gz">다운로드</a>하거나 아래 코드를 통해 터미널에서 작업할 수 있습니다.</p>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">wget</span> http://cf.10xgenomics.com/samples/cell-exp/1.1.0/pbmc3k/pbmc3k_filtered_gene_bc_matrices.tar.gz <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-O</span> data/pbmc3k_filtered_gene_bc_matrices.tar.gz</span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tar</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-xzf</span> pbmc3k_filtered_gene_bc_matrices.tar.gz</span></code></pre></div>
<p>다운로드 된 파일의 압축을 풀어보면 다음과 같이 3개의 파일로 구성되어 있습니다.</p>
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb2-1"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">.</span></span>
<span id="cb2-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> barcodes.tsv</span>
<span id="cb2-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> genes.tsv</span>
<span id="cb2-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">└──</span> matrix.mtx</span></code></pre></div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p><code>Cell Ranger</code> 버전 3.0 이후에는 파일 형식이 달라졌습니다. <code>genes.csv</code> 파일은 <code>features.tsv.gz</code>로 대체되었으며, mtx 파일 및 바코드 파일은 이제 <code>gzip</code>으로 압축되었습니다.</p>
</div>
</div>
</section>
<section id="mtx-to-anndata" class="level1">
<h1><code>mtx</code> to <code>AnnData</code></h1>
<div id="cell-2" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> warnings</span>
<span id="cb3-2"></span>
<span id="cb3-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> anndata</span>
<span id="cb3-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> pandas <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> pd</span>
<span id="cb3-5"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> scanpy <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> sc</span>
<span id="cb3-6"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> scipy</span>
<span id="cb3-7"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> scipy.io <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> mmread</span>
<span id="cb3-8"></span>
<span id="cb3-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 경고 무시</span></span>
<span id="cb3-10">warnings.simplefilter(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ignore"</span>)</span>
<span id="cb3-11"></span>
<span id="cb3-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 출력 세부 수준 설정</span></span>
<span id="cb3-13">sc.settings.verbosity <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 오류 (0), 경고 (1), 정보 (2), 힌트 (3)</span></span>
<span id="cb3-14"></span>
<span id="cb3-15"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 입력 경로</span></span>
<span id="cb3-16">input_path <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"../input/filtered_gene_bc_matrices/hg19/"</span></span>
<span id="cb3-17"></span>
<span id="cb3-18"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 데이터 읽기</span></span>
<span id="cb3-19">adata <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> sc.read_10x_mtx(</span>
<span id="cb3-20">    input_path,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># `.mtx` 파일이 있는 디렉토리</span></span>
<span id="cb3-21">    var_names<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gene_symbols"</span>,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 변수 이름에 유전자 기호 사용 (변수 축 인덱스)</span></span>
<span id="cb3-22">)</span>
<span id="cb3-23"></span>
<span id="cb3-24"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># `sc.read_10x_mtx`에서 `var_names='gene_ids'`를 사용하는 경우 이 작업이 필요하지 않음</span></span>
<span id="cb3-25">adata.var_names_make_unique()</span>
<span id="cb3-26"></span>
<span id="cb3-27">adata</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>AnnData object with n_obs × n_vars = 2700 × 32738
    var: 'gene_ids'</code></pre>
</div>
</div>
<p>위 출력 결과를 통해 원시 데이터에 총 2,700개의 바코드와 32,738개의 유전자가 있다는 것을 알 수 있습니다.</p>
<section id="기본적인-데이터-qc-하기" class="level2">
<h2 class="anchored" data-anchor-id="기본적인-데이터-qc-하기">기본적인 데이터 QC 하기</h2>
<div id="cell-4" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 기본 필터링: 최소 유전자가 200개 이상인 세포 필터링</span></span>
<span id="cb5-2">sc.pp.filter_cells(adata, min_genes<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">200</span>)</span>
<span id="cb5-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 최소 3개 이상의 세포에서 발현되는 유전자 필터링</span></span>
<span id="cb5-4">sc.pp.filter_genes(adata, min_cells<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>)</span>
<span id="cb5-5"></span>
<span id="cb5-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 미토콘드리아 유전자 그룹을 "mt"로 주석</span></span>
<span id="cb5-7">adata.var[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mt"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> adata.var_names.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>.startswith(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"MT-"</span>)</span>
<span id="cb5-8"></span>
<span id="cb5-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># QC 지표 계산</span></span>
<span id="cb5-10">sc.pp.calculate_qc_metrics(adata, qc_vars<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mt"</span>], percent_top<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>, log1p<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">False</span>, inplace<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb5-11"></span>
<span id="cb5-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 유전자 별 발현 수가 2500개 미만인 데이터 선택</span></span>
<span id="cb5-13">adata <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> adata[adata.obs.n_genes_by_counts <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2500</span>, :]</span>
<span id="cb5-14"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 미토콘드리아 발현 비율이 5% 미만인 데이터 선택 후 복사</span></span>
<span id="cb5-15">adata <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> adata[adata.obs.pct_counts_mt <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, :].copy()</span>
<span id="cb5-16"></span>
<span id="cb5-17">adata</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="2">
<pre><code>AnnData object with n_obs × n_vars = 2638 × 13714
    obs: 'n_genes', 'n_genes_by_counts', 'total_counts', 'total_counts_mt', 'pct_counts_mt'
    var: 'gene_ids', 'n_cells', 'mt', 'n_cells_by_counts', 'mean_counts', 'pct_dropout_by_counts', 'total_counts'</code></pre>
</div>
</div>
<p>위 결과를 통해 데이터 QC를 거치자 데이터가 조금 감소한 것(바코드 2,638개, 유전자 13,714개)을 알 수 있습니다.</p>
</section>
<section id="데이터-정규화하기" class="level2">
<h2 class="anchored" data-anchor-id="데이터-정규화하기">데이터 정규화하기</h2>
<p>UMAP을 그리기 위해 원시 데이터를 정규화하고 highly variable 유전자만 남긴 다음 클러스터링을 수행합니다. 계산량을 줄이기 위해 전체 유전자중 일부 highly variable 유전자만으로 진행합니다.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>전체 유전자를 다 사용한 것과 클러스터링 결과는 동일합니다.</p>
</div>
</div>
<div id="cell-6" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 총 카운트 정규화</span></span>
<span id="cb7-2">sc.pp.normalize_total(adata, target_sum<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1e4</span>)</span>
<span id="cb7-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 데이터 로그 스케일 변환</span></span>
<span id="cb7-4">sc.pp.log1p(adata)</span>
<span id="cb7-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 고변동성 유전자 식별</span></span>
<span id="cb7-6">sc.pp.highly_variable_genes(adata, min_mean<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.0125</span>, max_mean<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, min_disp<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>)</span>
<span id="cb7-7"></span>
<span id="cb7-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 나중에 사용하기 위해 AnnData 객체의 .raw 속성을 정규화되고 로그 스케일링된 원시 유전자 발현으로 설정</span></span>
<span id="cb7-9">adata.raw <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> adata</span>
<span id="cb7-10"></span>
<span id="cb7-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 필터링 실행</span></span>
<span id="cb7-12">adata <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> adata[:, adata.var.highly_variable]</span>
<span id="cb7-13"></span>
<span id="cb7-14"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 각 세포의 총 카운트 및 발현된 미토콘드리아 유전자의 백분율 효과를 회귀로 제거하고 데이터를 단위 분산으로 스케일링</span></span>
<span id="cb7-15">sc.pp.regress_out(adata, [<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"total_counts"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pct_counts_mt"</span>])</span>
<span id="cb7-16"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 각 유전자를 단위 분산으로 스케일링하고 표준 편차가 10을 초과하는 값을 클리핑</span></span>
<span id="cb7-17">sc.pp.scale(adata, max_value<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>)</span>
<span id="cb7-18"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># PCA 수행</span></span>
<span id="cb7-19">sc.tl.pca(adata, svd_solver<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"arpack"</span>)</span>
<span id="cb7-20"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 이웃 찾기</span></span>
<span id="cb7-21">sc.pp.neighbors(adata, n_neighbors<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, n_pcs<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">40</span>)</span>
<span id="cb7-22"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># UMAP 수행</span></span>
<span id="cb7-23">sc.tl.umap(adata)</span>
<span id="cb7-24"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Leiden 알고리즘을 사용하여 클러스터링 수행</span></span>
<span id="cb7-25">sc.tl.leiden(</span>
<span id="cb7-26">    adata,</span>
<span id="cb7-27">    resolution<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.4</span>,</span>
<span id="cb7-28">    random_state<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">42</span>,</span>
<span id="cb7-29">)</span>
<span id="cb7-30"></span>
<span id="cb7-31"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 처리된 데이터셋 반환</span></span>
<span id="cb7-32">adata</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="3">
<pre><code>AnnData object with n_obs × n_vars = 2638 × 1838
    obs: 'n_genes', 'n_genes_by_counts', 'total_counts', 'total_counts_mt', 'pct_counts_mt', 'leiden'
    var: 'gene_ids', 'n_cells', 'mt', 'n_cells_by_counts', 'mean_counts', 'pct_dropout_by_counts', 'total_counts', 'highly_variable', 'means', 'dispersions', 'dispersions_norm', 'mean', 'std'
    uns: 'log1p', 'hvg', 'pca', 'neighbors', 'umap', 'leiden'
    obsm: 'X_pca', 'X_umap'
    varm: 'PCs'
    obsp: 'distances', 'connectivities'</code></pre>
</div>
</div>
<p>이제 유전자의 갯수가 13,714개에서 1,838개로 줄어다는 것을 알 수 있습니다.</p>
</section>
<section id="umap-그리기" class="level2">
<h2 class="anchored" data-anchor-id="umap-그리기">UMAP 그리기</h2>
<div id="cell-8" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># UMAP 시각화</span></span>
<span id="cb9-2">sc.pl.umap(</span>
<span id="cb9-3">    adata,</span>
<span id="cb9-4">    color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"leiden"</span>,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 클러스터링 결과에 따라 색상 지정</span></span>
<span id="cb9-5">    add_outline<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 클러스터 경계 추가</span></span>
<span id="cb9-6">    legend_loc<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"on data"</span>,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 범례 위치 설정</span></span>
<span id="cb9-7">    legend_fontsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 범례 글꼴 크기 설정</span></span>
<span id="cb9-8">    legend_fontoutline<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 범례 글꼴 외곽선 굵기 설정</span></span>
<span id="cb9-9">    frameon<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">False</span>,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 테두리 제거</span></span>
<span id="cb9-10">    palette<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Set1"</span>,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 색상 팔레트 설정</span></span>
<span id="cb9-11">)</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://tomorrow-lab.github.io/posts/scRNAseq/python_scRNA_AnnData_mtx_files/figure-html/cell-5-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>이 데이터셋은 이미 많이 알려진 것이라. 클러스터에 대한 마커 유전자를 찾고 어떤 세포인지 알아내는 과정은 생략하겠습니다.</p>
<p>아래와 같이 수동으로 이름을 지정해줍니다. 숫자로 표시되는 각각의 클러스터에 대하여 아래 코드를 통해 이름을 붙여줍니다.</p>
<div id="cell-10" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1">new_cluster_names <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [</span>
<span id="cb10-2">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"CD4T"</span>,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># CD4T 세포</span></span>
<span id="cb10-3">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Monocytes"</span>,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 단핵구</span></span>
<span id="cb10-4">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"CD8T"</span>,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># CD8T 세포</span></span>
<span id="cb10-5">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"B cells"</span>,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># B 세포</span></span>
<span id="cb10-6">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Dendritic"</span>,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 수상돌기세포</span></span>
<span id="cb10-7">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Megakaryocytes"</span>,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 거대혈소판세포</span></span>
<span id="cb10-8">]</span>
<span id="cb10-9">adata.rename_categories(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"leiden"</span>, new_cluster_names)</span>
<span id="cb10-10"></span>
<span id="cb10-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 클러스터링된 세포의 UMAP 다시 시각화</span></span>
<span id="cb10-12">sc.pl.umap(</span>
<span id="cb10-13">    adata,</span>
<span id="cb10-14">    color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"leiden"</span>,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 클러스터링 결과에 따라 색상 지정</span></span>
<span id="cb10-15">    add_outline<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 클러스터 경계 추가</span></span>
<span id="cb10-16">    legend_loc<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"on data"</span>,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 범례 위치 설정</span></span>
<span id="cb10-17">    legend_fontsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 범례 글꼴 크기 설정</span></span>
<span id="cb10-18">    legend_fontoutline<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 범례 글꼴 외곽선 굵기 설정</span></span>
<span id="cb10-19">    frameon<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">False</span>,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 테두리 제거</span></span>
<span id="cb10-20">    palette<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Set1"</span>,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 색상 팔레트 설정</span></span>
<span id="cb10-21">)</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://tomorrow-lab.github.io/posts/scRNAseq/python_scRNA_AnnData_mtx_files/figure-html/cell-6-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>이후 데이터를 다시 읽어왔을때와 동일한지 확인하기 위해 <code>adata</code> 객체에 포함되어 있는 메타데이터의 데이터형을 확인합니다.</p>
<div id="cell-12" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># adata 메타데이터의 데이터 타입</span></span>
<span id="cb11-2">adata.obs.dtypes</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="6">
<pre><code>n_genes                 int64
n_genes_by_counts       int32
total_counts          float32
total_counts_mt       float32
pct_counts_mt         float32
leiden               category
dtype: object</code></pre>
</div>
</div>
</section>
<section id="h5ad-파일로-저장하기" class="level2">
<h2 class="anchored" data-anchor-id="h5ad-파일로-저장하기">H5AD 파일로 저장하기</h2>
<p>AnnData 객체를 저장할때는 H5AD(Hierarchical Data Format 5) 파일을 사용합니다. 이 파일 형식은 대용량 데이터셋의 주요 구성 요소(예: 표현형 데이터, 주석, 메타데이터)를 계층적으로 구조화해서 효율적으로 저장하고 처리할 수 있게 해 줍니다.</p>
<div id="cell-14" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 분석 결과를 저장할 파일 경로</span></span>
<span id="cb13-2">output_path <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"../output/pbmc3k/"</span></span>
<span id="cb13-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># `compression='gzip'`는 디스크 공간을 절약하지만 쓰기와 이후의 읽기가 약간 느려집니다.</span></span>
<span id="cb13-4">adata.write(output_path <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pbmc3k.h5ad"</span>, compression<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gzip"</span>)</span></code></pre></div>
</div>
</section>
<section id="h5ad-파일-다시-불러오기" class="level2">
<h2 class="anchored" data-anchor-id="h5ad-파일-다시-불러오기">H5AD 파일 다시 불러오기</h2>
<p><code>sc.read_h5ad</code> 함수는 H5AD 파일 형식을 AnnData 객체로 직접 불러옵니다.</p>
<div id="cell-16" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 저장했던 h5ad파일을 다시 불러옵니다.</span></span>
<span id="cb14-2">adata <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> sc.read_h5ad(output_path <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pbmc3k.h5ad"</span>)</span>
<span id="cb14-3">adata</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="8">
<pre><code>AnnData object with n_obs × n_vars = 2638 × 1838
    obs: 'n_genes', 'n_genes_by_counts', 'total_counts', 'total_counts_mt', 'pct_counts_mt', 'leiden'
    var: 'gene_ids', 'n_cells', 'mt', 'n_cells_by_counts', 'mean_counts', 'pct_dropout_by_counts', 'total_counts', 'highly_variable', 'means', 'dispersions', 'dispersions_norm', 'mean', 'std'
    uns: 'hvg', 'leiden', 'leiden_colors', 'log1p', 'neighbors', 'pca', 'umap'
    obsm: 'X_pca', 'X_umap'
    varm: 'PCs'
    obsp: 'connectivities', 'distances'</code></pre>
</div>
</div>
<p>데이터를 다시 불러와보니 유전자의 갯수가 1,838개입니다. <code>highly variable</code> 유전자가 아닌 원래 유전자 데이터로 되돌리려면 아래와 같이 해줍니다.</p>
<div id="cell-18" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># AnnData 객체를 불러온 후 원시 데이터로 변환</span></span>
<span id="cb16-2">adata <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> adata.raw.to_adata()</span>
<span id="cb16-3">adata</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="9">
<pre><code>AnnData object with n_obs × n_vars = 2638 × 13714
    obs: 'n_genes', 'n_genes_by_counts', 'total_counts', 'total_counts_mt', 'pct_counts_mt', 'leiden'
    var: 'gene_ids', 'n_cells', 'mt', 'n_cells_by_counts', 'mean_counts', 'pct_dropout_by_counts', 'total_counts', 'highly_variable', 'means', 'dispersions', 'dispersions_norm'
    uns: 'hvg', 'leiden', 'leiden_colors', 'log1p', 'neighbors', 'pca', 'umap'
    obsm: 'X_pca', 'X_umap'
    obsp: 'connectivities', 'distances'</code></pre>
</div>
</div>
<p>이제 유전자의 갯수가 13,714개로 돌아왔습니다.</p>
</section>
</section>
<section id="anndata-to-mtx" class="level1">
<h1><code>AnnData</code> to <code>mtx</code></h1>
<p><code>10x format</code> 으로 저장하는 방법은 아래와 같습니다.</p>
<div id="cell-20" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb18" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># genes.tsv 로 유전자 정보 저장</span></span>
<span id="cb18-2">df_genes <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> adata.var.gene_ids.reset_index()</span>
<span id="cb18-3">df_genes.set_index(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gene_ids"</span>).to_csv(</span>
<span id="cb18-4">    output_path <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"genes.tsv"</span>,</span>
<span id="cb18-5">    sep<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\t</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>,</span>
<span id="cb18-6">    index<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>,</span>
<span id="cb18-7">    header<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">False</span>,</span>
<span id="cb18-8">)</span>
<span id="cb18-9"></span>
<span id="cb18-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># barcodes.tsv 로 저장</span></span>
<span id="cb18-11">pd.DataFrame(adata.obs.index).to_csv(</span>
<span id="cb18-12">    output_path <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"barcodes.tsv"</span>,</span>
<span id="cb18-13">    sep<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\t</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>,</span>
<span id="cb18-14">    index<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">False</span>,</span>
<span id="cb18-15">    header<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">False</span>,</span>
<span id="cb18-16">)</span>
<span id="cb18-17"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># UMAP 좌표 저장</span></span>
<span id="cb18-18">pd.DataFrame(adata.obsm[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"X_umap"</span>], index<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>adata.obs_names).to_csv(</span>
<span id="cb18-19">    output_path <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"UMAP.tsv"</span>,</span>
<span id="cb18-20">    sep<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\t</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>,</span>
<span id="cb18-21">    index<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>,</span>
<span id="cb18-22">    header<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>,</span>
<span id="cb18-23">)</span>
<span id="cb18-24"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 메타 데이터 저장</span></span>
<span id="cb18-25">adata.obs.to_csv(</span>
<span id="cb18-26">    output_path <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"metadata.tsv"</span>,</span>
<span id="cb18-27">    sep<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\t</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>,</span>
<span id="cb18-28">    index<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>,</span>
<span id="cb18-29">)</span>
<span id="cb18-30"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># mtx 희소 행렬 저장, Transpose 필요</span></span>
<span id="cb18-31">scipy.io.mmwrite(output_path <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"matrix.mtx"</span>, adata.X.T)</span></code></pre></div>
</div>
<p><code>output_path</code>에 파일이 5개 생겼을 것입니다.</p>
</section>
<section id="다시-mtx-to-anndata" class="level1">
<h1>다시 <code>mtx</code> to <code>AnnData</code></h1>
<p>다시 <code>10x format</code> 데이터를 읽어서 <code>AnnData</code>객체를 만들어 봅니다. 2가지 방법으로 해보겠습니다. 첫번째는 기존에 <code>read_10x_mtx()</code>함수를 사용하는 방법이고 두번째는 수작업으로 각각의 데이터를 합치는 방법입니다.</p>
<section id="read_10x_mtx함수-사용" class="level2">
<h2 class="anchored" data-anchor-id="read_10x_mtx함수-사용"><code>read_10x_mtx()</code>함수 사용</h2>
<p>만약 다른 분석 도구를 통해 처리된 데이터의 경우라면 그리 추천하지는 않는 방법입니다.</p>
<div id="cell-22" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 데이터 읽기</span></span>
<span id="cb19-2">adata <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> sc.read_10x_mtx(</span>
<span id="cb19-3">    output_path,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># `.mtx` 파일이 있는 디렉토리</span></span>
<span id="cb19-4">    var_names<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gene_symbols"</span>,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 변수 이름에 유전자 기호 사용 (변수 축 인덱스)</span></span>
<span id="cb19-5">)</span>
<span id="cb19-6"></span>
<span id="cb19-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># `sc.read_10x_mtx`에서 `var_names='gene_ids'`를 사용하는 경우 이 작업이 필요하지 않음</span></span>
<span id="cb19-8">adata.var_names_make_unique()</span>
<span id="cb19-9">adata</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="11">
<pre><code>AnnData object with n_obs × n_vars = 2638 × 13714
    var: 'gene_ids'</code></pre>
</div>
</div>
<p><code>adata.var</code> 출력을 확인해 정상적으로 유전자 이름을 불러왔는지도 확인합니다.</p>
<div id="cell-24" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb21" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1">adata.var</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="12">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">gene_ids</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">AL627309.1</td>
<td>ENSG00000237683</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">AP006222.2</td>
<td>ENSG00000228463</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">RP11-206L10.2</td>
<td>ENSG00000228327</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">RP11-206L10.9</td>
<td>ENSG00000237491</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">LINC00115</td>
<td>ENSG00000225880</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">AC145212.1</td>
<td>ENSG00000215750</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">AL592183.1</td>
<td>ENSG00000220023</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">AL354822.1</td>
<td>ENSG00000215615</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">PNRC2-1</td>
<td>ENSG00000215700</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">SRSF10-1</td>
<td>ENSG00000215699</td>
</tr>
</tbody>
</table>

<p>13714 rows × 1 columns</p>
</div>
</div>
</div>
<p>기존에 작업한 메타데이터와 UMAP 좌표 정보도 불러옵니다.</p>
<div id="cell-26" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb22" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 세포 메타데이터 불러오기</span></span>
<span id="cb22-2">cell_meta <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.read_csv(output_path <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"metadata.tsv"</span>, sep<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\t</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>, index_col<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb22-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># AnnData 객체에 메타데이터 및 변수 이름 설정</span></span>
<span id="cb22-4">adata.obs <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> cell_meta</span>
<span id="cb22-5"></span>
<span id="cb22-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># UMAP 데이터 불러오기</span></span>
<span id="cb22-7">umap <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.read_csv(</span>
<span id="cb22-8">    output_path <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"UMAP.tsv"</span>,</span>
<span id="cb22-9">    sep<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\t</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>,</span>
<span id="cb22-10">    index_col<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb22-11">)</span>
<span id="cb22-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># UMAP 데이터 설정</span></span>
<span id="cb22-13">adata.obsm[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"X_umap"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> umap.loc[adata.obs.index].values</span>
<span id="cb22-14">adata</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="13">
<pre><code>AnnData object with n_obs × n_vars = 2638 × 13714
    obs: 'n_genes', 'n_genes_by_counts', 'total_counts', 'total_counts_mt', 'pct_counts_mt', 'leiden'
    var: 'gene_ids'
    obsm: 'X_umap'</code></pre>
</div>
</div>
<p>위 결과를 통해 정상적으로 데이터를 불러왔음을 확인 할 수 있습니다.</p>
</section>
<section id="read_10x_mtx가-아닌-수작업을-통한-방법" class="level2">
<h2 class="anchored" data-anchor-id="read_10x_mtx가-아닌-수작업을-통한-방법"><code>read_10x_mtx</code>가 아닌 수작업을 통한 방법</h2>
<p>수작업을 통해 만드는 방법을 해봅니다. <code>10x format</code>과 동일하지는 않지만 유사한 형태의 경우에는 이 방법이 유용합니다.</p>
<div id="cell-28" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb24" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># mtx 희소 행렬 불러오기</span></span>
<span id="cb24-2">X <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> mmread(output_path <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"matrix.mtx"</span>)</span>
<span id="cb24-3"></span>
<span id="cb24-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># AnnData 객체 생성</span></span>
<span id="cb24-5">adata <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> anndata.AnnData(X<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>X.transpose().tocsr())</span>
<span id="cb24-6"></span>
<span id="cb24-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 세포 메타데이터 불러오기</span></span>
<span id="cb24-8">cell_meta <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.read_csv(output_path <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"metadata.tsv"</span>, sep<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\t</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>, index_col<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb24-9"></span>
<span id="cb24-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 유전자 이름 불러오기</span></span>
<span id="cb24-11">gene_names <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.read_csv(</span>
<span id="cb24-12">    output_path <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"genes.tsv"</span>,</span>
<span id="cb24-13">    sep<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\t</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>,</span>
<span id="cb24-14">    index_col<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>,</span>
<span id="cb24-15">    header<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>,</span>
<span id="cb24-16">    names<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gene_ids"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gene_symbols"</span>],</span>
<span id="cb24-17">)</span>
<span id="cb24-18"></span>
<span id="cb24-19"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 바코드 불러오기</span></span>
<span id="cb24-20">barcodes <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.read_csv(</span>
<span id="cb24-21">    input_path <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"barcodes.tsv"</span>,</span>
<span id="cb24-22">    sep<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\t</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>,</span>
<span id="cb24-23">    index_col<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb24-24">    header<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>,</span>
<span id="cb24-25">)</span>
<span id="cb24-26"></span>
<span id="cb24-27"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># AnnData 객체에 메타데이터 및 변수 이름 설정</span></span>
<span id="cb24-28">adata.obs <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> cell_meta</span>
<span id="cb24-29">adata.obs.index <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">list</span>(barcodes.index)</span>
<span id="cb24-30">adata.var.index <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> gene_names[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gene_symbols"</span>].values</span>
<span id="cb24-31">adata.var[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gene_ids"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> gene_names[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gene_ids"</span>].values</span>
<span id="cb24-32"></span>
<span id="cb24-33"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># UMAP 데이터 불러오기</span></span>
<span id="cb24-34">umap <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.read_csv(</span>
<span id="cb24-35">    output_path <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"UMAP.tsv"</span>,</span>
<span id="cb24-36">    sep<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\t</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>,</span>
<span id="cb24-37">    index_col<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb24-38">)</span>
<span id="cb24-39"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># UMAP 데이터 설정</span></span>
<span id="cb24-40">adata.obsm[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"X_umap"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> umap.loc[adata.obs.index].values</span>
<span id="cb24-41"></span>
<span id="cb24-42"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># adata 데이터 확인</span></span>
<span id="cb24-43">adata</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="14">
<pre><code>AnnData object with n_obs × n_vars = 2638 × 13714
    obs: 'n_genes', 'n_genes_by_counts', 'total_counts', 'total_counts_mt', 'pct_counts_mt', 'leiden'
    var: 'gene_ids'
    obsm: 'X_umap'</code></pre>
</div>
</div>
<section id="메타-데이터의-데이터형-확인하기" class="level3">
<h3 class="anchored" data-anchor-id="메타-데이터의-데이터형-확인하기">메타 데이터의 데이터형 확인하기</h3>
<p>위의 방법을 통해 메타 데이터를 불러오면 데이터의 형이 잘못 지정되는 경우가 있습니다.</p>
<div id="cell-30" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb26" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># adata.obs의 데이터 타입 확인</span></span>
<span id="cb26-2">adata.obs.dtypes</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="15">
<pre><code>n_genes                int64
n_genes_by_counts      int64
total_counts         float64
total_counts_mt      float64
pct_counts_mt        float64
leiden                object
dtype: object</code></pre>
</div>
</div>
<p>예를 들면 <code>leiden</code> 클러스터는 기본적으로 숫자로 지정되는데 다시 불러오는 과정 중에 <code>category</code>가 아닌 <code>int</code>형으로 되는 경우가 있습니다. 이번에는 <code>object</code>로 되어 있습니다. 아래와 같이 <code>category</code>로 수정해줍니다.</p>
<div id="cell-32" class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb28" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># adata.obs의 'leiden' 열을 범주형으로 변환한 후 데이터 타입 확인</span></span>
<span id="cb28-2">adata.obs.astype({<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"leiden"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"category"</span>}).dtypes</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="16">
<pre><code>n_genes                 int64
n_genes_by_counts       int64
total_counts          float64
total_counts_mt       float64
pct_counts_mt         float64
leiden               category
dtype: object</code></pre>
</div>
</div>
<p>UMAP을 그려서 마지막으로 확인해 봅니다.</p>
<div id="cell-34" class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb30" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># UMAP 시각화</span></span>
<span id="cb30-2">sc.pl.umap(</span>
<span id="cb30-3">    adata,</span>
<span id="cb30-4">    color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"leiden"</span>,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 클러스터링 결과에 따라 색상 지정</span></span>
<span id="cb30-5">    add_outline<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 클러스터 경계 추가</span></span>
<span id="cb30-6">    legend_loc<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"on data"</span>,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 범례 위치 설정</span></span>
<span id="cb30-7">    legend_fontsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 범례 글꼴 크기 설정</span></span>
<span id="cb30-8">    legend_fontoutline<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 범례 글꼴 외곽선 굵기 설정</span></span>
<span id="cb30-9">    frameon<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">False</span>,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 테두리 제거</span></span>
<span id="cb30-10">    palette<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Set1"</span>,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 색상 팔레트 설정</span></span>
<span id="cb30-11">)</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://tomorrow-lab.github.io/posts/scRNAseq/python_scRNA_AnnData_mtx_files/figure-html/cell-18-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>UMAP이 문제없이 재현되는 것을 확인 할 수 있습니다.</p>
</section>
</section>
</section>
<section id="나가며" class="level1">
<h1>나가며</h1>
<p>단일세포 RNA 시퀀싱(scRNA-seq) 분야는 빠르게 발전하고 있지만, 여전히 표준화되지 않은 측면이 많습니다. 이는 여러 이유로 설명될 수 있습니다. 그 중에서도 표준화된 프로토콜을 개발하기가 어렵다는 것이 큰 이유라고 생각합니다.</p>
<p>따라서, 현재는 위에서 살펴본 방법처럼 가장 단순한 <code>mtx</code>으로 되돌리는 방법을 통해 데이터를 변환하는 것이 최선으로 보여집니다.</p>


</section>

 ]]></description>
  <category>python</category>
  <category>scRNA</category>
  <category>scanpy</category>
  <category>cellranger</category>
  <category>10x genomics</category>
  <guid>https://tomorrow-lab.github.io/posts/scRNAseq/python_scRNA_AnnData_mtx.html</guid>
  <pubDate>Wed, 20 Mar 2024 15:00:00 GMT</pubDate>
</item>
<item>
  <title>의존성 지옥에서 당신을 구하러 온 Pixi</title>
  <dc:creator>Taeyoon kim</dc:creator>
  <link>https://tomorrow-lab.github.io/posts/prefix_pixi/prefix_pixi.html</link>
  <description><![CDATA[ 




<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://tomorrow-lab.github.io/posts/prefix_pixi/thumbnail.svg" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:50.0%"></p>
</figure>
</div>
<section id="들어가며" class="level1">
<h1>들어가며</h1>
<p>파이썬 의존성 문제는 프로젝트가 의존하는 패키지들 간의 충돌, 버전 관리의 어려움, 시스템 환경에 따른 호환성 문제 등으로 나타납니다. 다음과 같은 상황에서 의존성 지옥이 발생할 수 있습니다.</p>
<ul>
<li><p>의존성 충돌: 프로젝트가 여러 개의 패키지를 사용하며, 각 패키지들이 서로 다른 버전의 의존성을 가질 때 발생합니다. 이로 인해 충돌이 발생하고, 프로젝트의 실행이나 빌드가 실패할 수 있습니다.</p></li>
<li><p>의존성 업데이트: 새로운 기능을 추가하거나 버그를 수정하기 위해 의존성을 업데이트할 때, 다른 패키지들과의 호환성 문제가 발생할 수 있습니다. 특히, 다른 패키지들이 특정 버전에 의존하는 경우에는 업데이트가 어려울 수 있습니다.</p></li>
<li><p>환경 별 차이: 개발 환경, 테스트 환경, 프로덕션 환경 등 각각의 환경에서는 다른 의존성이 필요할 수 있습니다. 이로 인해 각 환경마다 의존성을 관리하는 것이 복잡해질 수 있습니다.</p></li>
</ul>
<p>의존성 지옥을 겪지 않고 싶다면 파이썬 의존성 관리 도구를 활용해 각 프로젝트의 의존성을 격리해서 관리 해야 합니다.</p>
<section id="기존의-의존성-관리-도구" class="level2">
<h2 class="anchored" data-anchor-id="기존의-의존성-관리-도구">기존의 의존성 관리 도구</h2>
<ul>
<li><code>pip</code>: 파이썬의 기본 패키지 관리자로, 패키지 설치 및 관리에 사용됩니다.</li>
<li><code>venv</code>: Python 3.3 이후부터 기본적으로 제공되는 가상 환경 생성 도구로 프로젝트별로 독립된 가상 환경을 만들어주는 도구로, 각 프로젝트의 의존성을 분리하여 관리할 수 있습니다.</li>
<li><code>pipenv</code>: <code>Pipfile</code>과 <code>Pipfile.lock</code> 파일을 사용하여 의존성을 관리하는 도구로, 가상 환경과 패키지 설치를 함께 처리합니다.</li>
<li><code>poetry</code>: 프로젝트의 의존성 및 버전 관리, 패키지 빌드 및 배포 등을 지원하는 도구로, 편리한 프로젝트 관리를 제공합니다.</li>
<li><code>conda</code>: 데이터 과학 및 기계 학습을 위한 패키지 관리 및 환경 관리 도구로, 파이썬 패키지 외에도 다양한 라이브러리 및 도구를 관리할 수 있습니다.</li>
</ul>
</section>
<section id="새로운-의존성-관리-도구" class="level2">
<h2 class="anchored" data-anchor-id="새로운-의존성-관리-도구">새로운 의존성 관리 도구</h2>
<p><a href="https://prefix.dev/">Pixi</a>는 기존의 <code>conda</code> 생태계 위에 구축된 빠른 소프트웨어 패키지 매니저로 <code>Windows</code>, <code>macOS</code> 및 <code>Linux</code>에서 신속하게 개발 환경을 구축하는데 적합합니다. 심지어 <code>Docker</code> 없이도 운영 체제 간 재현 가능한 환경을 생성하며 <code>Python</code>, <code>R</code>, <code>C/C++</code>, <code>Rust</code>, <code>Ruby</code> 및 기타 많은 언어를 지원합니다.</p>
<blockquote class="blockquote">
<p>무엇보다도 <strong>빠르다</strong>는 것이 큰 장점입니다.</p>
</blockquote>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p><code>Pixi</code>는 활발하게 개발되고 있기 때문에 아래의 명령어가 변경될 가능성이 있습니다.</p>
</div>
</div>
</section>
</section>
<section id="설치하기" class="level1">
<h1>설치하기</h1>
<p>공식 홈페이지에서는 아래 명령어를 통해 설치하는 것을 추천합니다. 하지만 저는 <a href="https://brew.sh/">Homebrew</a>를 통해서 설치하는 것을 선호합니다. <code>brew install pixi</code>를 터미널에 입력하면 간단하게 할 수 있습니다. 물론 사전에 <code>Homebrew</code>를 해둔 상태에서 말이죠.</p>
<section id="리눅스-혹은-맥" class="level2">
<h2 class="anchored" data-anchor-id="리눅스-혹은-맥">리눅스 혹은 맥</h2>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">❯</span> curl <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-fsSL</span> https://pixi.sh/install.sh <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">|</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">bash</span></span></code></pre></div>
<p>위의 명령은 자동으로 최신 버전의 <code>pixi</code>를 다운로드해 <code>~/.pixi/bin</code>에 설치합니다. 또한 <code>~/.bash_profile</code>을 업데이트해 어디에서나 <code>pixi</code> 명령을 실행할 수 있도록 합니다.</p>
</section>
<section id="윈도우즈" class="level2">
<h2 class="anchored" data-anchor-id="윈도우즈">윈도우즈</h2>
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb2-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">iwr</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-useb</span> https://pixi.sh/install.ps1 <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">iex</span></span></code></pre></div>
<p>위의 명령은 자동으로 최신 버전의 <code>pixi</code>를 다운로드해 <code>LocalAppData/pixi/bin</code>에 설치합니다. 또한 <code>LocalAppData/pixi/bin</code>을 자동으로 경로에 추가하여 어디에서나 <code>pixi</code>를 호출할 수 있게 합니다.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>설치가 끝나고 바로 사용하려면 터미널을 다시 시작해야 합니다.</p>
</div>
</div>
</section>
</section>
<section id="삭제하기" class="level1">
<h1>삭제하기</h1>
<section id="리눅스-혹은-맥-1" class="level2">
<h2 class="anchored" data-anchor-id="리눅스-혹은-맥-1">리눅스 혹은 맥</h2>
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb3-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">❯</span> rm ~/.pixi/bin/pixi</span></code></pre></div>
<p>이 명령 이후에도 여전히 <code>pixi</code>로 설치한 패키지를 사용할 수 있습니다. 이를 제거하려면 <code>~/.pixi</code> 전체 디렉토리를 삭제하면 됩니다.</p>
</section>
<section id="윈도우즈-1" class="level2">
<h2 class="anchored" data-anchor-id="윈도우즈-1">윈도우즈</h2>
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb4-1"><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$PIXI_BIN</span> = <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$Env</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">:LocalAppData\pixi\bin\pixi"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">;</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Remove-Item</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-Path</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$PIXI_BIN</span></span></code></pre></div>
</section>
</section>
<section id="기본-사용법" class="level1">
<h1>기본 사용법</h1>
<section id="가상환경-만들기" class="level2">
<h2 class="anchored" data-anchor-id="가상환경-만들기">가상환경 만들기</h2>
<p>새로운 프로젝트를 시작할 때는 다음 명령어를 사용합니다.</p>
<div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb5-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">❯</span> pixi init hello-world</span>
<span id="cb5-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">❯</span> cd hello-word</span></code></pre></div>
<p>그러면 아래와 같은 3개의 파일이 생성됩니다.</p>
<div class="sourceCode" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb6-1"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">.</span></span>
<span id="cb6-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> .gitattributes</span>
<span id="cb6-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> .gitignore</span>
<span id="cb6-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">└──</span> pixi.toml</span>
<span id="cb6-5"></span>
<span id="cb6-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">0</span> directories, 3 files</span></code></pre></div>
<ul>
<li><code>pixi.toml</code>에 의존성 패키지 정보가 저장되게 됩니다.</li>
</ul>
</section>
<section id="의존성-추가" class="level2">
<h2 class="anchored" data-anchor-id="의존성-추가">의존성 추가</h2>
<p>원하는 패키지는 아래 명령어로 추가합니다. <a href="https://prefix.dev/">Prefix.dev</a>에서 검색을 통해 지원되는 패키지와 명령어를 확인할 수 있습니다.</p>
<div class="sourceCode" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb7-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">❯</span> pixi add python==3.10</span>
<span id="cb7-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">✔</span> Added python 3.10</span></code></pre></div>
<p>위 명령어를 실행하면 1개의 폴더(<code>.pixi</code>)와 <code>pixi.lock</code>이 생성되는 것을 알수 있습니다. <code>.pixi</code>폴더는 설치한 패키지들이 저장되는 곳이고 <code>pixi.lock</code>은 현재 프로젝트의 종속성 및 버전을 정확하게 기록한 파일입니다.</p>
<div class="sourceCode" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb8-1"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">.</span></span>
<span id="cb8-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> .gitattributes</span>
<span id="cb8-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> .gitignore</span>
<span id="cb8-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> .pixi</span>
<span id="cb8-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> pixi.lock</span>
<span id="cb8-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">└──</span> pixi.toml</span>
<span id="cb8-7"></span>
<span id="cb8-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">1</span> directory, 4 files</span></code></pre></div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p><code>pixi.lock</code>파일은 <code>pixi add</code>를 실행하거나 수동으로 <code>pixi.toml</code> 파일을 변경한 뒤 <code>pixi install</code>을 실행할 때 생성됩니다.</p>
</div>
</div>
<section id="채널-추가하기" class="level3">
<h3 class="anchored" data-anchor-id="채널-추가하기">채널 추가하기</h3>
<p><code>pixi</code>는 기본적으로 <code>conda-forge</code>를 기본 패키지 채널로 씁니다. 가끔 <code>conda-forge</code>에 해당 패키지가 없다면 아래와 같이 다른 채널을 추가하면 됩니다.</p>
<pre class="shell"><code>➜ pixi project channel add bioconda
✔ Added bioconda (https://conda.anaconda.org/bioconda/)

❯ pixi add anndata2ri
✔ Added anndata2ri</code></pre>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>아직 패키지 별로 채널을 선택해서 패키지를 설치하는 명령어는 없는 것으로 보입니다. 그러니 당분간은 위의 명령어를 사용할 수 밖에 없습니다.</p>
</div>
</div>
</section>
<section id="pypi-의존성-추가" class="level3">
<h3 class="anchored" data-anchor-id="pypi-의존성-추가">PyPI 의존성 추가</h3>
<p><a href="https://prefix.dev/">Prefix.dev</a>에서 찾을 수 없는 파이썬 패키지의 경우 <code>pixi add --pypi [패키지이름]</code>으로 설치 할 수 있습니다.</p>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p>현재 이 기능은 베타 버전입니다.</p>
</div>
</div>
</section>
</section>
<section id="패키지-설치하기" class="level2">
<h2 class="anchored" data-anchor-id="패키지-설치하기">패키지 설치하기</h2>
<p><code>pixi add</code> 명령어는 기본적으로 <code>pixi.toml</code> 파일에 패키지 이름을 추가하는 역할을 합니다. 보통은 동시에 <code>pixi.lock</code>파일도 업데이트가 됩니다. 그렇지 않은 경우에는 <code>pixi install</code> 명령어를 사용하면 업데이트와 설치가 동시에 됩니다. 그냥 항상 습관적으로 입력하세요.</p>
<div class="sourceCode" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb10-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">❯</span> pixi install</span></code></pre></div>
</section>
<section id="패키지-삭제하기" class="level2">
<h2 class="anchored" data-anchor-id="패키지-삭제하기">패키지 삭제하기</h2>
<p>설치한 패키지를 삭제하는 것은 2가지 방법이 있습니다. 두 번째 방법이 안되면 첫 번째방법으로 해보세요.</p>
<ol type="1">
<li><code>pixi.toml</code>파일을 수정하고 <code>pixi install</code>명령어 입력하기</li>
<li><code>pixi remove [패키지]</code> 명령어 사용하기</li>
</ol>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>PyPI로 설치한 패키지는 <code>pixi remove --pypi [패키지]</code>로 삭제할 수 있습니다.</p>
</div>
</div>
</section>
<section id="실행하기" class="level2">
<h2 class="anchored" data-anchor-id="실행하기">실행하기</h2>
<section id="shell-실행" class="level3">
<h3 class="anchored" data-anchor-id="shell-실행">shell 실행</h3>
<div class="sourceCode" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb11-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">❯</span> pixi shell</span></code></pre></div>
</section>
<section id="명령어-실행" class="level3">
<h3 class="anchored" data-anchor-id="명령어-실행">명령어 실행</h3>
<p><code>pixi run [명령어]</code> 형식으로 실행하면 됩니다.</p>
<div class="sourceCode" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb12-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">❯</span> pixi run python <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--version</span></span>
<span id="cb12-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Python</span> 3.10.0</span></code></pre></div>
</section>
</section>
<section id="파일로-의존성-저장하기" class="level2">
<h2 class="anchored" data-anchor-id="파일로-의존성-저장하기">파일로 의존성 저장하기</h2>
<p>아직 명령어로 지원하고 있지 않습니다. 하지만 아래와 같이 <code>conda</code> 명령어로 우회할 수 있습니다.</p>
<div class="sourceCode" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb13-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">❯</span> pixi run conda env export <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-f</span> env.yml</span></code></pre></div>
</section>
<section id="yml-파일에서-의존성-불러오기" class="level2">
<h2 class="anchored" data-anchor-id="yml-파일에서-의존성-불러오기"><code>.yml</code> 파일에서 의존성 불러오기</h2>
<div class="sourceCode" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb14-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">❯</span> pixi init <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--import</span> environment.yml</span></code></pre></div>
<p>환경을 가져올 때, 환경 파일에서 종속성이 있는 <code>pixi.toml</code>이 생성됩니다. 다만 <code>pip</code> 패키지의 종속성으로 <code>git+URL</code>을 지원하지 않습니다.</p>
</section>
<section id="가상환경-삭제" class="level2">
<h2 class="anchored" data-anchor-id="가상환경-삭제">가상환경 삭제</h2>
<p>`</p>
<p>아직 명령어로 지원하고 있지 않습니다. 프로젝트 폴더 전체를 삭제하거나 <code>pixi</code>와 연관된 파일을 삭제하는 방법으로 우회합니다.</p>
<div class="sourceCode" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb15-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">❯</span> rm <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-rf</span> .pixi</span>
<span id="cb15-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">❯</span> rm pixi.toml </span>
<span id="cb15-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">❯</span> rm pixi.lock</span></code></pre></div>
</section>
</section>
<section id="pixi-삭제하기" class="level1">
<h1>Pixi 삭제하기</h1>
<p>저처럼 <code>brew</code> 명령어로 설치를 했다면 <code>brew uninstall pixi</code>로 간단하게 할 수 있습니다. 그렇지 않더라도 시스템에서 <code>pixi</code>를 제거하려면, 단순히 바이너리를 삭제하는 아래 명령어를 사용하면 됩니다. 다만 아래 명령어를 실행한 후에도, <code>pixi</code>로 설치한 도구들은 계속 사용할 수 있습니다. 이것들도 함께 제거하고 싶다면, <code>~/.pixi</code> 디렉토리 전체를 삭제하고, 사용하는 쉘의 설정 파일에서 해당 경로를 삭제하면 됩니다.</p>
<section id="리눅스와-맥" class="level2">
<h2 class="anchored" data-anchor-id="리눅스와-맥">리눅스와 맥</h2>
<div class="sourceCode" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb16-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">❯</span> rm ~/.pixi/bin/pixi</span></code></pre></div>
</section>
<section id="윈도우즈-2" class="level2">
<h2 class="anchored" data-anchor-id="윈도우즈-2">윈도우즈</h2>
<div class="sourceCode" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode powershell code-with-copy"><code class="sourceCode powershell"><span id="cb17-1"><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$PIXI_BIN</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$Env</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">LocalAppData</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">\pixi\bin\pixi"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">Remove-Item</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>Path <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$PIXI_BIN</span></span></code></pre></div>
</section>
</section>
<section id="마치며" class="level1">
<h1>마치며</h1>
<p>이것 말고도 <code>Pixi</code>에는 아주 많은 기능이 있습니다. 그러니 이 참에 <a href="https://pixi.sh/latest/basic_usage/">공식문서</a>를 한번 읽어보고 사용해보세요.</p>


</section>

 ]]></description>
  <category>python</category>
  <category>mamba</category>
  <category>anaconda</category>
  <category>conda</category>
  <category>pixi</category>
  <category>R</category>
  <guid>https://tomorrow-lab.github.io/posts/prefix_pixi/prefix_pixi.html</guid>
  <pubDate>Tue, 27 Feb 2024 15:00:00 GMT</pubDate>
</item>
<item>
  <title>scRNA-seq 데이터 QC하기</title>
  <dc:creator>Taeyoon kim</dc:creator>
  <link>https://tomorrow-lab.github.io/posts/scRNAseq/python_scRNA_QC.html</link>
  <description><![CDATA[ 




<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://tomorrow-lab.github.io/posts/scRNAseq/Scanpy_logo.svg" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:50.0%"></p>
</figure>
</div>
<section id="데이터-품질-관리의-목적" class="level1">
<h1>데이터 품질 관리의 목적</h1>
<p>scRNA-seq 데이터에는 두 가지 중요한 특성이 있습니다. 첫째, scRNA-seq 데이터는 드롭아웃이 발생하는데, 이는 mRNA으로 인해 데이터에 0이 과도하게 많다는 것을 의미합니다. 둘째, 생물학적 복잡성으로 인해 얻은 데이터를 보정하고 품질 관리에 제한이 존재합니다. 따라서 생물학적 의미를 과하게 보정하거나 제거하지 않으면서 적합한 전처리 방법을 선택하는 것이 중요합니다. 예를 들어, 품질 관리 중에 너무 많은 세포를 걸러내면 희귀한 세포 집단을 놓칠 수 있습니다. 반대로 품질이 좋지 않은 세포를 제외하지 않으면 세포에 주석을 달기가 어려울 수 있습니다. 이 문서에서는 이러한 위험을 제거하고 고품질 데이터를 얻는 방법과 결과에 대해 설명합니다.</p>
</section>
<section id="카운트-행렬-데이터-불러오기" class="level1">
<h1>카운트 행렬 데이터 불러오기</h1>
<p>시작점은 <code>cellranger</code>를 통해 얻은 카운트 행렬(count matrix) 데이터 입니다. 카운트 행렬은 분자 식별자(UMI)로 구별된 바코드 X 각 유전자의 수로 구성된 표입니다.</p>
<blockquote class="blockquote">
<p>분자 식별자가 잘못 붙어 있을 수도 있음으로 세포라는 용어 대신에 바코드라는 용어를 사용합니다.</p>
</blockquote>
<div id="2ff5338f-d762-441d-bb60-cfb494e334d8" class="cell" data-tags="[]" data-execution_count="2">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># load data</span></span>
<span id="cb1-2">data_path <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"../input/231114_HL187/Isotype/"</span></span>
<span id="cb1-3">sample_name <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Isotype"</span></span>
<span id="cb1-4"></span>
<span id="cb1-5">adata <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> sc.read_10x_h5(data_path <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"filtered_feature_bc_matrix.h5"</span>)</span>
<span id="cb1-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 일부 변수(=유전자)가 두 번 이상 나타나서 다운스트림 분석 작업에서 오류나 의도하지 않은 동작을 일으킬 수 있음으로</span></span>
<span id="cb1-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 중복되는 요소에 숫자(예: '1', '2' 등)를 추가하여 변수 이름을 고유하게 만듭니다.</span></span>
<span id="cb1-8">adata.var_names_make_unique()</span>
<span id="cb1-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># print(f"데이터 세트의 형태는 n_obs {adata.shape[0]} x n_vars {adata.shape[1]} 입니다.")</span></span>
<span id="cb1-10">init_barcode_count <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> adata.shape[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]</span>
<span id="cb1-11">init_gene_count <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> adata.shape[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]</span>
<span id="cb1-12">adata</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="2">
<pre><code>AnnData object with n_obs × n_vars = 13486 × 32285
    var: 'gene_ids', 'feature_types', 'genome'</code></pre>
</div>
</div>
<p>정상적으로 데이터가 불러져 왔다면 <code>adata.var</code>에서 <code>gene_ids(Ensembl Id)</code>, <code>feature_types</code> 등의 유전자 정보와 바코드(<code>n_obs</code>) X 유전자 수(<code>n_vars</code>)를 확인 할 수 있습니다.</p>
</section>
<section id="저품질-시퀀싱-데이터-제거" class="level1">
<h1>저품질 시퀀싱 데이터 제거</h1>
<p>첫 번째 단계는 데이터셋에서 품질이 낮은 판독값을 제거하는 것입니다. 예를 들어 검출된 유전자 수가 적고 미토콘드리아 유전자 비율이 높은 경우, 세포막이 손상되 죽어가는 세포일 가능성이 높습니다. 이런 세포는 분석 대상이 아니며 다운스트림 분석을 왜곡할 수 있으므로 제거합니다. 이런 세포를 식별하기 위해서는 일반적으로 다음 세 가지 항목(QC metric)을 사용합니다.</p>
<ul>
<li>바코드당 카운트 수(카운트 깊이)</li>
<li>바코드당 유전자 수</li>
<li>바코드당 미토콘드리아 유전자 비율</li>
</ul>
<p>저품질 데이터는 각 항목의 임계값을 통해 필터링되며 낮은 카운트 깊이와 검출된 유전자 수, 높은 비율의 미토콘드리아 유전자로 판단합니다. 세포 신호가 잘못 해석될 수 있으므로 임계값을 결정할 때는 여러 변인을 고려해야 합니다. 예를 들어 미토콘드리아 수가 상대적으로 높은 세포는 호흡 과정에 관여할 수 있으므로 필터링해서는 안 됩니다. 반면, 미토콘드리아 수가 낮거나 높은 세포는 휴지기에 있는 세포 집단이나 크기가 큰 세포에 해당할 수 있습니다. 따라서 일반적으로 가능한 적은 수의 세포를 제외하고 최대한 허용하는 것이 좋습니다.</p>
<p>여기에서는 MAD(중앙값 절대 편차)를 사용한 임계값 설정으로 저품질 데이터를 필터링 합니다. MAD는 <img src="https://latex.codecogs.com/png.latex?MAD=median(%7CX_i-median(X)%7C)"> 로 주어지며, <img src="https://latex.codecogs.com/png.latex?X_i"> 는 관측값의 각 QC 메트릭이며 메트릭의 변동성을 나타냅니다. Germain et al., 2020에서 사용된 것 처럼 5 MAD 차이가 나는 경우에 이상값으로 표시하겠습니다. <code>scanpy</code>에서는 <code>sc.pp.calculate_qc_metrics</code> 함수를 사용해 <code>QC metric</code> 계산 할 수 있습니다. 다음의 코드를 사용해 미토콘드리아, 리보솜 및 헤모글로빈 유전자를 정의합니다. 미토콘드리아 유전자는 종에 따라 접두사 <code>mt-</code>(마우스) 또는 <code>MT-</code>(사람)이 추가되어 있습니다.</p>
<div id="3baa6041-1279-41ef-99b4-9cc355b4175a" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># for mouse genes</span></span>
<span id="cb3-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># mitochondrial genes</span></span>
<span id="cb3-3">adata.var[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mt"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> adata.var_names.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>.startswith(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mt-"</span>)</span>
<span id="cb3-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ribosomal genes</span></span>
<span id="cb3-5">adata.var[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ribo"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> adata.var_names.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>.startswith(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Rpl"</span>)</span>
<span id="cb3-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># hemoglobin genes.</span></span>
<span id="cb3-7">adata.var[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"hb"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> adata.var_names.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>.contains(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"^Hb[^(p)]"</span>)</span>
<span id="cb3-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Malat1</span></span>
<span id="cb3-9">adata.var[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Malat1"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> adata.var_names.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>.contains(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Malat1"</span>)</span>
<span id="cb3-10"></span>
<span id="cb3-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># calculate the respective QC metrics with scanpy.</span></span>
<span id="cb3-12">sc.pp.calculate_qc_metrics(</span>
<span id="cb3-13">    adata,</span>
<span id="cb3-14">    qc_vars<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mt"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ribo"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"hb"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Malat1"</span>],</span>
<span id="cb3-15">    inplace<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>,</span>
<span id="cb3-16">    percent_top<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>],</span>
<span id="cb3-17">    log1p<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>,</span>
<span id="cb3-18">)</span>
<span id="cb3-19"></span>
<span id="cb3-20">adata</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="3">
<pre><code>AnnData object with n_obs × n_vars = 13486 × 32285
    obs: 'n_genes_by_counts', 'log1p_n_genes_by_counts', 'total_counts', 'log1p_total_counts', 'pct_counts_in_top_20_genes', 'total_counts_mt', 'log1p_total_counts_mt', 'pct_counts_mt', 'total_counts_ribo', 'log1p_total_counts_ribo', 'pct_counts_ribo', 'total_counts_hb', 'log1p_total_counts_hb', 'pct_counts_hb', 'total_counts_Malat1', 'log1p_total_counts_Malat1', 'pct_counts_Malat1'
    var: 'gene_ids', 'feature_types', 'genome', 'mt', 'ribo', 'hb', 'Malat1', 'n_cells_by_counts', 'mean_counts', 'log1p_mean_counts', 'pct_dropout_by_counts', 'total_counts', 'log1p_total_counts'</code></pre>
</div>
</div>
<div id="4844a2a1-f0e2-446e-b29a-fc2d664704f8" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1">df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.concat(</span>
<span id="cb5-2">    [</span>
<span id="cb5-3">        adata.obs.n_genes_by_counts.describe(),</span>
<span id="cb5-4">        adata.obs.total_counts.describe(),</span>
<span id="cb5-5">        adata.obs.pct_counts_mt.describe(),</span>
<span id="cb5-6">        adata.obs.pct_counts_ribo.describe(),</span>
<span id="cb5-7">        adata.obs.pct_counts_hb.describe(),</span>
<span id="cb5-8">    ],</span>
<span id="cb5-9">    axis<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,</span>
<span id="cb5-10">)</span>
<span id="cb5-11"></span>
<span id="cb5-12">df</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="4">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">n_genes_by_counts</th>
<th data-quarto-table-cell-role="th">total_counts</th>
<th data-quarto-table-cell-role="th">pct_counts_mt</th>
<th data-quarto-table-cell-role="th">pct_counts_ribo</th>
<th data-quarto-table-cell-role="th">pct_counts_hb</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">count</td>
<td>13486.000000</td>
<td>13486.000000</td>
<td>13486.000000</td>
<td>13486.000000</td>
<td>13486.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">mean</td>
<td>2170.148228</td>
<td>7194.561523</td>
<td>1.063374</td>
<td>8.822847</td>
<td>0.008010</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">std</td>
<td>1066.073444</td>
<td>5309.599609</td>
<td>1.890632</td>
<td>3.806559</td>
<td>0.022218</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">min</td>
<td>180.000000</td>
<td>500.000000</td>
<td>0.000000</td>
<td>0.200000</td>
<td>0.000000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">25%</td>
<td>1334.000000</td>
<td>2991.250000</td>
<td>0.499700</td>
<td>6.600059</td>
<td>0.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">50%</td>
<td>2122.000000</td>
<td>6181.500000</td>
<td>0.764679</td>
<td>8.779517</td>
<td>0.000000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">75%</td>
<td>2874.000000</td>
<td>10178.750000</td>
<td>1.127175</td>
<td>10.907173</td>
<td>0.007614</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">max</td>
<td>8886.000000</td>
<td>79911.000000</td>
<td>55.456173</td>
<td>35.833851</td>
<td>0.730536</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>출력 결과를 통해 <code>.var</code>와 <code>.obs</code>에 몇 개의 열이 추가되었습니다. 추가된 열에 대한 간략한 설명은 아래와 같으며 자세한 내용은 <code>scanpy</code> 공식 문서에서 확인할 수 있습니다.</p>
<ul>
<li><code>.obs</code>의 <code>n_genes_by_counts</code>는 셀에서 양수인 유전자의 수입니다,</li>
<li><code>total_counts</code>는 셀의 총 카운트 수이며, 라이브러리 크기로도 알려져 있습니다.</li>
<li><code>pct_counts_mt</code>는 세포의 총 개수 중 미토콘드리아 유전자의 비율입니다. 죽어가는 세포는 발현이 더 높은 것으로 관찰되었습니다.</li>
<li><code>Malat1</code> poly-A로 캡처한 RNA-seq 데이터에서 자주 검출되며 주로 기술적 편향인 경우가 많습니다.</li>
<li><code>pct_counts_ribo</code>는 세포의 총 개수 중 리보솜 유전자의 비율로 세포 유형을 판단하는데 별 도움이 되지 않는다고 알려졌습니다.</li>
</ul>
<p>이제 몇 가지 QC metric에 대한 시각화를 해봅니다.</p>
<div id="be341c8f-d2e1-4d9c-b533-6a13c6731496" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1">sc.pl.violin(</span>
<span id="cb6-2">    adata,</span>
<span id="cb6-3">    [<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"n_genes_by_counts"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"total_counts"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pct_counts_mt"</span>],</span>
<span id="cb6-4">    jitter<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.4</span>,</span>
<span id="cb6-5">    multi_panel<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>,</span>
<span id="cb6-6">)</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://tomorrow-lab.github.io/posts/scRNAseq/python_scRNA_QC_files/figure-html/cell-6-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="1a1910b6-1fc7-4c7b-b6b8-92022938503a" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1">fig, ax <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> plt.subplots(nrows<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, ncols<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, figsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>))</span>
<span id="cb7-2"></span>
<span id="cb7-3">ax[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].hist(adata.obs.n_genes_by_counts, bins<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>)</span>
<span id="cb7-4">ax[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].set_title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"n_genes_by_counts"</span>)</span>
<span id="cb7-5">ax[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>].hist(adata.obs.total_counts, bins<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>)</span>
<span id="cb7-6">ax[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>].set_title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"total_counts"</span>)</span>
<span id="cb7-7">ax[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>].hist(adata.obs.pct_counts_Malat1, bins<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>)</span>
<span id="cb7-8">ax[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>].set_title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pct_counts_Malat1"</span>)</span>
<span id="cb7-9"></span>
<span id="cb7-10">plt.tight_layout()</span>
<span id="cb7-11">plt.show()</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://tomorrow-lab.github.io/posts/scRNAseq/python_scRNA_QC_files/figure-html/cell-7-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="dedd0868-fc39-4591-8c08-b3b9f5df3a9c" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1">fig, ax <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> plt.subplots(nrows<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, ncols<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, figsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>))</span>
<span id="cb8-2"></span>
<span id="cb8-3">ax[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].hist(adata.obs.pct_counts_ribo, bins<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>)</span>
<span id="cb8-4">ax[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].set_title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pct_counts_ribo"</span>)</span>
<span id="cb8-5">ax[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>].hist(adata.obs.pct_counts_hb, bins<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>)</span>
<span id="cb8-6">ax[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>].set_title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pct_counts_hb"</span>)</span>
<span id="cb8-7">ax[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>].hist(adata.obs.pct_counts_mt, bins<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>)</span>
<span id="cb8-8">ax[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>].set_title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pct_counts_mt"</span>)</span>
<span id="cb8-9"></span>
<span id="cb8-10">plt.tight_layout()</span>
<span id="cb8-11">plt.show()</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://tomorrow-lab.github.io/posts/scRNAseq/python_scRNA_QC_files/figure-html/cell-8-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1">sc.pl.scatter(</span>
<span id="cb9-2">    adata,</span>
<span id="cb9-3">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"total_counts"</span>,</span>
<span id="cb9-4">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"n_genes_by_counts"</span>,</span>
<span id="cb9-5">    color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pct_counts_mt"</span>,</span>
<span id="cb9-6">)</span>
<span id="cb9-7">plt.show()</span></code></pre></div>
<div id="f1f08cf5-d8d6-4d3f-88c3-81ffff7b9e04" class="cell quarto-layout-panel" data-execution_count="8" data-layout-ncol="2">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="https://tomorrow-lab.github.io/posts/scRNAseq/python_scRNA_QC_files/figure-html/cell-9-output-1.png" class="img-fluid"></p>
</div>
</div>
</div>
<p>위 플롯을 통해 미토콘드리아 유전자의 비율이 높으면 셀의 총 카운트 수(total_counts)와 유전자의 수(n_genes_by_counts)가 매우 높다는 것을 알 수 있습니다. 이 플롯을 기반으로 MAD을 통한 필터링을 적용하겠습니다. 먼저, 아래와 같이 MAD 함수를 정의하고 <code>log1p_total_counts</code>, <code>log1p_n_genes_by_counts</code>, <code>pct_counts_in_top_20_genes</code> QC metric으로 5 MAD 사이의 데이터를 필터링 합니다.</p>
<div id="ca277222-21d0-4a4f-95cc-d7952cbc8860" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> is_outlier(adata, metric: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, nmads: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">int</span>):</span>
<span id="cb10-2">    M <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> adata.obs[metric]</span>
<span id="cb10-3">    outlier <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (M <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> np.median(M) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> nmads <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> median_abs_deviation(M)) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span> (</span>
<span id="cb10-4">        np.median(M) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> nmads <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> median_abs_deviation(M) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> M</span>
<span id="cb10-5">    )</span>
<span id="cb10-6">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> outlier</span>
<span id="cb10-7"></span>
<span id="cb10-8"></span>
<span id="cb10-9">adata.obs[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"outlier"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (</span>
<span id="cb10-10">    is_outlier(adata, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"log1p_total_counts"</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>)</span>
<span id="cb10-11">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span> is_outlier(adata, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"log1p_n_genes_by_counts"</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>)</span>
<span id="cb10-12">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span> is_outlier(adata, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pct_counts_in_top_20_genes"</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>)</span>
<span id="cb10-13">)</span>
<span id="cb10-14">adata.obs.outlier.value_counts()</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="9">
<pre><code>outlier
False    13155
True       331
Name: count, dtype: int64</code></pre>
</div>
</div>
<p>미토콘드리아 유전자 비율은 좀 더 엄격하게 3 MAD 기준으로 필터링하고 백분율이 8%를 초과하는 세포도 제외합니다.</p>
<div id="f7f3211a-8976-42b9-a922-73735d641714" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1">adata.obs[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mt_outlier"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> is_outlier(adata, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pct_counts_mt"</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span> (</span>
<span id="cb12-2">    adata.obs[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pct_counts_mt"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span></span>
<span id="cb12-3">)</span>
<span id="cb12-4">adata.obs.mt_outlier.value_counts()</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="11">
<pre><code>mt_outlier
False    12054
True      1432
Name: count, dtype: int64</code></pre>
</div>
</div>
<p>이제 <code>outlier</code>, <code>mt_outlier</code> 에 모두 해당하는 데이터는 제거하고 미토콘드리아 유전자의 비율에 대해 시각화합니다. 시각화를 통하면 직관적으로 알수 있습니다.</p>
<div id="e23c69ec-b933-495d-9d4d-1df9b42d02f8" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Total number of cells: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>adata<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>n_obs<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb14-2">adata <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> adata[(<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>adata.obs.outlier) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> (<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>adata.obs.mt_outlier)].copy()</span>
<span id="cb14-3"></span>
<span id="cb14-4"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Number of cells after filtering of low quality cells: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>adata<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>n_obs<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Total number of cells: 13486
Number of cells after filtering of low quality cells: 11826</code></pre>
</div>
</div>
<div class="sourceCode cell-code" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1">p1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> sc.pl.scatter(adata, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"total_counts"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"n_genes_by_counts"</span>, color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pct_counts_mt"</span>)</span>
<span id="cb16-2">plt.show()</span></code></pre></div>
<div id="261e8bd6-abfa-45bd-8890-652b5fc02dd7" class="cell quarto-layout-panel" data-execution_count="13" data-layout-ncol="2">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="https://tomorrow-lab.github.io/posts/scRNAseq/python_scRNA_QC_files/figure-html/cell-13-output-1.png" class="img-fluid"></p>
</div>
</div>
</div>
<section id="배경ambient-rna-제거" class="level2">
<h2 class="anchored" data-anchor-id="배경ambient-rna-제거">배경(Ambient) RNA 제거</h2>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://www.sc-best-practices.org/_images/ambient_rna.jpeg" class="img-fluid figure-img"></p>
<figcaption>배경 RNA는 세포의 기본 mRNA와 함께 카운트되어 혼동을 일으킵니다.</figcaption>
</figure>
</div>
<p><code>droplet</code> 기술을 사용한 scRNA-seq의 경우, 세포가 용해되면서 나온 mRNA가 세포들과 함께 시퀀싱될 수 있습니다. 이런 현상을 배경(Ambient) RNA 오염이라 하며 다운스트림 분석에서 해석을 왜곡할 수 있습니다.</p>
<p>배경 RNA 오염은 사용한 scRNA-seq 기술과 분석한 세포의 유형에 따라 달라지기 때문에 데이터를 적절하게 보정하는 것이 중요합니다. 현재 알려진 방법으로는 <code>SoupX</code>[Young and Behjati, 2020] 및 <code>DecontX</code>[Yang et al., 2020]와 같은 방법이 있는데 이는 세포 용해액의 구성을 추정해 카운트 행렬의 값을 수정하는 원리입니다.</p>
<p><code>SoupX</code>는 <code>R</code>언어로 작성되어 있음으로 아래의 코드와 같이 파이썬의 <code>rpy2</code> 모듈을 사용해야 합니다.</p>
<div id="6441c4ed-38f2-47ea-b4be-92220649e256" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%%</span>R</span>
<span id="cb17-2">library(SoupX)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    WARNING: The R package "reticulate" only fixed recently
    an issue that caused a segfault when used with rpy2:
    https://github.com/rstudio/reticulate/pull/1188
    Make sure that you use a version of that package that includes
    the fix.
    </code></pre>
</div>
</div>
<p><code>SoupX</code>로 더 나은 결과를 얻기 위해서는 클러스터링 정보가 필요합니다.[Young and Behjati, 2020] 먼저 <code>AnnData</code> 객체의 복사본을 만들어 정규화하고, 클러스터링을 진행 합니다. 클러스터링 정보는 <code>soupx_groups</code> 객체로 저장해 사용합니다.</p>
<div id="12bc6f7f-fa8a-4e8f-ab71-bb7f99262c80" class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1">adata_pp <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> adata.copy()</span>
<span id="cb19-2">sc.pp.normalize_per_cell(adata_pp)</span>
<span id="cb19-3">sc.pp.log1p(adata_pp)</span>
<span id="cb19-4">sc.pp.pca(adata_pp)</span>
<span id="cb19-5">sc.pp.neighbors(adata_pp)</span>
<span id="cb19-6">sc.tl.leiden(adata_pp, key_added<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"soupx_groups"</span>)</span>
<span id="cb19-7"></span>
<span id="cb19-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 클러스터를 .obs에 soupx_groups로 추가하고 벡터로 저장합니다.</span></span>
<span id="cb19-9">soupx_groups <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> adata_pp.obs[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"soupx_groups"</span>]</span>
<span id="cb19-10"></span>
<span id="cb19-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># AnnData 객체의 복사본을 삭제해 메모리를 절약합니다.</span></span>
<span id="cb19-12"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">del</span> adata_pp</span>
<span id="cb19-13"></span>
<span id="cb19-14"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 세포, 유전자, 필터링된 카운터 행렬을 저장합니다.</span></span>
<span id="cb19-15"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># SoupX에는 모양 특징 x 바코드 행렬이 필요하므로 transpose해야 합니다.</span></span>
<span id="cb19-16">cells <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> adata.obs_names</span>
<span id="cb19-17">genes <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> adata.var_names</span>
<span id="cb19-18">data <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> adata.X.T</span></code></pre></div>
</div>
<p><code>cellranger</code>에서 얻은 <code>raw_feature_bc_matrix.h5</code>를 <code>data_tod</code> 객체로 저장해 <code>SoupX</code>의 인풋으로 사용합니다.</p>
<div id="3f0fadba-b7fa-4afc-b975-dfee2be8edd7" class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb20" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1">adata_raw <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> sc.read_10x_h5(</span>
<span id="cb20-2">    filename<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>data_path <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"raw_feature_bc_matrix.h5"</span>,</span>
<span id="cb20-3">)</span>
<span id="cb20-4">adata_raw.var_names_make_unique()</span>
<span id="cb20-5">data_tod <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> adata_raw.X.T</span>
<span id="cb20-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 객체를 삭제해 메모리를 절약합니다.</span></span>
<span id="cb20-7"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">del</span> adata_raw</span></code></pre></div>
</div>
<p>이제 <code>SoupX</code>를 실행하기 위한 모든 준비가 완료되었습니다. <code>SoupChannel</code> 객체를 만들고 메타데이터를 데이터 프레임 형식으로 추가합니다. 그런다음 <code>autoEstCont</code>함수를 사용해 배경 RNA 오염 비율을 계산하고 <code>adjustCounts</code>로 카운트 행렬을 보정합니다.다</p>
<div id="e4364038-67f5-4007-989f-09c5b597d613" class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb21" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%%</span>R <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>i data <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>i data_tod <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>i genes <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>i cells <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>i soupx_groups <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>o out </span>
<span id="cb21-2"></span>
<span id="cb21-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># specify row and column names of data</span></span>
<span id="cb21-4">rownames(data) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> genes</span>
<span id="cb21-5">colnames(data) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> cells</span>
<span id="cb21-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ensure correct sparse format for table of counts and table of droplets</span></span>
<span id="cb21-7">data <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span>(data, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"sparseMatrix"</span>)</span>
<span id="cb21-8">data_tod <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span>(data_tod, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"sparseMatrix"</span>)</span>
<span id="cb21-9"></span>
<span id="cb21-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Generate SoupChannel Object for SoupX </span></span>
<span id="cb21-11">sc <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> SoupChannel(data_tod, data, calcSoupProfile <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> FALSE)</span>
<span id="cb21-12"></span>
<span id="cb21-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Add extra meta data to the SoupChannel object</span></span>
<span id="cb21-14">soupProf <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> data.frame(row.names <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> rownames(data), est <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> rowSums(data)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">sum</span>(data), counts <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> rowSums(data))</span>
<span id="cb21-15">sc <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> setSoupProfile(sc, soupProf)</span>
<span id="cb21-16"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Set cluster information in SoupChannel</span></span>
<span id="cb21-17">sc <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> setClusters(sc, soupx_groups)</span>
<span id="cb21-18"></span>
<span id="cb21-19"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Estimate contamination fraction</span></span>
<span id="cb21-20">sc  <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> autoEstCont(sc, doPlot<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>TRUE)</span>
<span id="cb21-21"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Infer corrected table of counts and rount to integer</span></span>
<span id="cb21-22">out <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> adjustCounts(sc, roundToInt <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> TRUE)</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://tomorrow-lab.github.io/posts/scRNAseq/python_scRNA_QC_files/figure-html/cell-18-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>이후의 모든 분석 단계에 보정된 카운트 행렬을 사용하고자 <code>soupX_counts</code> 레이어로 <code>.X</code>을 덮어씌웁니다.</p>
<div id="63ab3451-b517-4c87-9350-08aecaa27822" class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb22" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1">adata.layers[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"counts"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> adata.X</span>
<span id="cb22-2">adata.layers[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"soupX_counts"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> out.T</span>
<span id="cb22-3">adata.X <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> adata.layers[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"soupX_counts"</span>]</span></code></pre></div>
</div>
<p>추가로 최소 20개 이상의 세포에서 검출되지 않는 유전자는 필터링합니다.</p>
<div id="82664698-932f-494a-88fe-2baf820fcbcf" class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb23" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Total number of genes: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>adata<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>n_vars<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb23-2"></span>
<span id="cb23-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Min 20 cells - filters out 0 count genes</span></span>
<span id="cb23-4">sc.pp.filter_genes(adata, min_cells<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>)</span>
<span id="cb23-5"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Number of genes after cell filter: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>adata<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>n_vars<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Total number of genes: 32285
Number of genes after cell filter: 14534</code></pre>
</div>
</div>
</section>
<section id="이중체doublet-검출" class="level2">
<h2 class="anchored" data-anchor-id="이중체doublet-검출">이중체(Doublet) 검출</h2>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://www.sc-best-practices.org/_images/doublet_detection.jpeg" class="img-fluid figure-img"></p>
<figcaption>세포 쌍을 무작위로 샘플링하고 유전자 발현 프로필을 평균화하여 염색체 수를 얻고 PCA 공간에 투영합니다. 그런 다음 kNN으로 Doublet점수를 계산해 검출합니다.</figcaption>
</figure>
</div>
<p>이중체는 두 개 이상의 세포가 하나의 <code>droplet</code>에 포함된 것입니다. 이런 기술적인 문제가 있기 때문에 카운터 행렬에서 ‘세포’ 대신 ’바코드’라는 용어를 사용하는 것입니다. 이중체는 동일한 세포 유형(그러나 다른 개체에서 유래한)에 의해 형성된 동형 이중체와 그렇지 않은 이형 이중체가 있습니다. 동형 이중체는 카운트 행렬의 정보로 구별이 어렵고 셀 해싱이나 SNP로만 식별할 수 있기 때문에 여기서 다루는 이중체 검출의 목표가 아닙니다.</p>
<p>반면에 이형 이중체는 잘못 분류될 가능성이 높고 다운스트림 결과를 왜곡할 수 있음으로 이를 식별하는 것은 중요합니다. 일반적으로 이중체 검출은 전처리 초기 단계에서 진행합니다. 이형 이중체 검출을 위한 여러 소프트웨어 패키지들이 있는데 <code>scDblFinder</code>는 현재 가장 검출 정확도가 높고 우수한 계산 효율성 및 안정성을 가진 도구로 평가됩니다.[Xi and Li, 2021] 따라서 여기에서는 <code>scDblFinder</code> 사용합니다.</p>
<div id="2cf00332-8494-4ff8-9a3c-a29ecb1f03f3" class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb25" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%%</span>R</span>
<span id="cb25-2">library(Seurat)</span>
<span id="cb25-3">library(scater)</span>
<span id="cb25-4">library(scDblFinder)</span>
<span id="cb25-5">library(BiocParallel)</span></code></pre></div>
</div>
<div id="17346345-3cfb-4904-8238-767720739546" class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb26" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1">data_mat <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> adata.X.T</span></code></pre></div>
</div>
<p><code>scDblFinder</code>는 입력 값으로 <code>SingleCellExperiment</code>객체를 사용하므로 아래 예시 코드와 같이 <code>AnnData</code>객체를 변환해야 합니다. 코드를 실행하면 다음의 열이 결과로 추가됩니다.</p>
<ul>
<li>scDblFinder.score: Doublet 점수(높을수록 셀이 이중일 가능성이 높음)</li>
<li>scDblFinder.class: 분류(Doublet 또는 Singlet)</li>
</ul>
<div id="bc97186f-d40d-4087-a608-11885777beff" class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb27" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%%</span>R <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>i data_mat <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>o doublet_score <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>o doublet_class</span>
<span id="cb27-2"></span>
<span id="cb27-3"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">set</span>.seed(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">42</span>)</span>
<span id="cb27-4">sce <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> scDblFinder(</span>
<span id="cb27-5">    SingleCellExperiment(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">list</span>(counts<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>data_mat), )</span>
<span id="cb27-6">)</span>
<span id="cb27-7"></span>
<span id="cb27-8">doublet_score <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> sce$scDblFinder.score</span>
<span id="cb27-9">doublet_class <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> sce$scDblFinder.<span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">class</span></span></code></pre></div>
</div>
<div id="4e9f9a09-77c4-4c82-84fa-64784f49c1db" class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb28" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># scDblFinder 결과를 AnnData 객체의 .obs에 추가합니다.</span></span>
<span id="cb28-2">adata.obs[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"scDblFinder_score"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> doublet_score</span>
<span id="cb28-3">adata.obs[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"scDblFinder_class"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> doublet_class</span>
<span id="cb28-4">adata.obs.scDblFinder_class.value_counts()</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="24">
<pre><code>scDblFinder_class
singlet    10125
doublet     1701
Name: count, dtype: int64</code></pre>
</div>
</div>
<p>Doublet 점수를 시각화해 <code>scDblFinder_class</code>이 올바른지 확인합니다.</p>
<div class="sourceCode cell-code" id="cb30" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1">plt.hist(doublet_score, bins<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>)</span>
<span id="cb30-2">plt.title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Doublet score"</span>)</span>
<span id="cb30-3">plt.show()</span></code></pre></div>
<div id="cf41918e-69ec-4126-9789-ff6b85488221" class="cell quarto-layout-panel" data-execution_count="25" data-layout-ncol="2">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="https://tomorrow-lab.github.io/posts/scRNAseq/python_scRNA_QC_files/figure-html/cell-25-output-1.png" class="img-fluid"></p>
</div>
</div>
</div>
<p>추후에 진행될 다운스트림 분석 과정에서 더 많은 또는 더 적은 셀을 필터링하는 것이 필요할 수 있습니다. 따라서 지금 당장 식별된 이중체를 삭제하는 것은 좋은 생각이 아닙니다. 지금까지 진행한 품질 관리 절차를 통해 얼마나 많은 바코드와 유전자가 필터링 되었는지 확인하고 파일로 저장하겠습니다.</p>
<div id="ae52d3e2-1a00-4b44-acd4-d423f3cb2d39" class="cell" data-execution_count="26">
<div class="cell-output cell-output-stdout">
<pre><code>바코드 수: 13486 -&gt; 11826(0.9)
유전자 수: 32285 -&gt; 14534(0.5)</code></pre>
</div>
</div>
</section>
</section>
<section id="결론" class="level1">
<h1>결론</h1>
<ul>
<li>품질이 낮은 셀을 필터링할 때는 작은 하위 세포 집단이 사라지는 것을 피하기 위해 컷오프가 느슨한 MAD를 사용합니다.</li>
<li>유전자 기반 필터링은 다운스트림 분석 작업에 아무런 이점이 없습니다.</li>
<li>이형 이중체 검출은 <code>scDblFinder</code>와 같은 도구를 사용하여 효율적으로 감지할 수 있습니다.</li>
<li>여러 배치를 포함한 scRNA-seq 데이터에는 이형 이중체 검출법을 사용하면 안 됩니다.</li>
</ul>
</section>
<section id="참고-자료" class="level1">
<h1>참고 자료</h1>
<ul>
<li>https://www.sc-best-practices.org/preprocessing_visualization/quality_control.html</li>
<li>https://academic.oup.com/gigascience/article/9/12/giaa151/6049831</li>
<li>https://blog.naver.com/naturelove87/221474142816</li>
<li>Pierre-Luc Germain, Anthony Sonrel, and Mark D. Robinson. pipeComp, a general framework for the evaluation of computational pipelines, reveals performant single cell rna-seq preprocessing tools. Genome Biology, 21(1):227, September 2020. doi:10.1186/s13059 020-02136-7.</li>
<li>Malte D Luecken, et al.&nbsp;A sandbox for prediction and integration of dna, rna, and proteins in single cells. In Thirty-fifth Conference on Neural Information Processing Systems Datasets and Benchmarks Track (Round 2). 2021.</li>
<li>Nan Miles Xi and Jingyi Jessica Li. Benchmarking Computational Doublet-Detection Methods for Single-Cell term RNA Sequencing Data. Cell Systems, 12(2):176–194.e6, 2021. doi:https://doi.org/10.1016/j.cels.2020.11.008.</li>
<li>Nan Miles Xi and Jingyi Jessica Li. Protocol for executing and benchmarking eight computational doublet-detection methods in single-cell RNA sequencing data analysis. STAR Protocols, 2(3):100699, sep 2021. doi:10.1016/j.xpro.2021.100699.</li>
<li>Shiyi Yang, Sean E. Corbett, Yusuke Koga, Zhe Wang, W Evan Johnson, Masanao Yajima, and Joshua D. Campbell. Decontamination of ambient rna in single-cell rna-seq with DecontX. Genome Biology, 21(1):57, March 2020. doi:10.1186/s13059-020-1950-6.</li>
<li>Matthew D Young and Sam Behjati. SoupX removes ambient term RNA contamination from droplet-based single-cell sequencing data. GigaScience, December 2020. doi:10.1093/gigascience/giaa151.</li>
<li>Luke Zappia and Fabian J. Theis. Over 1000 tools reveal trends in the single-cell rna-seq analysis landscape. Genome Biology, 22(1):301, Oct 2021. doi:10.1186/s13059-021-02519-4.</li>
</ul>


</section>

 ]]></description>
  <category>python</category>
  <category>scRNA</category>
  <category>scanpy</category>
  <guid>https://tomorrow-lab.github.io/posts/scRNAseq/python_scRNA_QC.html</guid>
  <pubDate>Wed, 21 Feb 2024 15:00:00 GMT</pubDate>
</item>
<item>
  <title>10X genomics scRNA-seq alignment</title>
  <dc:creator>Taeyoon kim</dc:creator>
  <link>https://tomorrow-lab.github.io/posts/scRNAseq/python_scRNA_alignment.html</link>
  <description><![CDATA[ 




<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://tomorrow-lab.github.io/posts/scRNAseq/Scanpy_logo.svg" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:50.0%"></p>
</figure>
</div>
<section id="들어가며" class="level1">
<h1>들어가며</h1>
<p>다음과 같은 몇가지 가정을 하고 시작하겠습니다.</p>
<p>가정1. 10x Genomics Single Cell Solution을 통해 얻은 서열 데이터를 사용 가정2. 리눅스(Ubuntu 22.04.3 LTS x86_64) OS를 사용하며 기본적인 shell 명령어를 앎 가정3. 패키지 매니저인 Anaconda에 대한 사용법을 알고 있음 터미널을 열고 원하는 폴더로 이동합니다. 저는 /home/fkt/Downloads에서 시작하도록 하겠습니다.</p>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$pwd</span></span>
<span id="cb1-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">/home/fkt/Downloads</span></span></code></pre></div>
<p>터미널을 열고 원하는 폴더로 이동합니다. 저는 <code>/home/fkt/Downloads</code>에서 시작하도록 하겠습니다. 저는 아래와 같은 가정을 한 상태로 진행합니다.</p>
<section id="가상환경-사용하기" class="level2">
<h2 class="anchored" data-anchor-id="가상환경-사용하기">가상환경 사용하기</h2>
<p>정확하게는 <code>velocyto</code>를 사용하기 위해 가상환경을 만들어 사용합니다. 먼저 <code>TutorialEnvironment.yml</code> 파일을 다음 명령어로 다운받습니다.</p>
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb2-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">wget</span> https://cf.10xgenomics.com/supp/cell-exp/neutrophils/TutorialEnvironment.yml</span></code></pre></div>
<p>다음 명령어로 가상환경을 만들어 줍니다.</p>
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb3-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">conda</span> env create <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--file</span> TutorialEnvironment.yml</span></code></pre></div>
<p>만들어진 가상환경을 활성화 시킵니다.</p>
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb4-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">conda</span> activate tutorial</span></code></pre></div>
<p>다운로드 받은 <code>yml</code>파일은 삭제해줍니다.</p>
<div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb5-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rm</span> TutorialEnvironment.yml</span></code></pre></div>
</section>
</section>
<section id="cellranger-설치" class="level1">
<h1>Cellranger 설치</h1>
<p>자세한 것은 https://www.10xgenomics.com/support/software/cell-ranger</p>
<section id="system-requirements" class="level2">
<h2 class="anchored" data-anchor-id="system-requirements">System Requirements</h2>
<p>Hardware Cell Ranger pipelines run on Linux systems that meet these minimum requirements:</p>
<ul>
<li>8-core Intel or AMD processor (16 cores recommended).</li>
<li>64GB RAM (128GB recommended).</li>
<li>1TB free disk space.</li>
<li>64-bit CentOS/RedHat 7.0 or Ubuntu 14.04 - See the 10x Genomics OS Support page for details.</li>
</ul>
<section id="cell-ranger-7.2.0-sep-13-2023" class="level3">
<h3 class="anchored" data-anchor-id="cell-ranger-7.2.0-sep-13-2023">Cell Ranger 7.2.0 (Sep 13, 2023)</h3>
<p>Chromium Single Cell Software Suite Self-contained, relocatable tar file. Does not require centralized installation. Contains binaries pre-compiled for CentOS/RedHat 7.0 and Ubuntu 14.04. Runs on Linux systems that meets the minimum compute requirements.</p>
<p>다음 명령어를 통해 cell ranger를 다운로드 합니다.</p>
<div class="sourceCode" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb6-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">wget</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-O</span> cellranger-7.2.0.tar.gz <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://cf.10xgenomics.com/releases/cell-exp/cellranger-7.2.0.tar.gz?Expires=1695129121&amp;Key-Pair-Id=APKAI7S6A5RYOXBWRPDA&amp;Signature=ZipqR8Pg4YvVDQ3MvAVuuiPwEOC5c39~Wj0WTAxfoJW6xtrxqIFgIDySFSFnsWcwDpmAovJGrHXU24Y9Cptt88OJSPdEupyFRXoGKJvVzRtDJChmuMbSpVCy-2N-QnMKwxNtd8Yt8Mdp2Vcq4wxx1hVC0Yx54c7U9o~RFXIVsIp48thKR6JnKhJmCAC5U4dFLa86~NcB4s5Ic4HATrQP2KyWexyYZWgmBEw13mlKYtlVRUil0zseoq0-CZyGmE8oB0iDBSUBAyIqo~XMVjv~lkMz4cRcyCbQKBRDr~U36FM2KnE3rhv-Rlp4KD-uXCReRnBsY6N6t-HxpS2YDpN3mQ__"</span></span></code></pre></div>
<p>그리고 나서 다음 명령어로 압축을 풀어줍니다.</p>
<div class="sourceCode" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb7-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tar</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-xvf</span> cellranger-7.2.0.tar.gz</span></code></pre></div>
<p><code>cellranger-7.2.0</code> 폴더로 이동하기</p>
<div class="sourceCode" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb8-1"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">cd</span> cellranger-7.2.0</span></code></pre></div>
<p>정상적으로 되었다면 아래와 같은 폴더 구조를 볼 수 있습니다.</p>
<div class="sourceCode" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb9-1"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">.</span></span>
<span id="cb9-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> bin</span>
<span id="cb9-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> builtwith.json</span>
<span id="cb9-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> cellranger <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> bin/cellranger</span>
<span id="cb9-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> external</span>
<span id="cb9-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> lib</span>
<span id="cb9-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> LICENSE</span>
<span id="cb9-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> mro</span>
<span id="cb9-9"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> probe_sets <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> external/tenx_feature_references/targeted_panels</span>
<span id="cb9-10"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> sourceme.bash</span>
<span id="cb9-11"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> sourceme.csh</span>
<span id="cb9-12"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">└──</span> THIRD-PARTY-LICENSES.cellranger.txt</span>
<span id="cb9-13"></span>
<span id="cb9-14"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">5</span> directories, 6 files</span></code></pre></div>
<p>이제 <code>./cellranger</code>명령어를 입력하면 아래와 같이 cell ranger 실행이 가능합니다.</p>
<div class="sourceCode" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb10-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">./cellranger</span></span>
<span id="cb10-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">cellranger</span> cellranger-7.2.0</span>
<span id="cb10-3"></span>
<span id="cb10-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Process</span> 10x Genomics Gene Expression, Feature Barcode, and Immune Profiling data</span>
<span id="cb10-5"></span>
<span id="cb10-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Usage:</span> cellranger <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>COMMAND<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb10-7"></span>
<span id="cb10-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Commands:</span></span>
<span id="cb10-9">  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">count</span>           Count gene expression and/or feature barcode reads from a single sample and GEM well</span>
<span id="cb10-10">  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">multi</span>           Analyze multiplexed data or combined gene expression/immune profiling/feature barcode data</span>
<span id="cb10-11">  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">multi-template</span>  Output a multi config CSV template</span>
<span id="cb10-12">  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">vdj</span>             Assembles single-cell VDJ receptor sequences from 10x Immune Profiling libraries</span>
<span id="cb10-13">  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">aggr</span>            Aggregate data from multiple Cell Ranger runs</span>
<span id="cb10-14">  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">reanalyze</span>       Re-run secondary analysis <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">dimensionality</span> reduction, clustering, etc<span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">)</span></span>
<span id="cb10-15">  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">mkvdjref</span>        Prepare a reference for use with CellRanger VDJ</span>
<span id="cb10-16">  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">mkfastq</span>         Run Illumina demultiplexer on sample sheets that contain 10x-specific sample index sets</span>
<span id="cb10-17">  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">testrun</span>         Execute the <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'count'</span> pipeline on a small test dataset</span>
<span id="cb10-18">  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">mat2csv</span>         Convert a gene count matrix to CSV format</span>
<span id="cb10-19">  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">mkref</span>           Prepare a reference for use with 10x analysis software. Requires a GTF and FASTA</span>
<span id="cb10-20">  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">mkgtf</span>           Filter a GTF file by attribute prior to creating a 10x reference</span>
<span id="cb10-21">  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">upload</span>          Upload analysis logs to 10x Genomics support</span>
<span id="cb10-22">  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">sitecheck</span>       Collect linux system configuration information</span>
<span id="cb10-23">  <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">help</span>            Print this message or the help of the given subcommand<span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">s</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">)</span></span>
<span id="cb10-24"></span>
<span id="cb10-25"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Options:</span></span>
<span id="cb10-26">  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-h,</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--help</span>     Print help</span>
<span id="cb10-27">  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-V,</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--version</span>  Print version</span></code></pre></div>
</section>
</section>
</section>
<section id="예제-fastq-파일과-레퍼런스-데이터-다운로드" class="level1">
<h1>예제 FASTQ 파일과 레퍼런스 데이터 다운로드</h1>
<p>사람과 마우스 데이터 두 종류를 모두 다운로드 합니다. 이미 많은 예제에서 <code>Human 1k PBMC</code>를 다루고 있으므로 저는 <code>Mouse 1k neuron</code>으로 진행해보겠습니다. <code>Human 1k PBMC</code>은 직접해보시기 바랍니다.</p>
<section id="human-pbmc-1k-data" class="level3">
<h3 class="anchored" data-anchor-id="human-pbmc-1k-data">Human PBMC 1k data</h3>
<div class="sourceCode" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb11-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mkdir</span> data <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">&amp;&amp;</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">cd</span> data</span>
<span id="cb11-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#  Human PBMC 1k = 5.17GB</span></span>
<span id="cb11-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">wget</span> https://cf.10xgenomics.com/samples/cell-exp/3.0.0/pbmc_1k_v3/pbmc_1k_v3_fastqs.tar</span>
<span id="cb11-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tar</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-xvf</span> pbmc_1k_v3_fastqs.tar</span>
<span id="cb11-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Human reference (GRCh38) = 11GB</span></span>
<span id="cb11-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">wget</span> https://cf.10xgenomics.com/supp/cell-exp/refdata-gex-GRCh38-2020-A.tar.gz</span>
<span id="cb11-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tar</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-zxvf</span> refdata-gex-GRCh38-2020-A.tar.gz</span></code></pre></div>
</section>
<section id="mouse-1k-neuron-data" class="level3">
<h3 class="anchored" data-anchor-id="mouse-1k-neuron-data">Mouse 1k neuron data</h3>
<div class="sourceCode" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb12-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Mouse neron 1k data = 7GB</span></span>
<span id="cb12-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">wget</span> http://cf.10xgenomics.com/samples/cell-exp/3.0.0/neuron_1k_v3/neuron_1k_v3_fastqs.tar</span>
<span id="cb12-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tar</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-xvf</span> neuron_1k_v3_fastqs.tar</span>
<span id="cb12-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Mouse reference = 9.7GB</span></span>
<span id="cb12-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">wget</span> https://cf.10xgenomics.com/supp/cell-exp/refdata-gex-mm10-2020-A.tar.gz</span>
<span id="cb12-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tar</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-zxvf</span> refdata-gex-mm10-2020-A.tar.gz</span></code></pre></div>
</section>
<section id="파일-확인" class="level3">
<h3 class="anchored" data-anchor-id="파일-확인">파일 확인</h3>
<p>압축파일을 삭제하고나면 다음과 같이 12개의 폴더와 52개의 파일을 확인할 수 있습니다.</p>
<div class="sourceCode" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb13-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">$</span> tree .</span>
<span id="cb13-2"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">.</span></span>
<span id="cb13-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> neuron_1k_v3_fastqs</span>
<span id="cb13-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>   ├── neuron_1k_v3_S1_L001_I1_001.fastq.gz</span>
<span id="cb13-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>   ├── neuron_1k_v3_S1_L001_R1_001.fastq.gz</span>
<span id="cb13-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>   ├── neuron_1k_v3_S1_L001_R2_001.fastq.gz</span>
<span id="cb13-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>   ├── neuron_1k_v3_S1_L002_I1_001.fastq.gz</span>
<span id="cb13-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>   ├── neuron_1k_v3_S1_L002_R1_001.fastq.gz</span>
<span id="cb13-9"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>   └── neuron_1k_v3_S1_L002_R2_001.fastq.gz</span>
<span id="cb13-10"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> pbmc_1k_v3_fastqs</span>
<span id="cb13-11"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>   ├── pbmc_1k_v3_S1_L001_I1_001.fastq.gz</span>
<span id="cb13-12"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>   ├── pbmc_1k_v3_S1_L001_R1_001.fastq.gz</span>
<span id="cb13-13"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>   ├── pbmc_1k_v3_S1_L001_R2_001.fastq.gz</span>
<span id="cb13-14"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>   ├── pbmc_1k_v3_S1_L002_I1_001.fastq.gz</span>
<span id="cb13-15"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>   ├── pbmc_1k_v3_S1_L002_R1_001.fastq.gz</span>
<span id="cb13-16"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>   └── pbmc_1k_v3_S1_L002_R2_001.fastq.gz</span>
<span id="cb13-17"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> refdata-gex-GRCh38-2020-A</span>
<span id="cb13-18"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>   ├── fasta</span>
<span id="cb13-19"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>   ├── genes</span>
<span id="cb13-20"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>   │   └── genes.gtf</span>
<span id="cb13-21"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>   ├── pickle</span>
<span id="cb13-22"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>   ├── reference.json</span>
<span id="cb13-23"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>   └── star</span>
<span id="cb13-24"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">└──</span> refdata-gex-mm10-2020-A</span>
<span id="cb13-25">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> fasta</span>
<span id="cb13-26">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> genes</span>
<span id="cb13-27">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>   └── genes.gtf</span>
<span id="cb13-28">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> pickle</span>
<span id="cb13-29">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> reference.json</span>
<span id="cb13-30">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">└──</span> star</span>
<span id="cb13-31"></span>
<span id="cb13-32"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">12</span> directories, 52 files</span></code></pre></div>
</section>
</section>
<section id="cell-ranger-count" class="level1">
<h1>Cell Ranger count</h1>
<p>Analyze Gene Expression and Feature Barcode data with Cell Ranger count</p>
<p>상위 디렉토리인 <code>cellranger-7.2.0</code>으로 이동합니다.</p>
<div class="sourceCode" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb14-1"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">cd</span> ..</span></code></pre></div>
<p>다음 <code>cellranger count</code> 명령어를 사용하면 <code>count matrix</code>데이터를 얻을 수 있습니다.</p>
<div class="sourceCode" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb15-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">./cellranger</span> count <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--id</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>run_count_mNeuron1k <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb15-2">--fastqs=data/neuron_1k_v3_fastqs  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb15-3">--sample=neuron_1k_v3  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb15-4">--transcriptome=data/refdata-gex-mm10-2020-A</span>
<span id="cb15-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">--nosecondary=false</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Optional. Disable secondary analysis, e.g. clustering (true, false).</span></span></code></pre></div>
<p><code>--id</code>는 생성되는 폴더명이며 <code>--fastqs</code>는 다운로드한 <code>fastq</code>파일의 위치입니다. <code>--sample</code>은 fastq 파일명의 접두사(prefix)를 의미하고 <code>--transcriptome</code>은 레퍼런스데이터의 위치입니다.</p>
<p>약 15분정도 지나면 다음과 같은 출력을 볼 수 있습니다.</p>
<div class="sourceCode" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb16-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Running</span> preflight checks <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">please</span> wait<span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">)</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">...</span></span>
<span id="cb16-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Checking</span> sample info...</span>
<span id="cb16-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Checking</span> FASTQ folder...</span>
<span id="cb16-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Checking</span> reference...</span>
<span id="cb16-5"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">중략</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">)</span></span></code></pre></div>
<div class="sourceCode" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb17-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">outs</span></span>
<span id="cb17-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> analysis</span>
<span id="cb17-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> cloupe.cloupe</span>
<span id="cb17-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> filtered_feature_bc_matrix</span>
<span id="cb17-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> filtered_feature_bc_matrix.h5</span>
<span id="cb17-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> metrics_summary.csv</span>
<span id="cb17-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> molecule_info.h5</span>
<span id="cb17-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> possorted_genome_bam.bam</span>
<span id="cb17-9"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> possorted_genome_bam.bam.bai</span>
<span id="cb17-10"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> raw_feature_bc_matrix</span>
<span id="cb17-11"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> raw_feature_bc_matrix.h5</span>
<span id="cb17-12"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">└──</span> web_summary.html</span></code></pre></div>
</section>
<section id="rna-velocity-분석을-위해-velocyto-실행하기" class="level1">
<h1>RNA velocity 분석을 위해 velocyto 실행하기</h1>
<p>RNA velocity이란? 스플라이싱된 RNA와 아직 스플라이싱되지 않은 RNA를 구분해 세포의 상태를 예측하는 기법으로 scRNA 데이터에서 클러스터간에 분화 과정에 대한 단서를 얻을 수 있습니다. 예를 들어 아래 그림에서 보면 cluster4에서 cluster2로의 방향성을 확인 할 수 있습니다.</p>
<p><img src="https://cdn.10xgenomics.com/image/upload/c_scale,w_600/v1646345944/analysis-guides/velocity-tutorial/scVelo-umap-cluster.png" class="img-fluid"></p>
<p>RNA velocity 분석을 위해서는 추가적으로 <code>velocyto</code>이라는 도구를 사용해 <code>loom</code>파일을 얻어야 합니다. 아래 명령어를 사용하면 간단하게 얻을 수 있습니다.</p>
<div class="sourceCode" id="cb18" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb18-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">velocyto</span> run10x run_count_mNeuron1k/ data/refdata-gex-mm10-2020-A/genes/genes.gtf</span></code></pre></div>
<div class="sourceCode" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb19-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">2023-09-19</span> 10:01:22,756 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span> DEBUG <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span> Using logic: Default</span>
<span id="cb19-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">2023-09-19</span> 10:01:22,757 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span> DEBUG <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span> Example of barcode: AAACGAATCAAAGCCT and cell_id: run_count_mNeuron1k:AAACGAATCAAAGCCT-1</span>
<span id="cb19-3"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">중략</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">)</span></span>
<span id="cb19-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">2023-09-19</span> 10:27:23,985 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span> DEBUG <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span> 1991314 reads were skipped because no apropiate cell or umi barcode was found</span>
<span id="cb19-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">2023-09-19</span> 10:27:23,985 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span> DEBUG <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span> Counting done!</span>
<span id="cb19-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">2023-09-19</span> 10:27:23,988 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span> DEBUG <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span> Collecting row attributes</span>
<span id="cb19-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">2023-09-19</span> 10:27:24,014 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span> DEBUG <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span> Generating data table</span>
<span id="cb19-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">2023-09-19</span> 10:27:24,056 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span> DEBUG <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span> Writing loom file</span>
<span id="cb19-9"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">2023-09-19</span> 10:27:25,286 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span> DEBUG <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span> Terminated Succesfully!</span></code></pre></div>
<p>완료가 되면 <code>run_count_mNeuron1k</code>폴더안에 <code>velocyto</code>라는 새로운 폴더가 생기고 <code>run_count_mNeuron1k.loom</code> 파일이 생성됩니다.</p>
</section>
<section id="count-matrix-데이터-읽기" class="level1">
<h1>Count matrix 데이터 읽기</h1>
<section id="scanpy-사용" class="level2">
<h2 class="anchored" data-anchor-id="scanpy-사용">Scanpy 사용</h2>
<div id="1e83ee5a-1b68-4e1b-915e-a29168d38d21" class="cell" data-tags="[]" data-execution_count="1">
<div class="sourceCode cell-code" id="cb20" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># conda install pandas scanpy</span></span>
<span id="cb20-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> scanpy <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> sc</span>
<span id="cb20-3"></span>
<span id="cb20-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Cell ranger 결과 파일이 들어있는 경로</span></span>
<span id="cb20-5">file_path <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"../input/run_count_mNeuron1k/outs/filtered_feature_bc_matrix"</span></span>
<span id="cb20-6"></span>
<span id="cb20-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># read_10x_mtx 함수를 사용</span></span>
<span id="cb20-8">adata <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> sc.read_10x_mtx(file_path, var_names<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gene_symbols"</span>, cache<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb20-9">adata</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>AnnData object with n_obs × n_vars = 1311 × 32285
    var: 'gene_ids', 'feature_types'</code></pre>
</div>
</div>
<div id="1868db07-40b2-4213-b062-f88b1fe0d693" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb22" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># conda install -c bioconda scvelo</span></span>
<span id="cb22-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> scvelo <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> scv</span>
<span id="cb22-3"></span>
<span id="cb22-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># load loom files for spliced/unspliced matrices for each sample</span></span>
<span id="cb22-5">loom <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> scv.read(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>file_path<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">/run_count_mNeuron1k.loom"</span>, validate<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">False</span>, cache<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">False</span>)</span>
<span id="cb22-6"></span>
<span id="cb22-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># rename barcodes in order to merge:</span></span>
<span id="cb22-8">barcodes <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [bc.split(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">":"</span>)[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>] <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> bc <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> loom.obs.index.tolist()]</span>
<span id="cb22-9">barcodes <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [bc[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span> : <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(bc) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"-1"</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> bc <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> barcodes]</span>
<span id="cb22-10">loom.obs.index <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> barcodes</span>
<span id="cb22-11"></span>
<span id="cb22-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># make variable names unique</span></span>
<span id="cb22-13">loom.var_names_make_unique()</span>
<span id="cb22-14"></span>
<span id="cb22-15"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># merge matrices into the original adata object</span></span>
<span id="cb22-16">adata <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> scv.utils.merge(adata, loom)</span>
<span id="cb22-17">adata</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="2">
<pre><code>AnnData object with n_obs × n_vars = 1311 × 32285
    obs: 'initial_size_unspliced', 'initial_size_spliced', 'initial_size'
    var: 'gene_ids', 'feature_types', 'Accession', 'Chromosome', 'End', 'Start', 'Strand'
    layers: 'matrix', 'ambiguous', 'spliced', 'unspliced'</code></pre>
</div>
</div>
<div id="4ffd23b8-a12a-4920-9c5d-537386cda97a" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb24" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1">scv.pl.proportions(adata)</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://tomorrow-lab.github.io/posts/scRNAseq/python_scRNA_alignment_files/figure-html/cell-4-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="14b6ea54-2dbd-4180-95cf-a4c16038a9c4" class="cell">
<div class="sourceCode cell-code" id="cb25" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1">adata.write(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"../output/mNeuron1k.h5ad"</span>, compression<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gzip"</span>)</span></code></pre></div>
</div>
</section>
<section id="seurat-사용" class="level2">
<h2 class="anchored" data-anchor-id="seurat-사용">Seurat 사용</h2>
<p>R에 좀 더 익숙하시다면 Seurat을 사용하세요. 저는 파이썬 문법을 더 좋아하지만 솔직히 분석 도구의 완성도 측면에서는 Seurat이 더 나은 것 같습니다. 아래 코드는 jupyter notebook에서 R코드를 사용하기 위해 필요한 것으로 rStudio를 사용하신다면 %%R이 포함된 셀의 코드만 사용하시면 됩니다.</p>
<div id="fd9293cd-66d8-4aab-9a91-581156580ebb" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb26" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> logging</span>
<span id="cb26-2"></span>
<span id="cb26-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> rpy2.rinterface_lib.callbacks <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> rcb</span>
<span id="cb26-4"></span>
<span id="cb26-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># import rpy2.robjects as ro</span></span>
<span id="cb26-6"></span>
<span id="cb26-7">rcb.logger.setLevel(logging.ERROR)</span>
<span id="cb26-8"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span>load_ext rpy2.ipython</span></code></pre></div>
</div>
<div id="c9b851da-9d12-465a-94b3-cb3979c9255e" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb27" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%%</span>R</span>
<span id="cb27-2">library(dplyr)</span>
<span id="cb27-3">library(Seurat)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    WARNING: The R package "reticulate" only fixed recently
    an issue that caused a segfault when used with rpy2:
    https://github.com/rstudio/reticulate/pull/1188
    Make sure that you use a version of that package that includes
    the fix.
    </code></pre>
</div>
</div>
<div id="03a5512a-eef5-4b89-969d-0715287d90de" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb29" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%%</span>R</span>
<span id="cb29-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Load dataset</span></span>
<span id="cb29-3">file_path <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"../input/run_count_mNeuron1k/outs/filtered_feature_bc_matrix"</span></span>
<span id="cb29-4">neuron_data <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> Read10X(data_dir<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>file_path)</span>
<span id="cb29-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Initialize the Seurat object.</span></span>
<span id="cb29-6">obj <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;-</span> CreateSeuratObject(counts <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> neuron_data)</span>
<span id="cb29-7">obj</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>An object of class Seurat 
32285 features across 1311 samples within 1 assay 
Active assay: RNA (32285 features, 0 variable features)</code></pre>
</div>
</div>
<p>Seurat object를 파일로 저장하는 방법에도 여러가지가 있지만 R에서 많이 사용되는 *.rds를 사용하는 코드는 아래와 같습니다.</p>
<div id="2a3178bf-3aff-4ee4-a2a8-d7b36eefa45a" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb31" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%%</span>R</span>
<span id="cb31-2">saveRDS(obj, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">file</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"../output/mNeuron1k.rds"</span>)</span></code></pre></div>
</div>
</section>
</section>
<section id="마치며" class="level1">
<h1>마치며</h1>
<p>이것으로 scRNA seq 데이터의 전처리 과정을 알아봤습니다. 여기 적힌 방법 외에도 더 효율적이고 나은 방법도 있고 앞으로도 더 생겨날 것입니다. 그러나 저도 배우는 입장에서 다른 분들에게 도움이 되고자 정리를 해봤습니다. 실제 실험을 통해 얻은 데이터를 분석하는데 도움이 되길 바랍니다.</p>


</section>

 ]]></description>
  <category>python</category>
  <category>scRNA</category>
  <category>scanpy</category>
  <category>cellranger</category>
  <category>10x genomics</category>
  <guid>https://tomorrow-lab.github.io/posts/scRNAseq/python_scRNA_alignment.html</guid>
  <pubDate>Tue, 20 Feb 2024 15:00:00 GMT</pubDate>
</item>
<item>
  <title>miniforge: 파이썬과 R의 패키지 및 개발 환경 관리 도구</title>
  <dc:creator>Taeyoon kim</dc:creator>
  <link>https://tomorrow-lab.github.io/posts/miniforge/</link>
  <description><![CDATA[ 




<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://tomorrow-lab.github.io/posts/miniforge/thumbnail.jpg" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:50.0%"></p>
</figure>
</div>
<section id="파이썬과-r의-의존성-지옥" class="level1">
<h1>파이썬과 R의 의존성 지옥</h1>
<p>파이썬과 R에는 유용한 패키지들이 아주 많습니다. 그러다보니 여러 패키지들이 버전이 서로 충돌하거나 호환되지 않는 경우가 발생하곤 합니다. 예를 들어 A 패키지가 B 패키지 1.0 버전에 기반해 만들어졌는데 C 패키지가 B 패키지 2.0 버전을 요구한다면 A와 C를 동시에 사용할 수 없는 경우가 생깁니다.</p>
<p>이런 의존성 문제를 해결하기 위해 다양한 방법론들이 등장했습니다. 파이썬의 경우에는 <code>venv + pip</code>, <code>Pyenv</code>, <code>Poetry</code>, <code>Conda</code>, <code>PDM</code> 등과 같은 새로운 패키지를 이용해 프로젝트 별로 의존성을 관리할 수 있도록 합니다. 그 중에서 저는 <code>Conda</code>를 이용해 프로젝트를 관리합니다.</p>
</section>
<section id="아나콘다anaconda" class="level1">
<h1>아나콘다(Anaconda)</h1>
<p>콘다는 Windows, macOS 및 Linux에서 실행되는 오픈 소스 패키지 관리 시스템이자 환경 관리 시스템으로 파이썬 뿐만 아니라 R 패키지도 지원합니다. 그래서 주로 과학 분야에서 많이 사용되는 도구입니다. 그러나 덩치가 커서 작은 프로젝트에는 너무 많은 의존성과 리소스를 잡아먹는다는 단점이 있죠. 그리고 개인용도가 아닌 경우에는 유료입니다.</p>
</section>
<section id="미니포지miniforge" class="level1">
<h1>미니포지(miniforge)</h1>
<p><a href="https://github.com/conda-forge/miniforge">miniforge</a>는 덩치큰 아나콘다를 아주 날씬하게 만드는 프로젝트입니다. 그래서 아래와 같은 특징을 갖습니다.</p>
<ul>
<li>기본(그리고 유일한) 채널로 conda-forge를 사용.</li>
<li>표준 Python 인터프리터(일명 “CPython”) 대신 PyPy에 대한 지원.</li>
<li>콘다보다 더 빠른 맘바(mamba)도 지원.</li>
<li>다양한 CPU 아키텍처(x86_64, ppc64le, Apple M1을 포함한 aarch64)지원.</li>
</ul>
<section id="맘바mamba는-또-뭐죠" class="level2">
<h2 class="anchored" data-anchor-id="맘바mamba는-또-뭐죠">맘바(mamba)는 또 뭐죠?</h2>
<p>콘다의 다른 단점에 패키지 설치 속도가 느리다는 점이 었습니다. 그래서 <code>C++</code>으로 작성된 맘바라는 도구가 새로 나오게 되었죠.</p>
<blockquote class="blockquote">
<p>파이썬 생태계에는 항상 새로운 도구가 우후죽순 나오죠. 그것이 장점이자 단점 입니다.</p>
</blockquote>
</section>
<section id="설치하기" class="level2">
<h2 class="anchored" data-anchor-id="설치하기">설치하기</h2>
<p><a href="https://github.com/conda-forge/miniforge/blob/main/README.md">공식문서</a>에서 각각의 OS에 맞는 설치 방법을 찾아 볼 수 있습니다. 저는 리눅스를 사용하기에 아래 명령어로 설치 하였습니다.</p>
</section>
<section id="리눅스와-맥" class="level2">
<h2 class="anchored" data-anchor-id="리눅스와-맥">리눅스와 맥</h2>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">wget</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://github.com/conda-forge/miniforge/releases/latest/download/Mambaforge-</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$(</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">uname</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">)</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">-</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$(</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">uname</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-m</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">)</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">.sh"</span></span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">bash</span> Mambaforge-<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$(</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">uname</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">)</span>-<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$(</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">uname</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-m</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">)</span>.sh</span></code></pre></div>
</section>
<section id="윈도우즈" class="level2">
<h2 class="anchored" data-anchor-id="윈도우즈">윈도우즈</h2>
<p>Github <a href="https://github.com/conda-forge/miniforge/tree/main">repo</a>를 참고하세요.</p>
</section>
</section>
<section id="개발-환경-설정" class="level1">
<h1>개발 환경 설정</h1>
<p><code>miniforge</code>를 설치했으면 이제 실제로 사용법을 알아 보겠습니다.</p>
<section id="가상환경-만들기" class="level2">
<h2 class="anchored" data-anchor-id="가상환경-만들기">가상환경 만들기</h2>
<p>맘바포지의 <code>(base)</code> 환경에 왠만하면 아무런 패키지를 설치하지 않을 것을 권장합니다. 따라서 새로운 가상환경인 <code>ipynb</code>를 만들어 주피터랩을 사용해 보겠습니다.</p>
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb2-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">mamba</span> create <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-n</span> ipynb python=3.11 pip r-base r-essentials</span></code></pre></div>
<p>기존 <code>conda</code> 명령어에서 <code>mamba</code>로 바꾸기만 하면 됩니다. <code>python=3.11</code>을 통해 파이썬 버전을 지정할 수 있고, PYPI 패키지를 설치하기 위해 <code>pip</code>도 같이 설치해줍니다. 저는 R을 사용하기 위해 <code>r-base</code>, <code>r-essential</code> 도 설치해주었습니다.</p>
</section>
<section id="가상환경-활성화-하기" class="level2">
<h2 class="anchored" data-anchor-id="가상환경-활성화-하기">가상환경 활성화 하기</h2>
<p>생성된 가상환경은 <code>mamba env list</code>명령어를 통해 리스트로 볼 수 있습니다. 위에서 만든 가상환경을 활성화 하려면 다음 명령어를 입력합니다.</p>
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb3-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">mamba</span> activate ipynb</span></code></pre></div>
</section>
<section id="anaconda에서-제공하는-패키지" class="level2">
<h2 class="anchored" data-anchor-id="anaconda에서-제공하는-패키지">Anaconda에서 제공하는 패키지</h2>
<p><a href="https://anaconda.org/">Anaconda.org</a>에서 제공하는 파이썬과 R 패키지는 다음 명령어를 사용해 쉽게 설치할 수 있습니다. <code>miniforge</code>에서 사용하는 기본 채널은 <code>conda-forge</code>입니다. 그래서 해당 채널을 원하지 않는 경우에는 검색을 해보고 <code>conda install</code>명령어를 복사해서 사용합니다.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p><a href="https://anaconda.org/">Anaconda.org</a>를 살펴보면 동일한 이름의 패키지도 다양한 채널을 가지고 있습니다. 서로 다른 채널을 섞어서 사용하면 의존성 문제가 발생할 수 있기 때문에 가능하다면 동일한 채널의 패키지들로 구성하세요.</p>
</div>
</div>
<section id="설치하기-1" class="level3">
<h3 class="anchored" data-anchor-id="설치하기-1">설치하기</h3>
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb4-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">mamba</span> install <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">[</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">패키지</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">]</span></span></code></pre></div>
</section>
<section id="제거하기" class="level3">
<h3 class="anchored" data-anchor-id="제거하기">제거하기</h3>
<p>설치한 패키지를 제거하고 싶다면 아래 명령어를 사용합니다.</p>
<div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb5-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">mamba</span> remove <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">[</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">패키지</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">]</span></span></code></pre></div>
</section>
</section>
<section id="pypi에서-제공하는-파이썬-패키지" class="level2">
<h2 class="anchored" data-anchor-id="pypi에서-제공하는-파이썬-패키지">PyPI에서 제공하는 파이썬 패키지</h2>
<p>대부분의 경우 <code>conda</code> 명령어로 해결할 수 있지만 가끔 <code>PyPI</code>에서만 제공하는 패키지를 써야할 경우도 있습니다. 그럴 때는 먼저 <a href="https://pypi.org/">PYPI</a>에서 패키지 검색을 해보시고 아래 명령어를 사용하는 것을 권장합니다.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>이 부분이 약간이 까다로운 부분입니다. 파이썬의 내장 패키지인 <code>pip</code>을 사용하다보면 실수로 <em>global</em>(프로젝트 폴더가 아닌 전체를 의미)에 설치를 하는 경우가 생기기 때문이죠.</p>
</div>
</div>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p><code>pip</code> 명령어는 가장 마지막 수단이 되어야 합니다. 항상 <code>mamba install</code>을 최우선으로 고려하세요.</p>
</div>
</div>
</section>
<section id="cran에서-제공하는-r-패키지" class="level2">
<h2 class="anchored" data-anchor-id="cran에서-제공하는-r-패키지">CRAN에서 제공하는 R 패키지</h2>
<p>다시 한번 <a href="https://anaconda.org/">Anaconda.org</a>에서 제공하는 방법을 사용하는 것이 최선입니다만, 만약 그게 어렵다면 <code>R</code> 콘솔에 들어가서 <code>install.packages("[패키지 이름]")</code> 으로 설치할 수 있습니다.</p>
<section id="설치" class="level3">
<h3 class="anchored" data-anchor-id="설치">설치</h3>
<ol type="1">
<li>먼저 <code>conda</code> 가상 환경에서 <code>pip</code> 설치</li>
</ol>
<div class="sourceCode" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb6-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">mamba</span> install pip <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-y</span></span></code></pre></div>
<ol start="2" type="1">
<li><code>pip install</code>대신 다음 명령어를 사용하기</li>
</ol>
<div class="sourceCode" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb7-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">python</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-m</span> pip install <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">[</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">패키지</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">]</span></span></code></pre></div>
</section>
<section id="제거하기-1" class="level3">
<h3 class="anchored" data-anchor-id="제거하기-1">제거하기</h3>
<p>설치한 패키지를 제거하고 싶다면 아래 명령어를 사용합니다.</p>
<div class="sourceCode" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb8-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">python</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-m</span> pip uninstall <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">[</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">패키지</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">]</span></span>
<span id="cb8-2"></span>
<span id="cb8-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## 설치된 패키지 제거하기</span></span>
<span id="cb8-4"></span>
<span id="cb8-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">설치한</span> 패키지를 제거하고 싶다면 아래 명령어를 사용합니다.</span>
<span id="cb8-6"></span>
<span id="cb8-7"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">```</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">bash</span></span>
<span id="cb8-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">mamba</span> remove r-tidyverse</span></code></pre></div>
</section>
</section>
<section id="가상환경-비활성화하기" class="level2">
<h2 class="anchored" data-anchor-id="가상환경-비활성화하기">가상환경 비활성화하기</h2>
<p>일반적으로는 그냥 터미널을 꺼버리고는 합니다만, 실수를 방지하기 위해 다음 명령어를 습관적으로 써주는 것이 좋습니다.</p>
<div class="sourceCode" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb9-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">mamba</span> deactivate </span></code></pre></div>
</section>
<section id="가상환경-제거하기" class="level2">
<h2 class="anchored" data-anchor-id="가상환경-제거하기">가상환경 제거하기</h2>
<p>필요없는 가상 환경은 다음과 같이 제거 합니다.</p>
<div class="sourceCode" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb10-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">mamba</span> env remove <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-n</span> ipynb</span></code></pre></div>
</section>
<section id="의존성-정보를-파일로-저장하기" class="level2">
<h2 class="anchored" data-anchor-id="의존성-정보를-파일로-저장하기">의존성 정보를 파일로 저장하기</h2>
<p>배포 혹은 프로젝트간의 전환을 위해 의존성을 파일로 저장해야하는 경우가 생깁니다. 그럴 때에는 아래와 같이 <code>env.yaml</code>파일을 생성하면 됩니다.</p>
<div class="sourceCode" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb11-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">mamba</span> env export <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> env.yaml</span></code></pre></div>
</section>
<section id="의존성-파일로-부터-가상환경-만들기" class="level2">
<h2 class="anchored" data-anchor-id="의존성-파일로-부터-가상환경-만들기">의존성 파일로 부터 가상환경 만들기</h2>
<p>위 명령어로 생성된 파일을 가지고 다음 명령어를 사용해 새로운 가상환경을 만들 수 있습니다. 생성된 가상환경의 이름은 <code>env.yaml</code> 파일 속에 적혀있는 것과 동일합니다.</p>
<div class="sourceCode" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb12-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">mamba</span> env create <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-f</span> env.yaml</span></code></pre></div>
</section>
</section>
<section id="마치며" class="level1">
<h1>마치며</h1>
<p>파이썬과 R에는 다양한 패키지가 있습니다. 그렇기 때문에 패키지의 버전과 호환성을 관리하는 일은 종종 문제를 일으킵니다. 이미 다양한 의존성 관리 도구들이 있지만 각각에는 장단점이 존재하고 유저의 취향과 프로젝트에 따라 도구를 선택해야 합니다. 그러니 패키지 관리에는 왕도가 없습니다. 항상 최신 도구가 나오면 써보고 적용해보세요.</p>


</section>

 ]]></description>
  <category>python</category>
  <category>miniforge</category>
  <category>mamba</category>
  <category>anaconda</category>
  <category>conda</category>
  <category>R</category>
  <guid>https://tomorrow-lab.github.io/posts/miniforge/</guid>
  <pubDate>Sat, 27 Jan 2024 15:00:00 GMT</pubDate>
</item>
<item>
  <title>파이썬 statsmodels로 통계분석</title>
  <dc:creator>Taeyoon kim</dc:creator>
  <link>https://tomorrow-lab.github.io/posts/python_StatisticalTesting.html</link>
  <description><![CDATA[ 




<p>통계적 추론이라는 것은 제한된 실험 데이터에서 얻은 결과를 모집단에도 적용하려는 것입니다. 이번 포스트에서는 통계적 추론에 사용되는 검정법을 배워봅니다.</p>
<blockquote class="blockquote">
<p>여기에 사용된 코드 <a href="https://github.com/gedeck/practical-statistics-for-data-scientists">출처</a></p>
</blockquote>
<section id="통계적-추론과-유의성-검정" class="level1">
<h1>0. 통계적 추론과 유의성 검정</h1>
<div id="cell-2" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2021-07-31T15:51:48.814274Z&quot;,&quot;iopub.status.busy&quot;:&quot;2021-07-31T15:51:48.813668Z&quot;,&quot;iopub.status.idle&quot;:&quot;2021-07-31T15:51:50.411554Z&quot;,&quot;shell.execute_reply&quot;:&quot;2021-07-31T15:51:50.411148Z&quot;}" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> random</span>
<span id="cb1-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> pathlib <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> Path</span>
<span id="cb1-3"></span>
<span id="cb1-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> matplotlib.pylab <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> plt</span>
<span id="cb1-5"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> numpy <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> np</span>
<span id="cb1-6"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> pandas <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> pd</span>
<span id="cb1-7"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> statsmodels.api <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> sm</span>
<span id="cb1-8"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> statsmodels.formula.api <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> smf</span>
<span id="cb1-9"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> scipy <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> stats</span>
<span id="cb1-10"></span>
<span id="cb1-11"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span>matplotlib inline</span></code></pre></div>
</div>
<div id="cell-3" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2021-07-31T15:51:50.415859Z&quot;,&quot;iopub.status.busy&quot;:&quot;2021-07-31T15:51:50.415047Z&quot;,&quot;iopub.status.idle&quot;:&quot;2021-07-31T15:51:50.933127Z&quot;,&quot;shell.execute_reply&quot;:&quot;2021-07-31T15:51:50.932491Z&quot;}" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">try</span>:</span>
<span id="cb2-2">    <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> common</span>
<span id="cb2-3"></span>
<span id="cb2-4">    DATA <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> common.dataDirectory()</span>
<span id="cb2-5"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">except</span> <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">ImportError</span>:</span>
<span id="cb2-6">    DATA <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Path().resolve() <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data"</span></span></code></pre></div>
</div>
<div id="cell-4" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2021-07-31T15:51:50.936440Z&quot;,&quot;iopub.status.busy&quot;:&quot;2021-07-31T15:51:50.936008Z&quot;,&quot;iopub.status.idle&quot;:&quot;2021-07-31T15:51:50.939441Z&quot;,&quot;shell.execute_reply&quot;:&quot;2021-07-31T15:51:50.938998Z&quot;}" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1">WEB_PAGE_DATA_CSV <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> DATA <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"web_page_data.csv"</span></span>
<span id="cb3-2">FOUR_SESSIONS_CSV <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> DATA <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"four_sessions.csv"</span></span>
<span id="cb3-3">CLICK_RATE_CSV <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> DATA <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"click_rates.csv"</span></span>
<span id="cb3-4">IMANISHI_CSV <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> DATA <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"imanishi_data.csv"</span></span></code></pre></div>
</div>
</section>
<section id="ab-검정" class="level1">
<h1>1. A/B 검정</h1>
<p>A/B 검정은 두 가지 중에 어떤 것이 더 좋은지를 증명하기 위해 실험군을 나누어 진행하는 실험입니다. 일반적으로 대조군(Negative control)과 처리군으로 나눕니다.</p>
<p>예시로 웹페이지에서 고객들이 얼마나 머무는지 측정(session_time)하고 A/B 검정을 해보겠습니다.</p>
<div id="cell-6" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2021-07-31T15:51:50.943426Z&quot;,&quot;iopub.status.busy&quot;:&quot;2021-07-31T15:51:50.942899Z&quot;,&quot;iopub.status.idle&quot;:&quot;2021-07-31T15:51:50.950614Z&quot;,&quot;shell.execute_reply&quot;:&quot;2021-07-31T15:51:50.950176Z&quot;}" data-execution_count="4">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1">session_times <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.read_csv(WEB_PAGE_DATA_CSV)</span>
<span id="cb4-2">session_times.Time <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> session_times.Time</span></code></pre></div>
</div>
<p>먼저 상자 그림 시각화를 통해 비교해보자</p>
<div id="cell-8" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2021-07-31T15:51:50.953938Z&quot;,&quot;iopub.status.busy&quot;:&quot;2021-07-31T15:51:50.953449Z&quot;,&quot;iopub.status.idle&quot;:&quot;2021-07-31T15:51:51.122208Z&quot;,&quot;shell.execute_reply&quot;:&quot;2021-07-31T15:51:51.121742Z&quot;}" data-execution_count="5">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1">ax <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> session_times.boxplot(by<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Page"</span>, column<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Time"</span>, figsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>))</span>
<span id="cb5-2">ax.set_xlabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>)</span>
<span id="cb5-3">ax.set_ylabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Time (in seconds)"</span>)</span>
<span id="cb5-4">plt.suptitle(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>)</span>
<span id="cb5-5"></span>
<span id="cb5-6">plt.tight_layout()</span>
<span id="cb5-7">plt.show()</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://tomorrow-lab.github.io/posts/python_StatisticalTesting_files/figure-html/cell-6-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>그림으로 봐서는 페이지B의 방문객들이 좀 더 오래 머무는 것 같다. 각각의 평균값을 구해 수치로 비교해보자.</p>
<div id="cell-10" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2021-07-31T15:51:51.127007Z&quot;,&quot;iopub.status.busy&quot;:&quot;2021-07-31T15:51:51.126446Z&quot;,&quot;iopub.status.idle&quot;:&quot;2021-07-31T15:51:51.129694Z&quot;,&quot;shell.execute_reply&quot;:&quot;2021-07-31T15:51:51.129295Z&quot;}" data-execution_count="6">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1">mean_a <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> session_times[session_times.Page <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Page A"</span>].Time.mean()</span>
<span id="cb6-2">mean_b <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> session_times[session_times.Page <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Page B"</span>].Time.mean()</span>
<span id="cb6-3"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(mean_b <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> mean_a)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>35.66666666666667</code></pre>
</div>
</div>
<p>대략적으로 36초정도 차이가 난다. 문제는 이 차이가 우연에 의한 것인지 아니면 통계적으로 중요한 것인지 판단하는 것이다.</p>
<section id="순열-검정을-통한-ab-검정" class="level2">
<h2 class="anchored" data-anchor-id="순열-검정을-통한-ab-검정">1.1. 순열 검정을 통한 A/B 검정</h2>
<blockquote class="blockquote">
<p>순열검정(permutaion test): 두 개 이상의 표본을 함께 결합하여 관측값들을 무작위로 재표본으로 추출하는 과정을 말한다.</p>
</blockquote>
<p>파이썬에서 순열 검정을 구현하기 위해 아래와 같이 <code>perm_fun</code> 함수를 정의합니다.</p>
<div id="cell-12" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2021-07-31T15:51:51.135944Z&quot;,&quot;iopub.status.busy&quot;:&quot;2021-07-31T15:51:51.135276Z&quot;,&quot;iopub.status.idle&quot;:&quot;2021-07-31T15:51:51.138639Z&quot;,&quot;shell.execute_reply&quot;:&quot;2021-07-31T15:51:51.139086Z&quot;}" data-execution_count="7">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Permutation test example with stickiness</span></span>
<span id="cb8-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> perm_fun(x, nA, nB):</span>
<span id="cb8-3">    n <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> nA <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> nB</span>
<span id="cb8-4">    idx_B <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">set</span>(random.sample(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(n), nB))</span>
<span id="cb8-5">    idx_A <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">set</span>(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(n)) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> idx_B</span>
<span id="cb8-6">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> x.loc[idx_B].mean() <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> x.loc[idx_A].mean()</span>
<span id="cb8-7"></span>
<span id="cb8-8"></span>
<span id="cb8-9">nA <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> session_times[session_times.Page <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Page A"</span>].shape[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]</span>
<span id="cb8-10">nB <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> session_times[session_times.Page <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Page B"</span>].shape[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]</span>
<span id="cb8-11"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(perm_fun(session_times.Time, nA, nB))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>24.23809523809524</code></pre>
</div>
</div>
<p>단 한번의 계산을 통해서 24초라는 차이가 발생하였습니다. 계산을 반복해서 페이지A와 페이지B 사이의 시간 차이에 대한 도수 분포표를 그려봅시다.</p>
<div id="cell-14" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2021-07-31T15:51:51.177938Z&quot;,&quot;iopub.status.busy&quot;:&quot;2021-07-31T15:51:51.177524Z&quot;,&quot;iopub.status.idle&quot;:&quot;2021-07-31T15:51:51.925302Z&quot;,&quot;shell.execute_reply&quot;:&quot;2021-07-31T15:51:51.924891Z&quot;}" data-execution_count="8">
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1">random.seed(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb10-2">perm_diffs <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [perm_fun(session_times.Time, nA, nB) <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> _ <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span>)]</span>
<span id="cb10-3"></span>
<span id="cb10-4">fig, ax <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> plt.subplots(figsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>))</span>
<span id="cb10-5">ax.hist(perm_diffs, bins<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">11</span>, rwidth<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.9</span>)</span>
<span id="cb10-6">ax.axvline(x<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>mean_b <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> mean_a, color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>, lw<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span>
<span id="cb10-7">ax.text(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">190</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Observed</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">difference"</span>, bbox<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>{<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"facecolor"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"white"</span>})</span>
<span id="cb10-8">ax.set_xlabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Session time differences (in seconds)"</span>)</span>
<span id="cb10-9">ax.set_ylabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Frequency"</span>)</span>
<span id="cb10-10"></span>
<span id="cb10-11">plt.tight_layout()</span>
<span id="cb10-12">plt.show()</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://tomorrow-lab.github.io/posts/python_StatisticalTesting_files/figure-html/cell-9-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>위 그림에서 수직선은 관측된 차이입니다. 이것을 통해 순열 검정에서 가끔 실제 관찰된 차이를 넘어가는 것을 알 수 있습니다. 그렇다면 어느정도의 확률로 그런 일이 벌어질까요?</p>
<div id="cell-16" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2021-07-31T15:51:51.929497Z&quot;,&quot;iopub.status.busy&quot;:&quot;2021-07-31T15:51:51.929001Z&quot;,&quot;iopub.status.idle&quot;:&quot;2021-07-31T15:51:51.932526Z&quot;,&quot;shell.execute_reply&quot;:&quot;2021-07-31T15:51:51.932151Z&quot;}" data-execution_count="9">
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(np.mean(perm_diffs <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> mean_b <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> mean_a))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>0.121</code></pre>
</div>
</div>
<p>답은 12.1% 입니다. 이것을 통해 페이지A와 페이지B의 차이인 36초가 통계적으로 봤을때는 차이가 없어도 약 12% 확률로 발생할 수 있다는 결론을 얻었습니다.</p>
</section>
<section id="t-test를-사용한-ab-검정" class="level2">
<h2 class="anchored" data-anchor-id="t-test를-사용한-ab-검정">1.1.2. t-Test를 사용한 A/B 검정</h2>
<blockquote class="blockquote">
<p>t-테스트(t-test) 또는 t-검정 또는 스튜던트 t-테스트(Student’s t-test)는 검정통계량이 귀무가설 하에서 t-분포를 따르는 통계적 가설 검정법이다. t-테스트는 일반적으로 검정통계량이 정규 분포를 따르며 분포와 관련된 스케일링 변숫값들이 알려진 경우에 사용한다. 이때 모집단의 분산과 같은 스케일링 항을 알 수 없으나, 이를 데이터를 기반으로 한 추정값으로 대체하면 검정통계량은 t-분포를 따른다. 예를 들어 t-테스트를 사용하여 두 데이터 세트(집단)의 평균이 서로 유의하게 다른지 여부를 판별할 수 있다. -wiki</p>
</blockquote>
<p>파이썬에서는 <code>ttest_ind</code> 함수를 사용하면 손쉽게 구해볼 수 있습니다.</p>
<div id="cell-19" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2021-07-31T15:52:09.637527Z&quot;,&quot;iopub.status.busy&quot;:&quot;2021-07-31T15:52:09.637091Z&quot;,&quot;iopub.status.idle&quot;:&quot;2021-07-31T15:52:09.640118Z&quot;,&quot;shell.execute_reply&quot;:&quot;2021-07-31T15:52:09.639804Z&quot;}" data-execution_count="13">
<div class="sourceCode cell-code" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1">res <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> stats.ttest_ind(</span>
<span id="cb13-2">    session_times[session_times.Page <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Page A"</span>].Time,</span>
<span id="cb13-3">    session_times[session_times.Page <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Page B"</span>].Time,</span>
<span id="cb13-4">    equal_var<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">False</span>,</span>
<span id="cb13-5">)</span>
<span id="cb13-6"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"p-value for single sided test: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>res<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>pvalue <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.4f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>p-value for single sided test: 0.1408</code></pre>
</div>
</div>
<p>결과 값이 앞서 구한 순열 검정의 확률인 12%과 유사한 수치인 14%임을 확인 할 수 있습니다. 컴퓨터가 보급되기 전에 순열 검정은 실용적이지 않았고 그래서 통계학자들에게 t-Test가 널리 사용되었습니다.</p>
<div id="cell-21" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2021-07-31T15:52:09.645240Z&quot;,&quot;iopub.status.busy&quot;:&quot;2021-07-31T15:52:09.644835Z&quot;,&quot;iopub.status.idle&quot;:&quot;2021-07-31T15:52:09.647859Z&quot;,&quot;shell.execute_reply&quot;:&quot;2021-07-31T15:52:09.647542Z&quot;}" data-execution_count="14">
<div class="sourceCode cell-code" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1">tstat, pvalue, df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> sm.stats.ttest_ind(</span>
<span id="cb15-2">    session_times[session_times.Page <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Page A"</span>].Time,</span>
<span id="cb15-3">    session_times[session_times.Page <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Page B"</span>].Time,</span>
<span id="cb15-4">    usevar<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"unequal"</span>,</span>
<span id="cb15-5">    alternative<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"smaller"</span>,</span>
<span id="cb15-6">)</span>
<span id="cb15-7"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"p-value: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>pvalue<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.4f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>p-value: 0.1408</code></pre>
</div>
</div>
</section>
</section>
<section id="통계적-유의성과-p-values" class="level1">
<h1>2. 통계적 유의성과 P-Values</h1>
<p>통계적 유의성이란 실험 결과가 우연하게 일어난 것인지 아닌지 판단하는 것입니다. 유의 확률(p-value)는 통계적 유의성을 판단하기 위해 가정한 귀무가설에서 극단적인 결과를 얻을 확률입니다. 따라서 p-value가 낮을수록 우연한 일이 아니라고 생각 할 수 있습니다.</p>
<p>다음의 예시 데이터를 가지고 예를 들어보도록 하겠습니다. 동일한 내용이지만 구성이 다른 상품판매 페이지A, 페이지B가 있고 방문자가 구매한 횟수와 그렇지 않은 데이터를 모았다고 생각합시다.</p>
<table class="table">
<thead>
<tr class="header">
<th>결과</th>
<th style="text-align: right;">페이지A</th>
<th style="text-align: right;">페이지B</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>구매</td>
<td style="text-align: right;">200</td>
<td style="text-align: right;">182</td>
</tr>
<tr class="even">
<td>구매하지 않음</td>
<td style="text-align: right;">23539</td>
<td style="text-align: right;">22406</td>
</tr>
</tbody>
</table>
<p>페이지A가 페이지B보다 약 5% 정도 우수한 결과를 보여주었는데 이것이 통계적으로 유의성을 갖는지 순열 검정을 통해 살펴봅시다.</p>
<div id="cell-23" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2021-07-31T15:51:51.950959Z&quot;,&quot;iopub.status.busy&quot;:&quot;2021-07-31T15:51:51.950448Z&quot;,&quot;iopub.status.idle&quot;:&quot;2021-07-31T15:52:09.616641Z&quot;,&quot;shell.execute_reply&quot;:&quot;2021-07-31T15:52:09.616297Z&quot;}" data-execution_count="10">
<div class="sourceCode cell-code" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1">random.seed(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb17-2">obs_pct_diff <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">200</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">23739</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">182</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">22588</span>)</span>
<span id="cb17-3"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Observed difference: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>obs_pct_diff<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.4f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">%"</span>)</span>
<span id="cb17-4">conversion <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">45945</span></span>
<span id="cb17-5">conversion.extend([<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">382</span>)</span>
<span id="cb17-6">conversion <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.Series(conversion)</span>
<span id="cb17-7"></span>
<span id="cb17-8">perm_diffs <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> perm_fun(conversion, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">23739</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">22588</span>) <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> _ <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span>)]</span>
<span id="cb17-9"></span>
<span id="cb17-10">fig, ax <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> plt.subplots(figsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>))</span>
<span id="cb17-11">ax.hist(perm_diffs, bins<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">11</span>, rwidth<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.9</span>)</span>
<span id="cb17-12">ax.axvline(x<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>obs_pct_diff, color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>, lw<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span>
<span id="cb17-13">ax.text(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.06</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">200</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Observed</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">difference"</span>, bbox<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>{<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"facecolor"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"white"</span>})</span>
<span id="cb17-14">ax.set_xlabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Conversion rate (percent)"</span>)</span>
<span id="cb17-15">ax.set_ylabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Frequency"</span>)</span>
<span id="cb17-16"></span>
<span id="cb17-17">plt.tight_layout()</span>
<span id="cb17-18">plt.show()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Observed difference: 0.0368%</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://tomorrow-lab.github.io/posts/python_StatisticalTesting_files/figure-html/cell-13-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>약 1000번의 순열 검정을 통해 얻은 히스토그램을 살펴보니 관측된 값은 충분히 우연에 의한 것으로 보입니다. 그러나 좀 더 명확하게 하기 위해 p-value를 계산해봅시다.</p>
<section id="p-value-구하기" class="level2">
<h2 class="anchored" data-anchor-id="p-value-구하기">2.1. P-Value 구하기</h2>
<p>p-value는 순열 검정에서 얻은 결과 중에 관찰된 차이와 같거나 더 큰 차이를 보이는 경우의 비율이라고 할 수 있기에 다음과 같이 추정할 수 있습니다.</p>
<div id="cell-25" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2021-07-31T15:52:09.621617Z&quot;,&quot;iopub.status.busy&quot;:&quot;2021-07-31T15:52:09.620951Z&quot;,&quot;iopub.status.idle&quot;:&quot;2021-07-31T15:52:09.624902Z&quot;,&quot;shell.execute_reply&quot;:&quot;2021-07-31T15:52:09.624440Z&quot;}" data-execution_count="11">
<div class="sourceCode cell-code" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(np.mean([diff <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> obs_pct_diff <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> diff <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> perm_diffs]))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>0.332</code></pre>
</div>
</div>
<p>예상한 것처럼 30%의 확률로 우연에 의해서 나타날 수 있는 차이였습니다. 따라서 페이지A와 페이지B의 차이는 통계적으로 유의미하지 않다고 말할 수 있겠습니다.</p>
</section>
</section>
<section id="일원-분산분석anova" class="level1">
<h1>3. 일원 분산분석(ANOVA )</h1>
<p>A/B 검정이 아닌 여러 그룹간의 통계적 유의미한 차이를 검정하는 절차를 분산분석이라 합니다. 예시로 페이지 1,2,3,4에 방문자들이 머문 시간에 대한 데이터를 살펴보겠습니다. 먼저 데이터셋을 불러옵니다.</p>
<div id="cell-27" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2021-07-31T15:52:09.774360Z&quot;,&quot;iopub.status.busy&quot;:&quot;2021-07-31T15:52:09.773586Z&quot;,&quot;iopub.status.idle&quot;:&quot;2021-07-31T15:52:09.781740Z&quot;,&quot;shell.execute_reply&quot;:&quot;2021-07-31T15:52:09.781338Z&quot;}" data-execution_count="16">
<div class="sourceCode cell-code" id="cb21" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(pd.read_csv(FOUR_SESSIONS_CSV).head())</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     Page  Time
0  Page 1   164
1  Page 2   178
2  Page 3   175
3  Page 4   155
4  Page 1   172</code></pre>
</div>
</div>
<p>네 그룹의 상자그림을 시각화해서 어떤 차이가 있는지 살펴봅시다.</p>
<div id="cell-29" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2021-07-31T15:52:09.652764Z&quot;,&quot;iopub.status.busy&quot;:&quot;2021-07-31T15:52:09.652004Z&quot;,&quot;iopub.status.idle&quot;:&quot;2021-07-31T15:52:09.769845Z&quot;,&quot;shell.execute_reply&quot;:&quot;2021-07-31T15:52:09.769535Z&quot;}" data-execution_count="15">
<div class="sourceCode cell-code" id="cb23" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1">four_sessions <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.read_csv(FOUR_SESSIONS_CSV)</span>
<span id="cb23-2"></span>
<span id="cb23-3">ax <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> four_sessions.boxplot(by<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Page"</span>, column<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Time"</span>, figsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>))</span>
<span id="cb23-4">ax.set_xlabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Page"</span>)</span>
<span id="cb23-5">ax.set_ylabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Time (in seconds)"</span>)</span>
<span id="cb23-6">plt.suptitle(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>)</span>
<span id="cb23-7">plt.title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>)</span>
<span id="cb23-8"></span>
<span id="cb23-9">plt.tight_layout()</span>
<span id="cb23-10">plt.show()</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://tomorrow-lab.github.io/posts/python_StatisticalTesting_files/figure-html/cell-16-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<section id="순열검정을-통한-one-way-anova" class="level2">
<h2 class="anchored" data-anchor-id="순열검정을-통한-one-way-anova">3.1. 순열검정을 통한 one-way ANOVA</h2>
<p>파이썬에서는 다음 코드를 사용해 순열 검정을 통해 ANOVA 분석을 진행할 수 있습니다.</p>
<div id="cell-31" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2021-07-31T15:52:09.791873Z&quot;,&quot;iopub.status.busy&quot;:&quot;2021-07-31T15:52:09.791415Z&quot;,&quot;iopub.status.idle&quot;:&quot;2021-07-31T15:52:09.793964Z&quot;,&quot;shell.execute_reply&quot;:&quot;2021-07-31T15:52:09.793625Z&quot;}" data-execution_count="17">
<div class="sourceCode cell-code" id="cb24" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1">observed_variance <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> four_sessions.groupby(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Page"</span>).mean().var()[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]</span>
<span id="cb24-2"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Observed means:"</span>, four_sessions.groupby(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Page"</span>).mean().values.ravel())</span>
<span id="cb24-3"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Variance:"</span>, observed_variance)</span>
<span id="cb24-4"></span>
<span id="cb24-5"></span>
<span id="cb24-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Permutation test example with stickiness</span></span>
<span id="cb24-7"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> perm_test(df):</span>
<span id="cb24-8">    df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> df.copy()</span>
<span id="cb24-9">    df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Time"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.random.permutation(df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Time"</span>].values)</span>
<span id="cb24-10">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> df.groupby(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Page"</span>).mean().var()[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]</span>
<span id="cb24-11"></span>
<span id="cb24-12"></span>
<span id="cb24-13"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(perm_test(four_sessions))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Observed means: [172.8 182.6 175.6 164.6]
Variance: 55.426666666666655
57.02666666666678</code></pre>
</div>
</div>
<div id="cell-32" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2021-07-31T15:52:09.802476Z&quot;,&quot;iopub.status.busy&quot;:&quot;2021-07-31T15:52:09.801939Z&quot;,&quot;iopub.status.idle&quot;:&quot;2021-07-31T15:52:13.868684Z&quot;,&quot;shell.execute_reply&quot;:&quot;2021-07-31T15:52:13.868143Z&quot;}" data-execution_count="18">
<div class="sourceCode cell-code" id="cb26" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1">random.seed(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb26-2">perm_variance <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [perm_test(four_sessions) <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> _ <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3000</span>)]</span>
<span id="cb26-3"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Pr(Prob)"</span>, np.mean([var <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> observed_variance <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> var <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> perm_variance]))</span>
<span id="cb26-4"></span>
<span id="cb26-5">fig, ax <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> plt.subplots(figsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>))</span>
<span id="cb26-6">ax.hist(perm_variance, bins<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">11</span>, rwidth<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.9</span>)</span>
<span id="cb26-7">ax.axvline(x<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>observed_variance, color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>, lw<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span>
<span id="cb26-8">ax.text(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">60</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">200</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Observed</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">variance"</span>, bbox<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>{<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"facecolor"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"white"</span>})</span>
<span id="cb26-9">ax.set_xlabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Variance"</span>)</span>
<span id="cb26-10">ax.set_ylabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Frequency"</span>)</span>
<span id="cb26-11"></span>
<span id="cb26-12">plt.tight_layout()</span>
<span id="cb26-13">plt.show()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Pr(Prob) 0.07766666666666666</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://tomorrow-lab.github.io/posts/python_StatisticalTesting_files/figure-html/cell-18-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Pr(Prob)의 값은 p-value이며 결과는 0.07입니다. 통상적인 임계 p-value 값인 0.05이상임으로 네 페이지간의 차이가 우연히 발생할 수 있다고 결론 내릴 수 있습니다.</p>
</section>
<section id="f-통계량을-통한-one-way-anova" class="level2">
<h2 class="anchored" data-anchor-id="f-통계량을-통한-one-way-anova">3.2. F-통계량을 통한 one-way ANOVA</h2>
<p>F-통계량은 잔차 오류에 인한 분산과 그룹 평균의 분산에 대한 비율을 기초로 합니다. 비율이 높으면 통계적으로 유의미 하다고 할 수 있고 이를 토대로 p-value를 계산할 수 있습니다.</p>
<div id="cell-34" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2021-07-31T15:52:13.877282Z&quot;,&quot;iopub.status.busy&quot;:&quot;2021-07-31T15:52:13.876749Z&quot;,&quot;iopub.status.idle&quot;:&quot;2021-07-31T15:52:13.886417Z&quot;,&quot;shell.execute_reply&quot;:&quot;2021-07-31T15:52:13.885960Z&quot;}" data-execution_count="19">
<div class="sourceCode cell-code" id="cb28" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1">model <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> smf.ols(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Time ~ Page"</span>, data<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>four_sessions).fit()</span>
<span id="cb28-2"></span>
<span id="cb28-3">aov_table <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> sm.stats.anova_lm(model)</span>
<span id="cb28-4"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(aov_table)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>            df  sum_sq     mean_sq         F    PR(&gt;F)
Page       3.0   831.4  277.133333  2.739825  0.077586
Residual  16.0  1618.4  101.150000       NaN       NaN</code></pre>
</div>
</div>
<p><code>df</code>는 자유도, <code>sum_sq</code>는 제곱합, <code>mean_sq</code>는 평균제곱, <code>F</code>는 F-통계량을 나타냅니다.</p>
<div id="cell-36" class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2021-07-31T15:52:13.937438Z&quot;,&quot;iopub.status.busy&quot;:&quot;2021-07-31T15:52:13.936755Z&quot;,&quot;iopub.status.idle&quot;:&quot;2021-07-31T15:52:13.944405Z&quot;,&quot;shell.execute_reply&quot;:&quot;2021-07-31T15:52:13.943932Z&quot;}" data-execution_count="20">
<div class="sourceCode cell-code" id="cb30" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1">res <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> stats.f_oneway(</span>
<span id="cb30-2">    four_sessions[four_sessions.Page <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Page 1"</span>].Time,</span>
<span id="cb30-3">    four_sessions[four_sessions.Page <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Page 2"</span>].Time,</span>
<span id="cb30-4">    four_sessions[four_sessions.Page <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Page 3"</span>].Time,</span>
<span id="cb30-5">    four_sessions[four_sessions.Page <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Page 4"</span>].Time,</span>
<span id="cb30-6">)</span>
<span id="cb30-7"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"F-Statistic: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>res<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>statistic <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.4f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb30-8"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"p-value: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>res<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>pvalue <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.4f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>F-Statistic: 1.3699
p-value: 0.0388</code></pre>
</div>
</div>
<p>F-통계량을 사용한 방법은 p-value 값이 더 적게나와 임계값인 0.05 이하입니다. 그러나 ANOVA 분석의 p-value가 낮게 나왔다고 해서 모든 그룹에서 통계적으로 차이가 있다고 할 수는 없습니다. 추가적인 Ad hoc 분석을 진행해 어떤 그룹에서 차이가 있는지 확인해보아야 합니다.</p>
</section>
</section>
<section id="마무리하며" class="level1">
<h1>4. 마무리하며</h1>
<p>현재 실험 데이터를 분석할때는 통계적 추론과 유의성 검증은 필수적인 절차입니다. 그렇기 때문에 반대로 실험에 대조군을 반드시 포함하며 데이터에 인위적인 조작이 없도록 하는 것이 더욱 중요해 졌습니다.</p>


</section>

 ]]></description>
  <category>python</category>
  <category>statstics</category>
  <guid>https://tomorrow-lab.github.io/posts/python_StatisticalTesting.html</guid>
  <pubDate>Fri, 06 Oct 2023 15:00:00 GMT</pubDate>
</item>
<item>
  <title>파이썬 통계분석하기</title>
  <dc:creator>Taeyoon kim</dc:creator>
  <link>https://tomorrow-lab.github.io/posts/python_Statistics.html</link>
  <description><![CDATA[ 




<section id="왜-파이썬으로-통계분석을-하나요" class="level1">
<h1>왜 파이썬으로 통계분석을 하나요?</h1>
<p>통계 계산을 위한 프로그래밍 언어에 R 프로그래밍 언어(줄여서 R)가 있는데, 왜 파이썬을 써야 할까요?</p>
<p>R은 문법 자체부터 통계에 특화되어 있고 여러가지 통계분석을 할 수 있습니다. 그럼에도 불구하고 제가 파이썬을 통계분석에 사용하는 이유는 간단합니다. 파이썬은 보다 범용적인 언어이고 라이브러리가 풍부해서 제가 원하는 기능은 거의 이미 다 있기 때문이죠.</p>
<section id="예를-들어봅시다." class="level2">
<h2 class="anchored" data-anchor-id="예를-들어봅시다.">예를 들어봅시다.</h2>
<p>여기, <strong>brain_size</strong> 라는 데이터를 살펴 보겠습니다.</p>
<div id="cell-2" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 필요한 라이브러리를 불러옵니다.</span></span>
<span id="cb1-2"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span>matplotlib inline</span>
<span id="cb1-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> matplotlib.pyplot <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> plt</span>
<span id="cb1-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> pandas <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> pd</span></code></pre></div>
</div>
</section>
<section id="csv-파일-읽어오기" class="level2">
<h2 class="anchored" data-anchor-id="csv-파일-읽어오기">CSV 파일 읽어오기</h2>
<p><code>brain_size</code> 데이터는 <strong>Willerman</strong>이 1991년에 사람의 뇌 크기와 무게, 그리고 IQ에 대하여 측정한 값입니다. 범주형의 데이터와 수치형 데이터로 구성 되어 있죠.</p>
<p>Pandas의 read_csv 기능을 이용해 데이터프레임을 만들어 보겠습니다.</p>
<div id="cell-4" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1">df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.read_csv(</span>
<span id="cb2-2">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"http://www.scipy-lectures.org/_downloads/brain_size.csv"</span>,</span>
<span id="cb2-3">    sep<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">";"</span>,</span>
<span id="cb2-4">    index_col<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb2-5">    na_values<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"."</span>,</span>
<span id="cb2-6">)</span>
<span id="cb2-7">df.head()  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 상단의 5개의 데이터 확인하기</span></span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="2">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Gender</th>
<th data-quarto-table-cell-role="th">FSIQ</th>
<th data-quarto-table-cell-role="th">VIQ</th>
<th data-quarto-table-cell-role="th">PIQ</th>
<th data-quarto-table-cell-role="th">Weight</th>
<th data-quarto-table-cell-role="th">Height</th>
<th data-quarto-table-cell-role="th">MRI_Count</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>Female</td>
<td>133</td>
<td>132</td>
<td>124</td>
<td>118.0</td>
<td>64.5</td>
<td>816932</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2</td>
<td>Male</td>
<td>140</td>
<td>150</td>
<td>124</td>
<td>NaN</td>
<td>72.5</td>
<td>1001121</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3</td>
<td>Male</td>
<td>139</td>
<td>123</td>
<td>150</td>
<td>143.0</td>
<td>73.3</td>
<td>1038437</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">4</td>
<td>Male</td>
<td>133</td>
<td>129</td>
<td>128</td>
<td>172.0</td>
<td>68.8</td>
<td>965353</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">5</td>
<td>Female</td>
<td>137</td>
<td>132</td>
<td>134</td>
<td>147.0</td>
<td>65.0</td>
<td>951545</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>간단히 살펴보면, 총 40명의 사람들의 성별, IQ, 몸무게, 키 그리고 MRI_count(total pixel Count from the 18 MRI scans) 값이 측정되어 있습니다. IQ의 경우 3종류로 세분화 되어있는데 각각을 알아 보면 아래와 같습니다.</p>
<ul>
<li>Full Scale Intelligence Quotient (FSIQ) : VIQ와 PIQ의 종합적인 수치입니다</li>
<li>Verbal IQ (VIQ) : 언어적인 측면을 측정합니다.</li>
<li>Performance IQ (PIQ) : 논리, 계산적인 측면을 측정</li>
</ul>
</section>
<section id="pandas-설명통계" class="level2">
<h2 class="anchored" data-anchor-id="pandas-설명통계">Pandas 설명통계</h2>
<p>pandas에서는 간단하게 평균값과 표준편차등을 계산해주는 기능이 있습니다.</p>
<p><code>describe()</code> 함수를 사용하면 모든 열에 대한 설명통계값을 보여줍니다.</p>
<div id="cell-6" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># padas 에서 제공하는 설명 통계</span></span>
<span id="cb3-2">df.describe()</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="3">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">FSIQ</th>
<th data-quarto-table-cell-role="th">VIQ</th>
<th data-quarto-table-cell-role="th">PIQ</th>
<th data-quarto-table-cell-role="th">Weight</th>
<th data-quarto-table-cell-role="th">Height</th>
<th data-quarto-table-cell-role="th">MRI_Count</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">count</td>
<td>40.000000</td>
<td>40.000000</td>
<td>40.00000</td>
<td>38.000000</td>
<td>39.000000</td>
<td>4.000000e+01</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">mean</td>
<td>113.450000</td>
<td>112.350000</td>
<td>111.02500</td>
<td>151.052632</td>
<td>68.525641</td>
<td>9.087550e+05</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">std</td>
<td>24.082071</td>
<td>23.616107</td>
<td>22.47105</td>
<td>23.478509</td>
<td>3.994649</td>
<td>7.228205e+04</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">min</td>
<td>77.000000</td>
<td>71.000000</td>
<td>72.00000</td>
<td>106.000000</td>
<td>62.000000</td>
<td>7.906190e+05</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">25%</td>
<td>89.750000</td>
<td>90.000000</td>
<td>88.25000</td>
<td>135.250000</td>
<td>66.000000</td>
<td>8.559185e+05</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">50%</td>
<td>116.500000</td>
<td>113.000000</td>
<td>115.00000</td>
<td>146.500000</td>
<td>68.000000</td>
<td>9.053990e+05</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">75%</td>
<td>135.500000</td>
<td>129.750000</td>
<td>128.00000</td>
<td>172.000000</td>
<td>70.500000</td>
<td>9.500780e+05</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">max</td>
<td>144.000000</td>
<td>150.000000</td>
<td>150.00000</td>
<td>192.000000</td>
<td>77.000000</td>
<td>1.079549e+06</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>IQ의 평균값은 113이군요. 몸무게는 kg으로 변환하면 약 70kg쯤 됩니다.</p>
</section>
<section id="산포-행렬을-그려보겠습니다." class="level2">
<h2 class="anchored" data-anchor-id="산포-행렬을-그려보겠습니다.">산포 행렬을 그려보겠습니다.</h2>
<p>전체적인 데이터의 양상을 보기에는 시각화가 중요합니다. 파이썬에서는 간단하게 산포 행렬(sactter matrix)를 그려 볼 수 있습니다.</p>
<p>먼저 키와 몸무게, MRI_count 간의 상관관계를 보겠습니다.</p>
<div id="cell-8" class="cell" data-scrolled="false" data-execution_count="4">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Plotting data</span></span>
<span id="cb4-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> pandas.plotting <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> scatter_matrix</span>
<span id="cb4-3"></span>
<span id="cb4-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 키와 몸무게, MRI_count</span></span>
<span id="cb4-5">scatter_matrix(df[[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Weight"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Height"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"MRI_Count"</span>]])</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="4">
<pre><code>array([[&lt;matplotlib.axes._subplots.AxesSubplot object at 0x000000000A1D2B70&gt;,
        &lt;matplotlib.axes._subplots.AxesSubplot object at 0x000000000A443668&gt;,
        &lt;matplotlib.axes._subplots.AxesSubplot object at 0x000000000A47E588&gt;],
       [&lt;matplotlib.axes._subplots.AxesSubplot object at 0x000000000A4B9588&gt;,
        &lt;matplotlib.axes._subplots.AxesSubplot object at 0x000000000A56D4A8&gt;,
        &lt;matplotlib.axes._subplots.AxesSubplot object at 0x000000000A56D4E0&gt;],
       [&lt;matplotlib.axes._subplots.AxesSubplot object at 0x000000000A5DC978&gt;,
        &lt;matplotlib.axes._subplots.AxesSubplot object at 0x000000000A614EB8&gt;,
        &lt;matplotlib.axes._subplots.AxesSubplot object at 0x000000000A643B70&gt;]], dtype=object)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://tomorrow-lab.github.io/posts/python_Statistics_files/figure-html/cell-5-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>키와 몸무계는 서로 연관이 있는듯 하고 나머지는 그다지 서로 연관이 없어 보입니다.</p>
<p>그 다음으로는 여러 IQ 수치간에 상관관계를 알아 보죠.</p>
<div id="cell-10" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1">scatter_matrix(df[[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"PIQ"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"VIQ"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"FSIQ"</span>]])</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="5">
<pre><code>array([[&lt;matplotlib.axes._subplots.AxesSubplot object at 0x000000000A9AD6A0&gt;,
        &lt;matplotlib.axes._subplots.AxesSubplot object at 0x000000000A9F34A8&gt;,
        &lt;matplotlib.axes._subplots.AxesSubplot object at 0x000000000AA2E3C8&gt;],
       [&lt;matplotlib.axes._subplots.AxesSubplot object at 0x000000000AA64358&gt;,
        &lt;matplotlib.axes._subplots.AxesSubplot object at 0x000000000AAA0358&gt;,
        &lt;matplotlib.axes._subplots.AxesSubplot object at 0x000000000AAA0390&gt;],
       [&lt;matplotlib.axes._subplots.AxesSubplot object at 0x000000000AB01EB8&gt;,
        &lt;matplotlib.axes._subplots.AxesSubplot object at 0x000000000AB3DEB8&gt;,
        &lt;matplotlib.axes._subplots.AxesSubplot object at 0x000000000AB72EB8&gt;]], dtype=object)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://tomorrow-lab.github.io/posts/python_Statistics_files/figure-html/cell-6-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>당연하지만, FSIQ는 VIQ, PIQ 각각과 연관성이 있어 보입니다. VIQ와 PIQ간에는 애매하게 연관성이 없어 보이네요. FSIQ의 히스토그램에서는 100 - 125 사이에는 데이터가 없는 것을 확인 할 수 있습니다.</p>
</section>
</section>
<section id="가설-검정-두-그룹간의-비교" class="level1">
<h1>가설 검정: 두 그룹간의 비교</h1>
<p><strong>T-test</strong> 는 두 그룹간의 평균의 차이가 통계적으로 의미가 있는지를 알아볼때 사용됩니다.T-test에는 다음과 같이 세 종류가 있습니다.</p>
<ol type="1">
<li>1-sample T-test</li>
<li>2-sample T-test</li>
<li>paired T-test</li>
</ol>
<p>여기서는 간단한 가설 검정 방법으로 <strong>scipy</strong>의 <strong>scipy.stats</strong> 라이브러리를 사용해, 1-sample, 2-sample T-test를 해보겠습니다.</p>
<blockquote class="blockquote">
<p>각각의 T-test는 사용되는 경우가 다르기에 주의 해야 합니다.</p>
</blockquote>
<section id="sample-t-test" class="level2">
<h2 class="anchored" data-anchor-id="sample-t-test">1-sample T-test</h2>
<p>하나의 집단의 평균이 특정 기준보다 유의미하게 다른지 를 알아보는 분석 방법입니다. Student T-test이라고도 하는 1-sample T-test 를 사용하려면 <code>scipy.stats.ttest_1samp()</code> 함수를 사용하면 됩니다.</p>
<div id="cell-12" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> scipy <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> stats</span></code></pre></div>
</div>
<div id="cell-13" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## Student’s t-test: the simplest statistical test</span></span>
<span id="cb9-2">stats.ttest_1samp(df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"VIQ"</span>], <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb9-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># VIQ의 평균값이 0과 통계적으로 유의미하게 다른지 알아 보겠습니다.</span></span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="7">
<pre><code>Ttest_1sampResult(statistic=30.088099970849328, pvalue=1.3289196468728067e-28)</code></pre>
</div>
</div>
<p>간단하게 결론만 말하자면, p-value가 아주 낮음(10의 -28제곱) 으로 VIQ의 평균은 0이 아니라고 말할 수 있습니다.</p>
</section>
<section id="sample-t-test-1" class="level2">
<h2 class="anchored" data-anchor-id="sample-t-test-1">2-sample t-test</h2>
<p>서로 다른 두개의 그룹 간 평균의 차이가 유의미 한지 여부를 판단하기 위해 시행합니다. 2-sample t-test 는 <code>scipy.stats.ttest_ind():</code> 함수를 사용합니다.</p>
<p>예를 들어 여자의 VIQ와 남자의 VIQ의 평균은 통계적으로 차이가 있는지 알아 보겠습니다.</p>
<div id="cell-15" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 여자의 VIQ</span></span>
<span id="cb11-2">female_viq <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> df[df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Gender"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Female"</span>][<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"VIQ"</span>]</span>
<span id="cb11-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 남자의 VIQ</span></span>
<span id="cb11-4">male_viq <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> df[df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Gender"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Male"</span>][<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"VIQ"</span>]</span>
<span id="cb11-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 두개의 리스트를 가지고 t-test실행</span></span>
<span id="cb11-6">stats.ttest_ind(female_viq, male_viq)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="8">
<pre><code>Ttest_indResult(statistic=-0.77261617232750113, pvalue=0.44452876778583217)</code></pre>
</div>
</div>
<p>p-value가 0.44로 아주 높게 나왔습니다. 따라서 기무가설이었던 <em>남자와 여자의 VIQ 평균에는 차이가 있다.</em> 는 기각되고 <em>차이가 없다</em> 라고 결론을 낼 수 있습니다.</p>
</section>
<section id="paired-tests" class="level2">
<h2 class="anchored" data-anchor-id="paired-tests">Paired tests:</h2>
<p>Paired t-test는 동일한 집단에서의 반복적인 측정에 의한 차이를 비교하기 위해 사용됩니다. 예를 들면 커피가 수면시간에 미치는 영향을 보기 위해 커피를 마시지 않고 측정하고 커피를 마시고 측정한 데이터를 수집하여 사용합니다. &gt; 전제조건을 충족하기 위해서는 실험이 길어지는 단점이 있습니다</p>
</section>
</section>
<section id="brain_size-데이터의-t-test" class="level1">
<h1>brain_size 데이터의 T-test</h1>
<p>주어진 <code>brain_size</code> 데이터에서 3가지 IQ수치 PIQ, VIQ, FSIQ가 제공 되고 있는데, FSIQ 평균 값과 PIQ 평균이 통계적으로 차이가 있는지 알아 보도록 하겠습니다. 이를 위해서 2-sample T-test를 수행하겠습니다.</p>
<p>먼저, 전체적인 데이터의 모습을 알기 위한 <strong>boxplot</strong>을 그려보겠습니다.</p>
<div id="cell-17" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Box plots of different columns for each gender</span></span>
<span id="cb13-2">groupby_gender <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> df.groupby(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Gender"</span>)</span>
<span id="cb13-3">groupby_gender.boxplot(column<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"FSIQ"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"VIQ"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"PIQ"</span>])</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="9">
<pre><code>Female         AxesSubplot(0.1,0.15;0.363636x0.75)
Male      AxesSubplot(0.536364,0.15;0.363636x0.75)
dtype: object</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://tomorrow-lab.github.io/posts/python_Statistics_files/figure-html/cell-10-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-18" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 2-sample t-test</span></span>
<span id="cb15-2">stats.ttest_ind(df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"FSIQ"</span>], df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"PIQ"</span>])</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="10">
<pre><code>Ttest_indResult(statistic=0.46563759638096403, pvalue=0.64277250094148408)</code></pre>
</div>
</div>
<p>T-test 결과 p-value가 0.64로 매우 높기 때문에 기무가설을 기각하지 못합니다. 따라서, FSIQ와 PIQ값에 통계적으로 유의적인 차이는 없다고 볼 수 있습니다.</p>
<p>여기서 한가지 문제 점이 있는데, 각각의 FSIQ와 PIQ값은 같은 개인에서 측정되었기 때문에, <strong>paried T-test</strong> 으로 추가적인 확인이 필요합니다.</p>
<div id="cell-20" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1">stats.ttest_rel(df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"FSIQ"</span>], df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"PIQ"</span>])</span>
<span id="cb17-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># This is equivalent to a 1-sample test on the difference:</span></span>
<span id="cb17-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># stats.ttest_1samp(df['FSIQ'] - df['PIQ'], 0)</span></span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="11">
<pre><code>Ttest_relResult(statistic=1.7842019405859857, pvalue=0.082172638183642358)</code></pre>
</div>
</div>
<p>Paired T-test결과에서도 p-value 값이 0.05 이상임으로 통계적으로 유의미한 차이가 없다고 볼 수 있습니다.</p>
</section>
<section id="성별과-viq-수치의-관계" class="level1">
<h1>성별과 VIQ 수치의 관계</h1>
<p>남성과 여성이 VIQ 차이가 있는지를 판단하기 위해서는 뇌의 크기, 키, 몸무게에 의한 영향을 배제해야 합니다. 이를 위해서는 <code>statsmodels</code> 라이브러리에서 제공하는 <code>ols</code>(ordinary least squares)모델을 사용하겠습니다. 그런 다음 <strong>F-test</strong>을 통해 통계적 유의성을 보겠습니다.</p>
<section id="f-test" class="level2">
<h2 class="anchored" data-anchor-id="f-test">F-test</h2>
<p>F-test는 두 표본의 분산에 대한 차이가 통계적으로 유의한가를 판별하는 검정기법입니다. 다른 이름으로 var-test로도 불립니다.</p>
<div id="cell-22" class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> statsmodels.formula.api <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> ols</span>
<span id="cb19-2"></span>
<span id="cb19-3">model <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ols(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"VIQ ~ Gender + MRI_Count + Height"</span>, df).fit()</span>
<span id="cb19-4"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(model.summary())</span>
<span id="cb19-5"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(model.f_test([<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                            OLS Regression Results                            
==============================================================================
Dep. Variable:                    VIQ   R-squared:                       0.246
Model:                            OLS   Adj. R-squared:                  0.181
Method:                 Least Squares   F-statistic:                     3.809
Date:                Thu, 21 Dec 2017   Prob (F-statistic):             0.0184
Time:                        15:34:54   Log-Likelihood:                -172.34
No. Observations:                  39   AIC:                             352.7
Df Residuals:                      35   BIC:                             359.3
Df Model:                           3                                         
Covariance Type:            nonrobust                                         
==================================================================================
                     coef    std err          t      P&gt;|t|      [0.025      0.975]
----------------------------------------------------------------------------------
Intercept        166.6258     88.824      1.876      0.069     -13.696     346.948
Gender[T.Male]     8.8524     10.710      0.827      0.414     -12.890      30.595
MRI_Count          0.0002   6.46e-05      2.615      0.013    3.78e-05       0.000
Height            -3.0837      1.276     -2.417      0.021      -5.674      -0.494
==============================================================================
Omnibus:                        7.373   Durbin-Watson:                   2.109
Prob(Omnibus):                  0.025   Jarque-Bera (JB):                2.252
Skew:                           0.005   Prob(JB):                        0.324
Kurtosis:                       1.823   Cond. No.                     2.40e+07
==============================================================================

Warnings:
[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.
[2] The condition number is large, 2.4e+07. This might indicate that there are
strong multicollinearity or other numerical problems.
&lt;F test: F=array([[ 0.68319608]]), p=0.4140878441244722, df_denom=35, df_num=1&gt;</code></pre>
</div>
</div>
<p>F test 결과, p-value 가 0.41로 아주 높게 나왔습니다. 따라서 기무가설을 기각하지 못합니다. 다시 말해 성별에 의한 VIQ 차이는 <strong>없다</strong> 라고 할 수 있습니다.</p>
</section>
<section id="시각화" class="level2">
<h2 class="anchored" data-anchor-id="시각화">시각화</h2>
<p>시각화를 하면 통계분석에 사용된 변수간의 상관관계를 손쉽게 확인할 수 있습니다. 아래 코드는 <code>scatter_matrix</code>를 그리는 방법입니다.</p>
<div id="cell-24" class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb21" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># This plotting is useful to get an intuitions on the relationships between</span></span>
<span id="cb21-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># our different variables</span></span>
<span id="cb21-3"></span>
<span id="cb21-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Fill in the missing values for Height for plotting</span></span>
<span id="cb21-5">df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Height"</span>].fillna(method<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pad"</span>, inplace<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb21-6"></span>
<span id="cb21-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># The parameter 'c' is passed to plt.scatter and will control the color</span></span>
<span id="cb21-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># The same holds for parameters 'marker', 'alpha' and 'cmap', that</span></span>
<span id="cb21-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># control respectively the type of marker used, their transparency and</span></span>
<span id="cb21-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># the colormap</span></span>
<span id="cb21-11">scatter_matrix(</span>
<span id="cb21-12">    df[[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"VIQ"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"MRI_Count"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Height"</span>]],</span>
<span id="cb21-13">    c<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Gender"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Female"</span>),</span>
<span id="cb21-14">    marker<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"o"</span>,</span>
<span id="cb21-15">    alpha<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7</span>,</span>
<span id="cb21-16">)</span>
<span id="cb21-17"></span>
<span id="cb21-18">fig <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> plt.gcf()</span>
<span id="cb21-19">fig.suptitle(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"purple: male, yellow: female"</span>, size<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">13</span>)</span>
<span id="cb21-20"></span>
<span id="cb21-21">plt.show()</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://tomorrow-lab.github.io/posts/python_Statistics_files/figure-html/cell-14-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="결론" class="level1">
<h1>결론</h1>
<p>시각화와 <strong>F-test</strong> 결과를 통해 성별은 VIQ값에 아무런 상관관계를 가지고 있지 않다는 것을 확인 할 수 있었습니다.</p>


</section>

 ]]></description>
  <category>python</category>
  <category>statstics</category>
  <guid>https://tomorrow-lab.github.io/posts/python_Statistics.html</guid>
  <pubDate>Sat, 16 Sep 2023 15:00:00 GMT</pubDate>
</item>
<item>
  <title>Seurat으로 scRNA seq데이터 분석하기</title>
  <dc:creator>Taeyoon kim</dc:creator>
  <link>https://tomorrow-lab.github.io/posts/scRNAseq/R_Seurat_tutorials.html</link>
  <description><![CDATA[ 




<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://tomorrow-lab.github.io/posts/scRNAseq/Seurat_logo.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:50.0%"></p>
</figure>
</div>
<section id="사전-정보" class="level1">
<h1>사전 정보</h1>
<section id="scrna-seq과-10xgenomics" class="level2">
<h2 class="anchored" data-anchor-id="scrna-seq과-10xgenomics">scRNA seq과 10xGenomics</h2>
<p>scRNA-seq는 single-cell RNA sequencing의 줄임말로, 하나의 세포에서 mRNA를 측정하는 방법입니다. 이 기술은 기존 bulk RNA-seq 방법과는 달리 하나의 세포에서 RNA를 추출하여 분석합니다. 이를 통해, 개별 세포의 유전자 발현 패턴, 전사체 감지, 변형과 발현의 상호작용 등을 이해할 수 있습니다.</p>
<p><code>10xGenomics</code>는 scRNA-seq 분석에서 매우 인기있는 플랫폼으로 droplet-based 방법을 사용합니다. droplet-based 방법은 cell barcoding 및 unique molecular identifier(UMI)를 사용하여 RNA-seq 라이브러리를 생성하는 공정으로 사실상 현재 scRNA seq분야에 표준으로 사용됩니다.</p>
</section>
</section>
<section id="사전-작업" class="level1">
<h1>사전 작업</h1>
<p><code>10xGenomics</code> 기술을 사용해 scRNA-seq을 진행하면 결과로 <code>fastq</code> 파일을 얻게 됩니다. <code>fastq</code> 파일을 <code>Seurat</code> 패키지에 바로 사용할 수는 없고, 10xGenomics에서 제공하는 <a href="https://support.10xgenomics.com/single-cell-gene-expression/software/pipelines/latest/what-is-cell-ranger">Cell Ranger</a>를 사용해 맵핑을 진행해야 합니다.</p>
<section id="시퀀싱-데이터-준비" class="level2">
<h2 class="anchored" data-anchor-id="시퀀싱-데이터-준비">시퀀싱 데이터 준비</h2>
<p>실험을 통해 다음과 같은 <code>fastq</code> 파일을 가지고 있다고 간주합니다. 여기에서는 학습 목적으로 아주 작은 데이터셋으로 진행합니다만 실제 데이터는 훨씬 큽니다.</p>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">.</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">pbmc_1k_v3_fastqs</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">)</span></span>
<span id="cb1-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> pbmc_1k_v3_S1_L001_I1_001.fastq.gz</span>
<span id="cb1-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> pbmc_1k_v3_S1_L001_R1_001.fastq.gz</span>
<span id="cb1-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> pbmc_1k_v3_S1_L001_R2_001.fastq.gz</span>
<span id="cb1-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> pbmc_1k_v3_S1_L002_I1_001.fastq.gz</span>
<span id="cb1-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> pbmc_1k_v3_S1_L002_R1_001.fastq.gz</span>
<span id="cb1-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">└──</span> pbmc_1k_v3_S1_L002_R2_001.fastq.gz</span></code></pre></div>
</section>
<section id="cell-ranger-설치" class="level2">
<h2 class="anchored" data-anchor-id="cell-ranger-설치">cell ranger 설치</h2>
<p>여기에서는 설치 방법은 생략하고 공식 홈페이지 <a href="https://support.10xgenomics.com/single-cell-gene-expression/software/pipelines/latest/installation">링크</a>를 참조하시기 바랍니다.</p>
</section>
<section id="cell-ranger-실행" class="level2">
<h2 class="anchored" data-anchor-id="cell-ranger-실행">cell ranger 실행</h2>
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb2-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">cellranger</span> count <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--id</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>run_count_1kpbmcs <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb2-2">   <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--fastqs</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>./pbmc_1k_v3_fastqs <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb2-3">   <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--sample</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>pbmc_1k_v3 <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb2-4">   <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--transcriptome</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>./refdata-gex-GRCh38-2020-A</span>
<span id="cb2-5">   <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">--nosecondary</span></span></code></pre></div>
<p>위의 명령어를 통해 cell ranger를 실행할 수 있습니다. <code>--id</code> 는 생성되는 결과의 폴더명이며, <code>--fastqs</code>는 fastq 파일이 있는 폴더의 위치, <code>--sample</code>은 metadata에 들어가는 샘플 정보, <code>--transcriptome</code>는 참조 전사체의 위치 입니다.</p>
<p>저의 경우는 10x Genomics 사이트에서 다음의 명령어로 다운로드 받았습니다. 참고로 참조 전사체는 실험에 사용된 시료에 따라 다르게 사용해야 합니다.</p>
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb3-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">wget</span> https://cf.10xgenomics.com/supp/cell-exp/refdata-gex-GRCh38-2020-A.tar.gz</span>
<span id="cb3-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tar</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-zxvf</span> refdata-gex-GRCh38-2020-A.tar.gz</span></code></pre></div>
</section>
<section id="cell-ranger-결과" class="level2">
<h2 class="anchored" data-anchor-id="cell-ranger-결과">cell ranger 결과</h2>
<p>cell ranger가 문제없이 작동했다면 <code>out</code> 폴더에 다음과 같은 파일과 폴더가 생겨납니다.</p>
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb4-1"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">.</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">out</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">)</span></span>
<span id="cb4-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> analysis</span>
<span id="cb4-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> cloupe.cloupe</span>
<span id="cb4-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> filtered_feature_bc_matrix</span>
<span id="cb4-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> filtered_feature_bc_matrix.h5</span>
<span id="cb4-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> metrics_summary.csv</span>
<span id="cb4-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> molecule_info.h5</span>
<span id="cb4-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> possorted_genome_bam.bam</span>
<span id="cb4-9"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> possorted_genome_bam.bam.bai</span>
<span id="cb4-10"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> raw_feature_bc_matrix</span>
<span id="cb4-11"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> raw_feature_bc_matrix.h5</span>
<span id="cb4-12"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">└──</span> web_summary.html</span></code></pre></div>
<p>이중에 <code>Seurat</code> 패키지가 필요로 하는 것은 <code>filtered_feature_bc_matrix</code> 폴더 입니다. 폴더안에는 다음과 같은 파일이 들어있습니다.</p>
<div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb5-1"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">.</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">filtered_feature_bc_matrix</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">)</span></span>
<span id="cb5-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> barcodes.tsv.gz</span>
<span id="cb5-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> features.tsv.gz</span>
<span id="cb5-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">└──</span> matrix.mtx.gz</span></code></pre></div>
<p>이걸로 모든 사전 준비가 완료되었습니다.</p>
</section>
<section id="사용할-패키기-불러오기" class="level2">
<h2 class="anchored" data-anchor-id="사용할-패키기-불러오기">사용할 패키기 불러오기</h2>
<section id="seurat" class="level3">
<h3 class="anchored" data-anchor-id="seurat">Seurat</h3>
<p><code>Seurat</code>은 R 프로그래밍 언어로 작성된 scRNA-seq 데이터 분석을 위한 유명한 패키지 중 하나입니다. Seurat은 높은 차원의 scRNA-seq 데이터에서 유전자 발현 패턴을 탐색하고 이를 이용하여 세포 및 클러스터의 식별과 분석, 특성 제시, 시각화 등 다양한 분석 작업을 수행할 수 있습니다. Seurat은 다양한 데이터 전처리 및 정규화 기능과 함께 차원 축소, 클러스터링, 시각화, 서브셋 생성, 유전자 발현 분석, 세포간 상호작용 분석 등 다양한 분석 도구를 제공합니다. Seurat은 현재까지 업데이트와 기능 추가가 활발하게 이루어지고 있으며, scRNA-seq 분석에 필수적인 유틸리티 패키지 중 하나입니다.</p>
</section>
<section id="scdblfinder" class="level3">
<h3 class="anchored" data-anchor-id="scdblfinder">scDblFinder</h3>
<p><code>scDblFinder</code>는 단일 세포 RNA 시퀀싱 데이터에서 더블렛(두 개의 세포가 동시에 캡처되어 하나의 세포로 보이는 것) 현상을 탐지하고 제거하기 위한 R 패키지입니다. 이 패키지는 UMI(Unique Molecular Identifier)를 기반으로하여 두 개 이상의 세포에서 동시에 탐지된 UMIs를 찾아서 더블렛으로 추정하고, 더블렛으로 추정된 셀을 제거합니다. 이를 통해 scRNA-seq 데이터의 정확도와 해석력을 높일 수 있습니다. 또한, scDblFinder는 Seurat 및 SingleCellExperiment 형식의 데이터를 지원하며, 다양한 분석 옵션을 제공하여 사용자가 데이터에 맞게 조정할 수 있습니다.</p>
</section>
<section id="tidyverse" class="level3">
<h3 class="anchored" data-anchor-id="tidyverse">tidyverse</h3>
<p><code>tidyverse</code>는 데이터 분석에 필요한 필수 R 패키지들의 모음으로 데이터 처리, 시각화, 모델링, 프로그래밍 등의 다양한 작업을 수행하는 데 사용됩니다. 주요 패키지로는 ggplot2, dplyr, tidyr, readr, purrr, tibble, stringr, forcats 등이 있습니다.</p>
<div id="c6faf600-f5e3-4443-ad00-2a3e82f04603" class="cell" data-tags="[]" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-execution_count="2">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">options</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">verbose=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Seurat 함수들이 실행될 때 로그 메시지를 표시하지 않습니다.</span></span>
<span id="cb6-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">options</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">tidyverse.quiet=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># tidyverse 패키지의 로그 메시지가 출력되지 않습니다.</span></span>
<span id="cb6-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">options</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">warn=</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb6-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">options</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">future.rng.onMisuse=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ignore"</span>)</span>
<span id="cb6-5"></span>
<span id="cb6-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(Seurat)</span>
<span id="cb6-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(tidyverse)</span>
<span id="cb6-8"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(scDblFinder)</span>
<span id="cb6-9"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(future) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Enable parallelization</span></span>
<span id="cb6-10"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plan</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"multicore"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">workers=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># cpu core에 맞게 조절합니다.</span></span>
<span id="cb6-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># plan()</span></span></code></pre></div>
</div>
</section>
<section id="패키지-버전-확인" class="level3">
<h3 class="anchored" data-anchor-id="패키지-버전-확인">패키지 버전 확인</h3>
<section id="사용한-seurat-패키지의-버전" class="level4">
<h4 class="anchored" data-anchor-id="사용한-seurat-패키지의-버전">사용한 Seurat 패키지의 버전</h4>
<div id="0332804e-963f-4235-86bf-45206f0d1957" class="cell" data-tags="[]" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-execution_count="3">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">packageVersion</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Seurat"</span>)</span></code></pre></div>
<div class="cell-output cell-output-display">
<pre><code>[1] ‘4.3.0’</code></pre>
</div>
</div>
</section>
<section id="사용한-scdblfinder-패키지의-버전" class="level4">
<h4 class="anchored" data-anchor-id="사용한-scdblfinder-패키지의-버전">사용한 scDblFinder 패키지의 버전</h4>
<div id="9f66c258-5686-4027-ab86-ca445977451c" class="cell" data-tags="[]" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-execution_count="4">
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">packageVersion</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"scDblFinder"</span>)</span></code></pre></div>
<div class="cell-output cell-output-display">
<pre><code>[1] ‘1.12.0’</code></pre>
</div>
</div>
</section>
</section>
</section>
</section>
<section id="ambient-rna-제거하기" class="level1">
<h1>Ambient RNA 제거하기</h1>
<p><code>Cellranger</code>에서 얻은 <code>raw_feature_bc_matrix.h5</code> 파일에 <a href="https://cellbender.readthedocs.io/en/latest/">CellBender</a>로 ambient RNA 데이터들을 제거해 줍니다.</p>
<div class="sourceCode" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb11-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">cellbender</span> remove-background <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb11-2">                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--cuda</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb11-3">                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--input</span> raw_feature_bc_matrix.h5 <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb11-4">                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--output</span> cellbender_output.h5</span></code></pre></div>
</section>
<section id="seurat-개체-만들기" class="level1">
<h1>Seurat 개체 만들기</h1>
<p>먼저 데이터를 읽어오는 것으로 시작합니다. <code>Read10X()</code> 함수를 사용하면 간단하게 UMI count 행렬을 불러 올수 있습니다. UMI count 행렬은 앞서 <code>cell ranger</code>를 통해 만들어 진 것으로 scRNA-seq 실험에서 얻어진 유전자 발현 데이터를 행렬 형태로 나타낸 것으로, 행은 각각의 세포를 나타내고, 열은 유전자를 나타냅니다.</p>
<p>그런 다음 <code>CreateSeuratObject()</code>함수를 사용해 Seurat 개체를 생성합니다. 그러면 UMI count 행렬은 <code>seurat_obj[["RNA"]]@counts</code>에 저장되게 됩니다.</p>
<div id="39a9cb79-f8be-4af6-ae7f-1cff59e4afde" class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-execution_count="5">
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># count 행렬 데이터 불러오기</span></span>
<span id="cb12-2">seurat_obj <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">Read10X_h5</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data.dir=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"../input/cellbender_output.h5"</span>)</span>
<span id="cb12-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 원시(정규화되지 않은 데이터)로 Seurat 객체를 초기화합니다.</span></span>
<span id="cb12-4">seurat_obj <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">CreateSeuratObject</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">counts=</span>seurat_obj, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">project=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pbmc1k"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">min.cells=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">min.features=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">200</span>)</span>
<span id="cb12-5">seurat_obj</span></code></pre></div>
<div class="cell-output cell-output-display">
<pre><code>An object of class Seurat 
20206 features across 1198 samples within 1 assay 
Active assay: RNA (20206 features, 0 variable features)</code></pre>
</div>
</div>
<section id="count-행렬은-어떻게-생겼을까" class="level2">
<h2 class="anchored" data-anchor-id="count-행렬은-어떻게-생겼을까">count 행렬은 어떻게 생겼을까?</h2>
<div id="cf06c88e-25d8-4189-9658-4f2241639ddb" class="cell" data-tags="[]" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-execution_count="6">
<div class="sourceCode cell-code" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 처음 5개의 세포에 있는 몇 가지 유전자를 확인해봅니다.</span></span>
<span id="cb14-2">seurat_obj[[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"RNA"</span>]]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">@</span>counts[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"CD3D"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"TCL1A"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"MS4A1"</span>), <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>]</span></code></pre></div>
<div class="cell-output cell-output-display">
<pre><code>3 x 3 sparse Matrix of class "dgCMatrix"
      AAACCCAAGGAGAGTA-1 AAACGCTTCAGCCCAG-1 AAAGAACAGACGACTG-1
CD3D                   .                  .                  6
TCL1A                  .                  9                  .
MS4A1                  .                  5                  .</code></pre>
</div>
</div>
</section>
<section id="seurat-개체의-메타데이터는-어디에-저장될까" class="level2">
<h2 class="anchored" data-anchor-id="seurat-개체의-메타데이터는-어디에-저장될까">Seurat 개체의 메타데이터는 어디에 저장될까?</h2>
<p><code>seurat_obj@meta.data</code> 혹은 <code>seurat_obj[[]]</code>을 통해 메타데이터를 확인할 수 있습니다.</p>
<div id="29340358-7a69-47ad-8ba7-fc1ca64bb80b" class="cell" data-tags="[]" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-execution_count="7">
<div class="sourceCode cell-code" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(seurat_obj<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">@</span>meta.data, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>)</span></code></pre></div>
<div class="cell-output cell-output-display">
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true">
<caption>A data.frame: 5 × 3</caption>
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th" scope="col">orig.ident</th>
<th data-quarto-table-cell-role="th" scope="col">nCount_RNA</th>
<th data-quarto-table-cell-role="th" scope="col">nFeature_RNA</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th" scope="col">&lt;fct&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;int&gt;</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th" scope="row">AAACCCAAGGAGAGTA-1</td>
<td>pbmc1k</td>
<td>12861</td>
<td>3871</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th" scope="row">AAACGCTTCAGCCCAG-1</td>
<td>pbmc1k</td>
<td>9432</td>
<td>3234</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th" scope="row">AAAGAACAGACGACTG-1</td>
<td>pbmc1k</td>
<td>6520</td>
<td>2631</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th" scope="row">AAAGAACCAATGGCAG-1</td>
<td>pbmc1k</td>
<td>4362</td>
<td>2121</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th" scope="row">AAAGAACGTCTGCAAT-1</td>
<td>pbmc1k</td>
<td>9905</td>
<td>3157</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
</section>
<section id="pre-processing" class="level1">
<h1>Pre-processing</h1>
<section id="서열-데이터-품질-관리" class="level2">
<h2 class="anchored" data-anchor-id="서열-데이터-품질-관리">서열 데이터 품질 관리</h2>
<p>scRNA seq 데이터의 분석의 신뢰성을 얻기 위해서 데이터의 품질 관리는 필수이빈다. <code>Seurat</code>을 사용하면 품질관리(QC) 지표를 쉽게 탐색하고 사용자 정의 기준에 따라 세포를 필터링할 수 있습니다. 일반적으로 사용되는 QC 기준은 다음 세가지 입니다.</p>
<ul>
<li>각 세포에서 검출된 고유 유전자의 수.
<ul>
<li>품질이 낮은 세포는 종종 유전자가 매우 적습니다.</li>
<li>이중 또는 다중의 세포가 들어간 droplet에는 비정상적으로 유전자 수가 높습니다.</li>
</ul></li>
<li>각 세포에서 검출된 총 서열의 수(고유 유전자의 수와 밀접한 상관관계가 있음)</li>
<li>미토콘드리아 게놈에 매핑되는 서열의 비율
<ul>
<li>품질이 낮거나 죽어가는 세포에는 미토콘드리아 유전자가 많이 발견됩니다.</li>
</ul></li>
</ul>
<section id="qc-지표-시각화하기" class="level3">
<h3 class="anchored" data-anchor-id="qc-지표-시각화하기">QC 지표 시각화하기</h3>
<section id="바이올린-플랏" class="level4">
<h4 class="anchored" data-anchor-id="바이올린-플랏">바이올린 플랏</h4>
<div id="b245c955-8ea2-4da6-8d42-405975c77b00" class="cell" data-tags="[]" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-execution_count="8">
<div class="sourceCode cell-code" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1">seurat_obj[[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"percent.mt"</span>]] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">PercentageFeatureSet</span>(seurat_obj, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pattern=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"^MT-"</span>) </span>
<span id="cb17-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># mouse 시료의 경우 pattern을 "^mt-"로 변경해야 합니다.</span></span>
<span id="cb17-3"></span>
<span id="cb17-4">plot <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">VlnPlot</span>(seurat_obj, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">features=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"nFeature_RNA"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"nCount_RNA"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"percent.mt"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ncol=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>)</span>
<span id="cb17-5"></span>
<span id="cb17-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">options</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">repr.plot.width=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">repr.plot.height=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>)</span>
<span id="cb17-7">plot</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://tomorrow-lab.github.io/posts/scRNAseq/R_Seurat_tutorials_files/figure-html/cell-8-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="scatter-플랏" class="level4">
<h4 class="anchored" data-anchor-id="scatter-플랏">Scatter 플랏</h4>
<div id="478affe2-7480-48ee-b1e8-2e177355ccd6" class="cell" data-tags="[]" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-execution_count="9">
<div class="sourceCode cell-code" id="cb18" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1">plot1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">FeatureScatter</span>(seurat_obj, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">feature1=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"nCount_RNA"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">feature2=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"percent.mt"</span>)</span>
<span id="cb18-2">plot2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">FeatureScatter</span>(seurat_obj, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">feature1=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"nCount_RNA"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">feature2=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"nFeature_RNA"</span>)</span>
<span id="cb18-3"></span>
<span id="cb18-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">options</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">repr.plot.width=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">repr.plot.height=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>)</span>
<span id="cb18-5">plot1 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> plot2</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://tomorrow-lab.github.io/posts/scRNAseq/R_Seurat_tutorials_files/figure-html/cell-9-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="qc-및-추가-분석을-위한-세포-선택하기" class="level3">
<h3 class="anchored" data-anchor-id="qc-및-추가-분석을-위한-세포-선택하기">QC 및 추가 분석을 위한 세포 선택하기</h3>
<p>위의 결과를 토대로 <code>nFeature_RNA</code>가 200개에서 6000개 사이이고 <code>percent.mt</code>가 20 이하인 세포들만 선택합니다.</p>
<div id="74884bc3-a699-4224-bcf5-e7f37dbf9b9e" class="cell" data-tags="[]" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-execution_count="10">
<div class="sourceCode cell-code" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1">seurat_obj <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">subset</span>(seurat_obj, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">subset=</span>nFeature_RNA <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">200</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> nFeature_RNA <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6000</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> percent.mt <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>)</span></code></pre></div>
</div>
<p>아직 모든 QC 과정이 끝난 것은 아닙니다. <code>PCA</code>를 진행하고나서 <code>scDblFinder</code> 패키지를 사용해 추가적인 더블렛 데이터를 제거하겠습니다.</p>
</section>
</section>
<section id="데이터-정규화하기" class="level2">
<h2 class="anchored" data-anchor-id="데이터-정규화하기">데이터 정규화하기</h2>
<p>QC를 통해 일부 데이터를 제거한 다음 단계는 데이터를 정규화하는 것입니다. 여기서는 각 세포의 발현 값을 전체 발현으로 나누고 스케일 계수(기본적으로 10,000)를 곱한 다음 로그 변환하는 <code>LogNormalize</code>방법을 사용합니다. 이렇게 정규화된 값은 <code>seurat_obj[["RNA"]]@data</code>에 저장됩니다.</p>
<div id="10a16786-077f-4463-90eb-4230c247479f" class="cell" data-tags="[]" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-execution_count="11">
<div class="sourceCode cell-code" id="cb20" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1">seurat_obj <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">NormalizeData</span>(seurat_obj, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">verbose=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>)</span>
<span id="cb20-2">seurat_obj <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">FindVariableFeatures</span>(seurat_obj, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">verbose=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>)</span>
<span id="cb20-3">seurat_obj <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ScaleData</span>(seurat_obj, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">verbose=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>)</span>
<span id="cb20-4">seurat_obj <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">RunPCA</span>(seurat_obj, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">verbose=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>)</span></code></pre></div>
</div>
<section id="elbow-플랏-그리기" class="level3">
<h3 class="anchored" data-anchor-id="elbow-플랏-그리기">Elbow 플랏 그리기</h3>
<p><code>Seurat</code>에서 clustering을 수행하기 전에는 몇 개의 차원(dimension)을 사용할지 결정해야 합니다. 차원의 수는 PCA와 같은 차원 축소 기법을 사용하여 줄여진 차원의 수를 의미합니다. 그리고 이 차원의 수는 클러스터링 알고리즘에 사용됩니다.</p>
<p>그러나 차원의 수가 너무 적거나 많으면 적절한 클러스터링이 어려울 수 있습니다. 차원이 적을 경우 정보 손실이 크게 발생하고, 차원이 많을 경우에는 불필요한 차원의 포함으로 인해 과적합(overfitting)이 발생할 가능성이 있습니다.</p>
<p>따라서 적절한 차원의 수를 선택하기 위해 elbow plot을 사용합니다. elbow plot은 차원의 수를 x축으로, 해당 차원의 데이터를 잘 설명하는 정도(예: variance)를 y축으로 나타냅니다. 이 때, 차원의 수를 늘리면 y축 값은 점점 증가하게 됩니다. 그러나 어느 지점 이후로는 y값이 더 이상 크게 증가하지 않고 평평해지는 지점이 나타나는데, 이 지점이 elbow point입니다. 이 지점 이후로는 차원을 늘려도 데이터를 잘 설명하지 못하므로, elbow point를 기준으로 적절한 차원의 수를 선택합니다. 이를 통해 데이터의 차원을 축소할 때, 적절한 차원의 수를 선택하여 과적합을 방지하고 필요한 정보만을 추출할 수 있습니다.</p>
<div id="dbe99645-6043-4639-8133-8a6d16627c72" class="cell" data-tags="[]" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-execution_count="12">
<div class="sourceCode cell-code" id="cb21" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1">plot <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ElbowPlot</span>(seurat_obj)</span>
<span id="cb21-2"></span>
<span id="cb21-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">options</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">repr.plot.width =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">repr.plot.height =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>)</span>
<span id="cb21-4">plot</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://tomorrow-lab.github.io/posts/scRNAseq/R_Seurat_tutorials_files/figure-html/cell-12-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="clustering" class="level1">
<h1>Clustering</h1>
<p>elbow 플랏에서 elbow point가 대략적으로 10임을 알 수 있습니다. 따라서 clustering의 <code>dims</code> 변수를 <code>1:10</code> 으로 지정합니다. 그런다음 UMAP을 그려보겠습니다.</p>
<section id="umap-그리기" class="level2">
<h2 class="anchored" data-anchor-id="umap-그리기">UMAP 그리기</h2>
<p>UMAP은 Uniform Manifold Approximation and Projection의 약자로, scRNA-seq 데이터를 시각화하기 위한 비선형 차원 축소 방법 중 하나입니다. t-SNE와 유사한 기능을 가지고 있지만, 대규모 데이터셋에서 더욱 빠르고 정확한 임베딩을 제공합니다.</p>
<p>UMAP은 데이터의 국부적인 구조를 보존하는데 초점을 둡니다. 즉, 비슷한 특성을 가진 데이터들이 서로 가깝게 묶이고, 서로 다른 특성을 가진 데이터들은 더 멀리 배치되도록 임베딩을 생성합니다. 이를 통해, scRNA-seq 데이터의 복잡한 구조를 파악하고 시각화할 수 있습니다.</p>
<div id="1efb9148-4360-46bc-94e7-5a9fc1b2711e" class="cell" data-tags="[]" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-execution_count="13">
<div class="sourceCode cell-code" id="cb22" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1">seurat_obj <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">FindNeighbors</span>(seurat_obj, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">dims =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">verbose =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>)</span>
<span id="cb22-2">seurat_obj <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">FindClusters</span>(seurat_obj, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">resolution =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">verbose =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>)</span>
<span id="cb22-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 일반적으로 resolution 값은 0.1 ~ 1.0 사이의 값을 많이 사용합니다. </span></span>
<span id="cb22-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 값이 작을수록 세분화된 군집을 얻을 수 있기 때문에</span></span>
<span id="cb22-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 세포의 종류나 상태 등을 더 세부적으로 파악하고자 할 때는 작은 값이 유용합니다. </span></span>
<span id="cb22-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 반면 큰 값은 대부분의 데이터를 하나의 군집으로 묶어줌으로써 전체적인 데이터 구조를 파악하는 데에 유용할 수 있습니다.</span></span>
<span id="cb22-7">seurat_obj <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">RunUMAP</span>(seurat_obj, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">dims =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">verbose =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>)</span>
<span id="cb22-8"></span>
<span id="cb22-9">plot <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">DimPlot</span>(seurat_obj, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">reduction =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"umap"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span>
<span id="cb22-10"></span>
<span id="cb22-11"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">options</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">repr.plot.width =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">repr.plot.height =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>)</span>
<span id="cb22-12">plot</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://tomorrow-lab.github.io/posts/scRNAseq/R_Seurat_tutorials_files/figure-html/cell-13-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>위의 UMAP 플랏을 통해 총 10개의 cluster로 나누어 졌음을 알 수 있습니다. 이제 추가적인 QC를 진행해보겠습니다.</p>
</section>
<section id="scdblfinder를-사용해-doublet-제거-하기" class="level2">
<h2 class="anchored" data-anchor-id="scdblfinder를-사용해-doublet-제거-하기">scDblFinder를 사용해 doublet 제거 하기</h2>
<p><code>scDblFinder</code>는 클러스터 정보를 기반으로 인공적으로 생성된 더블렛을 찾아냅니다. 아래 코드를 통해 더블렛을 찾고 UMAP 플랏에 표시해보겠습니다.</p>
<div id="aef8ad64-945a-4546-aa0f-8d5a5864aef5" class="cell" data-tags="[]" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-execution_count="14">
<div class="sourceCode cell-code" id="cb23" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1">sce <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scDblFinder</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">GetAssayData</span>(seurat_obj, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">slot =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"counts"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">clusters =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">Idents</span>(seurat_obj))</span>
<span id="cb23-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># scDblFinder 결과 점수를 다시 Seurat 객체로 옮깁니다.</span></span>
<span id="cb23-3">seurat_obj<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>scDblFinder.score <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> sce<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>scDblFinder.score</span>
<span id="cb23-4"></span>
<span id="cb23-5">p <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">FeaturePlot</span>(seurat_obj, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"scDblFinder.score"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pt.size =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>) </span>
<span id="cb23-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">options</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">repr.plot.width =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">repr.plot.height =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>)</span>
<span id="cb23-7">p</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Assuming the input to be a matrix of counts or expected counts.

11 clusters

Creating ~5000 artificial doublets...

as(&lt;dgeMatrix&gt;, "dgCMatrix") is deprecated since Matrix 1.5-0; do as(., "CsparseMatrix") instead

Dimensional reduction

Evaluating kNN...

Training model...

iter=0, 32 cells excluded from training.

iter=1, 29 cells excluded from training.

iter=2, 30 cells excluded from training.

Threshold found:0.519

30 (2.6%) doublets called
</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://tomorrow-lab.github.io/posts/scRNAseq/R_Seurat_tutorials_files/figure-html/cell-14-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p><code>scDblFinder</code> 결과에서 Threshold 값이 <code>0.519</code> 라는 것과 총 30(2.6%)개의 더블렛이 계산되었습니다. 다시 <code>subset()</code>함수를 사용해 scDblFinder 값이 0.519 이하인 세포만 고르는 QC 과정을 진행하겠습니다.</p>
<section id="더블렛-제거하기" class="level3">
<h3 class="anchored" data-anchor-id="더블렛-제거하기">더블렛 제거하기</h3>
<div id="dc3b073f-7d74-4947-958b-3a0209684d5b" class="cell" data-tags="[]" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-execution_count="15">
<div class="sourceCode cell-code" id="cb25" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 개체 메타 데이터의 값에 대한 하위 집합만들기</span></span>
<span id="cb25-2">seurat_obj <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">subset</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> seurat_obj, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">subset =</span> scDblFinder.score <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.519</span> )</span>
<span id="cb25-3"></span>
<span id="cb25-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">DefaultAssay</span>(seurat_obj) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"RNA"</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># default assay is RNA</span></span>
<span id="cb25-5">seurat_obj <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">NormalizeData</span>(seurat_obj, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">verbose =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>)</span>
<span id="cb25-6">seurat_obj <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">FindVariableFeatures</span>(seurat_obj, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">verbose =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>)</span>
<span id="cb25-7">seurat_obj <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ScaleData</span>(seurat_obj, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">verbose =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>)</span>
<span id="cb25-8">seurat_obj <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">RunPCA</span>(seurat_obj, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">verbose =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>)</span>
<span id="cb25-9">seurat_obj <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">FindNeighbors</span>(seurat_obj, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">dims =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">verbose =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>)</span>
<span id="cb25-10">seurat_obj <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">FindClusters</span>(seurat_obj, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">resolution =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">verbose =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>)</span>
<span id="cb25-11">seurat_obj <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">RunUMAP</span>(seurat_obj, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">dims =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">verbose =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>)</span>
<span id="cb25-12"></span>
<span id="cb25-13">p <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">DimPlot</span>(seurat_obj, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span>
<span id="cb25-14"></span>
<span id="cb25-15"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">options</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">repr.plot.width =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">repr.plot.height =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>)</span>
<span id="cb25-16">p</span></code></pre></div>
</div>
</section>
</section>
</section>
<section id="cell-type-identification" class="level1">
<h1>Cell type identification</h1>
<p>각각의 클러스터들이 어떤 세포인지 알아내는 작업을 합니다.<code>Seurat</code>의 <code>FindAllMarkers()</code>함수를 사용하면 나머지 모든 세포와 비교해 클러스터에 대한 유전자 마커를 찾을 수 있습니다.</p>
<section id="marker-gene-찾기" class="level2">
<h2 class="anchored" data-anchor-id="marker-gene-찾기">Marker gene 찾기</h2>
<div id="33f7de4e-87b7-4c6b-a1ab-f3f52cddef4c" class="cell" data-tags="[]" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-execution_count="17">
<div class="sourceCode cell-code" id="cb26" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1">markers <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">FindAllMarkers</span>(seurat_obj, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">only.pos =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">verbose =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>)</span>
<span id="cb26-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">write_csv</span>(markers, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"../output/pbmc1k_marker.csv"</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 결과를 csv 파일로 저장</span></span>
<span id="cb26-3">markers <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>()</span></code></pre></div>
<div class="cell-output cell-output-display">
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true">
<caption>A data.frame: 6 × 7</caption>
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th" scope="col">p_val</th>
<th data-quarto-table-cell-role="th" scope="col">avg_log2FC</th>
<th data-quarto-table-cell-role="th" scope="col">pct.1</th>
<th data-quarto-table-cell-role="th" scope="col">pct.2</th>
<th data-quarto-table-cell-role="th" scope="col">p_val_adj</th>
<th data-quarto-table-cell-role="th" scope="col">cluster</th>
<th data-quarto-table-cell-role="th" scope="col">gene</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;fct&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th" scope="row">S100A12</td>
<td>4.929494e-211</td>
<td>3.984628</td>
<td>0.979</td>
<td>0.047</td>
<td>9.960536e-207</td>
<td>0</td>
<td>S100A12</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th" scope="row">VCAN</td>
<td>3.023544e-202</td>
<td>4.236786</td>
<td>1.000</td>
<td>0.086</td>
<td>6.109374e-198</td>
<td>0</td>
<td>VCAN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th" scope="row">CD14</td>
<td>3.015410e-195</td>
<td>2.387003</td>
<td>0.954</td>
<td>0.058</td>
<td>6.092936e-191</td>
<td>0</td>
<td>CD14</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th" scope="row">CSF3R</td>
<td>2.588854e-192</td>
<td>2.561836</td>
<td>0.979</td>
<td>0.080</td>
<td>5.231038e-188</td>
<td>0</td>
<td>CSF3R</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th" scope="row">MNDA</td>
<td>1.513641e-189</td>
<td>3.044325</td>
<td>0.993</td>
<td>0.104</td>
<td>3.058462e-185</td>
<td>0</td>
<td>MNDA</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th" scope="row">S100A8</td>
<td>1.971209e-188</td>
<td>5.905527</td>
<td>0.996</td>
<td>0.142</td>
<td>3.983026e-184</td>
<td>0</td>
<td>S100A8</td>
</tr>
</tbody>
</table>
</div>
</div>
<p><code>FindAllMarkers()</code> 결과는 데이터프레임입니다. <code>avg_log2FC</code>는 다른 클러스터와 비교해 발현량이 얼마나 차이나는지를 의미합니다. 해당 열을 가지고 각 클러스터당 상위 5개의 유전자 마커를 추려서 heatmap 을 그려봅니다.</p>
</section>
<section id="marker-gene-heatmap" class="level2">
<h2 class="anchored" data-anchor-id="marker-gene-heatmap">Marker gene heatmap</h2>
<div id="28a2798f-196e-4cc6-9956-3cbbe818b54a" class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-execution_count="18">
<div class="sourceCode cell-code" id="cb27" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1">top5 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> markers <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(cluster) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">top_n</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">wt =</span> avg_log2FC)</span>
<span id="cb27-2">p <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">DoHeatmap</span>(seurat_obj, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">features =</span> top5<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>gene) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">NoLegend</span>()</span>
<span id="cb27-3"></span>
<span id="cb27-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">options</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">repr.plot.width =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">repr.plot.height =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>)</span>
<span id="cb27-5">p</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://tomorrow-lab.github.io/posts/scRNAseq/R_Seurat_tutorials_files/figure-html/cell-17-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>위의 heatmap은 멋져보이기는 하지만 그렇게 큰 정보를 제공해주지는 않습니다. 일반적으로 클러스터가 어떤 세포인지 알아내는 작업이 scRNA seq 분석방법에서 가장 중요한 부분이며 여러가지 접근법이 있지만 가장 덜 자동화된 부분이기도 합니다.</p>
<p>가장 일반적인 방법은 <code>FindAllMarkers()</code> 함수를 이용해 얻은 각 클러스터의 유전자 마커와 참조 데이터 세트를 비교 하는 것입니다. 참조 데이터 세트란, 이미 잘 정의된 세포 유형들의 scRNA-seq 데이터로 현재 분석 중인 데이터의 클러스터들을 참조 데이터 세트와 비교하여 유사한 패턴을 가진 세포 유형을 찾아내는 것입니다. 이 작업은 시간이 아주 많이 필요하며 작업자에 따라 다른 결과가 나옵니다. 그래서 이번에는 <code>ChatGPT</code>를 사용하는 방법으로 해보겠습니다.</p>
</section>
<section id="chatgpt-사용하기" class="level2">
<h2 class="anchored" data-anchor-id="chatgpt-사용하기"><code>ChatGPT</code> 사용하기</h2>
<blockquote class="blockquote">
<p><code>ChatGPT</code>에 대한 자세한 설명은 생략합니다.</p>
</blockquote>
<p>프롬프터에 클러스터의 유전자 마커를 쉽게 입력하기 위해 다음의 코드를 사용합니다.</p>
<div id="36150041-65f5-451f-9b78-a8da556ced7a" class="cell" data-tags="[]" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-execution_count="19">
<div class="sourceCode cell-code" id="cb28" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 빈 리스트 생성</span></span>
<span id="cb28-2">marker_list <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>()</span>
<span id="cb28-3">gene_number <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 10개의 유전자만 찾아낼때</span></span>
<span id="cb28-4"></span>
<span id="cb28-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># for loop으로 리스트에 값 추가</span></span>
<span id="cb28-6"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> (i <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unique</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">Idents</span>(seurat_obj))) {</span>
<span id="cb28-7">  marker_list[[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cluster"</span>,i)]] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> markers <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(cluster) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">top_n</span>(gene_number, avg_log2FC) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb28-8">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ungroup</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">arrange</span>(cluster, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">desc</span>(avg_log2FC)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(cluster <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> i) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> .<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>gene</span>
<span id="cb28-9">}</span>
<span id="cb28-10"></span>
<span id="cb28-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 결과 출력</span></span>
<span id="cb28-12">marker_list</span></code></pre></div>
<div class="cell-output cell-output-display">
<dl>
    <dt>$cluster0</dt>
        <dd><style>
.list-inline {list-style: none; margin:0; padding: 0}
.list-inline>li {display: inline-block}
.list-inline>li:not(:last-child)::after {content: "\00b7"; padding: 0 .5ex}
</style>
<ol class="list-inline"><li>'S100A8'</li><li>'S100A9'</li><li>'LYZ'</li><li>'VCAN'</li><li>'S100A12'</li><li>'FCN1'</li><li>'MNDA'</li><li>'CTSS'</li><li>'NAMPT'</li><li>'PLXDC2'</li></ol>
</dd>
    <dt>$cluster3</dt>
        <dd><style>
.list-inline {list-style: none; margin:0; padding: 0}
.list-inline>li {display: inline-block}
.list-inline>li:not(:last-child)::after {content: "\00b7"; padding: 0 .5ex}
</style>
<ol class="list-inline"><li>'IGHM'</li><li>'AFF3'</li><li>'IGHD'</li><li>'IGLC2'</li><li>'FCRL1'</li><li>'BANK1'</li><li>'TCL1A'</li><li>'BACH2'</li><li>'CD79A'</li><li>'LINC00926'</li></ol>
</dd>
    <dt>$cluster7</dt>
        <dd><style>
.list-inline {list-style: none; margin:0; padding: 0}
.list-inline>li {display: inline-block}
.list-inline>li:not(:last-child)::after {content: "\00b7"; padding: 0 .5ex}
</style>
<ol class="list-inline"><li>'GZMH'</li><li>'NKG7'</li><li>'CCL5'</li><li>'SGCD'</li><li>'SAMD3'</li><li>'CST7'</li><li>'GZMK'</li><li>'TOX'</li><li>'GZMA'</li><li>'KLRG1'</li></ol>
</dd>
    <dt>$cluster1</dt>
        <dd><style>
.list-inline {list-style: none; margin:0; padding: 0}
.list-inline>li {display: inline-block}
.list-inline>li:not(:last-child)::after {content: "\00b7"; padding: 0 .5ex}
</style>
<ol class="list-inline"><li>'INPP4B'</li><li>'IL7R'</li><li>'ANK3'</li><li>'CDC14A'</li><li>'SERINC5'</li><li>'BCL11B'</li><li>'IL32'</li><li>'RORA'</li><li>'CAMK4'</li><li>'TTC39C'</li></ol>
</dd>
    <dt>$cluster6</dt>
        <dd><style>
.list-inline {list-style: none; margin:0; padding: 0}
.list-inline>li {display: inline-block}
.list-inline>li:not(:last-child)::after {content: "\00b7"; padding: 0 .5ex}
</style>
<ol class="list-inline"><li>'IGKC'</li><li>'IGHA1'</li><li>'JCHAIN'</li><li>'IGHG3'</li><li>'IGHGP'</li><li>'IGHG1'</li><li>'IGHG2'</li><li>'BANK1'</li><li>'OSBPL10'</li><li>'MS4A1'</li></ol>
</dd>
    <dt>$cluster2</dt>
        <dd><style>
.list-inline {list-style: none; margin:0; padding: 0}
.list-inline>li {display: inline-block}
.list-inline>li:not(:last-child)::after {content: "\00b7"; padding: 0 .5ex}
</style>
<ol class="list-inline"><li>'LEF1'</li><li>'NELL2'</li><li>'TSHZ2'</li><li>'FHIT'</li><li>'CAMK4'</li><li>'PRKCA'</li><li>'BCL11B'</li><li>'PDE3B'</li><li>'TXK'</li><li>'TRABD2A'</li></ol>
</dd>
    <dt>$cluster5</dt>
        <dd><style>
.list-inline {list-style: none; margin:0; padding: 0}
.list-inline>li {display: inline-block}
.list-inline>li:not(:last-child)::after {content: "\00b7"; padding: 0 .5ex}
</style>
<ol class="list-inline"><li>'KLRB1'</li><li>'SLC4A10'</li><li>'IL4I1'</li><li>'GZMK'</li><li>'COLQ'</li><li>'ZBTB16'</li><li>'ADAM12'</li><li>'IL32'</li><li>'AL136456.1'</li><li>'AGAP1'</li></ol>
</dd>
    <dt>$cluster4</dt>
        <dd><style>
.list-inline {list-style: none; margin:0; padding: 0}
.list-inline>li {display: inline-block}
.list-inline>li:not(:last-child)::after {content: "\00b7"; padding: 0 .5ex}
</style>
<ol class="list-inline"><li>'TCF7L2'</li><li>'CST3'</li><li>'HLA-DPA1'</li><li>'FCGR3A'</li><li>'LST1'</li><li>'HLA-DPB1'</li><li>'AIF1'</li><li>'HLA-DRB1'</li><li>'HLA-DRA'</li><li>'IFI30'</li></ol>
</dd>
    <dt>$cluster8</dt>
        <dd><style>
.list-inline {list-style: none; margin:0; padding: 0}
.list-inline>li {display: inline-block}
.list-inline>li:not(:last-child)::after {content: "\00b7"; padding: 0 .5ex}
</style>
<ol class="list-inline"><li>'GNLY'</li><li>'NKG7'</li><li>'PRF1'</li><li>'KLRD1'</li><li>'GZMA'</li><li>'KLRF1'</li><li>'SPON2'</li><li>'FGFBP2'</li><li>'CST7'</li><li>'GZMB'</li></ol>
</dd>
    <dt>$cluster9</dt>
        <dd><style>
.list-inline {list-style: none; margin:0; padding: 0}
.list-inline>li {display: inline-block}
.list-inline>li:not(:last-child)::after {content: "\00b7"; padding: 0 .5ex}
</style>
<ol class="list-inline"><li>'PPBP'</li><li>'GP1BB'</li><li>'NRGN'</li><li>'PF4'</li><li>'CAVIN2'</li><li>'TUBB1'</li><li>'CLU'</li><li>'GNG11'</li><li>'RGS18'</li><li>'HIST1H2AC'</li></ol>
</dd>
</dl>
</div>
</div>
<p>위 코드의 출력을 가지고 <code>ChatGPT</code>에 입력했더니 다음과 같이 말했습니다.</p>
<pre><code>주어진 유전자 목록만으로는 각각의 클러스터의 정확한 세포 유형을 알 수 없습니다. 유전자는 여러 종류의 세포에서 발현될 수 있기 때문입니다. 유전자의 발현 패턴을 분석하거나 추가적인 실험 결과와 함께 고려해야만 각 클러스터의 세포 유형을 추론할 수 있습니다.

그러나 일반적으로 각 클러스터에 대한 예상 세포 유형은 다음과 같습니다:

$cluster0: 이 클러스터는 PBMC에서 neutrophils을 나타내는 것으로 추정됩니다.
$cluster1: 이 클러스터는 PBMC에서 CD4 T cells을 나타내는 것으로 추정됩니다.
$cluster2: 이 클러스터는 PBMC에서 B cells을 나타내는 것으로 추정됩니다.
$cluster3: 이 클러스터는 PBMC에서 B cells을 나타내는 것으로 추정됩니다.
$cluster4: 이 클러스터는 PBMC에서 monocytes을 나타내는 것으로 추정됩니다.
$cluster5: 이 클러스터는 PBMC에서 NK cells을 나타내는 것으로 추정됩니다.
$cluster6: 이 클러스터는 PBMC에서 B cells을 나타내는 것으로 추정됩니다.
$cluster7: 이 클러스터는 PBMC에서 CD8 T cells을 나타내는 것으로 추정됩니다.
$cluster8: 이 클러스터는 PBMC에서 NK cells을 나타내는 것으로 추정됩니다.
$cluster9: 이 클러스터는 PBMC에서 platelets을 나타내는 것으로 추정됩니다.</code></pre>
<p>위의 결과를 통해 대부분의 클러스터 타입을 알 수 있지만, B cell이 3개 NK cell이 2개로 중복됩니다. 좀 더 세분화하기 위해 B cell의 유전자 마커를 물어봅니다.</p>
<pre><code>B cell은 다양한 sub type으로 분류될 수 있습니다. 일부 sub type들과 그에 따른 대표 마커들은 다음과 같습니다.

- Naive B cell
    CD19, CD20, CD27-, IgD+, IgM+
- Memory B cell
    CD19, CD20, CD27+, IgD-, IgM+/-
- Plasma cell
    CD19, CD20-, CD38++, CD138+, MUM1+, IRF4+, XBP1+
- Germinal center B cell
    CD19, CD20, CD77+, CD10+, BCL6+, AID+
- Regulatory B cell (Breg)
    CD19, CD20, CD24++, CD38++, CD25+, IL-10+
- B1 B cell
    CD19, CD20, CD27+, IgM+, CD43+
- Marginal zone B cell
    CD19, CD20, CD27-, CD43-, IgM+, IgD+, CD23-, CD21+

각 sub type마다 대표적인 마커들이 있지만, 이것들만으로 모든 sub type을 완벽하게 분류하는 것은 어렵습니다. 따라서, sub type 분류는 보통 여러 마커를 조합하여 결정됩니다.</code></pre>
<p>이번에는 NK cell 세분화를 위한 유전자 마커를 물어봅니다.</p>
<pre><code>NK 세포는 크게 두 가지 subset으로 나눌 수 있습니다: CD56bright NK 세포와 CD56dim NK 세포입니다. CD56bright NK 세포는 주로 면역 조절에 관여하며, cytokine을 분비하는 역할을 합니다. 반면 CD56dim NK 세포는 주로 세포 독성에 관여하며, 인체 내에서 암세포와 바이러스에 대한 첫 번째 방어선 역할을 합니다.

CD56bright NK 세포를 구별하는 유전자 마커로는 CD56(bright) (NCAM1)과 CD16 (FCGR3A)이 있습니다. 반면 CD56dim NK 세포를 구별하는 유전자 마커로는 CD56(dim) (NCAM1)과 KIR (Killer-cell immunoglobulin-like receptors)가 있습니다. KIR은 NK 세포의 분화 상태, 활성 상태, 대상 세포와의 상호 작용 등을 조절합니다.</code></pre>
<p>위의 결과와 <code>pbmc1k_marker.csv</code> 파일을 비교하면서 다음과 같이 클러스터의 이름을 지정합니다.</p>
<blockquote class="blockquote">
<p><code>ChatGPT</code>를 사용한 방법은 정확하지 않고 힌트정도만 알 수 있습니다. 실제 실험결과라면 <code>SingleR</code> 패키지 혹은 문헌 검색을 통해 직접 찾아보시기 바랍니다.</p>
</blockquote>
<p>그리고 UMAP 플랏을 그려서 결과를 확인합니다.</p>
<div id="2866f146-e426-4854-8124-d1b9da7d2df9" class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-execution_count="20">
<div class="sourceCode cell-code" id="cb32" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 참조를 위해 이전 ID 클래스(클러스터 레이블)를 저장합니다.</span></span>
<span id="cb32-2">seurat_obj[[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"old.ident"</span>]] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">Idents</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">object =</span> seurat_obj)</span>
<span id="cb32-3"></span>
<span id="cb32-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 레이블 변경하기</span></span>
<span id="cb32-5">seurat_obj <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">RenameIdents</span>(</span>
<span id="cb32-6">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">object =</span> seurat_obj,</span>
<span id="cb32-7">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">0</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"neutrophils"</span>,</span>
<span id="cb32-8">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">1</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"CD4+ T cells"</span>,</span>
<span id="cb32-9">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">2</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"naive B cells"</span>,</span>
<span id="cb32-10">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">3</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Plasma cells"</span>,</span>
<span id="cb32-11">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">4</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"monocytes"</span>,</span>
<span id="cb32-12">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">5</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"CD56bright NK cells"</span>,</span>
<span id="cb32-13">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">6</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"memory  B cells"</span>,</span>
<span id="cb32-14">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">7</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"CD8 T cells"</span>,</span>
<span id="cb32-15">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">8</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"CD56dim NK cells"</span>,</span>
<span id="cb32-16">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">9</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"platelet"</span></span>
<span id="cb32-17">    )</span>
<span id="cb32-18"></span>
<span id="cb32-19"></span>
<span id="cb32-20">p <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">DimPlot</span>(seurat_obj, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">reduction =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"umap"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pt.size =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">NoLegend</span>()</span>
<span id="cb32-21"></span>
<span id="cb32-22"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">options</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">repr.plot.width =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">repr.plot.height =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>)</span>
<span id="cb32-23">p</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://tomorrow-lab.github.io/posts/scRNAseq/R_Seurat_tutorials_files/figure-html/cell-19-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="마치며" class="level1">
<h1>마치며</h1>
<p>클러스터에 포함된 세포 수를 확인해보고 <code>RDS</code> 파일을 저장하면서 마무리 하겠습니다.</p>
<section id="클러스터당-세포-수-확인" class="level2">
<h2 class="anchored" data-anchor-id="클러스터당-세포-수-확인">클러스터당 세포 수 확인</h2>
<div id="fb08f8f2-6803-4720-86b0-c7e3915c50a8" class="cell" data-tags="[]" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-execution_count="21">
<div class="sourceCode cell-code" id="cb33" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">table</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">Idents</span>(seurat_obj))</span></code></pre></div>
<div class="cell-output cell-output-display">
<pre><code>
        neutrophils        CD4+ T cells       naive B cells        Plasma cells 
                284                 204                 169                 130 
          monocytes CD56bright NK cells     memory  B cells         CD8 T cells 
                 87                  74                  60                  54 
   CD56dim NK cells            platelet 
                 53                  15 </code></pre>
</div>
</div>
</section>
<section id="클러스터당-세포-비율-확인" class="level2">
<h2 class="anchored" data-anchor-id="클러스터당-세포-비율-확인">클러스터당 세포 비율 확인</h2>
<div id="f2f277d4-a486-458a-b844-54c8d30ac415" class="cell" data-tags="[]" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-execution_count="22">
<div class="sourceCode cell-code" id="cb35" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">prop.table</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">table</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">Idents</span>(seurat_obj)))</span></code></pre></div>
<div class="cell-output cell-output-display">
<pre><code>
        neutrophils        CD4+ T cells       naive B cells        Plasma cells 
         0.25132743          0.18053097          0.14955752          0.11504425 
          monocytes CD56bright NK cells     memory  B cells         CD8 T cells 
         0.07699115          0.06548673          0.05309735          0.04778761 
   CD56dim NK cells            platelet 
         0.04690265          0.01327434 </code></pre>
</div>
</div>
</section>
<section id="rds-파일로-저장하기" class="level2">
<h2 class="anchored" data-anchor-id="rds-파일로-저장하기">RDS 파일로 저장하기</h2>
<p>RDS 파일을 저장해두면 추후 분석에 위의 과정을 반복할 필요가 없습니다.</p>
<div id="23a8d920-b981-4d7c-8521-f5520a353ba1" class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-execution_count="23">
<div class="sourceCode cell-code" id="cb37" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">saveRDS</span>(seurat_obj, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">file =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"../output/pbmc1k_final.rds"</span>)</span></code></pre></div>
</div>
<p>지금 까지 살펴본 내용을 요약해보면 다음과 같습니다.</p>
<ul>
<li>Pre-processing: 데이터 전처리를 통해 불필요한 변수 제거, 정규화 등을 수행합니다.</li>
<li>Dimensionality reduction: 차원 축소 기법을 사용해 데이터의 주요 구조를 파악합니다.</li>
<li>Clustering: 유사한 특성을 가진 데이터들을 그룹화합니다.</li>
<li>Cell type identification: 각 클러스터에 대해 유전자 발현 패턴 등을 비교하여 cell type을 추론합니다.</li>
</ul>
<p>이후 진행되는 scRNA-seq Downstream analysis는 여기서 얻은 결과를 기반으로 합니다. 따라서 여기서의 결과가 부정확하거나 신뢰성이 떨어지면 추가 분석에서 얻은 결과 또한 의미가 없습니다. 그러므로 분석에서 사용된 데이터의 품질, 분석 방법의 적절성, 도구의 성능 등을 철저히 검토하고 확실한 기준에 따라 분석을 수행하세요. 또한, 추후에 데이터나 분석 방법이 변경되는 경우 이전의 결과와의 비교를 통해 신뢰성을 유지할 수 있도록 관리하는 것도 잊지 말아야 합니다.</p>


</section>
</section>

 ]]></description>
  <category>R</category>
  <category>data science</category>
  <category>seurat</category>
  <guid>https://tomorrow-lab.github.io/posts/scRNAseq/R_Seurat_tutorials.html</guid>
  <pubDate>Fri, 31 Mar 2023 15:00:00 GMT</pubDate>
</item>
<item>
  <title>R로 논문급 도표 그리기</title>
  <dc:creator>Taeyoon kim</dc:creator>
  <link>https://tomorrow-lab.github.io/posts/R_ggpubr.html</link>
  <description><![CDATA[ 




<section id="ggpubr" class="level1">
<h1>0. ggpubr</h1>
<p>모든 내용은 <a href="http://www.sthda.com/english/rpkgs/ggpubr">공식문서</a>에서 간추린 것입니다. 자세한것은 공식문서를 읽어주세요.</p>
<p><code>ggpubr</code>은 ggplot2에 기반한 R 패키지입니다. 연구자들이 쉽게 높은 질의 도표를 그리는 것을 목표로 하고 있는 시각화 패키지죠. 주요 특징은 다음과 같습니다:</p>
<ul>
<li><code>ggplot2</code> 패키지를 기반으로해서 좀 더 명확한 문법으로 보다 쉽게 사용할 수 있습니다.</li>
<li>R 언어를 잘 모르더라도 높은 질의 도표를 만들수 있습니다.</li>
<li>자동으로 p-values 나 통계적 유의성을 표시할 할 수 있습니다.</li>
<li>여러 도표를 한 페이지에 배열 할 수 있는 기능을 가지고 있습니다.</li>
<li>레이블이나 색상을 쉽게 변경할 수 있습니다.</li>
</ul>
<p>먼저 <code>ggpubr</code> 로 시각화를 하는 간단한 방법을 살펴보고, 이후에 다양한 예시 도표를 보여드리겠습니다.</p>
</section>
<section id="ggpubr-설치하기" class="level1">
<h1>1. ggpubr 설치하기:</h1>
<p><strong>CRAN</strong> 을 통한 설치법은 아래와 같습니다.</p>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">install.packages</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ggpubr"</span>)</span></code></pre></div>
</section>
<section id="ggpubr-불러오기" class="level1">
<h1>2. ggpubr 불러오기:</h1>
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ggpubr"</span>)</span></code></pre></div>
</section>
<section id="ggpubr로-도표-그리기" class="level1">
<h1>3. ggpubr로 도표 그리기</h1>
<p>간단한 예시를 들어 시각화 방법을 살펴보겠습니다. 1. 대이터 불러와서 전처리하기 2. 시각화하고 설정하기</p>
<section id="데이터-불러오기" class="level2">
<h2 class="anchored" data-anchor-id="데이터-불러오기">3.1. 데이터 불러오기</h2>
<div id="cell-3" class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-execution_count="2">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 필요한  패키지 불러오기</span></span>
<span id="cb3-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dplyr"</span>) </span>
<span id="cb3-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ggpubr"</span>)</span>
<span id="cb3-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">options</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">warn=</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 경고메세지 무시하기</span></span>
<span id="cb3-5"></span>
<span id="cb3-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ToothGrowth"</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 예제 데이터 불러오기</span></span>
<span id="cb3-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(ToothGrowth,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 데이터 테이블 확인</span></span></code></pre></div>
<div class="cell-output cell-output-display">
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" scope="col">len</th>
<th data-quarto-table-cell-role="th" scope="col">supp</th>
<th data-quarto-table-cell-role="th" scope="col">dose</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>4.2</td>
<td>VC</td>
<td>0.5</td>
</tr>
<tr class="even">
<td>11.5</td>
<td>VC</td>
<td>0.5</td>
</tr>
<tr class="odd">
<td>7.3</td>
<td>VC</td>
<td>0.5</td>
</tr>
<tr class="even">
<td>5.8</td>
<td>VC</td>
<td>0.5</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="시각화-설정하기" class="level2">
<h2 class="anchored" data-anchor-id="시각화-설정하기">3.2. 시각화 설정하기</h2>
<div id="cell-5" class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-execution_count="3">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggline</span>(ToothGrowth, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dose"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"len"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">add =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mean_se"</span>, <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 각각의 축설정 </span></span>
<span id="cb4-2">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"supp"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">palette =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"npg"</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 색상 설정하기</span></span>
<span id="cb4-3">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">stat_compare_means</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">group =</span> supp), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"p.signif"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label.y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">25</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">29</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 통계적 유의성 표시</span></span>
<span id="cb4-4">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Dose'</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Length'</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Supp'</span>)) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 레이블 변경</span></span></code></pre></div>
<div class="cell-output cell-output-display">

</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://tomorrow-lab.github.io/posts/R_ggpubr_files/figure-html/cell-3-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="한페이지에-여러-도표-넣기" class="level2">
<h2 class="anchored" data-anchor-id="한페이지에-여러-도표-넣기">3.3. 한페이지에 여러 도표 넣기</h2>
<p>여러 도표를 한페이지에 넣는 기능은 <code>ggarrange()</code>입니다. <code>cowplot</code>의 <code>plot_grid()</code>함수에 기반하고 있죠. 그래서 사용법도 동일합니다. 아래의 예시 코드를 확인하세요.</p>
<div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggarrange</span>(a, b, c ,  </span>
<span id="cb5-2">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">labels =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"A"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"B"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"C"</span>),</span>
<span id="cb5-3">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ncol =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nrow =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span></code></pre></div>
</section>
</section>
<section id="다양한-ggpubr-예시" class="level1">
<h1>4. 다양한 ggpubr 예시</h1>
<p>아래에는 많이 사용되는 도표의 예시를 제공하고 있습니다. 필요한 것이 있는지 살펴보세요.</p>
<section id="분포distribution-시각화" class="level2">
<h2 class="anchored" data-anchor-id="분포distribution-시각화">4.1. 분포(Distribution) 시각화</h2>
<div id="cell-8" class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-execution_count="4">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 예제 데이터 만들기</span></span>
<span id="cb6-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set.seed</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1234</span>)</span>
<span id="cb6-3">wdata <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(</span>
<span id="cb6-4">   <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sex =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">factor</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"F"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"M"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">each=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">200</span>)),</span>
<span id="cb6-5">   <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">weight =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">200</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">55</span>), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">200</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">58</span>)))</span>
<span id="cb6-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(wdata, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>)</span></code></pre></div>
<div class="cell-output cell-output-display">
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" scope="col">sex</th>
<th data-quarto-table-cell-role="th" scope="col">weight</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>F</td>
<td>53.79293</td>
</tr>
<tr class="even">
<td>F</td>
<td>55.27743</td>
</tr>
<tr class="odd">
<td>F</td>
<td>56.08444</td>
</tr>
<tr class="even">
<td>F</td>
<td>52.65430</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="cell-9" class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-execution_count="5">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1">a1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggdensity</span>(wdata, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"weight"</span>,</span>
<span id="cb7-2">   <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">add =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mean"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">rug =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>, <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Density plot with mean lines and marginal rug</span></span>
<span id="cb7-3">   <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"sex"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"sex"</span>,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Change outline and fill colors by groups ("sex")</span></span>
<span id="cb7-4">   <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">palette =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#00AFBB"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#E7B800"</span>)) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Use custom palette</span></span>
<span id="cb7-5"></span>
<span id="cb7-6">a2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">gghistogram</span>(wdata, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"weight"</span>,</span>
<span id="cb7-7">   <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">add =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mean"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">rug =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>,</span>
<span id="cb7-8">   <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"sex"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"sex"</span>,</span>
<span id="cb7-9">   <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">palette =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#00AFBB"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#E7B800"</span>))</span>
<span id="cb7-10"></span>
<span id="cb7-11">a3 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggdensity</span>(wdata, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"weight"</span>,</span>
<span id="cb7-12">   <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">add =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mean"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">rug =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>,</span>
<span id="cb7-13">   <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lightgray"</span>)</span>
<span id="cb7-14"></span>
<span id="cb7-15"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Combine histogram and density plots</span></span>
<span id="cb7-16">a4 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">gghistogram</span>(wdata, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"weight"</span>,</span>
<span id="cb7-17">   <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">add =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mean"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">rug =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>,</span>
<span id="cb7-18">   <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"sex"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">palette =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#00AFBB"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#E7B800"</span>),</span>
<span id="cb7-19">   <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">add_density =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span>
<span id="cb7-20"></span>
<span id="cb7-21"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 한페이지에 넣기</span></span>
<span id="cb7-22"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggarrange</span>(a1, a2, a3 , a4,</span>
<span id="cb7-23">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">labels =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"A"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"B"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"C"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"D"</span>),</span>
<span id="cb7-24">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ncol =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nrow =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span></code></pre></div>
<div class="cell-output cell-output-display">

</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://tomorrow-lab.github.io/posts/R_ggpubr_files/figure-html/cell-5-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="박스-그래프box-plots-바이올린violin-plots-그래프" class="level1">
<h1>4.2. 박스 그래프(Box plots), 바이올린(violin plots) 그래프</h1>
<div id="cell-11" class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-execution_count="6">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Load data</span></span>
<span id="cb8-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ToothGrowth"</span>)</span>
<span id="cb8-3">df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> ToothGrowth</span>
<span id="cb8-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(df, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>)</span></code></pre></div>
<div class="cell-output cell-output-display">
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" scope="col">len</th>
<th data-quarto-table-cell-role="th" scope="col">supp</th>
<th data-quarto-table-cell-role="th" scope="col">dose</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>4.2</td>
<td>VC</td>
<td>0.5</td>
</tr>
<tr class="even">
<td>11.5</td>
<td>VC</td>
<td>0.5</td>
</tr>
<tr class="odd">
<td>7.3</td>
<td>VC</td>
<td>0.5</td>
</tr>
<tr class="even">
<td>5.8</td>
<td>VC</td>
<td>0.5</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="cell-12" class="cell" data-scrolled="false" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-execution_count="7">
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Box plots with jittered points</span></span>
<span id="cb9-2">p1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggboxplot</span>(df, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dose"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"len"</span>,</span>
<span id="cb9-3">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dose"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">palette =</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#00AFBB"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#E7B800"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#FC4E07"</span>),</span>
<span id="cb9-4">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">add =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"jitter"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">shape =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dose"</span>)</span>
<span id="cb9-5"></span>
<span id="cb9-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Add p-values comparing groups</span></span>
<span id="cb9-7">my_comparisons <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>( <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"0.5"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"1"</span>), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"1"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2"</span>), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"0.5"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2"</span>) )</span>
<span id="cb9-8">p2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> p1 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">stat_compare_means</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">comparisons =</span> my_comparisons)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Add pairwise comparisons p-value</span></span>
<span id="cb9-9">        <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">stat_compare_means</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label.y =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>)                   <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Add global p-value</span></span>
<span id="cb9-10"></span>
<span id="cb9-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Violin plots with box plots inside</span></span>
<span id="cb9-12">p3 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggviolin</span>(df, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dose"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"len"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dose"</span>,</span>
<span id="cb9-13">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">palette =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#00AFBB"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#E7B800"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#FC4E07"</span>),</span>
<span id="cb9-14">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">add =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"boxplot"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">add.params =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"white"</span>))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb9-15">         <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">stat_compare_means</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">comparisons =</span> my_comparisons, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"p.signif"</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Add significance levels</span></span>
<span id="cb9-16">         <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">stat_compare_means</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label.y =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>)        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Add global the p-value </span></span>
<span id="cb9-17"></span>
<span id="cb9-18"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggarrange</span>(p1, p2, p3,</span>
<span id="cb9-19">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">labels =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"A"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"B"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"C"</span>),</span>
<span id="cb9-20">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ncol =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nrow =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span></code></pre></div>
<div class="cell-output cell-output-display">

</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://tomorrow-lab.github.io/posts/R_ggpubr_files/figure-html/cell-7-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<section id="막대-그래프bar-plots" class="level2">
<h2 class="anchored" data-anchor-id="막대-그래프bar-plots">4.3. 막대 그래프(Bar plots)</h2>
<section id="간단한-막대-그래프" class="level3">
<h3 class="anchored" data-anchor-id="간단한-막대-그래프">4.3.1 간단한 막대 그래프</h3>
<div id="cell-14" class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-execution_count="8">
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># example Data</span></span>
<span id="cb10-2">df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">dose=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"D0.5"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"D1"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"D2"</span>),</span>
<span id="cb10-3">   <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">len=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">4.2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">29.5</span>))</span>
<span id="cb10-4">df2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">supp=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"VC"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"OJ"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">each=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>),</span>
<span id="cb10-5">   <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">dose=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"D0.5"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"D1"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"D2"</span>),<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>),</span>
<span id="cb10-6">   <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">len=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">6.8</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">15</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">33</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">4.2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">29.5</span>))</span>
<span id="cb10-7">df3 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> ToothGrowth</span>
<span id="cb10-8"></span>
<span id="cb10-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Change position: Interleaved (dodged) bar plot</span></span>
<span id="cb10-10">p1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggbarplot</span>(df2, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dose"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"len"</span>,</span>
<span id="cb10-11">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"supp"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"supp"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">palette =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Paired"</span>,</span>
<span id="cb10-12">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">position =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">position_dodge</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8</span>))</span>
<span id="cb10-13"></span>
<span id="cb10-14"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Change fill and outline color add labels inside bars</span></span>
<span id="cb10-15">p2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggbarplot</span>(df, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dose"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"len"</span>,</span>
<span id="cb10-16">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dose"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dose"</span>,</span>
<span id="cb10-17">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">palette =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#00AFBB"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#E7B800"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#FC4E07"</span>),</span>
<span id="cb10-18">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lab.pos =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"in"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lab.col =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"white"</span>)</span>
<span id="cb10-19"></span>
<span id="cb10-20"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Add jitter points and errors (mean_se)</span></span>
<span id="cb10-21">p3 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggbarplot</span>(df3, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dose"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"len"</span>,</span>
<span id="cb10-22">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">add =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mean_se"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"jitter"</span>))</span>
<span id="cb10-23"></span>
<span id="cb10-24"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Multiple groups with error bars and jitter point</span></span>
<span id="cb10-25">p4 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggbarplot</span>(df3, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dose"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"len"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"supp"</span>,</span>
<span id="cb10-26">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">add =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mean_se"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">palette =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#00AFBB"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#E7B800"</span>),</span>
<span id="cb10-27">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">position =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">position_dodge</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8</span>))</span>
<span id="cb10-28"></span>
<span id="cb10-29"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggarrange</span>(p1, p2, p3, p4,</span>
<span id="cb10-30">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">labels =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"A"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"B"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"C"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"D"</span>),</span>
<span id="cb10-31">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ncol =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nrow =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span></code></pre></div>
<div class="cell-output cell-output-display">

</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://tomorrow-lab.github.io/posts/R_ggpubr_files/figure-html/cell-8-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="정돈된ordered-바-그래프" class="level3">
<h3 class="anchored" data-anchor-id="정돈된ordered-바-그래프">4.3.2 정돈된(Ordered) 바 그래프</h3>
<p><strong>cyl</strong>에 따라서 그룹화하고, 전체적으로 정렬한 그래프(A)와 그룹별로 정렬한 그래프(B)의 시각화입니다.</p>
<div id="cell-16" class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-execution_count="9">
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 샘플 데이터 불러오기</span></span>
<span id="cb11-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mtcars"</span>)</span>
<span id="cb11-3">dfm <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> mtcars</span>
<span id="cb11-4">dfm<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>cyl <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.factor</span>(dfm<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>cyl) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Convert the cyl variable to a factor</span></span>
<span id="cb11-5">dfm<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>name <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(dfm) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Add the name colums</span></span>
<span id="cb11-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(dfm[, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"name"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"wt"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mpg"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cyl"</span>)]) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 데이터 살펴보기</span></span></code></pre></div>
<div class="cell-output cell-output-display">
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th" scope="col">name</th>
<th data-quarto-table-cell-role="th" scope="col">wt</th>
<th data-quarto-table-cell-role="th" scope="col">mpg</th>
<th data-quarto-table-cell-role="th" scope="col">cyl</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th" scope="row">Mazda RX4</td>
<td>Mazda RX4</td>
<td>2.620</td>
<td>21.0</td>
<td>6</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th" scope="row">Mazda RX4 Wag</td>
<td>Mazda RX4 Wag</td>
<td>2.875</td>
<td>21.0</td>
<td>6</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th" scope="row">Datsun 710</td>
<td>Datsun 710</td>
<td>2.320</td>
<td>22.8</td>
<td>4</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th" scope="row">Hornet 4 Drive</td>
<td>Hornet 4 Drive</td>
<td>3.215</td>
<td>21.4</td>
<td>6</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th" scope="row">Hornet Sportabout</td>
<td>Hornet Sportabout</td>
<td>3.440</td>
<td>18.7</td>
<td>8</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th" scope="row">Valiant</td>
<td>Valiant</td>
<td>3.460</td>
<td>18.1</td>
<td>6</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="cell-17" class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-execution_count="10">
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1">a1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggbarplot</span>(dfm, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"name"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mpg"</span>,</span>
<span id="cb12-2">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cyl"</span>,               <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># change fill color by cyl</span></span>
<span id="cb12-3">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"white"</span>,            <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Set bar border colors to white</span></span>
<span id="cb12-4">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">palette =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"jco"</span>,            <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># jco journal color palett. see ?ggpar</span></span>
<span id="cb12-5">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sort.val =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"desc"</span>,          <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Sort the value in dscending order</span></span>
<span id="cb12-6">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sort.by.groups =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>,     <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Don't sort inside each group</span></span>
<span id="cb12-7">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x.text.angle =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">90</span>)           <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Rotate vertically x axis texts</span></span>
<span id="cb12-8"></span>
<span id="cb12-9">a2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggbarplot</span>(dfm, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"name"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mpg"</span>,</span>
<span id="cb12-10">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cyl"</span>,               <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># change fill color by cyl</span></span>
<span id="cb12-11">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"white"</span>,            <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Set bar border colors to white</span></span>
<span id="cb12-12">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">palette =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"jco"</span>,            <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># jco journal color palett. see ?ggpar</span></span>
<span id="cb12-13">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sort.val =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"asc"</span>,           <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Sort the value in dscending order</span></span>
<span id="cb12-14">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sort.by.groups =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>,      <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Sort inside each group</span></span>
<span id="cb12-15">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x.text.angle =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">90</span>)           <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Rotate vertically x axis texts</span></span>
<span id="cb12-16"></span>
<span id="cb12-17"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggarrange</span>(a1, a2,</span>
<span id="cb12-18">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">labels =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"A"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"B"</span>),</span>
<span id="cb12-19">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ncol =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nrow =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span></code></pre></div>
<div class="cell-output cell-output-display">

</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://tomorrow-lab.github.io/posts/R_ggpubr_files/figure-html/cell-10-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="편차deviation-그래프" class="level3">
<h3 class="anchored" data-anchor-id="편차deviation-그래프">4.3.3. 편차(Deviation) 그래프</h3>
<p>편차(deviation) 그래프는 각각의 값들이 평균값 대비 얼마나 차이가 나는지를 시각화 합니다. 여기서는 연비 평균값에 비교해서 각 차량의 편차가 얼마인지 계산해(Z-score) 도표를 그려보겠습니다.</p>
<div id="cell-19" class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-execution_count="11">
<div class="sourceCode cell-code" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Calculate the z-score of the mpg data</span></span>
<span id="cb13-2">dfm<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>mpg_z <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> (dfm<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>mpg <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(dfm<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>mpg))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sd</span>(dfm<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>mpg)</span>
<span id="cb13-3">dfm<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>mpg_grp <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">factor</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ifelse</span>(dfm<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>mpg_z <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"low"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"high"</span>), </span>
<span id="cb13-4">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">levels =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"low"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"high"</span>))</span>
<span id="cb13-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Inspect the data</span></span>
<span id="cb13-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(dfm[, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"name"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"wt"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mpg"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mpg_z"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mpg_grp"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cyl"</span>)])</span></code></pre></div>
<div class="cell-output cell-output-display">
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th" scope="col">name</th>
<th data-quarto-table-cell-role="th" scope="col">wt</th>
<th data-quarto-table-cell-role="th" scope="col">mpg</th>
<th data-quarto-table-cell-role="th" scope="col">mpg_z</th>
<th data-quarto-table-cell-role="th" scope="col">mpg_grp</th>
<th data-quarto-table-cell-role="th" scope="col">cyl</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th" scope="row">Mazda RX4</td>
<td>Mazda RX4</td>
<td>2.620</td>
<td>21.0</td>
<td>0.1508848</td>
<td>high</td>
<td>6</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th" scope="row">Mazda RX4 Wag</td>
<td>Mazda RX4 Wag</td>
<td>2.875</td>
<td>21.0</td>
<td>0.1508848</td>
<td>high</td>
<td>6</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th" scope="row">Datsun 710</td>
<td>Datsun 710</td>
<td>2.320</td>
<td>22.8</td>
<td>0.4495434</td>
<td>high</td>
<td>4</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th" scope="row">Hornet 4 Drive</td>
<td>Hornet 4 Drive</td>
<td>3.215</td>
<td>21.4</td>
<td>0.2172534</td>
<td>high</td>
<td>6</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th" scope="row">Hornet Sportabout</td>
<td>Hornet Sportabout</td>
<td>3.440</td>
<td>18.7</td>
<td>-0.2307345</td>
<td>low</td>
<td>8</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th" scope="row">Valiant</td>
<td>Valiant</td>
<td>3.460</td>
<td>18.1</td>
<td>-0.3302874</td>
<td>low</td>
<td>6</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="cell-20" class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-execution_count="12">
<div class="sourceCode cell-code" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Create an ordered bar plot, colored according to the level of mpg:</span></span>
<span id="cb14-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggbarplot</span>(dfm, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"name"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mpg_z"</span>,</span>
<span id="cb14-3">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mpg_grp"</span>,           <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># change fill color by mpg_level</span></span>
<span id="cb14-4">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"white"</span>,            <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Set bar border colors to white</span></span>
<span id="cb14-5">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">palette =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"jco"</span>,            <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># jco journal color palett. see ?ggpar</span></span>
<span id="cb14-6">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sort.val =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"desc"</span>,          <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Sort the value in descending order</span></span>
<span id="cb14-7">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sort.by.groups =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>,     <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Don't sort inside each group</span></span>
<span id="cb14-8">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x.text.angle =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">90</span>,          <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Rotate vertically x axis texts</span></span>
<span id="cb14-9">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylab =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"MPG z-score"</span>,</span>
<span id="cb14-10">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"MPG Group"</span>,</span>
<span id="cb14-11">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">rotate =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>,</span>
<span id="cb14-12">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ggtheme =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>())</span></code></pre></div>
<div class="cell-output cell-output-display">

</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://tomorrow-lab.github.io/posts/R_ggpubr_files/figure-html/cell-12-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="점-그래프dot-plot" class="level1">
<h1>4.4 점 그래프(Dot plot)</h1>
<section id="막대사탕lollipop-plot" class="level2">
<h2 class="anchored" data-anchor-id="막대사탕lollipop-plot">4.4.1 막대사탕(Lollipop) plot</h2>
<p>막대사탕 그래프는 많은 양의 데이터를 시각화하는데 적합합니다. 아래 예시에서는 <strong>cyl</strong> 그룹에 맞춰서 색상을 구분하였습니다.</p>
<div id="cell-22" class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-execution_count="13">
<div class="sourceCode cell-code" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggdotchart</span>(dfm, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"name"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mpg"</span>,</span>
<span id="cb15-2">           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cyl"</span>,                                <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Color by groups</span></span>
<span id="cb15-3">           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">palette =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#00AFBB"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#E7B800"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#FC4E07"</span>), <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Custom color palette</span></span>
<span id="cb15-4">           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sorting =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"descending"</span>,                       <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Sort value in descending order</span></span>
<span id="cb15-5">           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">add =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"segments"</span>,                             <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Add segments from y = 0 to dots</span></span>
<span id="cb15-6">           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">rotate =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>,                                <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Rotate vertically</span></span>
<span id="cb15-7">           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">group =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cyl"</span>,                                <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Order by groups</span></span>
<span id="cb15-8">           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">dot.size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>,                                 <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Large dot size</span></span>
<span id="cb15-9">           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(dfm<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>mpg),                        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Add mpg values as dot labels</span></span>
<span id="cb15-10">           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">font.label =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"white"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span>, </span>
<span id="cb15-11">           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">vjust =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>),               <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Adjust label parameters</span></span>
<span id="cb15-12">           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ggtheme =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_pubr</span>())                        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ggplot2 theme</span></span></code></pre></div>
<div class="cell-output cell-output-display">

</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://tomorrow-lab.github.io/posts/R_ggpubr_files/figure-html/cell-13-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="도표에-설명figure-legend-넣기" class="level2">
<h2 class="anchored" data-anchor-id="도표에-설명figure-legend-넣기">4.5. 도표에 설명(figure legend) 넣기</h2>
<p>도표 밑에 설명을 넣는 방법입니다. 한줄단위로 내용을 끊어서 작성해야, 산출물에서 줄이 잘 맞게 할 수 있습니다. 아래의 예시 코드를 확인하세요.</p>
<div class="sourceCode" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggparagraph</span>(text, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NULL</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NULL</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">face =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NULL</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">family =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NULL</span>,</span>
<span id="cb16-2">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lineheight =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NULL</span>)</span>
<span id="cb16-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># S3 method for splitText</span></span>
<span id="cb16-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">drawDetails</span>(x, recording)</span></code></pre></div>
<div id="cell-24" class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-execution_count="14">
<div class="sourceCode cell-code" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Density plot</span></span>
<span id="cb17-2">density.p <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggdensity</span>(iris, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Sepal.Length"</span>,</span>
<span id="cb17-3">                      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Species"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">palette =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"jco"</span>)</span>
<span id="cb17-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Text plot</span></span>
<span id="cb17-5">text <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Iris data set gives the measurements in cm"</span>,</span>
<span id="cb17-6">             <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"of the variables sepal length and width"</span>,</span>
<span id="cb17-7">             <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"and petal length and width, respectively,"</span>,</span>
<span id="cb17-8">             <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"for 50 flowers from each of 3 species of iris."</span>,</span>
<span id="cb17-9">             <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"The species are Iris setosa, versicolor, and virginica."</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sep =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">" "</span>)</span>
<span id="cb17-10">text.p <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggparagraph</span>(text, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">face =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"italic"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>)</span>
<span id="cb17-11"></span>
<span id="cb17-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Arrange the plots on the same page</span></span>
<span id="cb17-13"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggarrange</span>(density.p, text.p,</span>
<span id="cb17-14">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ncol =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nrow =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,</span>
<span id="cb17-15">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">heights =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.3</span>))</span></code></pre></div>
<div class="cell-output cell-output-display">

</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://tomorrow-lab.github.io/posts/R_ggpubr_files/figure-html/cell-14-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="선-그래프" class="level2">
<h2 class="anchored" data-anchor-id="선-그래프">4.6. 선 그래프</h2>
<div id="cell-26" class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-execution_count="15">
<div class="sourceCode cell-code" id="cb18" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Data: ToothGrowth data set we'll be used.</span></span>
<span id="cb18-2">df3 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> ToothGrowth</span>
<span id="cb18-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Add error bars: mean_se</span></span>
<span id="cb18-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># (other values include: mean_sd, mean_ci, median_iqr, ....)</span></span>
<span id="cb18-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Add labels</span></span>
<span id="cb18-6">p1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggline</span>(df3, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dose"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"len"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">add =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mean_se"</span>)</span>
<span id="cb18-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Add jitter points and errors (mean_se)</span></span>
<span id="cb18-8">p2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggline</span>(df3, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dose"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"len"</span>,</span>
<span id="cb18-9"> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">add =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mean_se"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'jitter'</span>))</span>
<span id="cb18-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Multiple groups with error bars</span></span>
<span id="cb18-11">p3 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggline</span>(df3, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dose"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"len"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"supp"</span>,</span>
<span id="cb18-12"> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">add =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mean_se"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">palette =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#00AFBB"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#FC4E07"</span>))</span>
<span id="cb18-13"></span>
<span id="cb18-14"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggarrange</span>(p1, p2, p3,</span>
<span id="cb18-15">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">labels =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"A"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"B"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"C"</span>),</span>
<span id="cb18-16">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ncol =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nrow =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span></code></pre></div>
<div class="cell-output cell-output-display">

</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://tomorrow-lab.github.io/posts/R_ggpubr_files/figure-html/cell-15-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="히스토그램과-산포도scatter-plot-with-histograms" class="level2">
<h2 class="anchored" data-anchor-id="히스토그램과-산포도scatter-plot-with-histograms">4.7. 히스토그램과 산포도(Scatter Plot with Histograms)</h2>
<p>히스토그램과 산포도를 하나의 도표에 합쳐서 그려보도록 하겠습니다.</p>
<div id="cell-28" class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-execution_count="16">
<div class="sourceCode cell-code" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Grouped data</span></span>
<span id="cb19-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggscatterhist</span>(</span>
<span id="cb19-3"> iris, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Sepal.Length"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Sepal.Width"</span>,</span>
<span id="cb19-4"> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Species"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6</span>,</span>
<span id="cb19-5"> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">palette =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#00AFBB"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#E7B800"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#FC4E07"</span>),</span>
<span id="cb19-6"> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">margin.params =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Species"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.2</span>))</span></code></pre></div>
<div class="cell-output cell-output-display">

</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://tomorrow-lab.github.io/posts/R_ggpubr_files/figure-html/cell-16-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="상관분석correlation-coefficients과-p-values-추가하기" class="level2">
<h2 class="anchored" data-anchor-id="상관분석correlation-coefficients과-p-values-추가하기">4.8. 상관분석(Correlation Coefficients)과 P-values 추가하기</h2>
<p>산포도에 <strong>상관분석</strong>과 <strong>p-values</strong>를 추가하는 방법입니다.</p>
<div id="cell-30" class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-execution_count="17">
<div class="sourceCode cell-code" id="cb20" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Load data</span></span>
<span id="cb20-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mtcars"</span>)</span>
<span id="cb20-3">df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> mtcars</span>
<span id="cb20-4">df<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>cyl <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.factor</span>(df<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>cyl)</span>
<span id="cb20-5"></span>
<span id="cb20-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Scatter plot with correlation coefficient</span></span>
<span id="cb20-7">sp <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggscatter</span>(df, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"wt"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mpg"</span>,</span>
<span id="cb20-8">   <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">add =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"reg.line"</span>,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Add regressin line</span></span>
<span id="cb20-9">   <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">add.params =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"blue"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lightgray"</span>), <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Customize reg. line</span></span>
<span id="cb20-10">   <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">conf.int =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Add confidence interval</span></span>
<span id="cb20-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Add correlation coefficient</span></span>
<span id="cb20-12">p1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> sp <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">stat_cor</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">method =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pearson"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label.x =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label.y =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span>)</span>
<span id="cb20-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Color by groups and facet</span></span>
<span id="cb20-14">sp <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggscatter</span>(df, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"wt"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mpg"</span>,</span>
<span id="cb20-15">   <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cyl"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">palette =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"jco"</span>,</span>
<span id="cb20-16">   <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">add =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"reg.line"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">conf.int =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span>
<span id="cb20-17">p2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> sp <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">stat_cor</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> cyl), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label.x =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>)</span>
<span id="cb20-18"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Scatter plot with ellipses and group mean points</span></span>
<span id="cb20-19">p3 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggscatter</span>(df, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"wt"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mpg"</span>,</span>
<span id="cb20-20">   <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cyl"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">shape =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cyl"</span>,</span>
<span id="cb20-21">   <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mean.point =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ellipse =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb20-22">   <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">stat_stars</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> cyl))</span>
<span id="cb20-23"></span>
<span id="cb20-24"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggarrange</span>(p1, p2, p3,</span>
<span id="cb20-25">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">labels =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"A"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"B"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"C"</span>),</span>
<span id="cb20-26">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ncol =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nrow =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span></code></pre></div>
<div class="cell-output cell-output-display">

</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://tomorrow-lab.github.io/posts/R_ggpubr_files/figure-html/cell-17-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="plot-paired-data" class="level2">
<h2 class="anchored" data-anchor-id="plot-paired-data">4.9. Plot Paired Data</h2>
<div id="cell-32" class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-execution_count="18">
<div class="sourceCode cell-code" id="cb21" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Example data</span></span>
<span id="cb21-2">before <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">200.1</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">190.9</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">192.7</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">213</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">241.4</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">196.9</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">172.2</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">185.5</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">205.2</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">193.7</span>)</span>
<span id="cb21-3">after <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">392.9</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">393.2</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">345.1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">393</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">434</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">427.9</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">422</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">383.9</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">392.3</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">352.2</span>)</span>
<span id="cb21-4"></span>
<span id="cb21-5">d <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">before =</span> before, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">after =</span> after)</span>
<span id="cb21-6">p1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggpaired</span>(d, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cond1 =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"before"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cond2 =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"after"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">width =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.0</span>,</span>
<span id="cb21-7">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">line.color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gray"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">line.size =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.4</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">palette =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"npg"</span>)</span>
<span id="cb21-8">p2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggpaired</span>(d, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cond1 =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"before"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cond2 =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"after"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">width =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.2</span>,</span>
<span id="cb21-9">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">line.color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gray"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">line.size =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.4</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">palette =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"aaas"</span>)</span>
<span id="cb21-10">p3 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggpaired</span>(d, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cond1 =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"before"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cond2 =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"after"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">width =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.2</span>,</span>
<span id="cb21-11">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">line.color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gray"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">line.size =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.4</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"condition"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">palette =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"npg"</span>)</span>
<span id="cb21-12"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggarrange</span>(p1, p2, p3,</span>
<span id="cb21-13">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">labels =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"A"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"B"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"C"</span>),</span>
<span id="cb21-14">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ncol =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nrow =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span></code></pre></div>
<div class="cell-output cell-output-display">

</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://tomorrow-lab.github.io/posts/R_ggpubr_files/figure-html/cell-18-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="p-values-를-박스-그래프에-추가하기" class="level2">
<h2 class="anchored" data-anchor-id="p-values-를-박스-그래프에-추가하기">4.10. P-values 를 박스 그래프에 추가하기</h2>
<div id="cell-34" class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-execution_count="19">
<div class="sourceCode cell-code" id="cb22" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Load data</span></span>
<span id="cb22-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ToothGrowth"</span>)</span>
<span id="cb22-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(ToothGrowth)</span></code></pre></div>
<div class="cell-output cell-output-display">
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" scope="col">len</th>
<th data-quarto-table-cell-role="th" scope="col">supp</th>
<th data-quarto-table-cell-role="th" scope="col">dose</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>4.2</td>
<td>VC</td>
<td>0.5</td>
</tr>
<tr class="even">
<td>11.5</td>
<td>VC</td>
<td>0.5</td>
</tr>
<tr class="odd">
<td>7.3</td>
<td>VC</td>
<td>0.5</td>
</tr>
<tr class="even">
<td>5.8</td>
<td>VC</td>
<td>0.5</td>
</tr>
<tr class="odd">
<td>6.4</td>
<td>VC</td>
<td>0.5</td>
</tr>
<tr class="even">
<td>10.0</td>
<td>VC</td>
<td>0.5</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="cell-35" class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-execution_count="20">
<div class="sourceCode cell-code" id="cb23" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Two independent groups</span></span>
<span id="cb23-2">p <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggboxplot</span>(ToothGrowth, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"supp"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"len"</span>,</span>
<span id="cb23-3">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"supp"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">palette =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"npg"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">add =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"jitter"</span>)</span>
<span id="cb23-4"></span>
<span id="cb23-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#  Add p-value</span></span>
<span id="cb23-6">p1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> p <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">stat_compare_means</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">method =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"t.test"</span>)</span>
<span id="cb23-7"></span>
<span id="cb23-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Paired samples</span></span>
<span id="cb23-9">p2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggpaired</span>(ToothGrowth, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"supp"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"len"</span>,</span>
<span id="cb23-10">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"supp"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">line.color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gray"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">line.size =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.4</span>,</span>
<span id="cb23-11">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">palette =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"npg"</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb23-12">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">stat_compare_means</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">paired =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">method =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"t.test"</span>)</span>
<span id="cb23-13"></span>
<span id="cb23-14"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># More than two groups, Pairwise comparisons: Specify the comparisons you want</span></span>
<span id="cb23-15">my_comparisons <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>( <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"0.5"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"1"</span>), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"1"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2"</span>), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"0.5"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2"</span>) )</span>
<span id="cb23-16">p3 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggboxplot</span>(ToothGrowth, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dose"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"len"</span>,</span>
<span id="cb23-17">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dose"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">palette =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"npg"</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb23-18"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Add pairwise comparisons p-value</span></span>
<span id="cb23-19">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">stat_compare_means</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">comparisons =</span> my_comparisons, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label.y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">29</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">35</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">40</span>))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb23-20">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">stat_compare_means</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label.y =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">45</span>)     <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Add global Anova p-value</span></span>
<span id="cb23-21"></span>
<span id="cb23-22"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Multiple pairwise test against a reference group</span></span>
<span id="cb23-23">p4 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggboxplot</span>(ToothGrowth, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dose"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"len"</span>,</span>
<span id="cb23-24">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dose"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">palette =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"npg"</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb23-25">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">stat_compare_means</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">method =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"anova"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label.y =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">40</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Add global p-value</span></span>
<span id="cb23-26">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">stat_compare_means</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> ..p.signif..),</span>
<span id="cb23-27">                      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">method =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"t.test"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ref.group =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"0.5"</span>)</span>
<span id="cb23-28"></span>
<span id="cb23-29"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggarrange</span>(p1, p2, p3, p4,  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ncol =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nrow =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,</span>
<span id="cb23-30">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">labels =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"A"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"B"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"C"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"D"</span>))</span></code></pre></div>
<div class="cell-output cell-output-display">

</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://tomorrow-lab.github.io/posts/R_ggpubr_files/figure-html/cell-20-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-36" class="cell" data-scrolled="false" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-execution_count="21">
<div class="sourceCode cell-code" id="cb24" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Multiple grouping variables</span></span>
<span id="cb24-2">p <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggboxplot</span>(ToothGrowth, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"supp"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"len"</span>,</span>
<span id="cb24-3">              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"supp"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">palette =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"npg"</span>,</span>
<span id="cb24-4">              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">add =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"jitter"</span>,</span>
<span id="cb24-5">              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">facet.by =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dose"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">short.panel.labs =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>)</span>
<span id="cb24-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Use only p.format as label. Remove method name.</span></span>
<span id="cb24-7">p5 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> p <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">stat_compare_means</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"p = "</span>, ..p.format..)))</span>
<span id="cb24-8">p5</span></code></pre></div>
<div class="cell-output cell-output-display">

</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://tomorrow-lab.github.io/posts/R_ggpubr_files/figure-html/cell-21-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="간단한-통계-분석" class="level1">
<h1>5. 간단한 통계 분석</h1>
<p>위에서 사용한 <code>ToothGrowth</code> 데이터를 사용합니다.</p>
<div id="cell-38" class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-execution_count="22">
<div class="sourceCode cell-code" id="cb25" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Load data</span></span>
<span id="cb25-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ToothGrowth"</span>)</span>
<span id="cb25-3">df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> ToothGrowth</span></code></pre></div>
</div>
<div id="cell-39" class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-execution_count="23">
<div class="sourceCode cell-code" id="cb26" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># One-sample test</span></span>
<span id="cb26-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">compare_means</span>(len <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, df, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mu =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span></code></pre></div>
<div class="cell-output cell-output-display">
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" scope="col">.y.</th>
<th data-quarto-table-cell-role="th" scope="col">group1</th>
<th data-quarto-table-cell-role="th" scope="col">group2</th>
<th data-quarto-table-cell-role="th" scope="col">p</th>
<th data-quarto-table-cell-role="th" scope="col">p.adj</th>
<th data-quarto-table-cell-role="th" scope="col">p.format</th>
<th data-quarto-table-cell-role="th" scope="col">p.signif</th>
<th data-quarto-table-cell-role="th" scope="col">method</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>len</td>
<td>1</td>
<td>null model</td>
<td>1.664007e-11</td>
<td>1.664007e-11</td>
<td>1.7e-11</td>
<td>****</td>
<td>Wilcoxon</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="cell-40" class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-execution_count="24">
<div class="sourceCode cell-code" id="cb27" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Two-samples unpaired test</span></span>
<span id="cb27-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">compare_means</span>(len <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> supp, df)</span></code></pre></div>
<div class="cell-output cell-output-display">
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" scope="col">.y.</th>
<th data-quarto-table-cell-role="th" scope="col">group1</th>
<th data-quarto-table-cell-role="th" scope="col">group2</th>
<th data-quarto-table-cell-role="th" scope="col">p</th>
<th data-quarto-table-cell-role="th" scope="col">p.adj</th>
<th data-quarto-table-cell-role="th" scope="col">p.format</th>
<th data-quarto-table-cell-role="th" scope="col">p.signif</th>
<th data-quarto-table-cell-role="th" scope="col">method</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>len</td>
<td>OJ</td>
<td>VC</td>
<td>0.06449067</td>
<td>0.06449067</td>
<td>0.064</td>
<td>ns</td>
<td>Wilcoxon</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="cell-41" class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-execution_count="25">
<div class="sourceCode cell-code" id="cb28" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Two-samples paired test</span></span>
<span id="cb28-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">compare_means</span>(len <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> supp, df, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">paired =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span></code></pre></div>
<div class="cell-output cell-output-display">
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" scope="col">.y.</th>
<th data-quarto-table-cell-role="th" scope="col">group1</th>
<th data-quarto-table-cell-role="th" scope="col">group2</th>
<th data-quarto-table-cell-role="th" scope="col">p</th>
<th data-quarto-table-cell-role="th" scope="col">p.adj</th>
<th data-quarto-table-cell-role="th" scope="col">p.format</th>
<th data-quarto-table-cell-role="th" scope="col">p.signif</th>
<th data-quarto-table-cell-role="th" scope="col">method</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>len</td>
<td>OJ</td>
<td>VC</td>
<td>0.004312554</td>
<td>0.004312554</td>
<td>0.0043</td>
<td>**</td>
<td>Wilcoxon</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="cell-42" class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-execution_count="26">
<div class="sourceCode cell-code" id="cb29" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Compare supp levels after grouping the data by "dose"</span></span>
<span id="cb29-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">compare_means</span>(len <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> supp, df, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">group.by =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dose"</span>)</span></code></pre></div>
<div class="cell-output cell-output-display">
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" scope="col">dose</th>
<th data-quarto-table-cell-role="th" scope="col">.y.</th>
<th data-quarto-table-cell-role="th" scope="col">group1</th>
<th data-quarto-table-cell-role="th" scope="col">group2</th>
<th data-quarto-table-cell-role="th" scope="col">p</th>
<th data-quarto-table-cell-role="th" scope="col">p.adj</th>
<th data-quarto-table-cell-role="th" scope="col">p.format</th>
<th data-quarto-table-cell-role="th" scope="col">p.signif</th>
<th data-quarto-table-cell-role="th" scope="col">method</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>0.5</td>
<td>len</td>
<td>OJ</td>
<td>VC</td>
<td>0.023186427</td>
<td>0.04637285</td>
<td>0.023</td>
<td>*</td>
<td>Wilcoxon</td>
</tr>
<tr class="even">
<td>1.0</td>
<td>len</td>
<td>OJ</td>
<td>VC</td>
<td>0.004030367</td>
<td>0.01209110</td>
<td>0.004</td>
<td>**</td>
<td>Wilcoxon</td>
</tr>
<tr class="odd">
<td>2.0</td>
<td>len</td>
<td>OJ</td>
<td>VC</td>
<td>1.000000000</td>
<td>1.00000000</td>
<td>1.000</td>
<td>ns</td>
<td>Wilcoxon</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="cell-43" class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-execution_count="27">
<div class="sourceCode cell-code" id="cb30" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># pairwise comparisons</span></span>
<span id="cb30-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># As dose contains more thant two levels ==&gt;</span></span>
<span id="cb30-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># pairwise test is automatically performed.</span></span>
<span id="cb30-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">compare_means</span>(len <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> dose, df)</span></code></pre></div>
<div class="cell-output cell-output-display">
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" scope="col">.y.</th>
<th data-quarto-table-cell-role="th" scope="col">group1</th>
<th data-quarto-table-cell-role="th" scope="col">group2</th>
<th data-quarto-table-cell-role="th" scope="col">p</th>
<th data-quarto-table-cell-role="th" scope="col">p.adj</th>
<th data-quarto-table-cell-role="th" scope="col">p.format</th>
<th data-quarto-table-cell-role="th" scope="col">p.signif</th>
<th data-quarto-table-cell-role="th" scope="col">method</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>len</td>
<td>0.5</td>
<td>1</td>
<td>7.020855e-06</td>
<td>1.404171e-05</td>
<td>7.0e-06</td>
<td>****</td>
<td>Wilcoxon</td>
</tr>
<tr class="even">
<td>len</td>
<td>0.5</td>
<td>2</td>
<td>8.406447e-08</td>
<td>2.521934e-07</td>
<td>8.4e-08</td>
<td>****</td>
<td>Wilcoxon</td>
</tr>
<tr class="odd">
<td>len</td>
<td>1</td>
<td>2</td>
<td>1.772382e-04</td>
<td>1.772382e-04</td>
<td>0.00018</td>
<td>***</td>
<td>Wilcoxon</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="cell-44" class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-execution_count="28">
<div class="sourceCode cell-code" id="cb31" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Comparison against reference group</span></span>
<span id="cb31-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">compare_means</span>(len <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> dose, df, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ref.group =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"0.5"</span>)</span></code></pre></div>
<div class="cell-output cell-output-display">
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" scope="col">.y.</th>
<th data-quarto-table-cell-role="th" scope="col">group1</th>
<th data-quarto-table-cell-role="th" scope="col">group2</th>
<th data-quarto-table-cell-role="th" scope="col">p</th>
<th data-quarto-table-cell-role="th" scope="col">p.adj</th>
<th data-quarto-table-cell-role="th" scope="col">p.format</th>
<th data-quarto-table-cell-role="th" scope="col">p.signif</th>
<th data-quarto-table-cell-role="th" scope="col">method</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>len</td>
<td>0.5</td>
<td>1</td>
<td>7.020855e-06</td>
<td>7.020855e-06</td>
<td>7.0e-06</td>
<td>****</td>
<td>Wilcoxon</td>
</tr>
<tr class="even">
<td>len</td>
<td>0.5</td>
<td>2</td>
<td>8.406447e-08</td>
<td>1.681289e-07</td>
<td>8.4e-08</td>
<td>****</td>
<td>Wilcoxon</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="cell-45" class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-execution_count="29">
<div class="sourceCode cell-code" id="cb32" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Comparison against all</span></span>
<span id="cb32-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">compare_means</span>(len <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> dose, df, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ref.group =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">".all."</span>)</span></code></pre></div>
<div class="cell-output cell-output-display">
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" scope="col">.y.</th>
<th data-quarto-table-cell-role="th" scope="col">group1</th>
<th data-quarto-table-cell-role="th" scope="col">group2</th>
<th data-quarto-table-cell-role="th" scope="col">p</th>
<th data-quarto-table-cell-role="th" scope="col">p.adj</th>
<th data-quarto-table-cell-role="th" scope="col">p.format</th>
<th data-quarto-table-cell-role="th" scope="col">p.signif</th>
<th data-quarto-table-cell-role="th" scope="col">method</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>len</td>
<td>.all.</td>
<td>0.5</td>
<td>5.078788e-05</td>
<td>0.0001523636</td>
<td>5.1e-05</td>
<td>****</td>
<td>Wilcoxon</td>
</tr>
<tr class="even">
<td>len</td>
<td>.all.</td>
<td>1</td>
<td>7.640429e-01</td>
<td>0.7640429386</td>
<td>0.76404</td>
<td>ns</td>
<td>Wilcoxon</td>
</tr>
<tr class="odd">
<td>len</td>
<td>.all.</td>
<td>2</td>
<td>1.791243e-04</td>
<td>0.0003582486</td>
<td>0.00018</td>
<td>***</td>
<td>Wilcoxon</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="cell-46" class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-execution_count="30">
<div class="sourceCode cell-code" id="cb33" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Anova test</span></span>
<span id="cb33-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">compare_means</span>(len <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> dose, df, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">method =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"anova"</span>)</span></code></pre></div>
<div class="cell-output cell-output-display">
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" scope="col">.y.</th>
<th data-quarto-table-cell-role="th" scope="col">p</th>
<th data-quarto-table-cell-role="th" scope="col">p.adj</th>
<th data-quarto-table-cell-role="th" scope="col">p.format</th>
<th data-quarto-table-cell-role="th" scope="col">p.signif</th>
<th data-quarto-table-cell-role="th" scope="col">method</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>len</td>
<td>9.532727e-16</td>
<td>9.532727e-16</td>
<td>9.5e-16</td>
<td>****</td>
<td>Anova</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="cell-47" class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-execution_count="31">
<div class="sourceCode cell-code" id="cb34" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># kruskal.test</span></span>
<span id="cb34-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">compare_means</span>(len <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> dose, df, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">method =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"kruskal.test"</span>)</span></code></pre></div>
<div class="cell-output cell-output-display">
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" scope="col">.y.</th>
<th data-quarto-table-cell-role="th" scope="col">p</th>
<th data-quarto-table-cell-role="th" scope="col">p.adj</th>
<th data-quarto-table-cell-role="th" scope="col">p.format</th>
<th data-quarto-table-cell-role="th" scope="col">p.signif</th>
<th data-quarto-table-cell-role="th" scope="col">method</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>len</td>
<td>1.475207e-09</td>
<td>1.475207e-09</td>
<td>1.5e-09</td>
<td>****</td>
<td>Kruskal-Wallis</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="더-읽어볼것" class="level1">
<h1>6. 더 읽어볼것</h1>
<ul>
<li><a href="http://www.sthda.com/english/articles/24-ggpubr-publication-ready-plots/81-ggplot2-easy-way-to-mix-multiple-graphs-on-the-same-page/">Easy Way to Mix Multiple Graphs on The Same Page</a></li>
<li><a href="http://www.sthda.com/english/articles/24-ggpubr-publication-ready-plots/76-add-p-values-and-significance-levels-to-ggplots/">Add P-values and Significance Levels to ggplots</a></li>
</ul>
</section>
<section id="마치며" class="level1">
<h1>7. 마치며</h1>
<p><code>ggpubr</code>는 정말 딱 필요한 기능을 아주 쉽게 사용할 수 있게 디자인되어 있습니다. 너무 과하지도 않고 대부분의 과학저널에서 사용되는 시각화를 지원하죠. 간단하게 통계분석을 할 수 있다는 점도 마음에 듭니다. 다음에는 데이터 전처리에 사용되는 <code>dplyr</code> 패키지에 대해 알아보겠습니다.</p>


</section>

 ]]></description>
  <category>news</category>
  <category>R</category>
  <category>data science</category>
  <category>ggpubr</category>
  <guid>https://tomorrow-lab.github.io/posts/R_ggpubr.html</guid>
  <pubDate>Tue, 28 Feb 2023 15:00:00 GMT</pubDate>
</item>
<item>
  <title>각종 실험 방법 정리</title>
  <dc:creator>Taeyoon kim</dc:creator>
  <link>https://tomorrow-lab.github.io/posts/lab_protocols/lab_protocols.html</link>
  <description><![CDATA[ 




<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://tomorrow-lab.github.io/posts/lab_protocols/thumbnail.jpg" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:70.0%"></p>
</figure>
</div>
<section id="간략한-설명" class="level1">
<h1>간략한 설명</h1>
<p>이곳에는 실험 방법에 대한 간략한 정보가 있습니다. 계속해서 자주 사용하는 프로토콜들을 정리할 예정입니다.</p>
</section>
<section id="목차" class="level1">
<h1>목차</h1>
<ol type="1">
<li>Miniprep</li>
<li>ELISA</li>
<li>Sequencing</li>
<li>SDS-PAGE</li>
<li>PCR</li>
</ol>
</section>
<section id="miniprep" class="level1">
<h1>Miniprep <a name="miniprep"></a></h1>
<section id="왜-이름이-miniprep-인가요" class="level2">
<h2 class="anchored" data-anchor-id="왜-이름이-miniprep-인가요">왜 이름이 <strong>miniprep</strong> 인가요?</h2>
<p>다양한 회사에서 plasmid DNSA를 정제하는 하는 키트를 생산하고 있는데, 시작하는 E.coli 배양액의 양에 따라서 다음과 같이 miniprep, midiprep, maxiprep라고 공통적으로 부르고 있습니다. 이름에서 알 수 있듯 양이 적으면 mini 많으면 maxi입니다.</p>
<p>miniprep은 (상대적으로) 빠르고 작은 규모로 plasmid DNA를 뽑아 낼 수 있기에 많이 사용되고 있습니다. 원리는 <strong>alkaline lysis method</strong> 를 사용하고 있는데 간단히 이야기 하면 염기성 용액으로 셀을 깨주고, 빠르게 중화시켜 Plasmid DNA만 선택해 내는 방법 입니다. 보통의 경우 miniprep으로 약 50µg의 plasmid DNA를 얻을 수 있습니다.</p>
<blockquote class="blockquote">
<p>miniprep에 사용되는 다양한 키트가 있지만, 여기에서는 Qiagen Spin Miniprep 키트 기준으로 설명합니다.</p>
</blockquote>
</section>
<section id="metarials" class="level2">
<h2 class="anchored" data-anchor-id="metarials">Metarials:</h2>
<ul>
<li>하룻밤 키운 E.coli 배양액 (1-5ml)</li>
<li>차가운 P1 버퍼 (50 mM Tris-HCl pH 8.0, 10 mM EDTA, 100 µg/ml RNaseA) RNaseA가 들어있습니다, 항상 냉장 보관하세요.</li>
<li>P2 버퍼 (200 mM NaOH, 1% SDS)</li>
<li>N3 버퍼 (4.2 M Gu-HCl, 0.9 M potassium acetate, pH 4.8)</li>
<li>PB 버퍼 (5 M Gu-HCl, 30% ethanol)</li>
<li>PE 버퍼 (10 mM Tris-HCl pH 7.5, 80% ethanol)</li>
<li>EB 버퍼 (10 mM Tris·Cl, pH 8.5; DW로 대체하셔도 됩니다.)</li>
<li>QIAprep spin column (키트에 포함되어 있음)</li>
<li>Centrifuge</li>
<li>멸균된 1.5-ml microcentrifuge 튜브</li>
</ul>
</section>
<section id="methods" class="level2">
<h2 class="anchored" data-anchor-id="methods">Methods:</h2>
<ol type="1">
<li>microcentrifuge 튜브에 <strong>1.5 ml</strong> 의 배양액을 넣어 줍니다.</li>
<li>최대 속도로 Centrifuge for <strong>1 min</strong> at <strong>room temperature</strong>, gently aspirate out the supernatant and discard it.</li>
<li>충분한 크기의 cell pellet이 생길때 까지 반복합니다.</li>
<li><strong>250 µl</strong> 의 차가운 Buffer P1 를 넣어주고, Resuspend pelleted bacterial cells</li>
<li>Add 250 μl Buffer P2 and <strong>조심스럽게 invert</strong> the tube 4–6 times to mix.</li>
<li>Add <strong>300 µl</strong> of Buffer N3. NOTE: Proceed to the next step within <strong>immediately</strong> !</li>
<li>Close the tube tightly and invert the tube <strong>4 - 6 times</strong> . The solution should become cloudy.</li>
<li>Centrifuge for 10 min at 13,000 rpm (~17,900 x g) in a table-top microcentrifuge. A compact white pellet will form. Apply the supernatants from step 4 to the QIAprep spin column by decanting or pipetting.</li>
<li>Centrifuge for 30–60 s. Discard the flow-through. Spinning for 60 seconds produces good results.</li>
<li>Wash QIAprep spin column by adding <strong>0.75 ml</strong> Buffer PE and centrifuging for 30–60 s.</li>
<li>Discard the flow-through, and centrifuge for an additional 1 min to remove residual wash buffer. IMPORTANT: Residual wash buffer will inhibit subsequent enzymatic reactions.</li>
<li>Place the QIAprep column in a clean 1.5 ml microcentrifuge tube. To elute DNA, add 50 μl Buffer EB (10 mM Tris·Cl, pH 8.5) or water to the center of each QIAprep spin column, let stand for 1 min, and centrifuge for 1 min. 만약 높은 농도로 elution 받고 싶다면 add 30 μL의 DW를 컬럼 가운데에 넣고, incubate at room temperature on the bench for 5 mins and then centrifuge for 1 min.</li>
</ol>
<hr>
<section id="노트" class="level3">
<h3 class="anchored" data-anchor-id="노트">노트</h3>
<ul>
<li>한번에 10개 이상의 miniprep을 한다면 vacuum manifold 방법을 사용하는게 빠릅니다.</li>
<li>cell lysate를 column에 두번 거치면 수율이 약 20% 증가됩니다.</li>
<li>시퀀싱 경과가 안나오는 이유는 대체로 염에 의한 오염으로, Washing 하는 과정을 충분하게 해줍니다.</li>
</ul>
<div id="elisa">
</div></section>
</section>
</section>
<section id="elisa-enzyme-linked-immunosorbent-assay" class="level1">
<h1>ELISA (enzyme linked immunosorbent assay)</h1>
<p>효소면역 정량법 (elisa)는 오늘날 가장 널리 이용되는 면역정량법입니다. 항원-항체반응을 이용하여 항원이나 항체를 정성, 정량할 수 있는 감도가 우수한 실험법으로 항체에 효소를 결합시켜 항원항체반응을 확인하는 방법입니다. 간단하고 비용이 적게 들어 다량분석이 가능합니다.</p>
<section id="원리" class="level2">
<h2 class="anchored" data-anchor-id="원리">원리</h2>
<p>이름에서 알 수 있듯이 효소가 사용됩니다. 항원의 농도는 기질 전환 정도에 달라집니다 항체나 항원이 고체상에 흡착되어있으며 이렇게 해야지만 결합하지 않은 free항원들을 세척으로 없앨 수 있습니다. 실험동물을 immunization 한 후 얻은 serum이나 fusion을 통해 얻은 하이브리도마의 culture supernatant안에 원하는 항체가 생성되어있는지 확인할 수 있습니다. 방사능을 사용하지 않으면서 검사할 수 있고 샌드위치와 경쟁적 ELISA 방법이 가장 많이 사용됩니다. Dirent ELISA도 사용되는데 항원이 고체상에 고정됩니다. 이 방법은 항원특이적 항체 검출시에 용이합니다. 효소로는 간단한 기질을 넣어주었을때 색이 나는 반응을 이용합니다. 대표적으로는 alkaline phosphatase와 HRP(horseradish peroxidase)가 사용됩니다.</p>
</section>
<section id="종류" class="level2">
<h2 class="anchored" data-anchor-id="종류">종류</h2>
<ol type="1">
<li>Direct ELISA: 항원과 반응하는 항체에 바로 효소를 결합시킨다.</li>
<li>Indirect ELISA: 항원과 결합하는 항체(1차항체)에는 효소가 없고, 그 항체와 결합하는 항체(2차항체)에는 효소가 결합되어있다. 일반적으로 isotype에 대한 항체에 효소가 결합된 형태로 판매되고 있다. 자신이 이용하는 일차항체의 isotype에 맞는 효소결합항체를 구입하여 사용하면된다.항체를 정량 및 정성적으로 분석 할때 사용한다.</li>
<li>Sandwich ELISA: 항원에 대한 항체를 먼저 well에 결합시키고 그 항체에 대한 항원(시료)을 결합시킨다. 그 후 직접적이나 간접법으로 조사한다. 항원을 정성 및 정량적으로 분석한다.</li>
</ol>
<div id="sequencing">

</div></section>
</section>
<section id="dna-서열-분석하기" class="level1">
<h1>DNA 서열 분석하기</h1>
<p><a href="http://bitesizebio.com/articles/how-to-analyze-dna-sequencing-results-properly/">내용 출처</a></p>
<p><a href="http://www.incodom.kr/Sanger_sequencing">생거 시퀀싱</a>의 비용이 워낙 저렴해져서, 실험을 할 때 <strong>DNA 서열</strong>을 확인하는 것은 일상화 되었습니다. 시퀀싱을 서비스해주는 업체(코스모진텍이나 바이오니아)에서는 결과 값을 <code>ab1</code> 파일로 되돌려 줍니다.</p>
<section id="ab1-파일을-열기-위한-프로그램" class="level3">
<h3 class="anchored" data-anchor-id="ab1-파일을-열기-위한-프로그램">ab1 파일을 열기 위한 프로그램</h3>
<p>저는 개인적으로 <code>ApE</code>를 선호하지만, 다음과 같이 다양한 프로그램이 있습니다. 마음에 드시는 것을 선택하시면 됩니다.</p>
<ul>
<li><a href="http://nucleobytes.com/index.php/4peaks">4Peaks</a> (Mac)</li>
<li><a href="http://www.snapgene.com/products/snapgene_viewer/">SnapGene Viewer</a> (Mac/PC)</li>
<li><a href="http://www.geospiza.com/Products/finchtv.shtml">FinchTV</a>(Mac/PC)</li>
<li><a href="https://products.appliedbiosystems.com/ab/en/US/adirect/ab?cmd=catNavigate2&amp;catID=600583&amp;tab=DetailInfo">Sequence Scanner</a> (PC)</li>
<li><a href="http://technelysium.com.au/?page_id=13">Chromas</a> (PC)</li>
<li><a href="http://biologylabs.utah.edu/jorgensen/wayned/ape/">ApE</a>(Mac/PC)</li>
</ul>
<p>상기의 프로그램으로 <code>ab1</code>파일을 열어서 아래와 같은 크로마토그램을 확인 할 수 있습니다.</p>
</section>
<section id="dna-서열-크로마토그램은-겹쳐있지-않아야-합니다." class="level3">
<h3 class="anchored" data-anchor-id="dna-서열-크로마토그램은-겹쳐있지-않아야-합니다.">DNA 서열 크로마토그램은 겹쳐있지 않아야 합니다.</h3>
<p>여기 <em>DNA 서열 trace</em>가 있습니다.</p>
<p><img src="http://bitesizebio.s3.amazonaws.com/content/uploads/2013/05/dna-sequence-analysis-tips-1.jpg" class="img-fluid"></p>
<p>자세히 보면 이상한 것을 알 수 있는데요. 몇 개의 peak들이 겹쳐져 있는 것이지요. Peak이 겹쳐져 있다는 것은 DNA 시퀀싱 결과 값이 명확하지 않다는 것이고 측정 값의 신뢰도가 떨어 집니다.</p>
<p>아래 사진의 크로마토그램은 신뢰도가 아주 높다고 볼수 있죠.<br>
<img src="http://bitesizebio.s3.amazonaws.com/content/uploads/2013/05/dna-sequence-analysis-tips-2.jpg" title="dna-sequence-analysis-tips-2" class="img-fluid"></p>
</section>
<section id="dna-서열-수정하기" class="level3">
<h3 class="anchored" data-anchor-id="dna-서열-수정하기">DNA 서열 수정하기</h3>
<p>크로마토그램을 자세히 보다 보면 아래와 같이 잘못된 것이 있을 수있습니다.</p>
<p><img src="http://bitesizebio.s3.amazonaws.com/content/uploads/2013/05/dna-sequence-analysis-tips-4.jpg" title="dna-sequence-analysis-tips-4" class="img-fluid"></p>
<p>시퀀스 상에는 A가 없지만 크로마토그램을 보면 <code>CTC</code>가 아닌 <code>CATC</code>가 되어야 함을 알수 있습니다. 이런 경우가 간혹 있기 때문에 DNA 크로마토그램을 확인할 필요가 있습니다.</p>
</section>
<section id="dna-서열은-500-700개-까지는-믿을-만합니다." class="level3">
<h3 class="anchored" data-anchor-id="dna-서열은-500-700개-까지는-믿을-만합니다.">DNA 서열은 500-700개 까지는 믿을 만합니다.</h3>
<p>생어 시퀀싱에는 한계가 있습니다. 한 번에 약 500개 정도 까지의 결과값만 신뢰할 수 있다는 것입니다. 시퀀싱 서비스 업체에 문의하기 전에 이것을 먼저 확인 하셔야 합니다.</p>
</section>
<section id="dna-서열-처음-20-30개는-신뢰도가-낮습니다." class="level3">
<h3 class="anchored" data-anchor-id="dna-서열-처음-20-30개는-신뢰도가-낮습니다.">DNA 서열 처음 20-30개는 신뢰도가 낮습니다.</h3>
<p>그래서 Primer가 붙는 위치를 원하는 서열의 앞쪽 50개 정도로 선택하는게 좋습니다.</p>
</section>
<section id="dna-시퀀싱을-보낼-샘플은-깨끗하게-보냅니다." class="level3">
<h3 class="anchored" data-anchor-id="dna-시퀀싱을-보낼-샘플은-깨끗하게-보냅니다.">DNA 시퀀싱을 보낼 샘플은 깨끗하게 보냅니다.</h3>
<p>가능하면 깨끗한 튜브에 깔끔하게 준비한 DNA 샘플을 보내세요. 시퀀싱 반응이 되지 않더라도 업체는 돈을 받습니다. 그리고 생각보다 시퀀싱 반응은 오염에 민감합니다.</p>
<div id="sds-page">

</div></section>
</section>
<section id="sds-page" class="level1">
<h1>SDS-PAGE</h1>
<section id="sds-page-gel-쉽게-만들기" class="level2">
<h2 class="anchored" data-anchor-id="sds-page-gel-쉽게-만들기">SDS-PAGE Gel 쉽게 만들기</h2>
<p>준비물 :</p>
<pre><code>2X running gel buffer : 750 mM Tris-HCl, pH8.8 상온보관
1x stacking gel solution :  62.5mM Tris-HCl, pH6.8, 4% acrylamide 냉장보관
30% acrylamide stock solution (29:1): 냉장보관
10% Ammonium persulfate : 냉장보관</code></pre>
<p>Acrylamide의 quality는 해상도에 영향을 줍니다. 따라서 high quality를 사용하시는 편이 좋고 가급적 빠른 시간내 소비하는 것이 좋습니다.</p>
<section id="gel-만들기-총-10ml" class="level3">
<h3 class="anchored" data-anchor-id="gel-만들기-총-10ml">Gel 만들기 : 총 10ml</h3>
<ol type="1">
<li>2x running gel buffer 5ml + 20% acrylamide stock 5ml + 10% APS 100ul 섞어 줍니다. 2. TEMED 10 ul 넣고 천천히 섞어줍니다.</li>
<li>Gel cast에 기포가 생기지 않게 조심히 부어 줍니다.</li>
<li>100% Ethanol을 위에 조심스럽게 넣습니다. 양은 500ul정도</li>
<li>30분후 Gel이 굳은 걸 확인하고 DW로 gel 윗 부분을 한번 씻어줍니다.</li>
<li>1x stacking gel solution 1ml + 10% APS 10ul를 섞어 줍니다.</li>
<li>TEMED 1ul를 마지막으로 넣어 천천히 섞어 줍니다.</li>
<li>5번 과정을 끝낸 running gel 위에 붇고 comb을 꼽아 줍니다.</li>
<li>20분후 comb을 뽑고 실험에 사용합니다.</li>
</ol>
<p>Gel이 굳는 시간은 전적으로 APS의 첨가량에 따라 달라지며 시간이 촉박한 경우 APS의 양을 늘려 줍니다. Gel이 완전히 굳지 않았을 경우에 해상도는 떨어집니다. 이러한 점에서 오랜 시간 굳히는 방법보다는 APS의 양을 늘려 빨리 굳히는 편이 좋습니다.</p>
</section>
<section id="note" class="level3">
<h3 class="anchored" data-anchor-id="note">Note</h3>
<p>SDS는 sample buffer와 running buffer에 들어있으므로 gel에 넣지 않아도 해상도에 문제가 없습니다.</p>
</section>
</section>
</section>
<section id="dna-ligation" class="level1">
<h1>DNA ligation</h1>
<section id="standard-protocol-insert-vector-dna-ligation" class="level2">
<h2 class="anchored" data-anchor-id="standard-protocol-insert-vector-dna-ligation">Standard Protocol: Insert + Vector DNA Ligation</h2>
<p>대부분의 경우 3 insert : 1 vector 비율을 추천한다. 또한 ligation 반응 시 총 DNA의 양은 100ng 정도가 권장 된다.</p>
<ol type="1">
<li>Combine the following in a PCR or Eppendorf tube:
<ul>
<li>25ng Vector DNA</li>
<li>75ng Insert DNA</li>
<li>Ligase Buffer (1μL/10μL reaction for 10X buffer, and 2μL/10μL reaction for 5X buffer) 0.5-1μL T4 DNA Ligase</li>
<li>DW 를 넣어 total 10μL</li>
<li>만약 DNA 농도가 너무 낮다면 total volume을 증가 시켜서 진행한다.</li>
<li>항상 Vector만 넣은 control실험을 하고 다양한 vector : insert 비율을 시도 한다.</li>
</ul></li>
<li>RT에서 2시간 혹은 16°C에서 overnight 반응 시킨다.
<ul>
<li>“high concentration” ligase를 사용하는 경우 RT 5분이면 충분하다.</li>
</ul></li>
<li>transformation을 진행한다.</li>
</ol>
</section>
<section id="vectorinsert-비율" class="level2">
<h2 class="anchored" data-anchor-id="vectorinsert-비율">Vector:Insert 비율</h2>
<p>보통 3:1 비율로 넣어줄 경우 충분하지만 안될 경우 vector: insert 비율을 조절 해 줄 필요가 있다. 자동으로 계산해주는 <a href="http://www.insilico.uni-duesseldorf.de/Lig_Input.html">도구</a> 이 있으니 참고한다.</p>
</section>
<section id="tips-and-faq" class="level2">
<h2 class="anchored" data-anchor-id="tips-and-faq">Tips and FAQ</h2>
<p>ligation 단계는 실험의 성공 여부를 알기 힘들기 때문에 항상 컨트롤을 같이 해야 한다.</p>
<table class="table">
<colgroup>
<col style="width: 33%">
<col style="width: 33%">
<col style="width: 33%">
</colgroup>
<thead>
<tr class="header">
<th>Control</th>
<th>Ligase</th>
<th>Interpretation</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Uncut vector</td>
<td>-</td>
<td>Checks viability of competent cells and verifies the antibiotic resistance of the plasmid</td>
</tr>
<tr class="even">
<td>Cut vector</td>
<td>-</td>
<td>Background due to uncut vector</td>
</tr>
<tr class="odd">
<td>Cut vector</td>
<td>+</td>
<td>Background due to vector re-circularization - most useful for phosphatase treated vector</td>
</tr>
<tr class="even">
<td>Insert or water</td>
<td>+</td>
<td>Any colonies indicate contamination of intact plasmid in ligation or transformation reagents</td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="pcr" class="level1">
<h1>PCR</h1>
<section id="pcr-개요" class="level2">
<h2 class="anchored" data-anchor-id="pcr-개요">PCR 개요</h2>
<p>1983년 Kary Mullis에 의해 고안. DNA 중합효소를 이용하여 DNA, RNA의 특정영역을 시험관 내에 대량으로 증폭 80년대 제한효소(restriction enzyme)의 발견에 의한 gene cloning법 이후, 90년대 생명공 학 연구의 혁명적인 사건 연구하고 싶은 유전자는 무엇이든 대량 생산이 가능.</p>
</section>
<section id="pcr-목적" class="level2">
<h2 class="anchored" data-anchor-id="pcr-목적">PCR 목적</h2>
<p>복잡한 전체 genome 중에 연구하고자 하는 유전자가 희귀유전자를 분석하고 연구하는데 가장 큰 문제점이였다. PCR은 특정 DNA sequence의 copy 수를 기하급수적으로 증폭시킴으로써 증폭된 DNA를 여러 가지 실험에 이용할 수 있고, 실험 결과를 토대로 분자생물학, 의학, 이학, 농학, 수의학, 식품과학, 환경과학 연구에 응용할 수 있음</p>
</section>
<section id="pcr-구성-요소" class="level2">
<h2 class="anchored" data-anchor-id="pcr-구성-요소">PCR 구성 요소</h2>
<dl>
<dt>DNA, RNA template:</dt>
<dd>
<p>증폭 대상이 되는 DNA, RNA</p>
</dd>
<dt>PCR Primers:</dt>
<dd>
<p>증폭할 부분을 잡는 짧은 염기서열.</p>
</dd>
<dt>Taq polymerase:</dt>
<dd>
<p>열에 특별히 강한 유전자 합성효소 (Taq polymerase: Thermus aquaticus 라는 온천에 사는 세균의DNA polymerase, 72℃가 최적온도, 94℃에서도 안정함)</p>
</dd>
<dt>dNTP (dATP, dCTP, dGTP, dTTP):</dt>
<dd>
<p>유전자를 합성하는 재료가 되는 각 nucleotide</p>
</dd>
<dt>MgCl+2:</dt>
<dd>
<p>MgCl2+은 dNTP와 복합체를 형성하여 효소활성, primer annealing 등에 관여</p>
</dd>
</dl>
</section>
<section id="pcr-의-3-단계" class="level2">
<h2 class="anchored" data-anchor-id="pcr-의-3-단계">PCR 의 3 단계</h2>
<section id="dna-의-변성denaturation" class="level3">
<h3 class="anchored" data-anchor-id="dna-의-변성denaturation">DNA 의 변성(denaturation):</h3>
<ul>
<li>90℃∼96℃로 가열하여 두가닥 DNA를 단일가닥 DNA로 분리.</li>
<li>일반적으로 94℃사용: 높은 온도일수록 단일가닥 DNA로 잘 이행되지만 온도가 너무 높으면 Taq DNA polymerase 역시 activity(활성)가 낮아짐.</li>
<li>첫 Cycle에서는 확실한 변성을 위하여 약 5분간 지속시킴.</li>
<li>이 후의 cycle에서는 약 1분간 변성시킴.</li>
</ul>
</section>
<section id="primer-의-결합annealing" class="level3">
<h3 class="anchored" data-anchor-id="primer-의-결합annealing">Primer 의 결합(annealing):</h3>
<ul>
<li>50℃∼65℃에서 진행.</li>
<li>30sec~1min.</li>
<li>염기 간의 결합은 G, C의경우 세군데 에서 수소결합이 일어나고 A, T는 두군데에서 결합이 일어나므로 G+C 비율에 따라 결합 온도 결정.</li>
<li>Primer design시에 Annealing temperature를 고려해야 함.</li>
<li>일반적으로 GC content가 50%가 되는 primer 쌍을 이용하는 것이 바람직.</li>
</ul>
</section>
<section id="dna의-합성polymerization-extension" class="level3">
<h3 class="anchored" data-anchor-id="dna의-합성polymerization-extension">DNA의 합성(polymerization, extension):</h3>
<ul>
<li>70℃∼74℃에서 시행.</li>
<li>1min ~ 1min 30sec.</li>
<li>Taq DNA polymerase의 합성 속도: 2,000∼4,000 nucleotides/min, 1 kb마다 1분 정도의 시간을 배당.</li>
<li>원하는 PCR 산물의 크기가 크 거나 반응요소의 농도가 낮을 때에는 시간을 연장할 수 있음.</li>
<li>Cycle이 계속되면서 효소 활성이 감소할 수 있고 DNA 산물은 점점 많이 존재하게 되므로 cycle 후반부에는 반응시간을 조금씩 늘려가는 것도 좋은 방법의 하나이며 마지막 cycle 에는 약 10분 정도 시간을 충분히 주어서 효소의 활성이 충분히 발휘되도록 함.</li>
</ul>
</section>
</section>
<section id="pcr-실험-시-유의하여야-할-사항" class="level2">
<h2 class="anchored" data-anchor-id="pcr-실험-시-유의하여야-할-사항">PCR 실험 시 유의하여야 할 사항</h2>
<section id="pipetting-dna-template" class="level3">
<h3 class="anchored" data-anchor-id="pipetting-dna-template">Pipetting &amp; DNA template:</h3>
<p>여러 component를 혼합할 때에는 시료간에 오염이 되지 않도록 주의하여야 하며 가능하면 공기를 통한 오염을 방지할 수 있는 tip을 사용하는 것이 좋습니다. 반응물 혼합 시에는 tube를 ice상에 두고서 혼합하여야 상온에서의 잘못 primer annealing에 의한 extension을 방지할 수 있습니다. 이론적으로 Taq DNA polymerase는 최적 온도 이하에서도 반응이 어느 정도 진행됨 으로 상온 등에서 정확하게 annealing되지 않은 primer에 의한 임의의 반응이 진행됨으로써 원하는 size의 product 이외의 non-specific product가 만들어질 수 있습니다.</p>
</section>
<section id="setting-up-the-laboratory" class="level3">
<h3 class="anchored" data-anchor-id="setting-up-the-laboratory">Setting up the Laboratory:</h3>
<p>PCR은 민감도가 뛰어난 실험이기 때문에 아주 적은 양의 DNA가 오염되더라도 실험에 큰 영향을 미칠 수 있습니다. 그러므로 PCR을 위한 template를 준비하는 곳과 PCR 반응을 하는 곳, 그리고 PCR 후 전기영동 및 분석을 하는 곳은 격리시키는 것이 좋으며, DNase 와 RNase free PCR tube를 사용하는 것이 좋습니다. 모든 시약류는 반드시 autoclave와 filteration을 거친 후 사용하여야 합니다.</p>
</section>
<section id="pcr-cycling-program" class="level3">
<h3 class="anchored" data-anchor-id="pcr-cycling-program">PCR cycling program:</h3>
<p>PCR cycling 조건은 PCR의 종류와 주형 DNA, primer 그리고 PCR 기기등에 따라 달라 져야 합니다.</p>
<ol type="a">
<li><p>Initial denaturation:</p>
<blockquote class="blockquote">
<p>template DNA의 완전한 denaturation이 중요한데 94℃∼95℃에서 2∼3 min 정도로 충분하지만 대부분 5 min 정도 초기 변성 시간을 주는 것이 좋습니다. denaturation 이 충분하지 않으면 primer의 annealing 과 extension이 방해받아 정확한 반응물이 생기지 않을 수 도 있습니다.</p>
</blockquote></li>
<li><p>Denaturation step during cycling:</p>
<blockquote class="blockquote">
<p>보통 94℃∼95℃에서 20∼30 sec 정도이지만 PCR 기기와 tube 등에 따라 시간을 늘리기도 합니다. Template의 GC함량이 높으면 높은 온도와 긴 시간을 사용하기도 하지만 필요 이상으로 변성 온도가 높거나 길면 Taq DNA polymerase의 활성 이 감소됩니다.</p>
</blockquote></li>
<li><p>Primer annealing:</p>
<blockquote class="blockquote">
<p>대개의 경우 annealing 온도는 primer의 Tm 값에 따라 결정됩니다. 온도가 너무 높으면 primer가 annealing 되지 않아 PCR product가 생기지 않게 되고, 온도가 너무 낮으면 non-specific annealing 이 일어나 정확한 PCR product가 생기지 않습니다.</p>
</blockquote></li>
<li><p>Extension (polymerization):</p>
<blockquote class="blockquote">
<p>Taq polymerase의 경우 72℃에서 1초당 약 60개의 염기를 중합시키기 때문에 1 kb 까지는 45 sec정도면 충분합니다. 하지만 대부분의 경우 1kb당 1분정도의 시간이 필요합니다.</p>
</blockquote></li>
<li><dl>
<dt>Cycle number</dt>
<dd>
<p>대부분의 경우 25∼35 cycles을 진행하고, Template 분자가 10개 이하인 경우에는 40 cycles 정도 진행하면 product을 관찰할 수 있습니다. 그러나 cycle의 수를 무작 정 늘린다고 해서 product의 양이 급격히 늘지는 않으며 오히려 비특이적 밴드가 늘어날 수 있습니다.</p>
</dd>
</dl></li>
</ol>
</section>
<section id="equipment-thermocyclers-pcr-tubes" class="level3">
<h3 class="anchored" data-anchor-id="equipment-thermocyclers-pcr-tubes">Equipment (Thermocyclers &amp; PCR tubes):</h3>
<p>PCR 기기는 기본적으로 PCR 반응을 구성하는 세 가지 온도를 최소한의 시간에 정확하 고 재현성있게 유지할 수 있어야 합니다. 또한 반응 tube에 따라 열전도율의 차이가 있기 때문에 가능하면 thin-walled reaction tube를 사용하는 것이 좋으며 thermal cycler의 block에 꼭 맞는 크기를 사용하여야 합니다.</p>
</section>
<section id="pcr-reaction-components" class="level3">
<h3 class="anchored" data-anchor-id="pcr-reaction-components">PCR reaction components:</h3>
<ol type="a">
<li><p>DNA template: Template 양과 질은 PCR에 절대적인 영향을 미칩니다. template가 적을수록 product의 양 역시 비례적으로 감소하게 되며, RNA의 오염은 Mg2+ 이온을 잡아먹어 yield를 낮추게 되고 불 순한 template에는 반응저해제들을 많이 포함 하고 있어 반응의 효율을 떨어뜨립니다.</p></li>
<li><p>PCR Primers: PCR의 많은 요소들 중에서도 primer의 염기서열과 농도는 전체 반응의 성패에 가장 큰 영향을 미치는 요인 중 하나로 다음과 같은 사항들을 고려하여 설계하는 것이 좋습니다. 길이는 18∼24mer가 적당하며 두 primer의 Tm 값의 차이는 5℃ 이내로 하고 가급적 2차 구조가 형성되지 않도록하며 G+C 값은 40∼60%로하여 두 primer의 3′ 사이에 상보결합이 없어야 합니다.</p></li>
<li><p>Choice of DNA polymerase: PCR 반응에 사용하는 Taq DNA polymerase는 0.5∼2.5U/20∼50ul volume 정도가 적당합니다. 비율적으로 너무 많은 효소가 들어가게 되면 높은 glycerol 농도로 인하여 product가 끌리는 현상이나 특이성이 떨어져 불균형적인 결과를 초래하게 되며, 너무 적은 양의 효소를 사용하면 생성물의 양이 부족하게 됩니다.</p></li>
<li><p>Deoxynucleotide triphosphate (dNTP): 항상 dNTP의 4가지 요소들은 동일 농도로 사용하여야 합니다. dNTP mixture의 불균 형은 Taq polymerase의 fidelity를 감소시켜 error rate가 증가될 수 있습니다. 또한 dNTP stock은 thawing/freezing에 민감하여 3∼5차례만 반복하여도 활성이 감소하여 올바른 결과를 기대할 수 없습니다. 그러므로 stock은 사용량에 맞게끔 적절하게 배분해놓는 것이 좋습니다. 만일 dNTP의 농도를 증가시키려면 반드시 Mg2+의 농도 역시 증가시켜 주어야 합니다. 높은 dNTP 농도는 free Mg2+을 감소시켜 효소의 반응을 방해하고 primer의 annealing을 감소시키게 됩니다. 일반적으로 사용되는 dNTP의 최종 농도는 각 200∼250uM 입니다.</p></li>
<li><p>MgCl2 concentration: Mg2+은 dNTP와 복합체를 형성하여 효소의 실질적인 substrate로 이용됩니다. free Mg2+의 농도는 dNTP, free pyrophosphate 그리 고 EDTA 같은 ion 결합 물질의 농도에 영향을 받게 됩니다. 최적 의 실험결과를 위해선 적절한 MgCl2의 농도를 사용하여야 하는데 가장 일반적인 농도는 1.5mM (dNTP 각 200uM 일 때)입니다. Mg2+은 효소 활성에 영향을 미치고 double-strand DNA의 Tm 값 을 증가시키는 효과가 있습니다. 과다한 Mg2+은 primer의 비 특이 적인 결합과 background를 증가시키게 됩니다.</p></li>
<li><p>Reaction overlay: PCR 반응을 하는 동안 mixture가 증발되는 것을 방지하기 위하여 mineral oil을 넣어주어야 합니다. 하지만 PCR 기기의 두껑에 히터가 달려있다면 mineral oil을 넣어 줄 필요 없습니다.</p></li>
</ol>
</section>
</section>
<section id="pcr의-종류" class="level2">
<h2 class="anchored" data-anchor-id="pcr의-종류">PCR의 종류</h2>
<section id="rt-pcr" class="level3">
<h3 class="anchored" data-anchor-id="rt-pcr">RT-PCR</h3>
<p>RT-PCR((Reverse Transcriptase Polymerase Chain Reaction)이란 P.Seeburg(1986)에 의해 RNA를 찾고 분석하는데 도입된 방법으로 mRNA(messenger RNA)로부터 reverse transcription 과정을 통해 얻어진 cDNA(complementary DNA)를 PCR로 증폭하는 방법이다. 이러한 방법은 RNA 검사의 sensitivity를 높이고 소량의 RNA로부터 염기서열을 분석할 수 있게 하였다. 이 방법은 Northern blot hybridization과 같은 방법을 통해 가능하던 RNA 분석보다 실험방법이 더욱 간단할 뿐 아니라 유전자의 염기서열 결정이 가능하기 때문에 주로 mRNA의 염기서열 및 전사량을 연구할 때 크게 도움을 준다. 염기서열이 알려진 유전자의 경우 RT-PCR을 통해서 전체 길이의 cDNA를 간단하게 합성하여 cloning 할 수 있다.</p>
</section>
<section id="rt-pcr의-세가지-과정" class="level3">
<h3 class="anchored" data-anchor-id="rt-pcr의-세가지-과정">RT-PCR의 세가지 과정:</h3>
<ol type="1">
<li>RNA 분리 과정(이 과정은 Northern Blot을 하기 전에 시행해야 하는 동일한 과정이다)</li>
<li>cDNA 합성 과정(reverse transcription)</li>
<li>PCR amplification (이 과정은 Genomic DNA로부터 특정 유전자 부위를 증폭시키는 과정과 같다)으로 진행된다.</li>
</ol>
<p>mRNA로부터 reverse transcriptase를 이용하여 cDNA를 제조하는 방법에는 어떤 oligonucleotide를 primer로 사용하는가에 따라 세가지 방법</p>
<ol type="1">
<li>Antisense primer(3’쪽 유전자에 특이성을 지닌 primer)를 이용하여 특정부위 cDNA 제조</li>
<li>Random hexamer를 이용하여 전체 mRNA에 상보적인 cDNA 제조</li>
<li>Oligo dT primer를 이용하여 전체 mRNA에 상보적인 cDNA 제조가 있다.</li>
</ol>
</section>
<section id="sscpsingle-strand-conformation-polymorphism" class="level3">
<h3 class="anchored" data-anchor-id="sscpsingle-strand-conformation-polymorphism">SSCP(Single Strand Conformation Polymorphism)</h3>
<p>point mutation 찾기. 유전자내의 변이, 특히 point mutation을 발견하는데 가장 간단하고 신속한 방법이다. PCR 수행시 각하는 방향과 반대 방향으로 PCR을 실시하는 방법이다. 변이가 있을 것으로 예상되는 DNA 특정부위 양쪽으로 적당히 덜어져 있는 부위에 PCR을 실시하기 위한 primer를 제조한 후 PCR로 이 DNA를 증폭시킨다. 이 증폭된 DNA를 검출하기 위해서는 전기영동을 실시해야 하는데 전기영동에 영향을 주는 인자들에는 여러 가지가 있다. 그 중 SSCP에 이용되는 인자는 입자들의 형태에 따라 전기영동시 이동하는 속도가 달라진다는 점을 이용하는 것이다. 한 개의 point mutation만 있는 경우에도 나타날 수 있는 미세한 이동 속도의 차이도 검출해야 하므로 SSCP를 위해서는 agarose gel대신 acrylamide gel이 이용된다. PCR 산물을 전기영동하기 전에 DNA를 변성시킬 수 있도록 NaOH를 가한 후 urea가 포함된 denaturing acrylamide gel에 전기영동하면 변성된 DNA double strand는 두 개의 single strand DNA로 분리되어 전기영동하게 되며 이 때 point mutation이 생긴 시료는 다른 정상적인 시료에서 얻어진 두 개의 DNA band와 다른 위치에 band가 나타나게 된다. 일반적인 염색만으로 변이 여부를 판정할 수 있는 경우도 있으나, 워낙 미세한 차이를 감지해야 하므로 민감도가 높은 silver nitrate 염색을 하는 편이 결과를 판정하기에 편리하다. 과거에는 아주 시료를 변성시킨 후 non-denatured acrylamide에 전기영동하고, 이를 nylon membrane에 transfer한 후 방사성 동위 원소(radioisotope)로 표지된 probe를 붙이는 복잡한 실험 방법이었으나 최근에는 아주 간단한 방법으로 개량되어 널리 쓰이고 있으며, 민감도를 높이기 위해 방사성 동위 원소를 사용할 필요 없이 silver nitrate를 이용하여 건강을 헤치지 않고 간단히 결과를 판독할 수 있게 되었다.</p>
</section>
<section id="racerapid-amplification-of-cdna-ends" class="level3">
<h3 class="anchored" data-anchor-id="racerapid-amplification-of-cdna-ends">RACE(Rapid Amplification of cDNA Ends):</h3>
<p>cDNA를 cloning하기 위해서는 cDNA library를 screening하는 방법이 현재 가장 일반적이라 할 수있지만, 이 방법으로 처음 screening을 하여 찾아낸 clone은 대개 전체 cDNA의 일부이며 계속 반복하여 screening을 하여야만 완전한 cDNA를 얻어낼 수 있다. 그러나 이런 과정은 대단히 시간과 노력이 소모되는 작업이며 유전자 자체가 cDNA library에 적은 양으로 존재하는 경우는 더더욱 힘든 일이 될 것이다. 또한 initiation codon부터 termination codon까지 open reading frame(ORF)을 완전히 결정한 경우에도 cDNA의 5’과 3′-끝의 non-coding region 일부는 library screening에서 얻기가 어렵다. 이러한 문제를 해결하고자, 1988년 Frohmann 등은 다음과 같은 방법을 소개하고, 이를 RACE(rapid amplification of cDNA ends)라 이름하였다. 즉, cDNA의 일부 염기서열을 알고 있으면, 이 부분에서 gene specific primer를 합성하고 PCR reaction을 통해 5′ 혹은 3′-end 까지의 DNA를 증폭하는 것이다. 3′-RACE에서는 mRNA의 3′-end에 존재하는 poly(A) tail을 이용할 수 있으므로, down stream primer로 oligo-(dT) primer를 쓴다. 그러나, 5′-RACE의 경우는 gene specific primer로 합성한 1st single strand cDNA의 끝에 TdT(terminal deoxynucleotidyl transferase)를 사용하여 poly(A) 혹은 poly(C) tail을 인위적으로 만들어 주어야만 한다.</p>
</section>
<section id="ispcrin-situ-polymerase-chain-reaction" class="level3">
<h3 class="anchored" data-anchor-id="ispcrin-situ-polymerase-chain-reaction">ISPCR(In Situ Polymerase Chain Reaction):</h3>
<p>PCR은 원하는 DNA를 대량으로 증폭시키는 방법이고, in situ hybidization (ISH)은 세포나 조직에 존재하는 극미량의 DNA 및 RNA를 찾아낼 수 있음은 물론 원하는 유전자들의 위치까지 확인할 수 있는 방법이다. ISPCR은 이 두 가지 방법의 장점을 혼합하여 응용한 방법으로서 PCR의 sensitivity와 ISH의 specificity를 고루 갖추고 있다. ISPCR의 실험원리는 일반적인 PCR 방법과 같으나, slide glass 등의 사용에 적합한 ISPCR용 기구가 필요하며 사용하는 기구에 따라 반응시키는 방법들이 다양하게 제시되어 있다. ISPCR은 세포내의 target sequence를 증폭시키는 것으로부터 반응이 시작되며 세포막을 통해 여러 물질(예: PCR 용액에 들어 있는 salt 등)들이 쉽게 이동할 수 있도록 세포막을 HCl, proteinase K 또는 Triton X-100 등으로 처리해 주는 과정을 거쳐야 한다. 이 과정에 이상이 생기면 세포가 손상되거나 파괴되는 수가 있으므로 PCR이 끝난 후에 세포 안에서 증폭된 PCR 산물이 세포 밖으로 빠져나오는 원인이 되기도 한다. 그러므로 적당한 세제의 적절한 선택과 사용이 무엇보다 중요하며 PCR 산물이 세포 밖으로 유출되는 것을 막기 위해서는 single primer pair with complementary tail, biotinylated dNTPs, multiple overlapping primer pair 등을 이용한 방법이 소개되어 있다.현재까지 ISPCR 방법의 효율은 그다지 높지 못한 것으로 알려져 있으며 specificity를 증가시키기 위해서는 DNA probe를 이용한 in situ hybridization을 시행하거나 Southern blot hybridization을 시행하는 것이 좋은 방법이 된다. 효율이 별로 높지 못한 방법임에도 불구하고 ISPCR에 대한 관심이 최근 크게 증가하고 있는 것은 여러 가지 질병들의 조기 발견에 큰 도움을 받을 수 있을 것으로 기대되기 때문이며, 지금도 여러 회사에서 ISPCR에 유용한 기구들을 제작, 판매하고 있으나 더 좋은 기구의 개발이 이루어져 효율을 더욱 높일 수 있다면 ISPCR이 더욱 유용하게 사용될 수 있을 것으로 기대된다.</p>
</section>
<section id="ddrt-pcrdifferential-display-reverse-transcriptase-pcr" class="level3">
<h3 class="anchored" data-anchor-id="ddrt-pcrdifferential-display-reverse-transcriptase-pcr">DDRT-PCR(Differential Display Reverse Transcriptase PCR):</h3>
<p>일반적으로 고등동물에서는 약 100,000가지 정도의 서로 다른 유전자가 발현되고 있으며 각각의 세포 한 개에서는 이중 약 15%만이 발현되고 있다. 발생, 분화, homeostasis, 세포주기 조절, 노화, 발암과정 및 세포의 퇴화 등의 과정에서 표현되어 나타나는 유전자들은 전체 유전자들 중에서 일부가 선택되어 나타나는 것이라고 할 수가 있다. 특정 세포에서 발현되는 특정 유전자들을 찾아내기 위하여 주로 사용되는 방법은 subtractive hybridization 또는 differential hybridization 방법이었으나 최근 PCR을 이용하여 유전자를 찾아내는 방법(DDRT-PCR)이 개발되었다. DDRT-PCR이란 서로 다른 세포로부터 RNA를 분리한 후 특정하게 발현되는 mRNA를 찾아내기 위하여 T 염기 10개와 비특정염기 2개가 연결된 oligonucleotide를 primer로 이용하여 cDNA를 합성한 후 이 primer와 비특정 염기서열을 지닌 oligonucleotide를 primer로 이용하여 PCR 하였을 때 나타나는 여러가지 PCR 산물을 비교함으로써 서로 다른 세포로부터 증폭된 PCR 산물에 차이가 있는지 없는지를 확인하는 방법이다. 서로 다르게 증폭된 PCR 산물을 선택하여 이와 같이 증폭된 DNA가 특정 세포에서 특징적으로 발현되는 유전자인지를 보는 것으로 subtractive hybridization보다 방법이 훨씬 간단한 것이 장점이지만, 실험의 sensitivity와 specificity가 낮은 것이 단점이다. 최근 이 방법에 대한 연구가 많이 진행되면서 새로운 더 좋은 방법들이 계속 발표되고 있으므로 최신 논문을 참고로 적절한 조건을 찾아내어 실험을 시행하면 좋은 결과를 얻을 수 있을 것으로 기대된다.</p>
<section id="특징" class="level4">
<h4 class="anchored" data-anchor-id="특징">특징:</h4>
<ul>
<li>서로 다르게 증폭된 PCR 산물을 선택하여 이와 같이 증폭된 DNA가 특정 세포에서 특징적으로 발현되는 유전자인지를 보는 것으로 subtractive hybridization보다 방법이 훨씬 간단한 것이 장점</li>
</ul>
</section>
<section id="단점" class="level4">
<h4 class="anchored" data-anchor-id="단점">단점:</h4>
<ul>
<li>실험의 sensitivity와 specificity가 낮은 것이 단점</li>
</ul>
</section>
</section>
<section id="hot-start-pcr" class="level3">
<h3 class="anchored" data-anchor-id="hot-start-pcr">Hot start PCR:</h3>
<p>Taq1 polymerase는 37℃에서도 그 활성이 좋기 때문에 간혹 가다가 첫 번째 denaturation 과정이 완전히 진행되기도 전에 primer가 DNA molecule에 붙어서 extension이 일어나는 경우가 있다. 이렇게 낮은 온도에서 annealing이 일어날 경우 primer가 mismatch할 확률이 높고, 따라서 결과적으로 정확도가 떨어지는 band를 얻게 된다. 이것을 막는 방법이 Hot-start PCR를 이용하는 것이다. Hot start PCR에서는 primer가 정확하게 원하는 DNA site에만 붙을 수 있도록 충분한 온도가 된 후에 PCR이 일어나도록 필요한 물질(ex. polymerase, MgCl2, dNTP)을 넣어준다. (물론 그 전에는 안 넣어준다는 말이다.) 이렇게 하면 위에서 말한 것과 같은 mismatch를 피할 수 있어, 상대적으로 clear한 band를 얻을 수 있다.</p>
</section>
<section id="rapd-pcr" class="level3">
<h3 class="anchored" data-anchor-id="rapd-pcr">RAPD PCR:</h3>
<p>RAPD (random amplified polymorphic DNA) PCR은 일반적으로 두 생명체가 계통 유전학적으로 얼마나 유사성이 있는가를 판별할 때 사용한다. PCR할 때 primer가 짧을 경우 genome 상에 여러 군데 달라 붙어서 여러 fragment를 만든다. 이렇게 해서 생겨난 여러 fragment를 전기영동을 사용해서 확인하면 생명체마다 각각 독특한 band를 형성하는데 이것을 가지고 생명체간의 유사성을 판별할 수 있다. 만약 두 생명체가 비슷한 종일 경우에는 band의 모양이 비슷할 것이며, 그렇지 않을 경우에는 서로 많은 차이를 나타낼 것이다. 이 RAPD PCR은 방법이 비교적 간단하고 쉬워 genome sequencing을 하기 전에 대략적인 종간의 관계를 나타내기 위해서 많이 사용된다.</p>
</section>
<section id="touchdown-pcr" class="level3">
<h3 class="anchored" data-anchor-id="touchdown-pcr">Touchdown PCR:</h3>
<p>방법은 PCR할 때 Tm(melting temperature)을 알기 위해서 하는 PCR 방법이다. PCR 과정에서 매 2 cycle 마다 annealing temperature을 1℃씩 낮춘다. 일반적으로 annealing이 Tm에서 1℃만큼 차이가 난 온도에서 일어날 때 한 cycle에 product의 양이 두배 정도 차이가 난다. Touchdown PCR에서는 2 cycle 마다 온도를 낮췄으므로 1℃에 product의 양이 4배가 차이나는 셈이다. 이것을 이용해서 Tm을 알 수 있다. (즉 온도가 1도 내려갔을 때 product의 양이 4배 증가한 과정에서의 temperature가 Tm이 된다.) 특징적으로 Gene-specific product 를 많이 생성하므로, non-specific amplification을 줄일 수 있는 PCR 방법</p>
</section>
<section id="long-accurate-pcr" class="level3">
<h3 class="anchored" data-anchor-id="long-accurate-pcr">Long Accurate PCR:</h3>
<p>일반적으로 PCR로는 많아야 3kb, 좀 더 이상적일려면 1kb 미만의 크기의 DNA를 증폭할 수 있으나 이 방법을 사용하면 5-40kb의 DNA도 증폭할 수 있다. 이 long accurate PCR에서는 polymerase를 두 개 사용하는데, 그중 하나가 minor-proofreading을 할 수 있어서, 긴 DNA를 증폭할 때 error rate를 감소시켜 준다.</p>
</section>
<section id="asymmetric-pcr" class="level3">
<h3 class="anchored" data-anchor-id="asymmetric-pcr">Asymmetric PCR:</h3>
<p>Single strand를 얻을 목적으로 이용하는 PCR방법이다. Primer를 두 개 사용하는데 두 primer를 농도가 100:1로 섞어 사용한다. PCR의 초기에 한쪽의 primer는 소비되어 버리고 과잉의 primer에서 single strand DNA가 생성된다</p>
</section>
<section id="nest-pcr" class="level3">
<h3 class="anchored" data-anchor-id="nest-pcr">Nest PCR:</h3>
<p>한번 PCR로 증폭한 DNA 단편을 한번 더 내부의 primer를 사용하여 증폭하는 방법이다. 이는 비 특이적 반응을 감소 시키며, PCR을 2회 실시하므로 감도가 상승하는 효과를 얻을 수 있다.</p>
</section>
<section id="inverse-pcr" class="level3">
<h3 class="anchored" data-anchor-id="inverse-pcr">Inverse PCR:</h3>
<p>Inverse PCR은 기존에 서열을 알고 있는 DNA의 양 옆에 서열을 알지 못하는 region이 있고, 이것을 알고자 할 때 많이 이용된다.</p>
</section>
<section id="gradient-pcr" class="level3">
<h3 class="anchored" data-anchor-id="gradient-pcr">Gradient PCR:</h3>
<p>하나의 목적 유전자를 증폭하는 반응조건을 최적화하기 위하여 여러 번의 실험을 수행해야 하는 번거로움이 있었음. 각 단계의 온도 조건에서 시료 block의 첫 lane과 마지막 lane 사이에 최대 20 ℃의 온도 폭 설정이 가능한 gradient 기능을 이용하여 한번의 실험으로 반응조건을 최적화하는 PCR 방법</p>
<p>효과:</p>
<ul>
<li>Annealing temp. 를 단계별로 설정하여 최적의 melting temp.를 찾을 수 있음</li>
<li>Denaturation 단계뿐만 아니라 extension 단계에도 적용 가능</li>
</ul>
</section>
<section id="real-time-pcr" class="level3">
<h3 class="anchored" data-anchor-id="real-time-pcr">Real-Time PCR:</h3>
<p>Thermal Cycler와 분광 형광 광도계가 일체화된 장치를 이용하여 PCR 증폭 산물의 생성 과정을 real time으로 모니터링하여 해석하는 방법. 지금까지 단순히 DNA 증폭을 목적으로 하는 PCR에 비해 증폭량을 real time으로 모니터 하면서 PCR 하는 방법입니다. Real time PCR은 지금까지의 PCR에 비해 (1)전기영동이 필요없고, (2)반응 사이클 도중에 증폭산물을 확인할 수 있으며, (3)정량적인 결과를 얻을 수 있는 이점을 가지고 있습니다.</p>
<p>특징:</p>
<ul>
<li>신속성: 전기영동이 필요 없음</li>
<li>정량성: 증폭이 지수함수적으로 일어나는 영역에서 증폭산물량을 비교할 수 있음(보다 정확한 정량이 가능)</li>
<li>역전사효소를 이용하여 total RNA나 mRNA에서 cDNA를 합성한 후, PCR로 목적 cDNA를 증폭하는 RT(Reverse Transcription)-PCR 방법은, 미량의 RNA 시료에서도 분석이 가능하여 RNA 실험에서 중요하게 대두되고 있음</li>
</ul>
</section>
<section id="pcr-annealing-온도" class="level3">
<h3 class="anchored" data-anchor-id="pcr-annealing-온도">PCR Annealing 온도</h3>
<p>Tm은 DNA 두 가닥이 반쯤 풀어졌을때 또는 두 가닥 ssDNA가 반쯤 annealing됬을떄의 온도를 말합니다. “반 쯤” 이라는 표현은 “반쯤 풀어졌을때” 와 “반쯤 붙었을때” 가 같은 의미로 사용됩니다. 긴 template와 고농도의 짧은 primer들이 같이 있을때 프라이머가 적당한 온도가 되면 서서히 유사한 서열에 붙기 시작합니다. 하지만 Tm에서는 반 밖에 붙지 못하므로, 특히 프라이머의 3’ 쪽이 붙지 못한 상태라면 PCR 이 일어나지 않습니다. 그래서 온도를 좀 더 내려서 프라이머가 template에 더 붙도록 합니다. DNA의 Tm 값은 다음과 같이 계산할 수 있습니다.</p>
<p><img src="https://latex.codecogs.com/png.latex?%20Tm%20=%204*(G+C)+2*(A+T)%20"></p>
<p>Primer를 디자인할때 가능하면 같은 Tm 값의 forward,reverse primer를 주문하는 하는것이 좋습니다. 그렇지 못한 경우 낮은 Tm값의 primer를 기준으로 약 5도 정도 낮은 온도에서 PCR을 수행합니다. 만약 원하는 사이즈의 PCR 밴드와 잡밴드가 같이 뜨면 annealing 온도를 2도씩 올려 가면서 PCR 실행합니다.</p>
<p>만약 실험실에 gradient PCR기가 있으면 낮은 Tm-5도와 높은 Tm-5도로해서 한번에 하는 방법도 있습니다. 보통 20~30 mer사이는 보통 55도 근처에서 하면 잘 나오는경우가 많습니다.</p>
</section>
<section id="잘-안되는-경우" class="level3">
<h3 class="anchored" data-anchor-id="잘-안되는-경우">잘 안되는 경우</h3>
<p>primer의 길이가 50~60mer를 넘어간다던가 GC비율이 현저하게 높거나 낮을때에는 annealing temperature를 찾아야 하는 경우가 많습니다. 그럴때는 바로 gradient PCR을 최저 온도(보통 48~50도)에서 윗쪽으로 해보는것이 좋습니다. 잡밴드를 감수하고 원하는 밴드를 PCR 하기 위함입니다.</p>


</section>
</section>
</section>

 ]]></description>
  <category>lab</category>
  <category>biology</category>
  <guid>https://tomorrow-lab.github.io/posts/lab_protocols/lab_protocols.html</guid>
  <pubDate>Sun, 26 Feb 2023 15:00:00 GMT</pubDate>
</item>
<item>
  <title>파이썬 Pingouin으로 통계 분석하기</title>
  <dc:creator>Taeyoon kim</dc:creator>
  <link>https://tomorrow-lab.github.io/posts/python_pingouin.html</link>
  <description><![CDATA[ 




<p><code>Pingouin</code>은 <strong>간단하지만 완전한 통계 기능</strong>를 위해 설계되었습니다. 예를 들어 기존의 SciPy 패키지의 <code>ttest_ind</code> 함수는 <code>T-value</code>과 <code>p-value</code>만 알려주지만 Pingouin의 <code>ttest</code> 함수는 <code>T-value</code>, <code>p-value</code>뿐만 아니라 자유도, 효과 크기(Cohen ’s d), 95% 신뢰 구간, 통계적 검정력등을 동시에 출력합니다. 아래의 목록은 할 수 있는 대표적인 분석입니다.</p>
<ol type="1">
<li>분산 분석(ANOVAs): N-ways, repeated measures, mixed, ancova</li>
<li>Pairwise 사후 검정(post-hocs tests), pairwise 상관관계</li>
<li>견고한(Robust), 부분(partial), 거리(distance), 반복 측정 상관관계</li>
<li>선형(Linear) 회귀, 로지스틱(logistic) 회귀, 매개(mediation) 분석</li>
<li>베이즈 인자(Bayes factor)</li>
<li>다변량(Multivariate) 테스트</li>
<li>신뢰성과 일관성 검정</li>
<li>효과 크기 및 검정력 분석</li>
<li>효과 크기 또는 상관 계수의 모수(Parametric) 혹은 부트스트랩(bootstrapped) 신뢰구간</li>
<li>순환(Circular) 통계</li>
<li>카이제곱 검정(chi-squared test)</li>
<li>Bland-Altman plot, Q-Q plot, paired plot, robust correlation 시각화</li>
</ol>
<p>더 자세한 것은 <a href="https://pingouin-stats.org/">공식 홈페이지</a>를 참고하세요.</p>
<section id="설치하기" class="level1">
<h1>설치하기</h1>
<p>Pingouin은 파이썬3 패키지이며 파이썬 2.7에서는 작동하지 않습니다. Pingouin의 주요 종속 패키지는 다음과 같습니다:</p>
<p>가장 쉬운 설치 방법은 <code>pip</code> 명령어를 사용하는 것입니다.</p>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">pip</span> install pingouin</span></code></pre></div>
<p>혹은 <code>conda</code>를 사용할 수도 있습니다.</p>
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb2-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">conda</span> install <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-c</span> conda-forge pingouin</span></code></pre></div>
<p>아직 Pingouin은 개발 중에 있으며 버그 수정을 위해 새로운 버전이 계속 배포되고 있습니다(한 달에 약 1 회). 그러니 항상 최신 버전의 Pingouin을 사용하고 있는지 확인하세요. 새로운 버전이 출시 될 때마다 터미널 창에 다음 명령어를 입력해 업그레이드 할 수 있습니다.</p>
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb3-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">pip</span> install <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--upgrade</span> pingouin</span>
<span id="cb3-2"></span>
<span id="cb3-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># conda를 사용할 경우</span></span>
<span id="cb3-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">conda</span> update pingouin</span></code></pre></div>
<p>자세한 내용은 <a href="https://pingouin-stats.org/">Pingouin 공식 페이지</a>을 참고하세요.</p>
</section>
<section id="예제-살펴보기" class="level1">
<h1>예제 살펴보기</h1>
<p>먼저 필요한 패키지를 불러옵니다.</p>
<div id="cell-2" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> numpy <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> np</span>
<span id="cb4-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> pingouin <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> pg</span>
<span id="cb4-3"></span>
<span id="cb4-4">np.random.seed(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">42</span>)</span></code></pre></div>
</div>
<section id="one-sample-t-test" class="level2">
<h2 class="anchored" data-anchor-id="one-sample-t-test">1.1. One-sample T-test</h2>
<ul>
<li>모집단의 평균은 <code>4</code>로 가정</li>
</ul>
<div id="cell-4" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1">mu <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span></span>
<span id="cb5-2">x <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">5.5</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2.4</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">6.8</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">9.6</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">4.2</span>]</span>
<span id="cb5-3">pg.ttest(x, mu)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="2">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">T</th>
<th data-quarto-table-cell-role="th">dof</th>
<th data-quarto-table-cell-role="th">tail</th>
<th data-quarto-table-cell-role="th">p-val</th>
<th data-quarto-table-cell-role="th">CI95%</th>
<th data-quarto-table-cell-role="th">cohen-d</th>
<th data-quarto-table-cell-role="th">BF10</th>
<th data-quarto-table-cell-role="th">power</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">T-test</td>
<td>1.397391</td>
<td>4</td>
<td>two-sided</td>
<td>0.234824</td>
<td>[-1.68, 5.08]</td>
<td>0.624932</td>
<td>0.766</td>
<td>0.191796</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>자유도(dof)는 4, <code>T-value</code>(T)는 1.3973 이며 <code>p-Value</code>가 일반적인 기준(0.05) 이상이기 때문에 표본 <code>x</code>의 평균은 모집단의 평균과 차이가 없다(귀무가설)고 볼 수 있다.</p>
</section>
<section id="paired-t-test" class="level2">
<h2 class="anchored" data-anchor-id="paired-t-test">1.2. Paired T-test</h2>
<p>꼬리를 <code>one-sided</code>로 설정하면 pingouin이 알아서 꼬리의 방향을 알려줍니다. 아래 코드의 경우 <code>T-value</code>가 음수이기 때문에 꼬리의 방향이 <code>less</code>로 표현됩니다.</p>
<div id="cell-6" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1">pre <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">5.5</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2.4</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">6.8</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">9.6</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">4.2</span>]</span>
<span id="cb6-2">post <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">6.4</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">3.4</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">6.4</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">11.0</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">4.8</span>]</span>
<span id="cb6-3">pg.ttest(pre, post, paired<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>, tail<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"one-sided"</span>)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="3">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">T</th>
<th data-quarto-table-cell-role="th">dof</th>
<th data-quarto-table-cell-role="th">tail</th>
<th data-quarto-table-cell-role="th">p-val</th>
<th data-quarto-table-cell-role="th">CI95%</th>
<th data-quarto-table-cell-role="th">cohen-d</th>
<th data-quarto-table-cell-role="th">BF10</th>
<th data-quarto-table-cell-role="th">power</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">T-test</td>
<td>-2.307832</td>
<td>4</td>
<td>less</td>
<td>0.041114</td>
<td>[-inf, -0.05]</td>
<td>0.250801</td>
<td>3.122</td>
<td>0.12048</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>꼬리의 방향이 <code>less</code>라는 것은 표본 <code>x</code>의 평균이 표본 <code>y</code>의 평균보다 작다는 것을 뜻합니다.</p>
<p>일부러 꼬리의 방향을 반대(<code>greater</code>)로 한 대립 가설을 확인해 봅니다.</p>
<div id="cell-8" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1">pg.ttest(pre, post, paired<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>, tail<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"greater"</span>)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="4">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">T</th>
<th data-quarto-table-cell-role="th">dof</th>
<th data-quarto-table-cell-role="th">tail</th>
<th data-quarto-table-cell-role="th">p-val</th>
<th data-quarto-table-cell-role="th">CI95%</th>
<th data-quarto-table-cell-role="th">cohen-d</th>
<th data-quarto-table-cell-role="th">BF10</th>
<th data-quarto-table-cell-role="th">power</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">T-test</td>
<td>-2.307832</td>
<td>4</td>
<td>greater</td>
<td>0.958886</td>
<td>[-1.35, inf]</td>
<td>0.250801</td>
<td>0.32</td>
<td>0.016865</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p><code>p-Value</code>가 엉망인것을 알 수 있습니다.</p>
</section>
<section id="two-sample-t-test" class="level2">
<h2 class="anchored" data-anchor-id="two-sample-t-test">1.3. Two-sample T-test</h2>
<section id="표본-크기가-같은-경우" class="level3">
<h3 class="anchored" data-anchor-id="표본-크기가-같은-경우">1.3.1. 표본 크기가 같은 경우</h3>
<div id="cell-10" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1">x <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.random.normal(loc<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>, size<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>)</span>
<span id="cb8-2">y <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.random.normal(loc<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>, size<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>)</span>
<span id="cb8-3">pg.ttest(x, y, correction<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"auto"</span>)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="5">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">T</th>
<th data-quarto-table-cell-role="th">dof</th>
<th data-quarto-table-cell-role="th">tail</th>
<th data-quarto-table-cell-role="th">p-val</th>
<th data-quarto-table-cell-role="th">CI95%</th>
<th data-quarto-table-cell-role="th">cohen-d</th>
<th data-quarto-table-cell-role="th">BF10</th>
<th data-quarto-table-cell-role="th">power</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">T-test</td>
<td>10.151246</td>
<td>38</td>
<td>two-sided</td>
<td>2.245760e-12</td>
<td>[2.48, 3.71]</td>
<td>3.210106</td>
<td>2.223e+09</td>
<td>1.0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="표본-크기가-다른경우" class="level3">
<h3 class="anchored" data-anchor-id="표본-크기가-다른경우">1.3.2. 표본 크기가 다른경우</h3>
<div id="cell-12" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1">x <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.random.normal(loc<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>, size<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>)</span>
<span id="cb9-2">y <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.random.normal(loc<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>, size<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">15</span>)</span>
<span id="cb9-3">pg.ttest(x, y, correction<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"auto"</span>)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="6">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">T</th>
<th data-quarto-table-cell-role="th">dof</th>
<th data-quarto-table-cell-role="th">tail</th>
<th data-quarto-table-cell-role="th">p-val</th>
<th data-quarto-table-cell-role="th">CI95%</th>
<th data-quarto-table-cell-role="th">cohen-d</th>
<th data-quarto-table-cell-role="th">BF10</th>
<th data-quarto-table-cell-role="th">power</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">T-test</td>
<td>8.352442</td>
<td>24.033207</td>
<td>two-sided</td>
<td>1.443438e-08</td>
<td>[2.21, 3.65]</td>
<td>2.995554</td>
<td>5.808e+06</td>
<td>1.0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
</section>
<section id="pearsons-correlation" class="level2">
<h2 class="anchored" data-anchor-id="pearsons-correlation">1.4. Pearson’s correlation</h2>
<div id="cell-14" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1">mean, cov, n <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>], [(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6</span>), (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)], <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span></span>
<span id="cb10-2">x, y <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.random.multivariate_normal(mean, cov, n).T</span>
<span id="cb10-3">pg.corr(x, y)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="7">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">n</th>
<th data-quarto-table-cell-role="th">r</th>
<th data-quarto-table-cell-role="th">CI95%</th>
<th data-quarto-table-cell-role="th">r2</th>
<th data-quarto-table-cell-role="th">adj_r2</th>
<th data-quarto-table-cell-role="th">p-val</th>
<th data-quarto-table-cell-role="th">BF10</th>
<th data-quarto-table-cell-role="th">power</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">pearson</td>
<td>30</td>
<td>0.63893</td>
<td>[0.36, 0.81]</td>
<td>0.408231</td>
<td>0.364397</td>
<td>0.000145</td>
<td>220.85</td>
<td>0.978466</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="robust-correlation" class="level2">
<h2 class="anchored" data-anchor-id="robust-correlation">1.5. Robust correlation</h2>
<div id="cell-16" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 표본 x에 아웃라이어 추가</span></span>
<span id="cb11-2">x[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">18</span></span>
<span id="cb11-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Use the robust Shepherd's pi correlation</span></span>
<span id="cb11-4">pg.corr(x, y, method<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"shepherd"</span>)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="8">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">n</th>
<th data-quarto-table-cell-role="th">outliers</th>
<th data-quarto-table-cell-role="th">r</th>
<th data-quarto-table-cell-role="th">CI95%</th>
<th data-quarto-table-cell-role="th">r2</th>
<th data-quarto-table-cell-role="th">adj_r2</th>
<th data-quarto-table-cell-role="th">p-val</th>
<th data-quarto-table-cell-role="th">power</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">shepherd</td>
<td>30</td>
<td>3</td>
<td>0.391331</td>
<td>[0.04, 0.66]</td>
<td>0.15314</td>
<td>0.090409</td>
<td>0.043538</td>
<td>0.586546</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="데이터의-정규성-테스트" class="level2">
<h2 class="anchored" data-anchor-id="데이터의-정규성-테스트">1.6. 데이터의 정규성 테스트</h2>
<p><code>pingouin.normality()</code>함수를 pandas의 데이터 프레임형식에 사용할 수 있습니다.</p>
<div id="cell-18" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 일변량 정규성(Univariate normality)</span></span>
<span id="cb12-2">pg.normality(x)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="9">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">W</th>
<th data-quarto-table-cell-role="th">pval</th>
<th data-quarto-table-cell-role="th">normal</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>0.485009</td>
<td>3.733778e-09</td>
<td>False</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-19" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 다변량 정규성(Multivariate normality)</span></span>
<span id="cb13-2">pg.multivariate_normality(np.column_stack((x, y)))</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="10">
<pre><code>(False, 6.620602006901788e-07)</code></pre>
</div>
</div>
</section>
<section id="q-q-plot-시각화" class="level2">
<h2 class="anchored" data-anchor-id="q-q-plot-시각화">1.7. Q-Q plot 시각화</h2>
<div id="cell-21" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1">x <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.random.normal(size<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>)</span>
<span id="cb15-2">ax <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pg.qqplot(x, dist<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"norm"</span>)</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://tomorrow-lab.github.io/posts/python_pingouin_files/figure-html/cell-12-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="one-way-anova" class="level2">
<h2 class="anchored" data-anchor-id="one-way-anova">1.8. One-way ANOVA</h2>
<p>기본 내장되어 있는 데이터프레임(<code>mixed_anova</code>)을 사용합니다.</p>
<div id="cell-23" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Read an example dataset</span></span>
<span id="cb16-2">df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pg.read_dataset(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mixed_anova"</span>)</span>
<span id="cb16-3">df.tail()</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="12">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Scores</th>
<th data-quarto-table-cell-role="th">Time</th>
<th data-quarto-table-cell-role="th">Group</th>
<th data-quarto-table-cell-role="th">Subject</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">175</td>
<td>6.176981</td>
<td>June</td>
<td>Meditation</td>
<td>55</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">176</td>
<td>8.523692</td>
<td>June</td>
<td>Meditation</td>
<td>56</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">177</td>
<td>6.522273</td>
<td>June</td>
<td>Meditation</td>
<td>57</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">178</td>
<td>4.990568</td>
<td>June</td>
<td>Meditation</td>
<td>58</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">179</td>
<td>7.822986</td>
<td>June</td>
<td>Meditation</td>
<td>59</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-24" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Run the ANOVA</span></span>
<span id="cb17-2">aov <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pg.anova(data<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>df, dv<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Scores"</span>, between<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Group"</span>, detailed<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb17-3">aov</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="13">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Source</th>
<th data-quarto-table-cell-role="th">SS</th>
<th data-quarto-table-cell-role="th">DF</th>
<th data-quarto-table-cell-role="th">MS</th>
<th data-quarto-table-cell-role="th">F</th>
<th data-quarto-table-cell-role="th">p-unc</th>
<th data-quarto-table-cell-role="th">np2</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Group</td>
<td>5.459963</td>
<td>1</td>
<td>5.459963</td>
<td>5.243656</td>
<td>0.0232</td>
<td>0.028616</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Within</td>
<td>185.342729</td>
<td>178</td>
<td>1.041251</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="repeated-measures-anova" class="level2">
<h2 class="anchored" data-anchor-id="repeated-measures-anova">1.9. Repeated measures ANOVA</h2>
<div id="cell-26" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb18" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1">pg.rm_anova(data<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>df, dv<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Scores"</span>, within<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Time"</span>, subject<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Subject"</span>, detailed<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="14">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Source</th>
<th data-quarto-table-cell-role="th">SS</th>
<th data-quarto-table-cell-role="th">DF</th>
<th data-quarto-table-cell-role="th">MS</th>
<th data-quarto-table-cell-role="th">F</th>
<th data-quarto-table-cell-role="th">p-unc</th>
<th data-quarto-table-cell-role="th">np2</th>
<th data-quarto-table-cell-role="th">eps</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Time</td>
<td>7.628428</td>
<td>2</td>
<td>3.814214</td>
<td>3.912796</td>
<td>0.022629</td>
<td>0.062194</td>
<td>0.998751</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Error</td>
<td>115.027023</td>
<td>118</td>
<td>0.974805</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="post-hoc-tests-corrected-for-multiple-comparisons" class="level2">
<h2 class="anchored" data-anchor-id="post-hoc-tests-corrected-for-multiple-comparisons">1.10. Post-hoc tests corrected for multiple-comparisons</h2>
<div id="cell-28" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># FDR-corrected post hocs with Hedges'g effect size</span></span>
<span id="cb19-2">posthoc <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pg.pairwise_ttests(</span>
<span id="cb19-3">    data<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>df,</span>
<span id="cb19-4">    dv<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Scores"</span>,</span>
<span id="cb19-5">    within<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Time"</span>,</span>
<span id="cb19-6">    subject<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Subject"</span>,</span>
<span id="cb19-7">    parametric<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>,</span>
<span id="cb19-8">    padjust<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"fdr_bh"</span>,</span>
<span id="cb19-9">    effsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"hedges"</span>,</span>
<span id="cb19-10">)</span>
<span id="cb19-11"></span>
<span id="cb19-12">posthoc</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="15">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Contrast</th>
<th data-quarto-table-cell-role="th">A</th>
<th data-quarto-table-cell-role="th">B</th>
<th data-quarto-table-cell-role="th">Paired</th>
<th data-quarto-table-cell-role="th">Parametric</th>
<th data-quarto-table-cell-role="th">T</th>
<th data-quarto-table-cell-role="th">dof</th>
<th data-quarto-table-cell-role="th">Tail</th>
<th data-quarto-table-cell-role="th">p-unc</th>
<th data-quarto-table-cell-role="th">p-corr</th>
<th data-quarto-table-cell-role="th">p-adjust</th>
<th data-quarto-table-cell-role="th">BF10</th>
<th data-quarto-table-cell-role="th">hedges</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Time</td>
<td>August</td>
<td>January</td>
<td>True</td>
<td>True</td>
<td>-1.740370</td>
<td>59.0</td>
<td>two-sided</td>
<td>0.087008</td>
<td>0.130512</td>
<td>fdr_bh</td>
<td>0.582</td>
<td>-0.327583</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Time</td>
<td>August</td>
<td>June</td>
<td>True</td>
<td>True</td>
<td>-2.743238</td>
<td>59.0</td>
<td>two-sided</td>
<td>0.008045</td>
<td>0.024134</td>
<td>fdr_bh</td>
<td>4.232</td>
<td>-0.482547</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Time</td>
<td>January</td>
<td>June</td>
<td>True</td>
<td>True</td>
<td>-1.023620</td>
<td>59.0</td>
<td>two-sided</td>
<td>0.310194</td>
<td>0.310194</td>
<td>fdr_bh</td>
<td>0.232</td>
<td>-0.169520</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="two-way-mixed-anova" class="level2">
<h2 class="anchored" data-anchor-id="two-way-mixed-anova">1.11. Two-way mixed ANOVA</h2>
<div id="cell-30" class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb20" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Compute the two-way mixed ANOVA and export to a .csv file</span></span>
<span id="cb20-2">aov <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pg.mixed_anova(</span>
<span id="cb20-3">    data<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>df,</span>
<span id="cb20-4">    dv<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Scores"</span>,</span>
<span id="cb20-5">    between<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Group"</span>,</span>
<span id="cb20-6">    within<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Time"</span>,</span>
<span id="cb20-7">    subject<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Subject"</span>,</span>
<span id="cb20-8">    correction<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">False</span>,</span>
<span id="cb20-9">    effsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"np2"</span>,</span>
<span id="cb20-10">)</span>
<span id="cb20-11">aov</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="16">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Source</th>
<th data-quarto-table-cell-role="th">SS</th>
<th data-quarto-table-cell-role="th">DF1</th>
<th data-quarto-table-cell-role="th">DF2</th>
<th data-quarto-table-cell-role="th">MS</th>
<th data-quarto-table-cell-role="th">F</th>
<th data-quarto-table-cell-role="th">p-unc</th>
<th data-quarto-table-cell-role="th">np2</th>
<th data-quarto-table-cell-role="th">eps</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Group</td>
<td>5.459963</td>
<td>1</td>
<td>58</td>
<td>5.459963</td>
<td>5.051709</td>
<td>0.028420</td>
<td>0.080120</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Time</td>
<td>7.628428</td>
<td>2</td>
<td>116</td>
<td>3.814214</td>
<td>4.027394</td>
<td>0.020369</td>
<td>0.064929</td>
<td>0.998751</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Interaction</td>
<td>5.167192</td>
<td>2</td>
<td>116</td>
<td>2.583596</td>
<td>2.727996</td>
<td>0.069545</td>
<td>0.044922</td>
<td>NaN</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="bland-altman-plot" class="level2">
<h2 class="anchored" data-anchor-id="bland-altman-plot">1.12. Bland-Altman plot</h2>
<div id="cell-32" class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb21" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1">mean, cov <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">11</span>], [[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8</span>], [<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]]</span>
<span id="cb21-2">x, y <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.random.multivariate_normal(mean, cov, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span>).T</span>
<span id="cb21-3">ax <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pg.plot_blandaltman(x, y)</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://tomorrow-lab.github.io/posts/python_pingouin_files/figure-html/cell-18-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="paired-t-test-검정력-시각화" class="level2">
<h2 class="anchored" data-anchor-id="paired-t-test-검정력-시각화">1.13. paired T-test 검정력 시각화</h2>
<p>T-검정의 표본 크기와 효과 크기(Cohen’d)에 따른 검정력 곡선을 시각화합니다.</p>
<div id="cell-34" class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb22" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> matplotlib.pyplot <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> plt</span>
<span id="cb22-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> seaborn <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> sns</span>
<span id="cb22-3"></span>
<span id="cb22-4">sns.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">set</span>(style<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ticks"</span>, context<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"notebook"</span>, font_scale<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.2</span>)</span>
<span id="cb22-5">d <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Fixed effect size</span></span>
<span id="cb22-6">n <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.arange(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">80</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Incrementing sample size</span></span>
<span id="cb22-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Compute the achieved power</span></span>
<span id="cb22-8">pwr <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pg.power_ttest(d<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>d, n<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>n, contrast<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"paired"</span>, tail<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"two-sided"</span>)</span>
<span id="cb22-9">plt.plot(n, pwr, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ko-."</span>)</span>
<span id="cb22-10">plt.axhline(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8</span>, color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"r"</span>, ls<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">":"</span>)</span>
<span id="cb22-11">plt.xlabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Sample size"</span>)</span>
<span id="cb22-12">plt.ylabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Power (1 - type II error)"</span>)</span>
<span id="cb22-13">plt.title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Achieved power of a paired T-test"</span>)</span>
<span id="cb22-14">sns.despine()</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://tomorrow-lab.github.io/posts/python_pingouin_files/figure-html/cell-19-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="paired-plot" class="level2">
<h2 class="anchored" data-anchor-id="paired-plot">1.14. Paired plot</h2>
<p><code>mixed_anova</code>데이터셋을 가지고 명상이 학교 성적에 미치는 영향에 대한 시각화를 해본다.</p>
<div id="cell-36" class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb23" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1">df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pg.read_dataset(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mixed_anova"</span>).query(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Group == 'Meditation' and Time != 'January'"</span>)</span>
<span id="cb23-2"></span>
<span id="cb23-3">pg.plot_paired(data<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>df, dv<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Scores"</span>, within<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Time"</span>, subject<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Subject"</span>)</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://tomorrow-lab.github.io/posts/python_pingouin_files/figure-html/cell-20-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="마무리하며" class="level1">
<h1>마무리하며</h1>
<p>파이썬을 사용한 통계 분석은 <code>R</code>언어에 비해 사용법과 기능이 부족했습니다. 그렇기 때문에 <code>pingouin</code>의 등장이 반갑습니다. 아직 초기 버전이지만 기존에 존재했던 통계 분석 패키지들을 뛰어 넘는 성능과 완성도를 보여주고 있어 앞으로의 발전이 기대 됩니다.</p>


</section>

 ]]></description>
  <category>news</category>
  <category>python</category>
  <category>data science</category>
  <category>pingouin</category>
  <guid>https://tomorrow-lab.github.io/posts/python_pingouin.html</guid>
  <pubDate>Sun, 22 Jan 2023 15:00:00 GMT</pubDate>
</item>
<item>
  <title>Jupyter notebook 소개</title>
  <dc:creator>Taeyoon kim</dc:creator>
  <link>https://tomorrow-lab.github.io/posts/python_jupyter.html</link>
  <description><![CDATA[ 




<section id="ipython" class="level1">
<h1>Ipython</h1>
<p><strong>ipython</strong>는 파이썬을 위한 향상된 대화형 커맨드라인 콘솔입니다. <strong>Jupyter notebook</strong>은 그것에서 보다 발전된 형태로 <em>코딩</em>과 <em>문서화</em>를 동시에 해서 생산성을 극대화 하는 도구입니다. 이 블로그도 jupyter notebook을 기반으로 해서 만들어 졌습니다.</p>
<div id="cell-2" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Hello!"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Hello!</code></pre>
</div>
</div>
<section id="매직-명령어magic-commands" class="level2">
<h2 class="anchored" data-anchor-id="매직-명령어magic-commands">매직 명령어(Magic commands)</h2>
<p>파일 시스템과 상호작용을 할 수 있는 명령어로 <strong>%</strong> 기호로 시작합니다. 현재 디렉토리 위치를 출력해 보겠습니다.</p>
<div id="cell-4" class="cell" data-scrolled="true" data-execution_count="2">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span>pwd</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="2">
<pre><code>'/home/partrita/Documents/blog/partrita.github.io/posts'</code></pre>
</div>
</div>
<p>더 많은 매직 명령어는 <em>%lsmagic</em>으로 확인 할 수 있고, 각 명령어에 <em>?</em>를 추가하면 추가 정보를 보여줍니다.</p>
<div id="cell-6" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span>lsmagic</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="3">
<pre><code>Available line magics:
%alias  %alias_magic  %autocall  %automagic  %autosave  %bookmark  %cat  %cd  %clear  %colors  %config  %connect_info  %cp  %debug  %dhist  %dirs  %doctest_mode  %ed  %edit  %env  %gui  %hist  %history  %killbgscripts  %ldir  %less  %lf  %lk  %ll  %load  %load_ext  %loadpy  %logoff  %logon  %logstart  %logstate  %logstop  %ls  %lsmagic  %lx  %macro  %magic  %man  %matplotlib  %mkdir  %more  %mv  %notebook  %page  %pastebin  %pdb  %pdef  %pdoc  %pfile  %pinfo  %pinfo2  %popd  %pprint  %precision  %profile  %prun  %psearch  %psource  %pushd  %pwd  %pycat  %pylab  %qtconsole  %quickref  %recall  %rehashx  %reload_ext  %rep  %rerun  %reset  %reset_selective  %rm  %rmdir  %run  %save  %sc  %set_env  %store  %sx  %system  %tb  %time  %timeit  %unalias  %unload_ext  %who  %who_ls  %whos  %xdel  %xmode

Available cell magics:
%%!  %%HTML  %%SVG  %%bash  %%capture  %%debug  %%file  %%html  %%javascript  %%js  %%latex  %%markdown  %%perl  %%prun  %%pypy  %%python  %%python2  %%python3  %%ruby  %%script  %%sh  %%svg  %%sx  %%system  %%time  %%timeit  %%writefile

Automagic is ON, % prefix IS NOT needed for line magics.</code></pre>
</div>
</div>
</section>
<section id="자동완성-tab-completion" class="level2">
<h2 class="anchored" data-anchor-id="자동완성-tab-completion">자동완성 (Tab completion)</h2>
<p>자동완성은 믿을 수 없을 정도로 아주 유용한 기능입니다. 코딩을 하면서 모든 것을 타이핑하는것보다 <em>tab</em>키를 누르면 알아서 완성해주는 기능입니다.</p>
</section>
</section>
<section id="matplotlib-과-seaborn" class="level1">
<h1>Matplotlib 과 Seaborn</h1>
<p><strong>matplotlib</strong>은 파이썬의 중심 라이브러리입니다. 사용하기 복잡할 수 있지만 풍부하고 강력한 기능을 제공하죠. 다만 기본 스타일이 촌스럽게 느껴질수 있습니다. 그래서 <strong>seaborn</strong>이 만들어 졌죠. seaborn은 matplotlib 기반으로 사용하기 쉽고 통계적인 시각화를 제공합니다.</p>
<div id="cell-9" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 필요한 모듈을 임포트합니다.</span></span>
<span id="cb7-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> matplotlib.pyplot <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> plt</span>
<span id="cb7-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> numpy <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> np</span>
<span id="cb7-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> seaborn <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> sns</span>
<span id="cb7-5"></span>
<span id="cb7-6"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span>matplotlib inline</span></code></pre></div>
</div>
<div id="cell-10" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># matplotlib 으로 임의의 신호를 생성하고 그려보자</span></span>
<span id="cb8-2">y <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.random.randn(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span>)</span>
<span id="cb8-3">plt.plot(y)</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://tomorrow-lab.github.io/posts/python_jupyter_files/figure-html/cell-6-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-11" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 수학함수를 그래프로 그려보자</span></span>
<span id="cb9-2">x <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.linspace(<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">10.0</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">10.0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span>)</span>
<span id="cb9-3">y <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.sin(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> x) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> np.exp(<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>, x<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span>
<span id="cb9-4">plt.plot(x, y)</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://tomorrow-lab.github.io/posts/python_jupyter_files/figure-html/cell-7-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-12" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 산점도를 그려보자</span></span>
<span id="cb10-2">x <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.random.randn(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>)</span>
<span id="cb10-3">y <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> x <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> np.random.randn(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>)</span>
<span id="cb10-4">plt.scatter(x, y)</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://tomorrow-lab.github.io/posts/python_jupyter_files/figure-html/cell-8-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<section id="seaborn-시각화" class="level2">
<h2 class="anchored" data-anchor-id="seaborn-시각화">Seaborn 시각화</h2>
<p>seaborn은 사용하기 쉬운 발전된 기능을 제공 합니다.</p>
<div id="cell-14" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 예제에 사용될 데이터를 읽어오자</span></span>
<span id="cb11-2">df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> sns.load_dataset(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"iris"</span>)</span>
<span id="cb11-3">df.head()  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 데이터의 모양을 확인</span></span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="5">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">sepal_length</th>
<th data-quarto-table-cell-role="th">sepal_width</th>
<th data-quarto-table-cell-role="th">petal_length</th>
<th data-quarto-table-cell-role="th">petal_width</th>
<th data-quarto-table-cell-role="th">species</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>5.1</td>
<td>3.5</td>
<td>1.4</td>
<td>0.2</td>
<td>setosa</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>4.9</td>
<td>3.0</td>
<td>1.4</td>
<td>0.2</td>
<td>setosa</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>4.7</td>
<td>3.2</td>
<td>1.3</td>
<td>0.2</td>
<td>setosa</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>4.6</td>
<td>3.1</td>
<td>1.5</td>
<td>0.2</td>
<td>setosa</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>5.0</td>
<td>3.6</td>
<td>1.4</td>
<td>0.2</td>
<td>setosa</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>사용한 데이터셋은 <strong>붓꽃(iris)</strong> 의 3가지 종(setosa, versicolor, virginica)에 대해 꽃받침(sepal)과 꽃잎(petal)의 넓이와 길이를 정리한 데이터입니다.</p>
<p><img src="https://upload.wikimedia.org/wikipedia/commons/thumb/7/7f/Mature_flower_diagram.svg/310px-Mature_flower_diagram.svg.png" class="img-fluid"></p>
<p>위 그림을 참고하시면 이해가 되실 겁니다.</p>
<div id="cell-16" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># pair plot을 그려본다</span></span>
<span id="cb12-2">sns.pairplot(df, hue<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"species"</span>, size<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2.5</span>)</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://tomorrow-lab.github.io/posts/python_jupyter_files/figure-html/cell-10-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>각각의 붓꽃종에 따라 꽃받침(sepal)과 꽃잎(petal)에 어떠한 연관성이 있는 지 확인 할 수 있습니다. 예를 들면 꽃잎의 길이가 길면 넓이도 넓어지는것은 모든종에서 연관관계가 있는 것을 볼수 있습니다.</p>


</section>
</section>

 ]]></description>
  <category>news</category>
  <category>python</category>
  <guid>https://tomorrow-lab.github.io/posts/python_jupyter.html</guid>
  <pubDate>Mon, 09 Jan 2023 15:00:00 GMT</pubDate>
</item>
<item>
  <title>깔끔하게 데이터 정리하기</title>
  <dc:creator>Taeyoon kim</dc:creator>
  <link>https://tomorrow-lab.github.io/posts/Tidydata/python_TidyData.html</link>
  <description><![CDATA[ 




<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://tomorrow-lab.github.io/posts/Tidydata/thumbnail.jpg" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:70.0%"></p>
</figure>
</div>
<section id="깔끔한-데이터tidy-data란" class="level1">
<h1>깔끔한 데이터(Tidy data)란?</h1>
<blockquote class="blockquote">
<p>우리는 데이터 분석을 수행하면서 다양한 데이터 변환 작업을 수행하게 된다. 이는 데이터가 원래 특정 분석을 염두에 두고 만들어지는 경우가 거의 없기 때문이며, 사실 애초 데이터 설계를 할 때 분석 목적을 알기도 불가능하다는 게 가장 큰 원인이 아닐까 한다. 이런 연유로 전체 데이터 분석 작업에서 70% 혹은 80% 이상이 이런 데이터 변환 및 전처리 작업에서 소모된다. <sup><a href="http://freesearch.pe.kr/archives/3942">1</a></sup></p>
</blockquote>
<p>다른 사람들과 데이터(예를 들면 엑셀파일)를 주고 받다 보면 깨닫게 됩니다. 모든 사람의 생각은 다르다는 것을요. 사람마다 (좋게 말하면) 각양각색으로 정리를 하다보니, 여러명이 작성한 엑셀 파일을 하나의 파일로 합치려 보면 결국에는 누군가가 새로 정리를 해야 하는 상황이 됩니다.</p>
<p>Tidy data의 개념은 그런 상황을 방지하기 위해 <strong>Jeff Leek</strong>이 만들었습니다. 데이터 처리에 가장 많은 시간이 소요되는 전처리 과정을 줄여 보자, 그러기 위해 처음부터 데이터를 표준화해서 만들자는 것입니다. 처음부터 기본적인 규칙을 가지고 데이터를 만들면, 모두의 시간을 아낄 수 있으니까요.</p>
<p>위키피디아에 따르면 Tidy data의 정의는 다음와 같습니다. “밑바닥 부터 시작할 필요 없는 데이터”</p>
<section id="더-알아-보기" class="level2">
<h2 class="anchored" data-anchor-id="더-알아-보기">더 알아 보기</h2>
<ul>
<li>2014년도에 출판된 <a href="http://vita.had.co.nz/papers/tidy-data.pdf">논문</a> 입니다.</li>
<li>데이터의 출처는 <a href="https://github.com/nickhould/tidy-data-python">이곳</a> 입니다.</li>
</ul>
</section>
<section id="깔끔한-데이터tidy-data의-특징" class="level2">
<h2 class="anchored" data-anchor-id="깔끔한-데이터tidy-data의-특징">깔끔한 데이터(Tidy data)의 특징</h2>
<p><strong>Jeff Leek</strong>가 쓴 책 <strong>The Elements of Data Analytic Style</strong>에서 정의한 깔끔한 데이터는 아래와 같은 특징을 가집니다.</p>
<ol type="1">
<li>각 변수는 개별의 열(column)으로 존재한다.</li>
<li>각 관측치는 행(row)를 구성한다.</li>
<li>각 표는 단 하나의 관측기준에 의해서 조직된 데이터를 저장한다.</li>
<li>만약 여러개의 표가 존재한다면, 적어도 하나이상의 열(column)이 공유되어야 한다.</li>
</ol>
<ul>
<li>변수(Variable): 예를 들면 <em>키, 몸무게, 성별</em></li>
<li>값(Value): 예를 들자면 <em>152 cm, 80 kg, 여성</em></li>
<li>관측치(Observation): 값을 측정한 단위, 여기서는 <em>각각의 사람</em></li>
</ul>
<p>너무 복잡하다고 생각되신다면 아래 예시를 확인하세요.</p>
<section id="지저분한-데이터의-예" class="level3">
<h3 class="anchored" data-anchor-id="지저분한-데이터의-예">지저분한 데이터의 예:</h3>
<div>
<table class="dataframe table table-sm table-striped small">
<thead>
<tr>
<th>
</th>
<th>
Treatment A
</th>
<th>
Treatment B
</th>
</tr>
</thead>
<tbody>
<tr>
<th>
John Smith
</th>
<td>
-
</td>
<td>
2
</td>
</tr>
<tr>
<th>
Jane Doe
</th>
<td>
16
</td>
<td>
11
</td>
</tr>
<tr>
<th>
Mary Johnson
</th>
<td>
3
</td>
<td>
1
</td>
</tr>
</tbody>
</table>
</div>
</section>
<section id="깔끔한-데이터tidy-data의-예" class="level3">
<h3 class="anchored" data-anchor-id="깔끔한-데이터tidy-data의-예">깔끔한 데이터(Tidy data)의 예:</h3>
<div>
<table class="dataframe table table-sm table-striped small">
<thead>
<tr>
<th>
Name
</th>
<th>
Treatment
</th>
<th>
Result
</th>
</tr>
</thead>
<tbody>
<tr>
<th>
John Smith
</th>
<td>
a
</td>
<td>
-
</td>
</tr>
<tr>
<th>
Jane Doe
</th>
<td>
a
</td>
<td>
16
</td>
</tr>
<tr>
<th>
Mary Johnson
</th>
<td>
a
</td>
<td>
3
</td>
</tr>
<tr>
<th>
John Smith
</th>
<td>
b
</td>
<td>
2
</td>
</tr>
<tr>
<th>
Jane Doe
</th>
<td>
b
</td>
<td>
11
</td>
</tr>
<tr>
<th>
Mary Johnson
</th>
<td>
b
</td>
<td>
1
</td>
</tr>
</tbody>
</table>
</div>
</section>
</section>
</section>
<section id="지저분한-데이터-처리하기" class="level1">
<h1>지저분한 데이터 처리하기</h1>
<p><strong>Wickham</strong>의 <a href="http://vita.had.co.nz/papers/tidy-data.pdf">논문</a>에 있던 데이터를 가지고 아래의 문제를 해결해 보도록 하겠습니다. 여기서 우리의 목표는 데이터 분석이 아니고 깔끔한 데이터를 만드는 것임을 명심하세요.</p>
<p>지저분한 데이터의 일반적인 모습은 다음과 같습니다.</p>
<ol type="1">
<li>열 이름(Column header)이 변수 이름이 아니고 값인 경우</li>
<li>같은 표에 다양한 관측 단위(observational units)가 있는 경우</li>
<li>하나의 열(column)에 여러 값이 들어 있는 경우</li>
<li>변수가 행과 열에 모두 포함되어 있는 경우</li>
<li>하나의 관측 단위(observational units)가 여러 파일로 나누어져 있는 경우</li>
</ol>
<blockquote class="blockquote">
<p>우리는 <code>Python</code>의 대표적인 라이브러리인 <code>Pandas</code>를 사용하도록 할게요.</p>
</blockquote>
<div id="cell-3" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 필요한 라이브러리 불러들이기</span></span>
<span id="cb1-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> datetime</span>
<span id="cb1-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> glob</span>
<span id="cb1-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> re  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 정규식</span></span>
<span id="cb1-5"></span>
<span id="cb1-6"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> pandas <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> pd</span></code></pre></div>
</div>
<section id="열-이름column-header이-변수-이름이-아니고-값인-경우" class="level2">
<h2 class="anchored" data-anchor-id="열-이름column-header이-변수-이름이-아니고-값인-경우">1. 열 이름(Column header)이 변수 이름이 아니고 값인 경우</h2>
<section id="pew-research-center-dataset" class="level3">
<h3 class="anchored" data-anchor-id="pew-research-center-dataset">Pew Research Center Dataset</h3>
<p>종교에 따른 개인의 수입의 관한 데이터입니다. 먼저 <code>pandas</code>의 <code>read_csv</code>기능을 사용해 파일을 읽어옵니다.</p>
<div id="cell-6" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1">df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.read_csv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"./data/pew-raw.csv"</span>)</span>
<span id="cb2-2">df</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="7">
<div>

<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">religion</th>
<th data-quarto-table-cell-role="th">&lt;$10k</th>
<th data-quarto-table-cell-role="th">$10-20k</th>
<th data-quarto-table-cell-role="th">$20-30k</th>
<th data-quarto-table-cell-role="th">$30-40k</th>
<th data-quarto-table-cell-role="th">$40-50k</th>
<th data-quarto-table-cell-role="th">$50-75k</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Agnostic</td>
<td>27</td>
<td>34</td>
<td>60</td>
<td>81</td>
<td>76</td>
<td>137</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Atheist</td>
<td>12</td>
<td>27</td>
<td>37</td>
<td>52</td>
<td>35</td>
<td>70</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Buddhist</td>
<td>27</td>
<td>21</td>
<td>30</td>
<td>34</td>
<td>33</td>
<td>58</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Catholic</td>
<td>418</td>
<td>617</td>
<td>732</td>
<td>670</td>
<td>638</td>
<td>1116</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Dont know/refused</td>
<td>15</td>
<td>14</td>
<td>15</td>
<td>11</td>
<td>10</td>
<td>35</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>Evangelical Prot</td>
<td>575</td>
<td>869</td>
<td>1064</td>
<td>982</td>
<td>881</td>
<td>1486</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>Hindu</td>
<td>1</td>
<td>9</td>
<td>7</td>
<td>9</td>
<td>11</td>
<td>34</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>Historically Black Prot</td>
<td>228</td>
<td>244</td>
<td>236</td>
<td>238</td>
<td>197</td>
<td>223</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>Jehovahs Witness</td>
<td>20</td>
<td>27</td>
<td>24</td>
<td>24</td>
<td>21</td>
<td>30</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>Jewish</td>
<td>19</td>
<td>19</td>
<td>25</td>
<td>25</td>
<td>30</td>
<td>95</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<ul>
<li>Evangelical Prot는 기독교 종파중에 하나로 ’개신교’입니다.</li>
</ul>
<p><strong>문제점</strong>: 이 데이터들의 문제는 열 이름(columns headers)이 개인소득의 범위로 되어 있다는 것이죠.</p>
<blockquote class="blockquote">
<p>다시 말해서 보기에는 좋아보일지는 몰라도 분석하기에는 어려운 형식입니다.</p>
</blockquote>
<p>이러한 데이터를 Tidy data 형태로 변환하기 위해서 <code>pandas</code>라이브러리에서는 아주 쉬운 기능을 제공해 줍니다. 바로 <code>melt</code>라는 기능이지요. <strong>pivot table</strong>의 반대되는 개념으로 행이 많은 데이터를 열이 많은 데이터로 바꿔줍니다. <code>melt</code>는 아주 유용하기 때문에 앞으로도 자주 언급 됩니다.</p>
<div id="cell-9" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1">formatted_df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.melt(df, [<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"religion"</span>], var_name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"income"</span>, value_name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"freq"</span>)</span>
<span id="cb3-2">formatted_df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> formatted_df.sort_values(by<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"religion"</span>])  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 종교 이름순으로 정렬</span></span>
<span id="cb3-3">formatted_df.head(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 너무 길기 때문에 윗쪽 10개만 보겠습니다.</span></span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="8">
<div>

<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">religion</th>
<th data-quarto-table-cell-role="th">income</th>
<th data-quarto-table-cell-role="th">freq</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Agnostic</td>
<td>&lt;$10k</td>
<td>27</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">30</td>
<td>Agnostic</td>
<td>$30-40k</td>
<td>81</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">40</td>
<td>Agnostic</td>
<td>$40-50k</td>
<td>76</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">50</td>
<td>Agnostic</td>
<td>$50-75k</td>
<td>137</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">10</td>
<td>Agnostic</td>
<td>$10-20k</td>
<td>34</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">20</td>
<td>Agnostic</td>
<td>$20-30k</td>
<td>60</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">41</td>
<td>Atheist</td>
<td>$40-50k</td>
<td>35</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">21</td>
<td>Atheist</td>
<td>$20-30k</td>
<td>37</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">11</td>
<td>Atheist</td>
<td>$10-20k</td>
<td>27</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">31</td>
<td>Atheist</td>
<td>$30-40k</td>
<td>52</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>이것이 <em>Pew Research Center Dataset</em> 의 Tidy data 형태 입니다.</p>
</section>
<section id="billboard-top-100-dataset" class="level3">
<h3 class="anchored" data-anchor-id="billboard-top-100-dataset">Billboard Top 100 Dataset</h3>
<p>이 데이터는 아주 오래전 같은 1999년부터 2000년까지의 빌보드차트 주간 순위 변동을 포함하고 있는 데이터 입니다.</p>
<div id="cell-12" class="cell" data-execution_count="69">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1">df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.read_csv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"./data/billboard.csv"</span>, encoding<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mac_latin2"</span>)</span>
<span id="cb4-2">df.head(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="69">
<div>

<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">artist.inverted</th>
<th data-quarto-table-cell-role="th">track</th>
<th data-quarto-table-cell-role="th">time</th>
<th data-quarto-table-cell-role="th">genre</th>
<th data-quarto-table-cell-role="th">date.entered</th>
<th data-quarto-table-cell-role="th">date.peaked</th>
<th data-quarto-table-cell-role="th">x1st.week</th>
<th data-quarto-table-cell-role="th">x2nd.week</th>
<th data-quarto-table-cell-role="th">x3rd.week</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">x67th.week</th>
<th data-quarto-table-cell-role="th">x68th.week</th>
<th data-quarto-table-cell-role="th">x69th.week</th>
<th data-quarto-table-cell-role="th">x70th.week</th>
<th data-quarto-table-cell-role="th">x71st.week</th>
<th data-quarto-table-cell-role="th">x72nd.week</th>
<th data-quarto-table-cell-role="th">x73rd.week</th>
<th data-quarto-table-cell-role="th">x74th.week</th>
<th data-quarto-table-cell-role="th">x75th.week</th>
<th data-quarto-table-cell-role="th">x76th.week</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>2000</td>
<td>Destiny's Child</td>
<td>Independent Women Part I</td>
<td>3:38</td>
<td>Rock</td>
<td>2000-09-23</td>
<td>2000-11-18</td>
<td>78</td>
<td>63.0</td>
<td>49.0</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2000</td>
<td>Santana</td>
<td>Maria, Maria</td>
<td>4:18</td>
<td>Rock</td>
<td>2000-02-12</td>
<td>2000-04-08</td>
<td>15</td>
<td>8.0</td>
<td>6.0</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>2000</td>
<td>Savage Garden</td>
<td>I Knew I Loved You</td>
<td>4:07</td>
<td>Rock</td>
<td>1999-10-23</td>
<td>2000-01-29</td>
<td>71</td>
<td>48.0</td>
<td>43.0</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>2000</td>
<td>Madonna</td>
<td>Music</td>
<td>3:45</td>
<td>Rock</td>
<td>2000-08-12</td>
<td>2000-09-16</td>
<td>41</td>
<td>23.0</td>
<td>18.0</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>2000</td>
<td>Aguilera, Christina</td>
<td>Come On Over Baby (All I Want Is You)</td>
<td>3:38</td>
<td>Rock</td>
<td>2000-08-05</td>
<td>2000-10-14</td>
<td>57</td>
<td>47.0</td>
<td>45.0</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>2000</td>
<td>Janet</td>
<td>Doesn't Really Matter</td>
<td>4:17</td>
<td>Rock</td>
<td>2000-06-17</td>
<td>2000-08-26</td>
<td>59</td>
<td>52.0</td>
<td>43.0</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>2000</td>
<td>Destiny's Child</td>
<td>Say My Name</td>
<td>4:31</td>
<td>Rock</td>
<td>1999-12-25</td>
<td>2000-03-18</td>
<td>83</td>
<td>83.0</td>
<td>44.0</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>2000</td>
<td>Iglesias, Enrique</td>
<td>Be With You</td>
<td>3:36</td>
<td>Latin</td>
<td>2000-04-01</td>
<td>2000-06-24</td>
<td>63</td>
<td>45.0</td>
<td>34.0</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>2000</td>
<td>Sisqo</td>
<td>Incomplete</td>
<td>3:52</td>
<td>Rock</td>
<td>2000-06-24</td>
<td>2000-08-12</td>
<td>77</td>
<td>66.0</td>
<td>61.0</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>2000</td>
<td>Lonestar</td>
<td>Amazed</td>
<td>4:25</td>
<td>Country</td>
<td>1999-06-05</td>
<td>2000-03-04</td>
<td>81</td>
<td>54.0</td>
<td>44.0</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
</tbody>
</table>

<p>10 rows × 83 columns</p>
</div>
</div>
</div>
<p><strong>문제점:</strong></p>
<ul>
<li>열 이름(columns headers)이 값으로 구성되어 있다: <code>x1st.week</code>, <code>x2st.week</code> 등등</li>
<li>순위가 100위권 밖으로 밀려나게 되면 <code>Nan</code> 값을 가지고, 따라서 필요없는 부수적인 값이 많아진다.</li>
</ul>
<p>위 데이터의 깔끔한 데이터를 만들기 위해서는 다시 <code>melt</code> 기능을 사용하겠습니다. 각각의 열이 행이 되도록 하고, 순위가 100위 밖으로 밀려난 경우(<code>Nan</code>값을 갖는경우)에는 행을 삭제할게요.</p>
<div id="cell-14" class="cell" data-execution_count="70">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Melting</span></span>
<span id="cb5-2">id_vars <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [</span>
<span id="cb5-3">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"year"</span>,</span>
<span id="cb5-4">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"artist.inverted"</span>,</span>
<span id="cb5-5">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"track"</span>,</span>
<span id="cb5-6">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"time"</span>,</span>
<span id="cb5-7">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"genre"</span>,</span>
<span id="cb5-8">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"date.entered"</span>,</span>
<span id="cb5-9">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"date.peaked"</span>,</span>
<span id="cb5-10">]</span>
<span id="cb5-11">df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.melt(frame<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>df, id_vars<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>id_vars, var_name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"week"</span>, value_name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"rank"</span>)</span>
<span id="cb5-12"></span>
<span id="cb5-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Formatting</span></span>
<span id="cb5-14">df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"week"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (</span>
<span id="cb5-15">    df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"week"</span>].<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>.extract(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"(\d+)"</span>, expand<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">False</span>).astype(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">int</span>)</span>
<span id="cb5-16">)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 정규식으로 x1st.week 에서 숫자 1만 추출</span></span>
<span id="cb5-17">df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"rank"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"rank"</span>].astype(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">int</span>)</span>
<span id="cb5-18"></span>
<span id="cb5-19"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 필요없는 행을 삭제합니다.</span></span>
<span id="cb5-20">df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> df.dropna()</span>
<span id="cb5-21"></span>
<span id="cb5-22"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Create "date" columns</span></span>
<span id="cb5-23">df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"date"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (</span>
<span id="cb5-24">    pd.to_datetime(df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"date.entered"</span>])</span>
<span id="cb5-25">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> pd.to_timedelta(df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"week"</span>], unit<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"w"</span>)</span>
<span id="cb5-26">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> pd.DateOffset(weeks<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb5-27">)</span>
<span id="cb5-28"></span>
<span id="cb5-29">df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> df[[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"year"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"artist.inverted"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"track"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"time"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"genre"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"week"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"rank"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"date"</span>]]</span>
<span id="cb5-30">df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> df.sort_values(ascending<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>, by<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"year"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"artist.inverted"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"track"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"week"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"rank"</span>])</span>
<span id="cb5-31"></span>
<span id="cb5-32"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Assigning the tidy dataset to a variable for future usage</span></span>
<span id="cb5-33">billboard <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> df</span>
<span id="cb5-34"></span>
<span id="cb5-35">df.head(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="70">
<div>

<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">artist.inverted</th>
<th data-quarto-table-cell-role="th">track</th>
<th data-quarto-table-cell-role="th">time</th>
<th data-quarto-table-cell-role="th">genre</th>
<th data-quarto-table-cell-role="th">week</th>
<th data-quarto-table-cell-role="th">rank</th>
<th data-quarto-table-cell-role="th">date</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">246</td>
<td>2000</td>
<td>2 Pac</td>
<td>Baby Don't Cry (Keep Ya Head Up II)</td>
<td>4:22</td>
<td>Rap</td>
<td>1</td>
<td>87</td>
<td>2000-02-26</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">563</td>
<td>2000</td>
<td>2 Pac</td>
<td>Baby Don't Cry (Keep Ya Head Up II)</td>
<td>4:22</td>
<td>Rap</td>
<td>2</td>
<td>82</td>
<td>2000-03-04</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">880</td>
<td>2000</td>
<td>2 Pac</td>
<td>Baby Don't Cry (Keep Ya Head Up II)</td>
<td>4:22</td>
<td>Rap</td>
<td>3</td>
<td>72</td>
<td>2000-03-11</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1197</td>
<td>2000</td>
<td>2 Pac</td>
<td>Baby Don't Cry (Keep Ya Head Up II)</td>
<td>4:22</td>
<td>Rap</td>
<td>4</td>
<td>77</td>
<td>2000-03-18</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1514</td>
<td>2000</td>
<td>2 Pac</td>
<td>Baby Don't Cry (Keep Ya Head Up II)</td>
<td>4:22</td>
<td>Rap</td>
<td>5</td>
<td>87</td>
<td>2000-03-25</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1831</td>
<td>2000</td>
<td>2 Pac</td>
<td>Baby Don't Cry (Keep Ya Head Up II)</td>
<td>4:22</td>
<td>Rap</td>
<td>6</td>
<td>94</td>
<td>2000-04-01</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2148</td>
<td>2000</td>
<td>2 Pac</td>
<td>Baby Don't Cry (Keep Ya Head Up II)</td>
<td>4:22</td>
<td>Rap</td>
<td>7</td>
<td>99</td>
<td>2000-04-08</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">287</td>
<td>2000</td>
<td>2Ge+her</td>
<td>The Hardest Part Of Breaking Up (Is Getting Ba...</td>
<td>3:15</td>
<td>R&amp;B</td>
<td>1</td>
<td>91</td>
<td>2000-09-02</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">604</td>
<td>2000</td>
<td>2Ge+her</td>
<td>The Hardest Part Of Breaking Up (Is Getting Ba...</td>
<td>3:15</td>
<td>R&amp;B</td>
<td>2</td>
<td>87</td>
<td>2000-09-09</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">921</td>
<td>2000</td>
<td>2Ge+her</td>
<td>The Hardest Part Of Breaking Up (Is Getting Ba...</td>
<td>3:15</td>
<td>R&amp;B</td>
<td>3</td>
<td>92</td>
<td>2000-09-16</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>위와 같이 데이터를 깔끔하게 만들었습니다. 하지만 <em>track, time, genre</em> 열을 보시면 아주 많은 중복이 있는 것을 알 수 있습니다. 이러한 점을 해결 하는 방법은 다음 예제에서 다루어 보겠습니다.</p>
</section>
</section>
<section id="하나의-표에-여러가지-타입" class="level2">
<h2 class="anchored" data-anchor-id="하나의-표에-여러가지-타입">2. 하나의 표에 여러가지 타입</h2>
<p>위에서 다루었던 빌보드차트 데이터를 가지고 데이터가 반복되는 문제를 해결해 보겠습니다.</p>
<p><strong>문제점:</strong></p>
<ul>
<li>다양한 관측 단위(observational units), 여기서는 <code>song</code> 과 <code>rank</code>가 하나의 표에 들어 있습니다. 이를 위해서는 표를 나눌 필요가 있습니다.</li>
</ul>
<p>먼저, 각각의 노래의 자세한 내용을 담고 있는 표를 만들어 보겠습니다. 그런다음 각각의 <code>song_id</code>를 부여합니다. 그런다음 순위 값을 가지고 있는 표를 <code>song_id</code>로 정리합니다.</p>
<div id="cell-17" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1">songs_cols <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"year"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"artist.inverted"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"track"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"time"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"genre"</span>]</span>
<span id="cb6-2">songs <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> billboard[songs_cols].drop_duplicates()</span>
<span id="cb6-3">songs <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> songs.reset_index(drop<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb6-4">songs[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"song_id"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> songs.index</span>
<span id="cb6-5">songs.head(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="11">
<div>

<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">artist.inverted</th>
<th data-quarto-table-cell-role="th">track</th>
<th data-quarto-table-cell-role="th">time</th>
<th data-quarto-table-cell-role="th">genre</th>
<th data-quarto-table-cell-role="th">song_id</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>2000</td>
<td>2 Pac</td>
<td>Baby Don't Cry (Keep Ya Head Up II)</td>
<td>4:22</td>
<td>Rap</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2000</td>
<td>2Ge+her</td>
<td>The Hardest Part Of Breaking Up (Is Getting Ba...</td>
<td>3:15</td>
<td>R&amp;B</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>2000</td>
<td>3 Doors Down</td>
<td>Kryptonite</td>
<td>3:53</td>
<td>Rock</td>
<td>2</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>2000</td>
<td>3 Doors Down</td>
<td>Loser</td>
<td>4:24</td>
<td>Rock</td>
<td>3</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>2000</td>
<td>504 Boyz</td>
<td>Wobble Wobble</td>
<td>3:35</td>
<td>Rap</td>
<td>4</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>2000</td>
<td>98°</td>
<td>Give Me Just One Night (Una Noche)</td>
<td>3:24</td>
<td>Rock</td>
<td>5</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>2000</td>
<td>A*Teens</td>
<td>Dancing Queen</td>
<td>3:44</td>
<td>Pop</td>
<td>6</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>2000</td>
<td>Aaliyah</td>
<td>I Don't Wanna</td>
<td>4:15</td>
<td>Rock</td>
<td>7</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>2000</td>
<td>Aaliyah</td>
<td>Try Again</td>
<td>4:03</td>
<td>Rock</td>
<td>8</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>2000</td>
<td>Adams, Yolanda</td>
<td>Open My Heart</td>
<td>5:30</td>
<td>Gospel</td>
<td>9</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>위 와같은 새로운 표를 분리하고, 아래와 같이 순위를 포함하고 있는 표를 새로 만들어줍니다. &gt; 두개의 표를 연결하기 위해 <code>song_id</code>열을 만드는 것을 주의하세요</p>
<div id="cell-19" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1">ranks <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.merge(billboard, songs, on<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"year"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"artist.inverted"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"track"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"time"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"genre"</span>])</span>
<span id="cb7-2">ranks <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ranks[[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"song_id"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"date"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"rank"</span>]]</span>
<span id="cb7-3">ranks.head(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="12">
<div>

<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">song_id</th>
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th">rank</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>0</td>
<td>2000-02-26</td>
<td>87</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>0</td>
<td>2000-03-04</td>
<td>82</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>0</td>
<td>2000-03-11</td>
<td>72</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>0</td>
<td>2000-03-18</td>
<td>77</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>0</td>
<td>2000-03-25</td>
<td>87</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>0</td>
<td>2000-04-01</td>
<td>94</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>0</td>
<td>2000-04-08</td>
<td>99</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>1</td>
<td>2000-09-02</td>
<td>91</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>1</td>
<td>2000-09-09</td>
<td>87</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>1</td>
<td>2000-09-16</td>
<td>92</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="다양한-변수가-하나의-열에-있는-경우-multiple-variables-stored-in-one-column" class="level2">
<h2 class="anchored" data-anchor-id="다양한-변수가-하나의-열에-있는-경우-multiple-variables-stored-in-one-column">3. 다양한 변수가 하나의 열에 있는 경우 Multiple variables stored in one column</h2>
<section id="tubercolosis-example" class="level3">
<h3 class="anchored" data-anchor-id="tubercolosis-example">Tubercolosis Example</h3>
<p>WHO(World Health Organization)에서 수집한 결핵환자의 기록입니다. 이 데이터에는 확인된 결핵환자의 국가, 연도, 나이, 성별이 포함되어 있습니다.</p>
<p><strong>문제점:</strong></p>
<ul>
<li>몇개의 열(columns)에 다양한 변수가 포함되어 있습니다.(성별과 나이)</li>
<li>값이 존재하지 않는 곳에 <code>NaN</code>과 0 이 혼재되어 있습니다.</li>
</ul>
<p>미리 알아둘 점:</p>
<ul>
<li>열의 이름에 적혀있는 “m”이나 “f”는 성별을 뜻합니다.</li>
<li>열의 이름에 적혀있는 숫자는 나이대(“0-14”,“15-24”, “25-34”, “45-54”, “55-64”, “65”, “unknown”)를 나타냅니다.</li>
</ul>
<div id="cell-22" class="cell" data-execution_count="49">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1">df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.read_csv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"./data/tb-raw.csv"</span>)</span>
<span id="cb8-2">df</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="49">
<div>

<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">country</th>
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">m014</th>
<th data-quarto-table-cell-role="th">m1524</th>
<th data-quarto-table-cell-role="th">m2534</th>
<th data-quarto-table-cell-role="th">m3544</th>
<th data-quarto-table-cell-role="th">m4554</th>
<th data-quarto-table-cell-role="th">m5564</th>
<th data-quarto-table-cell-role="th">m65</th>
<th data-quarto-table-cell-role="th">mu</th>
<th data-quarto-table-cell-role="th">f014</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>AD</td>
<td>2000</td>
<td>0.0</td>
<td>0.0</td>
<td>1.0</td>
<td>0.0</td>
<td>0</td>
<td>0</td>
<td>0.0</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>AE</td>
<td>2000</td>
<td>2.0</td>
<td>4.0</td>
<td>4.0</td>
<td>6.0</td>
<td>5</td>
<td>12</td>
<td>10.0</td>
<td>NaN</td>
<td>3.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>AF</td>
<td>2000</td>
<td>52.0</td>
<td>228.0</td>
<td>183.0</td>
<td>149.0</td>
<td>129</td>
<td>94</td>
<td>80.0</td>
<td>NaN</td>
<td>93.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>AG</td>
<td>2000</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0</td>
<td>0</td>
<td>1.0</td>
<td>NaN</td>
<td>1.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>AL</td>
<td>2000</td>
<td>2.0</td>
<td>19.0</td>
<td>21.0</td>
<td>14.0</td>
<td>24</td>
<td>19</td>
<td>16.0</td>
<td>NaN</td>
<td>3.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>AM</td>
<td>2000</td>
<td>2.0</td>
<td>152.0</td>
<td>130.0</td>
<td>131.0</td>
<td>63</td>
<td>26</td>
<td>21.0</td>
<td>NaN</td>
<td>1.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>AN</td>
<td>2000</td>
<td>0.0</td>
<td>0.0</td>
<td>1.0</td>
<td>2.0</td>
<td>0</td>
<td>0</td>
<td>0.0</td>
<td>NaN</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>AO</td>
<td>2000</td>
<td>186.0</td>
<td>999.0</td>
<td>1003.0</td>
<td>912.0</td>
<td>482</td>
<td>312</td>
<td>194.0</td>
<td>NaN</td>
<td>247.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>AR</td>
<td>2000</td>
<td>97.0</td>
<td>278.0</td>
<td>594.0</td>
<td>402.0</td>
<td>419</td>
<td>368</td>
<td>330.0</td>
<td>NaN</td>
<td>121.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>AS</td>
<td>2000</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>1</td>
<td>1</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>이 데이터를 정리하기 위해서는 먼저 <code>melt</code>를 이용해 <code>sex</code> + <code>age group</code> 를 합쳐서 하나의 행으로 만들겠습니다. 그런 다음에 다시 행을 <code>sex</code>, <code>age</code>로 구분해서 정리하도록 하죠.</p>
<div id="cell-24" class="cell" data-execution_count="50">
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1">df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.melt(df, id_vars<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"country"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"year"</span>], value_name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cases"</span>, var_name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"sex_and_age"</span>)</span>
<span id="cb9-2"></span>
<span id="cb9-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Extract Sex, Age lower bound and Age upper bound group</span></span>
<span id="cb9-4">tmp_df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"sex_and_age"</span>].<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>.extract(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"(\D)(\d+)(\d</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{2}</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">)"</span>, expand<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">False</span>)</span>
<span id="cb9-5"></span>
<span id="cb9-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Name columns</span></span>
<span id="cb9-7">tmp_df.columns <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"sex"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"age_lower"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"age_upper"</span>]</span>
<span id="cb9-8"></span>
<span id="cb9-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Create `age`column based on `age_lower` and `age_upper`</span></span>
<span id="cb9-10">tmp_df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"age"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> tmp_df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"age_lower"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"-"</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> tmp_df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"age_upper"</span>]</span>
<span id="cb9-11"></span>
<span id="cb9-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Merge</span></span>
<span id="cb9-13">df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.concat([df, tmp_df], axis<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb9-14"></span>
<span id="cb9-15"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Drop unnecessary columns and rows</span></span>
<span id="cb9-16">df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> df.drop([<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"sex_and_age"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"age_lower"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"age_upper"</span>], axis<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb9-17">df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> df.dropna()</span>
<span id="cb9-18">df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> df.sort_values(ascending<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>, by<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"country"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"year"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"sex"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"age"</span>])</span>
<span id="cb9-19">df.head(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="50">
<div>

<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">country</th>
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">cases</th>
<th data-quarto-table-cell-role="th">sex</th>
<th data-quarto-table-cell-role="th">age</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>AD</td>
<td>2000</td>
<td>0.0</td>
<td>m</td>
<td>0-14</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">10</td>
<td>AD</td>
<td>2000</td>
<td>0.0</td>
<td>m</td>
<td>15-24</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">20</td>
<td>AD</td>
<td>2000</td>
<td>1.0</td>
<td>m</td>
<td>25-34</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">30</td>
<td>AD</td>
<td>2000</td>
<td>0.0</td>
<td>m</td>
<td>35-44</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">40</td>
<td>AD</td>
<td>2000</td>
<td>0.0</td>
<td>m</td>
<td>45-54</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">50</td>
<td>AD</td>
<td>2000</td>
<td>0.0</td>
<td>m</td>
<td>55-64</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">81</td>
<td>AE</td>
<td>2000</td>
<td>3.0</td>
<td>f</td>
<td>0-14</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>AE</td>
<td>2000</td>
<td>2.0</td>
<td>m</td>
<td>0-14</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">11</td>
<td>AE</td>
<td>2000</td>
<td>4.0</td>
<td>m</td>
<td>15-24</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">21</td>
<td>AE</td>
<td>2000</td>
<td>4.0</td>
<td>m</td>
<td>25-34</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>이것이 정리된 결과 입니다.</p>
</section>
</section>
<section id="변수가-행과-열에rows-and-columns-모두-포함되어-있는-경우" class="level2">
<h2 class="anchored" data-anchor-id="변수가-행과-열에rows-and-columns-모두-포함되어-있는-경우">4. 변수가 행과 열에(rows and columns) 모두 포함되어 있는 경우</h2>
<section id="global-historical-climatology-network-dataset" class="level3">
<h3 class="anchored" data-anchor-id="global-historical-climatology-network-dataset">Global Historical Climatology Network Dataset</h3>
<p>이것은 2010년도 멕시코 기상청(MX17004)에서 5개월 동안 측정한 기상 데이터입니다.</p>
<div id="cell-28" class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1">df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.read_csv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"./data/weather-raw.csv"</span>)</span></code></pre></div>
</div>
<p><strong>문제점:</strong></p>
<ul>
<li>변수들이 행(<code>tmin</code>, <code>tmax</code>) 과 열(<code>days</code>)에 존재합니다.</li>
</ul>
<p>깔끔한 데이터를 만들기 위해 <code>melt</code>기능을 사용해 <code>day_raw</code>를 각각의 열로 만들겠습니다.</p>
<div id="cell-30" class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1">df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.melt(df, id_vars<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"id"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"year"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"month"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"element"</span>], var_name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"day_raw"</span>)</span>
<span id="cb11-2">df.head(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="25">
<div>

<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">id</th>
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">month</th>
<th data-quarto-table-cell-role="th">element</th>
<th data-quarto-table-cell-role="th">day_raw</th>
<th data-quarto-table-cell-role="th">value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>MX17004</td>
<td>2010</td>
<td>1</td>
<td>tmax</td>
<td>d1</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>MX17004</td>
<td>2010</td>
<td>1</td>
<td>tmin</td>
<td>d1</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>MX17004</td>
<td>2010</td>
<td>2</td>
<td>tmax</td>
<td>d1</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>MX17004</td>
<td>2010</td>
<td>2</td>
<td>tmin</td>
<td>d1</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>MX17004</td>
<td>2010</td>
<td>3</td>
<td>tmax</td>
<td>d1</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>MX17004</td>
<td>2010</td>
<td>3</td>
<td>tmin</td>
<td>d1</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>MX17004</td>
<td>2010</td>
<td>4</td>
<td>tmax</td>
<td>d1</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>MX17004</td>
<td>2010</td>
<td>4</td>
<td>tmin</td>
<td>d1</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>MX17004</td>
<td>2010</td>
<td>5</td>
<td>tmax</td>
<td>d1</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>MX17004</td>
<td>2010</td>
<td>5</td>
<td>tmin</td>
<td>d1</td>
<td>NaN</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>그럼에도 아직 불필요한 것들이 보이는 군요. 좀 더 깔끔한 데이터를 만들기 위해 <code>tmin</code>, <code>tmax</code>를 각각의 열로 만들겠습니다. 그리고 날짜 정보들을 합쳐서 <code>date</code>로 통합하겠습니다.</p>
<div id="cell-32" class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Extracting day</span></span>
<span id="cb12-2">df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"day"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"day_raw"</span>].<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>.extract(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"d(\d+)"</span>, expand<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">False</span>)</span>
<span id="cb12-3">df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"id"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"MX17004"</span></span>
<span id="cb12-4"></span>
<span id="cb12-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># To numeric values</span></span>
<span id="cb12-6">df[[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"year"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"month"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"day"</span>]] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> df[[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"year"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"month"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"day"</span>]].<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">apply</span>(</span>
<span id="cb12-7">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">lambda</span> x: pd.to_numeric(x, errors<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ignore"</span>)</span>
<span id="cb12-8">)</span>
<span id="cb12-9"></span>
<span id="cb12-10"></span>
<span id="cb12-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Creating a date from the different columns</span></span>
<span id="cb12-12"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> create_date_from_year_month_day(row):</span>
<span id="cb12-13">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> datetime.datetime(year<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>row[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"year"</span>], month<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">int</span>(row[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"month"</span>]), day<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>row[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"day"</span>])</span>
<span id="cb12-14"></span>
<span id="cb12-15"></span>
<span id="cb12-16">df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"date"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> df.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">apply</span>(<span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">lambda</span> row: create_date_from_year_month_day(row), axis<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb12-17">df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> df.drop([<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"year"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"month"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"day"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"day_raw"</span>], axis<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb12-18">df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> df.dropna()</span>
<span id="cb12-19"></span>
<span id="cb12-20"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Unmelting column "element"</span></span>
<span id="cb12-21">df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> df.pivot_table(index<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"id"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"date"</span>], columns<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"element"</span>, values<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"value"</span>)</span>
<span id="cb12-22">df.reset_index(drop<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">False</span>, inplace<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb12-23">df</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="26">
<div>

<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">element</th>
<th data-quarto-table-cell-role="th">id</th>
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th">tmax</th>
<th data-quarto-table-cell-role="th">tmin</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>MX17004</td>
<td>2010-02-02</td>
<td>27.3</td>
<td>14.4</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>MX17004</td>
<td>2010-02-03</td>
<td>24.1</td>
<td>14.4</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>MX17004</td>
<td>2010-03-05</td>
<td>32.1</td>
<td>14.2</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>충분히 깔끔한 모양새가 되었습니다.</p>
</section>
</section>
<section id="하나의-관측-단위observational-units가-여러-파일로-나누어져-있는-경우" class="level2">
<h2 class="anchored" data-anchor-id="하나의-관측-단위observational-units가-여러-파일로-나누어져-있는-경우">5. 하나의 관측 단위(observational units)가 여러 파일로 나누어져 있는 경우</h2>
<section id="baby-names-in-illinois" class="level3">
<h3 class="anchored" data-anchor-id="baby-names-in-illinois">Baby Names in Illinois</h3>
<p>2014, 2015년도 미국 일리노이 주(Illinois)의 신생아의 (남자)이름을 수집한 데이터 입니다.</p>
<p><strong>문제점:</strong></p>
<ul>
<li>여러 표와 파일에 데이터가 흩어져 있다.</li>
<li>연도(Year)”가 파일 이름에 적혀져 있다.</li>
</ul>
<p>서로 다른 파일에 데이터가 흩어져 있어 조금 복잡한 과정이 필요합니다. 먼저 아래의 코드로 파일 리스트를 만들고 거기에서 <em>연도</em> 값을 뽑아냅니다. 그런 다음 각각의 파일에서 표를 만들어내고 마지막으로 <code>concat</code>기능으로 사용해 하나의 표로 합치겠습니다.</p>
<div id="cell-35" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> extract_year(string):</span>
<span id="cb13-2">    match <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> re.match(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">".+(\d</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{4}</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">)"</span>, string)</span>
<span id="cb13-3">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> match <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">is</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">not</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>:</span>
<span id="cb13-4">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> match.group(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb13-5"></span>
<span id="cb13-6"></span>
<span id="cb13-7">path <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"./data"</span></span>
<span id="cb13-8">allFiles <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> glob.glob(path <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/201*-baby-names-illinois.csv"</span>)</span>
<span id="cb13-9">frame <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.DataFrame()</span>
<span id="cb13-10">df_list <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> []</span>
<span id="cb13-11"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> file_ <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> allFiles:</span>
<span id="cb13-12">    df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.read_csv(file_, index_col<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>, header<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb13-13">    df.columns <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">map</span>(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>.lower, df.columns)</span>
<span id="cb13-14">    df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"year"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> extract_year(file_)</span>
<span id="cb13-15">    df_list.append(df)</span>
<span id="cb13-16"></span>
<span id="cb13-17">df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.concat(df_list)</span>
<span id="cb13-18">df.head(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="5">
<div>

<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">rank</th>
<th data-quarto-table-cell-role="th">name</th>
<th data-quarto-table-cell-role="th">frequency</th>
<th data-quarto-table-cell-role="th">sex</th>
<th data-quarto-table-cell-role="th">year</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1</td>
<td>Noah</td>
<td>837</td>
<td>Male</td>
<td>2014</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2</td>
<td>Alexander</td>
<td>747</td>
<td>Male</td>
<td>2014</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>3</td>
<td>William</td>
<td>687</td>
<td>Male</td>
<td>2014</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>4</td>
<td>Michael</td>
<td>680</td>
<td>Male</td>
<td>2014</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>5</td>
<td>Liam</td>
<td>670</td>
<td>Male</td>
<td>2014</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
</section>
<section id="마치며" class="level2">
<h2 class="anchored" data-anchor-id="마치며">마치며</h2>
<p>이 글에서 가장 중점으로 둔것은 파이썬으로 지저분한 데이터를 깔끔하게 만드는 것이 었습니다. 그걸을 위해 <strong>Wickham</strong>의 논문에서 사용된 데이터를 살펴 보았죠. 깔끔한 데이터(Tidy data)의 최고의 장점은 <strong>시각화</strong>(Visualization)이 쉽다는 것에 있습니다. 그것은 다음에 다루어 보도록 하겠습니다.</p>
<p>앞으로는 <strong>Tidy data</strong>를 고려해서 데이터를 수집하도록 하세요. 모두의 시간은 소중하니까요.</p>


</section>
</section>

 ]]></description>
  <category>news</category>
  <category>python</category>
  <category>data science</category>
  <category>pandas</category>
  <guid>https://tomorrow-lab.github.io/posts/Tidydata/python_TidyData.html</guid>
  <pubDate>Mon, 02 Jan 2023 15:00:00 GMT</pubDate>
</item>
</channel>
</rss>
