<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.557">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Taeyoon Kim">
<meta name="dcterms.date" content="2024-09-28">

<title>tomorrow-lab - Rosalind Textbook track 문제풀이</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../favicon.ico" rel="icon">
<script src="../../site_libs/cookie-consent/cookie-consent.js"></script>
<link href="../../site_libs/cookie-consent/cookie-consent.css" rel="stylesheet">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-31EWCYNR0V"></script>

<script type="text/plain" cookie-consent="tracking">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-31EWCYNR0V', { 'anonymize_ip': true});
</script>

<script type="text/javascript" charset="UTF-8">
document.addEventListener('DOMContentLoaded', function () {
cookieconsent.run({
  "notice_banner_type":"simple",
  "consent_type":"implied",
  "palette":"light",
  "language":"en",
  "page_load_consent_levels":["strictly-necessary","functionality","tracking","targeting"],
  "notice_banner_reject_button_hide":false,
  "preferences_center_close_button_hide":false,
  "website_name":""
  ,
"language":"en"
  });
});
</script> 
  
<meta name="google-site-verification" content="z2S1Xqj9hfJiC31aNGCnOA1gYpL_8MoZpPI2avrWMvg">

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<meta property="og:title" content="tomorrow-lab - Rosalind Textbook track 문제풀이">
<meta property="og:description" content="The future of scientific discovery lies at the convergence of computational power and biological complexity. Our mission is to provide a platform where enthusiasts, researchers, and professionals can learn about and contribute to the rapidly evolving fields of bioinformatics, computational biology, and systems biology.">
<meta property="og:site_name" content="tomorrow-lab">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">tomorrow-lab</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../book.html"> 
<span class="menu-text">Book</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../resume.html"> 
<span class="menu-text">Resume</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://partrita.github.io"> <i class="bi bi-sign-do-not-enter" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/partrita"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/partrita"> <i class="bi bi-twitter-x" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar"><div class="quarto-margin-header"><div class="margin-header-item">
<div style="padding-bottom: 25px;">
    <script async="" src="https://eocampaign1.com/form/2616a818-1ef8-11ef-b372-4587d096212f.js" data-form="2616a818-1ef8-11ef-b372-4587d096212f"></script>
</div>
</div></div>
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#compute-the-number-of-times-a-pattern-appears-in-a-text" id="toc-compute-the-number-of-times-a-pattern-appears-in-a-text" class="nav-link active" data-scroll-target="#compute-the-number-of-times-a-pattern-appears-in-a-text"><span class="header-section-number">1</span> Compute the Number of Times a Pattern Appears in a Text</a>
  <ul class="collapse">
  <li><a href="#sample-dataset" id="toc-sample-dataset" class="nav-link" data-scroll-target="#sample-dataset"><span class="header-section-number">1.1</span> Sample Dataset</a></li>
  <li><a href="#sample-output" id="toc-sample-output" class="nav-link" data-scroll-target="#sample-output"><span class="header-section-number">1.2</span> Sample Output</a></li>
  <li><a href="#solution" id="toc-solution" class="nav-link" data-scroll-target="#solution"><span class="header-section-number">1.3</span> Solution</a></li>
  </ul></li>
  <li><a href="#find-the-most-frequent-words-in-a-string" id="toc-find-the-most-frequent-words-in-a-string" class="nav-link" data-scroll-target="#find-the-most-frequent-words-in-a-string"><span class="header-section-number">2</span> Find the Most Frequent Words in a String</a>
  <ul class="collapse">
  <li><a href="#sample-dataset-1" id="toc-sample-dataset-1" class="nav-link" data-scroll-target="#sample-dataset-1"><span class="header-section-number">2.1</span> Sample Dataset</a></li>
  <li><a href="#sample-output-1" id="toc-sample-output-1" class="nav-link" data-scroll-target="#sample-output-1"><span class="header-section-number">2.2</span> Sample Output</a></li>
  <li><a href="#solution-1" id="toc-solution-1" class="nav-link" data-scroll-target="#solution-1"><span class="header-section-number">2.3</span> Solution</a></li>
  </ul></li>
  <li><a href="#find-the-reverse-complement-of-a-string" id="toc-find-the-reverse-complement-of-a-string" class="nav-link" data-scroll-target="#find-the-reverse-complement-of-a-string"><span class="header-section-number">3</span> Find the Reverse Complement of a String</a>
  <ul class="collapse">
  <li><a href="#sample-dataset-2" id="toc-sample-dataset-2" class="nav-link" data-scroll-target="#sample-dataset-2"><span class="header-section-number">3.1</span> Sample Dataset</a></li>
  <li><a href="#sample-output-2" id="toc-sample-output-2" class="nav-link" data-scroll-target="#sample-output-2"><span class="header-section-number">3.2</span> Sample Output</a></li>
  <li><a href="#solution-2" id="toc-solution-2" class="nav-link" data-scroll-target="#solution-2"><span class="header-section-number">3.3</span> Solution</a></li>
  </ul></li>
  <li><a href="#find-all-occurrences-of-a-pattern-in-a-string" id="toc-find-all-occurrences-of-a-pattern-in-a-string" class="nav-link" data-scroll-target="#find-all-occurrences-of-a-pattern-in-a-string"><span class="header-section-number">4</span> Find All Occurrences of a Pattern in a String</a>
  <ul class="collapse">
  <li><a href="#sample-dataset-3" id="toc-sample-dataset-3" class="nav-link" data-scroll-target="#sample-dataset-3"><span class="header-section-number">4.1</span> Sample Dataset</a></li>
  <li><a href="#sample-output-3" id="toc-sample-output-3" class="nav-link" data-scroll-target="#sample-output-3"><span class="header-section-number">4.2</span> Sample Output</a></li>
  <li><a href="#solution-3" id="toc-solution-3" class="nav-link" data-scroll-target="#solution-3"><span class="header-section-number">4.3</span> Solution</a></li>
  </ul></li>
  <li><a href="#find-patterns-forming-clumps-in-a-string" id="toc-find-patterns-forming-clumps-in-a-string" class="nav-link" data-scroll-target="#find-patterns-forming-clumps-in-a-string"><span class="header-section-number">5</span> Find Patterns Forming Clumps in a String</a>
  <ul class="collapse">
  <li><a href="#sample-dataset-4" id="toc-sample-dataset-4" class="nav-link" data-scroll-target="#sample-dataset-4"><span class="header-section-number">5.1</span> Sample Dataset</a></li>
  <li><a href="#sample-output-4" id="toc-sample-output-4" class="nav-link" data-scroll-target="#sample-output-4"><span class="header-section-number">5.2</span> Sample Output</a></li>
  <li><a href="#solution-4" id="toc-solution-4" class="nav-link" data-scroll-target="#solution-4"><span class="header-section-number">5.3</span> Solution</a></li>
  </ul></li>
  <li><a href="#find-a-position-in-a-genome-minimizing-the-skew" id="toc-find-a-position-in-a-genome-minimizing-the-skew" class="nav-link" data-scroll-target="#find-a-position-in-a-genome-minimizing-the-skew"><span class="header-section-number">6</span> Find a Position in a Genome Minimizing the Skew</a>
  <ul class="collapse">
  <li><a href="#sample-dataset-5" id="toc-sample-dataset-5" class="nav-link" data-scroll-target="#sample-dataset-5"><span class="header-section-number">6.1</span> Sample Dataset</a></li>
  <li><a href="#sample-output-5" id="toc-sample-output-5" class="nav-link" data-scroll-target="#sample-output-5"><span class="header-section-number">6.2</span> Sample Output</a></li>
  <li><a href="#solution-5" id="toc-solution-5" class="nav-link" data-scroll-target="#solution-5"><span class="header-section-number">6.3</span> Solution</a></li>
  </ul></li>
  <li><a href="#compute-the-hamming-distance-between-two-strings" id="toc-compute-the-hamming-distance-between-two-strings" class="nav-link" data-scroll-target="#compute-the-hamming-distance-between-two-strings"><span class="header-section-number">7</span> Compute the Hamming Distance Between Two Strings</a>
  <ul class="collapse">
  <li><a href="#sample-dataset-6" id="toc-sample-dataset-6" class="nav-link" data-scroll-target="#sample-dataset-6"><span class="header-section-number">7.1</span> Sample Dataset</a></li>
  <li><a href="#sample-output-6" id="toc-sample-output-6" class="nav-link" data-scroll-target="#sample-output-6"><span class="header-section-number">7.2</span> Sample Output</a></li>
  <li><a href="#solution-6" id="toc-solution-6" class="nav-link" data-scroll-target="#solution-6"><span class="header-section-number">7.3</span> Solution</a></li>
  </ul></li>
  <li><a href="#find-all-approximate-occurrences-of-a-pattern-in-a-string" id="toc-find-all-approximate-occurrences-of-a-pattern-in-a-string" class="nav-link" data-scroll-target="#find-all-approximate-occurrences-of-a-pattern-in-a-string"><span class="header-section-number">8</span> Find All Approximate Occurrences of a Pattern in a String</a>
  <ul class="collapse">
  <li><a href="#sample-dataset-7" id="toc-sample-dataset-7" class="nav-link" data-scroll-target="#sample-dataset-7"><span class="header-section-number">8.1</span> Sample Dataset</a></li>
  <li><a href="#sample-output-7" id="toc-sample-output-7" class="nav-link" data-scroll-target="#sample-output-7"><span class="header-section-number">8.2</span> Sample Output</a></li>
  <li><a href="#solution-7" id="toc-solution-7" class="nav-link" data-scroll-target="#solution-7"><span class="header-section-number">8.3</span> Solution</a></li>
  </ul></li>
  <li><a href="#find-the-most-frequent-words-with-mismatches-in-a-string" id="toc-find-the-most-frequent-words-with-mismatches-in-a-string" class="nav-link" data-scroll-target="#find-the-most-frequent-words-with-mismatches-in-a-string"><span class="header-section-number">9</span> Find the Most Frequent Words with Mismatches in a String</a>
  <ul class="collapse">
  <li><a href="#sample-dataset-8" id="toc-sample-dataset-8" class="nav-link" data-scroll-target="#sample-dataset-8"><span class="header-section-number">9.1</span> Sample Dataset</a></li>
  <li><a href="#sample-output-8" id="toc-sample-output-8" class="nav-link" data-scroll-target="#sample-output-8"><span class="header-section-number">9.2</span> Sample Output</a></li>
  <li><a href="#solution-8" id="toc-solution-8" class="nav-link" data-scroll-target="#solution-8"><span class="header-section-number">9.3</span> Solution</a></li>
  </ul></li>
  <li><a href="#find-frequent-words-with-mismatches-and-reverse-complements" id="toc-find-frequent-words-with-mismatches-and-reverse-complements" class="nav-link" data-scroll-target="#find-frequent-words-with-mismatches-and-reverse-complements"><span class="header-section-number">10</span> Find Frequent Words with Mismatches and Reverse Complements</a>
  <ul class="collapse">
  <li><a href="#sample-dataset-9" id="toc-sample-dataset-9" class="nav-link" data-scroll-target="#sample-dataset-9"><span class="header-section-number">10.1</span> Sample Dataset</a></li>
  <li><a href="#sample-output-9" id="toc-sample-output-9" class="nav-link" data-scroll-target="#sample-output-9"><span class="header-section-number">10.2</span> Sample Output</a></li>
  <li><a href="#solution-9" id="toc-solution-9" class="nav-link" data-scroll-target="#solution-9"><span class="header-section-number">10.3</span> Solution</a></li>
  </ul></li>
  <li><a href="#generate-the-frequency-array-of-a-string" id="toc-generate-the-frequency-array-of-a-string" class="nav-link" data-scroll-target="#generate-the-frequency-array-of-a-string"><span class="header-section-number">11</span> Generate the Frequency Array of a String</a>
  <ul class="collapse">
  <li><a href="#sample-dataset-10" id="toc-sample-dataset-10" class="nav-link" data-scroll-target="#sample-dataset-10"><span class="header-section-number">11.1</span> Sample Dataset</a></li>
  <li><a href="#sample-output-10" id="toc-sample-output-10" class="nav-link" data-scroll-target="#sample-output-10"><span class="header-section-number">11.2</span> Sample Output</a></li>
  <li><a href="#solution-10" id="toc-solution-10" class="nav-link" data-scroll-target="#solution-10"><span class="header-section-number">11.3</span> Solution</a></li>
  </ul></li>
  <li><a href="#implement-patterntonumber" id="toc-implement-patterntonumber" class="nav-link" data-scroll-target="#implement-patterntonumber"><span class="header-section-number">12</span> Implement PatternToNumber</a>
  <ul class="collapse">
  <li><a href="#sample-dataset-11" id="toc-sample-dataset-11" class="nav-link" data-scroll-target="#sample-dataset-11"><span class="header-section-number">12.1</span> Sample Dataset</a></li>
  <li><a href="#sample-output-11" id="toc-sample-output-11" class="nav-link" data-scroll-target="#sample-output-11"><span class="header-section-number">12.2</span> Sample Output</a></li>
  <li><a href="#solution-11" id="toc-solution-11" class="nav-link" data-scroll-target="#solution-11"><span class="header-section-number">12.3</span> Solution</a></li>
  </ul></li>
  <li><a href="#implement-numbertopattern" id="toc-implement-numbertopattern" class="nav-link" data-scroll-target="#implement-numbertopattern"><span class="header-section-number">13</span> Implement NumberToPattern</a>
  <ul class="collapse">
  <li><a href="#sample-dataset-12" id="toc-sample-dataset-12" class="nav-link" data-scroll-target="#sample-dataset-12"><span class="header-section-number">13.1</span> Sample Dataset</a></li>
  <li><a href="#sample-output-12" id="toc-sample-output-12" class="nav-link" data-scroll-target="#sample-output-12"><span class="header-section-number">13.2</span> Sample Output</a></li>
  <li><a href="#solution-12" id="toc-solution-12" class="nav-link" data-scroll-target="#solution-12"><span class="header-section-number">13.3</span> Solution</a></li>
  </ul></li>
  <li><a href="#generate-the-d-neighborhood-of-a-string" id="toc-generate-the-d-neighborhood-of-a-string" class="nav-link" data-scroll-target="#generate-the-d-neighborhood-of-a-string"><span class="header-section-number">14</span> Generate the d-Neighborhood of a String</a>
  <ul class="collapse">
  <li><a href="#sample-dataset-13" id="toc-sample-dataset-13" class="nav-link" data-scroll-target="#sample-dataset-13"><span class="header-section-number">14.1</span> Sample Dataset</a></li>
  <li><a href="#sample-output-13" id="toc-sample-output-13" class="nav-link" data-scroll-target="#sample-output-13"><span class="header-section-number">14.2</span> Sample Output</a></li>
  <li><a href="#solution-13" id="toc-solution-13" class="nav-link" data-scroll-target="#solution-13"><span class="header-section-number">14.3</span> Solution</a></li>
  </ul></li>
  <li><a href="#compute-the-probability-of-a-hidden-path" id="toc-compute-the-probability-of-a-hidden-path" class="nav-link" data-scroll-target="#compute-the-probability-of-a-hidden-path"><span class="header-section-number">15</span> Compute the Probability of a Hidden Path</a>
  <ul class="collapse">
  <li><a href="#sample-dataset-14" id="toc-sample-dataset-14" class="nav-link" data-scroll-target="#sample-dataset-14"><span class="header-section-number">15.1</span> Sample Dataset</a></li>
  <li><a href="#sample-output-14" id="toc-sample-output-14" class="nav-link" data-scroll-target="#sample-output-14"><span class="header-section-number">15.2</span> Sample Output</a></li>
  <li><a href="#solution-14" id="toc-solution-14" class="nav-link" data-scroll-target="#solution-14"><span class="header-section-number">15.3</span> Solution</a></li>
  </ul></li>
  <li><a href="#compute-the-probability-of-an-outcome-given-a-hidden-path" id="toc-compute-the-probability-of-an-outcome-given-a-hidden-path" class="nav-link" data-scroll-target="#compute-the-probability-of-an-outcome-given-a-hidden-path"><span class="header-section-number">16</span> Compute the Probability of an Outcome Given a Hidden Path</a>
  <ul class="collapse">
  <li><a href="#sample-dataset-15" id="toc-sample-dataset-15" class="nav-link" data-scroll-target="#sample-dataset-15"><span class="header-section-number">16.1</span> Sample Dataset</a></li>
  <li><a href="#sample-output-15" id="toc-sample-output-15" class="nav-link" data-scroll-target="#sample-output-15"><span class="header-section-number">16.2</span> Sample Output</a></li>
  <li><a href="#solution-15" id="toc-solution-15" class="nav-link" data-scroll-target="#solution-15"><span class="header-section-number">16.3</span> Solution</a></li>
  </ul></li>
  <li><a href="#implement-the-viterbi-algorithm" id="toc-implement-the-viterbi-algorithm" class="nav-link" data-scroll-target="#implement-the-viterbi-algorithm"><span class="header-section-number">17</span> Implement the Viterbi Algorithm</a>
  <ul class="collapse">
  <li><a href="#sample-dataset-16" id="toc-sample-dataset-16" class="nav-link" data-scroll-target="#sample-dataset-16"><span class="header-section-number">17.1</span> Sample Dataset</a></li>
  <li><a href="#sample-output-16" id="toc-sample-output-16" class="nav-link" data-scroll-target="#sample-output-16"><span class="header-section-number">17.2</span> Sample Output</a></li>
  <li><a href="#solution-16" id="toc-solution-16" class="nav-link" data-scroll-target="#solution-16"><span class="header-section-number">17.3</span> Solution</a></li>
  </ul></li>
  <li><a href="#compute-the-probability-of-a-string-emitted-by-an-hmm" id="toc-compute-the-probability-of-a-string-emitted-by-an-hmm" class="nav-link" data-scroll-target="#compute-the-probability-of-a-string-emitted-by-an-hmm"><span class="header-section-number">18</span> Compute the Probability of a String Emitted by an HMM</a>
  <ul class="collapse">
  <li><a href="#sample-dataset-17" id="toc-sample-dataset-17" class="nav-link" data-scroll-target="#sample-dataset-17"><span class="header-section-number">18.1</span> Sample Dataset</a></li>
  <li><a href="#sample-output-17" id="toc-sample-output-17" class="nav-link" data-scroll-target="#sample-output-17"><span class="header-section-number">18.2</span> Sample Output</a></li>
  <li><a href="#solution-17" id="toc-solution-17" class="nav-link" data-scroll-target="#solution-17"><span class="header-section-number">18.3</span> Solution</a></li>
  </ul></li>
  <li><a href="#construct-a-profile-hmm" id="toc-construct-a-profile-hmm" class="nav-link" data-scroll-target="#construct-a-profile-hmm"><span class="header-section-number">19</span> Construct a Profile HMM</a>
  <ul class="collapse">
  <li><a href="#sample-dataset-18" id="toc-sample-dataset-18" class="nav-link" data-scroll-target="#sample-dataset-18"><span class="header-section-number">19.1</span> Sample Dataset</a></li>
  <li><a href="#sample-output-18" id="toc-sample-output-18" class="nav-link" data-scroll-target="#sample-output-18"><span class="header-section-number">19.2</span> Sample Output</a></li>
  <li><a href="#solution-18" id="toc-solution-18" class="nav-link" data-scroll-target="#solution-18"><span class="header-section-number">19.3</span> Solution</a></li>
  </ul></li>
  <li><a href="#construct-a-profile-hmm-with-pseudocounts" id="toc-construct-a-profile-hmm-with-pseudocounts" class="nav-link" data-scroll-target="#construct-a-profile-hmm-with-pseudocounts"><span class="header-section-number">20</span> Construct a Profile HMM with Pseudocounts</a>
  <ul class="collapse">
  <li><a href="#sample-dataset-19" id="toc-sample-dataset-19" class="nav-link" data-scroll-target="#sample-dataset-19"><span class="header-section-number">20.1</span> Sample Dataset</a></li>
  <li><a href="#sample-output-19" id="toc-sample-output-19" class="nav-link" data-scroll-target="#sample-output-19"><span class="header-section-number">20.2</span> Sample Output</a></li>
  <li><a href="#solution-19" id="toc-solution-19" class="nav-link" data-scroll-target="#solution-19"><span class="header-section-number">20.3</span> Solution</a></li>
  </ul></li>
  <li><a href="#perform-a-multiple-sequence-alignment-with-a-profile-hmm" id="toc-perform-a-multiple-sequence-alignment-with-a-profile-hmm" class="nav-link" data-scroll-target="#perform-a-multiple-sequence-alignment-with-a-profile-hmm"><span class="header-section-number">21</span> Perform a Multiple Sequence Alignment with a Profile HMM</a>
  <ul class="collapse">
  <li><a href="#sample-dataset-20" id="toc-sample-dataset-20" class="nav-link" data-scroll-target="#sample-dataset-20"><span class="header-section-number">21.1</span> Sample Dataset</a></li>
  <li><a href="#sample-output-20" id="toc-sample-output-20" class="nav-link" data-scroll-target="#sample-output-20"><span class="header-section-number">21.2</span> Sample Output</a></li>
  <li><a href="#solution-20" id="toc-solution-20" class="nav-link" data-scroll-target="#solution-20"><span class="header-section-number">21.3</span> Solution</a></li>
  </ul></li>
  <li><a href="#estimate-the-parameters-of-an-hmm" id="toc-estimate-the-parameters-of-an-hmm" class="nav-link" data-scroll-target="#estimate-the-parameters-of-an-hmm"><span class="header-section-number">22</span> Estimate the Parameters of an HMM</a>
  <ul class="collapse">
  <li><a href="#sample-dataset-21" id="toc-sample-dataset-21" class="nav-link" data-scroll-target="#sample-dataset-21"><span class="header-section-number">22.1</span> Sample Dataset</a></li>
  <li><a href="#sample-output-21" id="toc-sample-output-21" class="nav-link" data-scroll-target="#sample-output-21"><span class="header-section-number">22.2</span> Sample Output</a></li>
  <li><a href="#solution-21" id="toc-solution-21" class="nav-link" data-scroll-target="#solution-21"><span class="header-section-number">22.3</span> Solution</a></li>
  </ul></li>
  <li><a href="#implement-viterbi-learning" id="toc-implement-viterbi-learning" class="nav-link" data-scroll-target="#implement-viterbi-learning"><span class="header-section-number">23</span> Implement Viterbi Learning</a>
  <ul class="collapse">
  <li><a href="#sample-dataset-22" id="toc-sample-dataset-22" class="nav-link" data-scroll-target="#sample-dataset-22"><span class="header-section-number">23.1</span> Sample Dataset</a></li>
  <li><a href="#sample-output-22" id="toc-sample-output-22" class="nav-link" data-scroll-target="#sample-output-22"><span class="header-section-number">23.2</span> Sample Output</a></li>
  <li><a href="#solution-22" id="toc-solution-22" class="nav-link" data-scroll-target="#solution-22"><span class="header-section-number">23.3</span> Solution</a></li>
  </ul></li>
  <li><a href="#solve-the-soft-decoding-problem" id="toc-solve-the-soft-decoding-problem" class="nav-link" data-scroll-target="#solve-the-soft-decoding-problem"><span class="header-section-number">24</span> Solve the Soft Decoding Problem</a>
  <ul class="collapse">
  <li><a href="#sample-dataset-23" id="toc-sample-dataset-23" class="nav-link" data-scroll-target="#sample-dataset-23"><span class="header-section-number">24.1</span> Sample Dataset</a></li>
  <li><a href="#sample-output-23" id="toc-sample-output-23" class="nav-link" data-scroll-target="#sample-output-23"><span class="header-section-number">24.2</span> Sample Output</a></li>
  <li><a href="#solution-23" id="toc-solution-23" class="nav-link" data-scroll-target="#solution-23"><span class="header-section-number">24.3</span> Solution</a></li>
  </ul></li>
  <li><a href="#implement-baum-welch-learning" id="toc-implement-baum-welch-learning" class="nav-link" data-scroll-target="#implement-baum-welch-learning"><span class="header-section-number">25</span> Implement Baum-Welch Learning</a>
  <ul class="collapse">
  <li><a href="#sample-dataset-24" id="toc-sample-dataset-24" class="nav-link" data-scroll-target="#sample-dataset-24"><span class="header-section-number">25.1</span> Sample Dataset</a></li>
  <li><a href="#sample-output-24" id="toc-sample-output-24" class="nav-link" data-scroll-target="#sample-output-24"><span class="header-section-number">25.2</span> Sample Output</a></li>
  <li><a href="#solution-24" id="toc-solution-24" class="nav-link" data-scroll-target="#solution-24"><span class="header-section-number">25.3</span> Solution</a></li>
  </ul></li>
  <li><a href="#construct-the-graph-of-a-spectrum" id="toc-construct-the-graph-of-a-spectrum" class="nav-link" data-scroll-target="#construct-the-graph-of-a-spectrum"><span class="header-section-number">26</span> Construct the Graph of a Spectrum</a>
  <ul class="collapse">
  <li><a href="#spectrum-graph-construction" id="toc-spectrum-graph-construction" class="nav-link" data-scroll-target="#spectrum-graph-construction"><span class="header-section-number">26.1</span> Spectrum Graph Construction</a></li>
  <li><a href="#sample-dataset-25" id="toc-sample-dataset-25" class="nav-link" data-scroll-target="#sample-dataset-25"><span class="header-section-number">26.2</span> Sample Dataset</a></li>
  <li><a href="#sample-output-25" id="toc-sample-output-25" class="nav-link" data-scroll-target="#sample-output-25"><span class="header-section-number">26.3</span> Sample Output</a></li>
  <li><a href="#solution-25" id="toc-solution-25" class="nav-link" data-scroll-target="#solution-25"><span class="header-section-number">26.4</span> Solution</a></li>
  </ul></li>
  <li><a href="#implement-motifenumeration" id="toc-implement-motifenumeration" class="nav-link" data-scroll-target="#implement-motifenumeration"><span class="header-section-number">27</span> Implement MotifEnumeration</a>
  <ul class="collapse">
  <li><a href="#sample-dataset-26" id="toc-sample-dataset-26" class="nav-link" data-scroll-target="#sample-dataset-26"><span class="header-section-number">27.1</span> Sample Dataset</a></li>
  <li><a href="#sample-output-26" id="toc-sample-output-26" class="nav-link" data-scroll-target="#sample-output-26"><span class="header-section-number">27.2</span> Sample Output</a></li>
  <li><a href="#solution-26" id="toc-solution-26" class="nav-link" data-scroll-target="#solution-26"><span class="header-section-number">27.3</span> Solution</a></li>
  </ul></li>
  <li><a href="#find-a-median-string" id="toc-find-a-median-string" class="nav-link" data-scroll-target="#find-a-median-string"><span class="header-section-number">28</span> Find a Median String</a>
  <ul class="collapse">
  <li><a href="#sample-dataset-27" id="toc-sample-dataset-27" class="nav-link" data-scroll-target="#sample-dataset-27"><span class="header-section-number">28.1</span> Sample Dataset</a></li>
  <li><a href="#sample-output-27" id="toc-sample-output-27" class="nav-link" data-scroll-target="#sample-output-27"><span class="header-section-number">28.2</span> Sample Output</a></li>
  <li><a href="#solution-27" id="toc-solution-27" class="nav-link" data-scroll-target="#solution-27"><span class="header-section-number">28.3</span> Solution</a></li>
  </ul></li>
  <li><a href="#find-a-profile-most-probable-k-mer-in-a-string" id="toc-find-a-profile-most-probable-k-mer-in-a-string" class="nav-link" data-scroll-target="#find-a-profile-most-probable-k-mer-in-a-string"><span class="header-section-number">29</span> Find a Profile-most Probable k-mer in a String</a>
  <ul class="collapse">
  <li><a href="#sample-dataset-28" id="toc-sample-dataset-28" class="nav-link" data-scroll-target="#sample-dataset-28"><span class="header-section-number">29.1</span> Sample Dataset</a></li>
  <li><a href="#sample-output-28" id="toc-sample-output-28" class="nav-link" data-scroll-target="#sample-output-28"><span class="header-section-number">29.2</span> Sample Output</a></li>
  <li><a href="#solution-28" id="toc-solution-28" class="nav-link" data-scroll-target="#solution-28"><span class="header-section-number">29.3</span> Solution</a></li>
  </ul></li>
  <li><a href="#implement-greedymotifsearch" id="toc-implement-greedymotifsearch" class="nav-link" data-scroll-target="#implement-greedymotifsearch"><span class="header-section-number">30</span> Implement GreedyMotifSearch</a>
  <ul class="collapse">
  <li><a href="#sample-dataset-29" id="toc-sample-dataset-29" class="nav-link" data-scroll-target="#sample-dataset-29"><span class="header-section-number">30.1</span> Sample Dataset</a></li>
  <li><a href="#sample-output-29" id="toc-sample-output-29" class="nav-link" data-scroll-target="#sample-output-29"><span class="header-section-number">30.2</span> Sample Output</a></li>
  <li><a href="#solution-29" id="toc-solution-29" class="nav-link" data-scroll-target="#solution-29"><span class="header-section-number">30.3</span> Solution</a></li>
  </ul></li>
  <li><a href="#implement-greedymotifsearch-with-pseudocounts" id="toc-implement-greedymotifsearch-with-pseudocounts" class="nav-link" data-scroll-target="#implement-greedymotifsearch-with-pseudocounts"><span class="header-section-number">31</span> Implement GreedyMotifSearch with Pseudocounts</a>
  <ul class="collapse">
  <li><a href="#sample-dataset-30" id="toc-sample-dataset-30" class="nav-link" data-scroll-target="#sample-dataset-30"><span class="header-section-number">31.1</span> Sample Dataset</a></li>
  <li><a href="#sample-output-30" id="toc-sample-output-30" class="nav-link" data-scroll-target="#sample-output-30"><span class="header-section-number">31.2</span> Sample Output</a></li>
  <li><a href="#solution-30" id="toc-solution-30" class="nav-link" data-scroll-target="#solution-30"><span class="header-section-number">31.3</span> Solution</a></li>
  </ul></li>
  <li><a href="#implement-randomizedmotifsearch" id="toc-implement-randomizedmotifsearch" class="nav-link" data-scroll-target="#implement-randomizedmotifsearch"><span class="header-section-number">32</span> Implement RandomizedMotifSearch</a>
  <ul class="collapse">
  <li><a href="#sample-dataset-31" id="toc-sample-dataset-31" class="nav-link" data-scroll-target="#sample-dataset-31"><span class="header-section-number">32.1</span> Sample Dataset</a></li>
  <li><a href="#sample-output-31" id="toc-sample-output-31" class="nav-link" data-scroll-target="#sample-output-31"><span class="header-section-number">32.2</span> Sample Output</a></li>
  <li><a href="#solution-31" id="toc-solution-31" class="nav-link" data-scroll-target="#solution-31"><span class="header-section-number">32.3</span> Solution</a></li>
  </ul></li>
  <li><a href="#implement-gibbssampler" id="toc-implement-gibbssampler" class="nav-link" data-scroll-target="#implement-gibbssampler"><span class="header-section-number">33</span> Implement GibbsSampler</a>
  <ul class="collapse">
  <li><a href="#sample-dataset-32" id="toc-sample-dataset-32" class="nav-link" data-scroll-target="#sample-dataset-32"><span class="header-section-number">33.1</span> Sample Dataset</a></li>
  <li><a href="#sample-output-32" id="toc-sample-output-32" class="nav-link" data-scroll-target="#sample-output-32"><span class="header-section-number">33.2</span> Sample Output</a></li>
  <li><a href="#solution-32" id="toc-solution-32" class="nav-link" data-scroll-target="#solution-32"><span class="header-section-number">33.3</span> Solution</a></li>
  </ul></li>
  <li><a href="#implement-distancebetweenpatternandstrings" id="toc-implement-distancebetweenpatternandstrings" class="nav-link" data-scroll-target="#implement-distancebetweenpatternandstrings"><span class="header-section-number">34</span> Implement DistanceBetweenPatternAndStrings</a>
  <ul class="collapse">
  <li><a href="#sample-dataset-33" id="toc-sample-dataset-33" class="nav-link" data-scroll-target="#sample-dataset-33"><span class="header-section-number">34.1</span> Sample Dataset</a></li>
  <li><a href="#sample-output-33" id="toc-sample-output-33" class="nav-link" data-scroll-target="#sample-output-33"><span class="header-section-number">34.2</span> Sample Output</a></li>
  <li><a href="#solution-33" id="toc-solution-33" class="nav-link" data-scroll-target="#solution-33"><span class="header-section-number">34.3</span> Solution</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Rosalind Textbook track 문제풀이</h1>
  <div class="quarto-categories">
    <div class="quarto-category">Python</div>
    <div class="quarto-category">Rosalind</div>
    <div class="quarto-category">Bioinformatics</div>
    <div class="quarto-category">Tip</div>
  </div>
  </div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Taeyoon Kim </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">September 28, 2024</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Rosalind_textbookTrack.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%"></p>
</figure>
</div>
<p>Phillip Compeau 와 Pavel Pevzner 가 쓴 책 “<a href="https://www.bioinformaticsalgorithms.org/">능동적 접근 방식의 생물정보학 알고리즘</a>” 에서 제공되는 연습 문제 모음입니다.</p>
<p><a href="https://rosalind.info/">Rosalind</a> 는 <a href="http://projecteuler.net/">프로젝트 오일러</a>, <a href="http://code.google.com/codejam">구글 코드 잼</a> 에서 영감을 얻었습니다. 이 프로젝트의 이름은 DNA 이중나선을 발견하는 데 기여한 <a href="http://en.wikipedia.org/wiki/Rosalind_Franklin">로잘린드 프랭클린</a> 에서 따왔습니다. Rosalind 는 프로그래밍 실력을 키우고자 하는 생물학자와 분자생물학의 계산 문제를 접해본 적이 없는 프로그래머들에게 도움이 될 것입니다.</p>
<section id="compute-the-number-of-times-a-pattern-appears-in-a-text" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Compute the Number of Times a Pattern Appears in a Text</h1>
<p>This is the first problem in a collection of “code challenges” to accompany&nbsp;<a href="http://bioinformaticsalgorithms.org/">Bioinformatics Algorithms: An Active-Learning Approach</a>&nbsp;by Phillip Compeau &amp; Pavel Pevzner.</p>
<p>A&nbsp;<a href="https://rosalind.info/glossary/k-mer/">k-mer</a>&nbsp;is a&nbsp;<a href="https://rosalind.info/glossary/string/">string</a>&nbsp;of length&nbsp;<em>k</em>. We define&nbsp;<em>Count</em>(<em>Text</em>,&nbsp;<em>Pattern</em>) as the number of times that a&nbsp;<em>k</em>-mer&nbsp;<em>Pattern</em>&nbsp;appears as a&nbsp;<a href="https://rosalind.info/glossary/substring/">substring</a>&nbsp;of&nbsp;<em>Text</em>.</p>
<p>For example, We note that&nbsp;<span class="math inline">\(Count(CGATATATCCATAGCGATATATCCATAG,ATAATA)\)</span> is equal to 3 (not 2) since we should account for overlapping occurrences of&nbsp;<em>Pattern</em>&nbsp;in&nbsp;<em>Text</em>.</p>
<p>Given:&nbsp;{DNA strings}}&nbsp;<em>Text</em>&nbsp;and&nbsp;<em>Pattern</em>.</p>
<p>Return:&nbsp;<em>Count</em>(<em>Text</em>,&nbsp;<em>Pattern</em>).</p>
<section id="sample-dataset" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="sample-dataset"><span class="header-section-number">1.1</span> Sample Dataset</h2>
<pre><code>GCGCG
GCG</code></pre>
</section>
<section id="sample-output" class="level2" data-number="1.2">
<h2 data-number="1.2" class="anchored" data-anchor-id="sample-output"><span class="header-section-number">1.2</span> Sample Output</h2>
<pre><code>2</code></pre>
</section>
<section id="solution" class="level2" data-number="1.3">
<h2 data-number="1.3" class="anchored" data-anchor-id="solution"><span class="header-section-number">1.3</span> Solution</h2>
<div class="sourceCode" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> typing <span class="im">import</span> Generator</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> generate_substrings(text: <span class="bu">str</span>, size: <span class="bu">int</span>) <span class="op">-&gt;</span> Generator[<span class="bu">str</span>, <span class="va">None</span>, <span class="va">None</span>]:</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Generate all substrings of a given size from the text."""</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(text) <span class="op">-</span> size <span class="op">+</span> <span class="dv">1</span>):</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">yield</span> text[i:i <span class="op">+</span> size]</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> count_pattern_occurrences(text: <span class="bu">str</span>, pattern: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="bu">int</span>:</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Count how many times the pattern occurs in the text."""</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">sum</span>(pattern <span class="op">==</span> substring <span class="cf">for</span> substring <span class="kw">in</span> generate_substrings(text, <span class="bu">len</span>(pattern)))</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Sample input</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>sample_input <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a><span class="st">GCGCG</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a><span class="st">GCG</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Split input into text and pattern</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>text, pattern <span class="op">=</span> sample_input.strip().split(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the count of pattern occurrences in text</span></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(count_pattern_occurrences(text, pattern))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="find-the-most-frequent-words-in-a-string" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Find the Most Frequent Words in a String</h1>
<p>We say that&nbsp;<em>Pattern</em>&nbsp;is a&nbsp;<strong>most frequent&nbsp;k-mer</strong>&nbsp;in&nbsp;<em>Text</em>&nbsp;if it maximizes&nbsp;<em>Count</em>(<em>Text</em>,&nbsp;<em>Pattern</em>) among all&nbsp;<a href="https://rosalind.info/glossary/k-mer/">k-mers</a>. For example, “ACTAT” is a most frequent 5-mer in “ACAACTATGCATCACTATCGGGAACTATCCT”, and “ATA” is a most frequent 3-mer of “CGATATATCCATAG”.</p>
<p>Given:&nbsp;A&nbsp;<a href="https://rosalind.info/glossary/dna-string/">DNA string</a>&nbsp;<em>Text</em>&nbsp;and an integer&nbsp;<em>k</em>.</p>
<p>Return:&nbsp;All most frequent&nbsp;<em>k</em>-mers in&nbsp;<em>Text</em>&nbsp;(in any order).</p>
<section id="sample-dataset-1" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="sample-dataset-1"><span class="header-section-number">2.1</span> Sample Dataset</h2>
<pre><code>ACGTTGCATGTCGCATGATGCATGAGAGCT
4</code></pre>
</section>
<section id="sample-output-1" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="sample-output-1"><span class="header-section-number">2.2</span> Sample Output</h2>
<pre><code>CATG GCAT</code></pre>
</section>
<section id="solution-1" class="level2" data-number="2.3">
<h2 data-number="2.3" class="anchored" data-anchor-id="solution-1"><span class="header-section-number">2.3</span> Solution</h2>
<div class="sourceCode" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> typing <span class="im">import</span> List, Dict, Tuple</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> collections <span class="im">import</span> defaultdict</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> generate_substrings(text: <span class="bu">str</span>, size: <span class="bu">int</span>) <span class="op">-&gt;</span> List[<span class="bu">str</span>]:</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Generate all substrings of a given size from the text."""</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> [text[i:i <span class="op">+</span> size] <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(text) <span class="op">-</span> size <span class="op">+</span> <span class="dv">1</span>)]</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> count_kmers(text: <span class="bu">str</span>, k: <span class="bu">int</span>) <span class="op">-&gt;</span> Dict[<span class="bu">str</span>, <span class="bu">int</span>]:</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Count occurrences of each k-mer in the text."""</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>    kmer_counts <span class="op">=</span> defaultdict(<span class="bu">int</span>)</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> kmer <span class="kw">in</span> generate_substrings(text, k):</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>        kmer_counts[kmer] <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> kmer_counts</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> most_frequent_kmers(kmer_counts: Dict[<span class="bu">str</span>, <span class="bu">int</span>]) <span class="op">-&gt;</span> List[<span class="bu">str</span>]:</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Find the most frequent k-mers."""</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>    max_count <span class="op">=</span> <span class="bu">max</span>(kmer_counts.values())</span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> [kmer <span class="cf">for</span> kmer, count <span class="kw">in</span> kmer_counts.items() <span class="cf">if</span> count <span class="op">==</span> max_count]</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Sample input</span></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>sample_input <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a><span class="st">ACGTTGCATGTCGCATGATGCATGAGAGCT</span></span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a><span class="st">4</span></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Split input into text and pattern size</span></span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>text, k <span class="op">=</span> sample_input.strip().split(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)</span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>k <span class="op">=</span> <span class="bu">int</span>(k)</span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Find and print the most frequent k-mers</span></span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a>most_frequent <span class="op">=</span> most_frequent_kmers(count_kmers(text, k))</span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="op">*</span>most_frequent)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="find-the-reverse-complement-of-a-string" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Find the Reverse Complement of a String</h1>
<p>Find the reverse complement of a DNA string.</p>
<p>Given:&nbsp;A DNA string&nbsp;<em>Pattern</em>.</p>
<p>Return:&nbsp;<span class="math inline">\(\overline{Pattern}\)</span>, the reverse complement of&nbsp;<em>Pattern</em>.</p>
<section id="sample-dataset-2" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="sample-dataset-2"><span class="header-section-number">3.1</span> Sample Dataset</h2>
<pre><code>AAAACCCGGT</code></pre>
</section>
<section id="sample-output-2" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="sample-output-2"><span class="header-section-number">3.2</span> Sample Output</h2>
<pre><code>ACCGGGTTTT</code></pre>
</section>
<section id="solution-2" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="solution-2"><span class="header-section-number">3.3</span> Solution</h2>
<div class="sourceCode" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> reverse_complement(seq: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Return the reverse complement of a DNA sequence."""</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> seq[::<span class="op">-</span><span class="dv">1</span>].translate(<span class="bu">str</span>.maketrans(<span class="st">"ACGT"</span>, <span class="st">"TGCA"</span>))</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Sample input</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>sample_input <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="st">AAAACCCGGT</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Process the input and print the reverse complement</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>sequence <span class="op">=</span> sample_input.strip().split()[<span class="dv">0</span>]</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(reverse_complement(sequence))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="find-all-occurrences-of-a-pattern-in-a-string" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Find All Occurrences of a Pattern in a String</h1>
<p>Pattern Matching Problem, Find all occurrences of a pattern in a string.</p>
<p>Given:&nbsp;Strings&nbsp;<em>Pattern</em>&nbsp;and&nbsp;<em>Genome</em>.</p>
<p>Return:&nbsp;All starting positions in&nbsp;<em>Genome</em>&nbsp;where&nbsp;<em>Pattern</em>&nbsp;appears as a substring. Use&nbsp;<a href="https://rosalind.info/glossary/0-based-numbering/">0-based indexing</a>.</p>
<section id="sample-dataset-3" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="sample-dataset-3"><span class="header-section-number">4.1</span> Sample Dataset</h2>
<pre><code>ATAT
GATATATGCATATACTT</code></pre>
</section>
<section id="sample-output-3" class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="sample-output-3"><span class="header-section-number">4.2</span> Sample Output</h2>
<pre><code>1 3 9</code></pre>
</section>
<section id="solution-3" class="level2" data-number="4.3">
<h2 data-number="4.3" class="anchored" data-anchor-id="solution-3"><span class="header-section-number">4.3</span> Solution</h2>
<div class="sourceCode" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> typing <span class="im">import</span> List, Generator</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> generate_substrings(text: <span class="bu">str</span>, size: <span class="bu">int</span>) <span class="op">-&gt;</span> List[<span class="bu">str</span>]:</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Generate all substrings of a given size from the text."""</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> [text[i:i <span class="op">+</span> size] <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(text) <span class="op">-</span> size <span class="op">+</span> <span class="dv">1</span>)]</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> find_pattern_indices(text: <span class="bu">str</span>, pattern: <span class="bu">str</span>) <span class="op">-&gt;</span> Generator[<span class="bu">int</span>, <span class="va">None</span>, <span class="va">None</span>]:</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Yield starting indices where the pattern is found in the text."""</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, substring <span class="kw">in</span> <span class="bu">enumerate</span>(generate_substrings(text, <span class="bu">len</span>(pattern))):</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> substring <span class="op">==</span> pattern:</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>            <span class="cf">yield</span> i</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Sample input</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>sample_input <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a><span class="st">ATAT</span></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a><span class="st">GATATATGCATATACTT</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Split input into pattern and text</span></span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>pattern, text <span class="op">=</span> sample_input.strip().split(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Print indices where the pattern is found</span></span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="op">*</span>find_pattern_indices(text, pattern))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="find-patterns-forming-clumps-in-a-string" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> Find Patterns Forming Clumps in a String</h1>
<p>Clump Finding Problem, Find patterns forming clumps in a string.</p>
<p>Given:&nbsp;A string&nbsp;<em>Genome</em>, and integers&nbsp;<em>k</em>,&nbsp;<em>L</em>, and&nbsp;<em>t</em>.</p>
<p>Return:&nbsp;All distinct&nbsp;<em>k</em>-mers forming (<em>L</em>,&nbsp;<em>t</em>)-clumps in&nbsp;<em>Genome</em>.</p>
<section id="sample-dataset-4" class="level2" data-number="5.1">
<h2 data-number="5.1" class="anchored" data-anchor-id="sample-dataset-4"><span class="header-section-number">5.1</span> Sample Dataset</h2>
<pre><code>CGGACTCGACAGATGTGAAGAAATGTGAAGACTGAGTGAAGAGAAGAGGAAACACGACACGACATTGCGACATAATGTACGAATGTAATGTGCCTATGGC
5 75 4</code></pre>
</section>
<section id="sample-output-4" class="level2" data-number="5.2">
<h2 data-number="5.2" class="anchored" data-anchor-id="sample-output-4"><span class="header-section-number">5.2</span> Sample Output</h2>
<pre><code>CGACA GAAGA AATGT</code></pre>
</section>
<section id="solution-4" class="level2" data-number="5.3">
<h2 data-number="5.3" class="anchored" data-anchor-id="solution-4"><span class="header-section-number">5.3</span> Solution</h2>
<div class="sourceCode" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> collections <span class="im">import</span> defaultdict</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> typing <span class="im">import</span> List, Dict</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> generate_substrings(text: <span class="bu">str</span>, size: <span class="bu">int</span>) <span class="op">-&gt;</span> List[<span class="bu">str</span>]:</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Generate all substrings of a given size from the text."""</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> [text[i:i <span class="op">+</span> size] <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(text) <span class="op">-</span> size <span class="op">+</span> <span class="dv">1</span>)]</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> find_kmers(text: <span class="bu">str</span>, k: <span class="bu">int</span>) <span class="op">-&gt;</span> Dict[<span class="bu">str</span>, List[<span class="bu">int</span>]]:</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Find positions of k-length kmers within the text."""</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>    kmer_positions <span class="op">=</span> defaultdict(<span class="bu">list</span>)</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, substring <span class="kw">in</span> <span class="bu">enumerate</span>(generate_substrings(text, k)):</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>        kmer_positions[substring].append(i)</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> kmer_positions</span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> has_clump(positions: List[<span class="bu">int</span>], L: <span class="bu">int</span>, t: <span class="bu">int</span>, k: <span class="bu">int</span>) <span class="op">-&gt;</span> <span class="bu">bool</span>:</span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Check if a given array of kmers at positions forms a clump of t within L."""</span></span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(positions) <span class="op">-</span> t <span class="op">+</span> <span class="dv">1</span>):</span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (positions[i <span class="op">+</span> t <span class="op">-</span> <span class="dv">1</span>] <span class="op">+</span> k <span class="op">-</span> positions[i]) <span class="op">&lt;=</span> L:</span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">True</span></span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="va">False</span></span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Sample input</span></span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a>sample_input <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a><span class="st">CGGACTCGACAGATGTGAAGAAATGTGAAGACTGAGTGAAGAGAAGAGGAAACACGACACGACATTGCGACATAATGTACGAATGTAATGTGCCTATGGC</span></span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a><span class="st">5 75 4</span></span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-28"><a href="#cb15-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Split input into sequence and parameters</span></span>
<span id="cb15-29"><a href="#cb15-29" aria-hidden="true" tabindex="-1"></a>seq, params <span class="op">=</span> sample_input.strip().split(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)</span>
<span id="cb15-30"><a href="#cb15-30" aria-hidden="true" tabindex="-1"></a>k, L, t <span class="op">=</span> <span class="bu">map</span>(<span class="bu">int</span>, params.split())</span>
<span id="cb15-31"><a href="#cb15-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-32"><a href="#cb15-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Find kmers and print those forming clumps</span></span>
<span id="cb15-33"><a href="#cb15-33" aria-hidden="true" tabindex="-1"></a>kmers <span class="op">=</span> find_kmers(seq, k)</span>
<span id="cb15-34"><a href="#cb15-34" aria-hidden="true" tabindex="-1"></a>clumps <span class="op">=</span> [kmer <span class="cf">for</span> kmer <span class="kw">in</span> kmers <span class="cf">if</span> has_clump(kmers[kmer], L, t, k)]</span>
<span id="cb15-35"><a href="#cb15-35" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="op">*</span>clumps)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="find-a-position-in-a-genome-minimizing-the-skew" class="level1" data-number="6">
<h1 data-number="6"><span class="header-section-number">6</span> Find a Position in a Genome Minimizing the Skew</h1>
<p>Minimum Skew Problem, Find a position in a genome minimizing the skew.</p>
<p>Given:&nbsp;A DNA string&nbsp;<em>Genome</em>.</p>
<p>Return:&nbsp;All integer(s)&nbsp;<em>i</em>&nbsp;minimizing&nbsp;<em>Skew</em>(_Prefix__i_&nbsp;(<em>Text</em>)) over all values of&nbsp;<em>i</em>&nbsp;(from 0 to |<em>Genome</em>|).</p>
<section id="sample-dataset-5" class="level2" data-number="6.1">
<h2 data-number="6.1" class="anchored" data-anchor-id="sample-dataset-5"><span class="header-section-number">6.1</span> Sample Dataset</h2>
<pre><code>CCTATCGGTGGATTAGCATGTCCCTGTACGTTTCGCCGCGAACTAGTTCACACGGCTTGATGGCAAATGGTTTTTCCGGCGACCGTAATCGTCCACCGAG</code></pre>
</section>
<section id="sample-output-5" class="level2" data-number="6.2">
<h2 data-number="6.2" class="anchored" data-anchor-id="sample-output-5"><span class="header-section-number">6.2</span> Sample Output</h2>
<pre><code>53 97</code></pre>
</section>
<section id="solution-5" class="level2" data-number="6.3">
<h2 data-number="6.3" class="anchored" data-anchor-id="solution-5"><span class="header-section-number">6.3</span> Solution</h2>
<div class="sourceCode" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> typing <span class="im">import</span> Generator</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> find_minima(seq: <span class="bu">str</span>) <span class="op">-&gt;</span> Generator[<span class="bu">int</span>, <span class="va">None</span>, <span class="va">None</span>]:</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Find positions with the minimum skew in a DNA sequence."""</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>    skew <span class="op">=</span> [<span class="dv">0</span>]</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>    delta <span class="op">=</span> {<span class="st">"G"</span>: <span class="dv">1</span>, <span class="st">"C"</span>: <span class="op">-</span><span class="dv">1</span>, <span class="st">"A"</span>: <span class="dv">0</span>, <span class="st">"T"</span>: <span class="dv">0</span>}</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, nucleotide <span class="kw">in</span> <span class="bu">enumerate</span>(seq):</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>        skew.append(skew[i] <span class="op">+</span> delta[nucleotide])</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>    min_skew <span class="op">=</span> <span class="bu">min</span>(skew)</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (i <span class="cf">for</span> i, value <span class="kw">in</span> <span class="bu">enumerate</span>(skew) <span class="cf">if</span> value <span class="op">==</span> min_skew)</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Sample input</span></span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>sample_input <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a><span class="st">CCTATCGGTGGATTAGCATGTCCCTGTACGTTTCGCCGCGAACTAGTTCACACGGCTTGATGGCAAATGGTTTTTCCGGCGACCGTAATCGTCCACCGAG</span></span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Process the input and print the positions with minimum skew</span></span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a>sequence <span class="op">=</span> sample_input.strip()</span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="op">*</span>find_minima(sequence))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="compute-the-hamming-distance-between-two-strings" class="level1" data-number="7">
<h1 data-number="7"><span class="header-section-number">7</span> Compute the Hamming Distance Between Two Strings</h1>
<p>Hamming Distance Problem, Compute the Hamming distance between two DNA strings.</p>
<p>Given:&nbsp;Two DNA strings.</p>
<p>Return:&nbsp;An integer value representing the Hamming distance.</p>
<section id="sample-dataset-6" class="level2" data-number="7.1">
<h2 data-number="7.1" class="anchored" data-anchor-id="sample-dataset-6"><span class="header-section-number">7.1</span> Sample Dataset</h2>
<pre><code>GGGCCGTTGGT
GGACCGTTGAC</code></pre>
</section>
<section id="sample-output-6" class="level2" data-number="7.2">
<h2 data-number="7.2" class="anchored" data-anchor-id="sample-output-6"><span class="header-section-number">7.2</span> Sample Output</h2>
<pre><code>3</code></pre>
</section>
<section id="solution-6" class="level2" data-number="7.3">
<h2 data-number="7.3" class="anchored" data-anchor-id="solution-6"><span class="header-section-number">7.3</span> Solution</h2>
<div class="sourceCode" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> itertools <span class="im">import</span> zip_longest</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> typing <span class="im">import</span> Tuple</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> calculate_hamming_distance(sequence1: <span class="bu">str</span>, sequence2: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="bu">int</span>:</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">sum</span>(base1 <span class="op">!=</span> base2 <span class="cf">for</span> base1, base2 <span class="kw">in</span> zip_longest(sequence1, sequence2, fillvalue<span class="op">=</span><span class="va">None</span>))</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> parse_dna_sequences(input_string: <span class="bu">str</span>) <span class="op">-&gt;</span> Tuple[<span class="bu">str</span>, <span class="bu">str</span>]:</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">tuple</span>(input_string.strip().split(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span>))</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Sample input</span></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>Sample_input <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a><span class="st">GGGCCGTTGGT</span></span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a><span class="st">GGACCGTTGAC</span></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>dna_sequence1, dna_sequence2 <span class="op">=</span> parse_dna_sequences(Sample_input)</span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>hamming_distance <span class="op">=</span> calculate_hamming_distance(dna_sequence1, dna_sequence2)</span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(hamming_distance)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="find-all-approximate-occurrences-of-a-pattern-in-a-string" class="level1" data-number="8">
<h1 data-number="8"><span class="header-section-number">8</span> Find All Approximate Occurrences of a Pattern in a String</h1>
<p>Approximate Pattern Matching Problem, Find all approximate occurrences of a pattern in a string.</p>
<p>Given:&nbsp;Strings&nbsp;<em>Pattern</em>&nbsp;and&nbsp;<em>Text</em>&nbsp;along with an integer&nbsp;<em>d</em>.</p>
<p>Return:&nbsp;All starting positions where&nbsp;<em>Pattern</em>&nbsp;appears as a substring of&nbsp;<em>Text</em>&nbsp;with at most&nbsp;<em>d</em>&nbsp;mismatches.</p>
<section id="sample-dataset-7" class="level2" data-number="8.1">
<h2 data-number="8.1" class="anchored" data-anchor-id="sample-dataset-7"><span class="header-section-number">8.1</span> Sample Dataset</h2>
<pre><code>ATTCTGGA
CGCCCGAATCCAGAACGCATTCCCATATTTCGGGACCACTGGCCTCCACGGTACGGACGTCAATCAAATGCCTAGCGGCTTGTGGTTTCTCCTACGCTCC
3</code></pre>
</section>
<section id="sample-output-7" class="level2" data-number="8.2">
<h2 data-number="8.2" class="anchored" data-anchor-id="sample-output-7"><span class="header-section-number">8.2</span> Sample Output</h2>
<pre><code>6 7 26 27 78</code></pre>
</section>
<section id="solution-7" class="level2" data-number="8.3">
<h2 data-number="8.3" class="anchored" data-anchor-id="solution-7"><span class="header-section-number">8.3</span> Solution</h2>
<div class="sourceCode" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> typing <span class="im">import</span> Iterator, List</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> generate_substrings(dna_sequence: <span class="bu">str</span>, substring_length: <span class="bu">int</span>) <span class="op">-&gt;</span> Iterator[<span class="bu">str</span>]:</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (dna_sequence[i:i <span class="op">+</span> substring_length] <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(dna_sequence) <span class="op">-</span> substring_length <span class="op">+</span> <span class="dv">1</span>))</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> calculate_hamming_distance(sequence1: <span class="bu">str</span>, sequence2: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="bu">int</span>:</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">sum</span>(base1 <span class="op">!=</span> base2 <span class="cf">for</span> base1, base2 <span class="kw">in</span> <span class="bu">zip</span>(sequence1, sequence2))</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> find_approximate_matches(pattern: <span class="bu">str</span>, genome: <span class="bu">str</span>, max_mismatch: <span class="bu">int</span>) <span class="op">-&gt;</span> Iterator[<span class="bu">int</span>]:</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>    pattern_length <span class="op">=</span> <span class="bu">len</span>(pattern)</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (position <span class="cf">for</span> position, substring <span class="kw">in</span> <span class="bu">enumerate</span>(generate_substrings(genome, pattern_length))</span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> calculate_hamming_distance(substring, pattern) <span class="op">&lt;=</span> max_mismatch)</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> parse_input(input_data: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="bu">tuple</span>[<span class="bu">str</span>, <span class="bu">str</span>, <span class="bu">int</span>]:</span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>    pattern, genome, max_mismatch_str <span class="op">=</span> input_data.strip().split(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)</span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> pattern, genome, <span class="bu">int</span>(max_mismatch_str)</span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a>sample_input <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a><span class="st">ATTCTGGA</span></span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a><span class="st">CGCCCGAATCCAGAACGCATTCCCATATTTCGGGACCACTGGCCTCCACGGTACGGACGTCAATCAAATGCCTAGCGGCTTGTGGTTTCTCCTACGCTCC</span></span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a><span class="st">3</span></span>
<span id="cb24-22"><a href="#cb24-22" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb24-23"><a href="#cb24-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-24"><a href="#cb24-24" aria-hidden="true" tabindex="-1"></a>pattern, genome, max_mismatch <span class="op">=</span> parse_input(sample_input)</span>
<span id="cb24-25"><a href="#cb24-25" aria-hidden="true" tabindex="-1"></a>match_positions <span class="op">=</span> <span class="bu">list</span>(find_approximate_matches(pattern, genome, max_mismatch))</span>
<span id="cb24-26"><a href="#cb24-26" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="op">*</span>match_positions)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="find-the-most-frequent-words-with-mismatches-in-a-string" class="level1" data-number="9">
<h1 data-number="9"><span class="header-section-number">9</span> Find the Most Frequent Words with Mismatches in a String</h1>
<p>Frequent Words with Mismatches Problem, Find the most frequent k-mers with mismatches in a string.</p>
<p>Given:&nbsp;A string&nbsp;<em>Text</em>&nbsp;as well as integers&nbsp;<em>k</em>&nbsp;and&nbsp;<em>d</em>.</p>
<p>Return:&nbsp;All most frequent&nbsp;<em>k</em>-mers with up to&nbsp;<em>d</em>&nbsp;mismatches in&nbsp;<em>Text</em>.</p>
<section id="sample-dataset-8" class="level2" data-number="9.1">
<h2 data-number="9.1" class="anchored" data-anchor-id="sample-dataset-8"><span class="header-section-number">9.1</span> Sample Dataset</h2>
<pre><code>ACGTTGCATGTCGCATGATGCATGAGAGCT
4 1</code></pre>
</section>
<section id="sample-output-8" class="level2" data-number="9.2">
<h2 data-number="9.2" class="anchored" data-anchor-id="sample-output-8"><span class="header-section-number">9.2</span> Sample Output</h2>
<pre><code>ATGC ATGT GATG</code></pre>
</section>
<section id="solution-8" class="level2" data-number="9.3">
<h2 data-number="9.3" class="anchored" data-anchor-id="solution-8"><span class="header-section-number">9.3</span> Solution</h2>
<div class="sourceCode" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> collections <span class="im">import</span> defaultdict</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> itertools <span class="im">import</span> product</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> typing <span class="im">import</span> Dict, List, Iterator, Tuple</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> calculate_hamming_distance(sequence1: <span class="bu">str</span>, sequence2: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="bu">int</span>:</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">sum</span>(base1 <span class="op">!=</span> base2 <span class="cf">for</span> base1, base2 <span class="kw">in</span> <span class="bu">zip</span>(sequence1, sequence2))</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> generate_substrings(dna_sequence: <span class="bu">str</span>, substring_length: <span class="bu">int</span>) <span class="op">-&gt;</span> Iterator[<span class="bu">str</span>]:</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (dna_sequence[i:i <span class="op">+</span> substring_length] <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(dna_sequence) <span class="op">-</span> substring_length <span class="op">+</span> <span class="dv">1</span>))</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> count_kmers(dna_sequence: <span class="bu">str</span>, kmer_length: <span class="bu">int</span>) <span class="op">-&gt;</span> Dict[<span class="bu">str</span>, <span class="bu">int</span>]:</span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>    kmer_counts <span class="op">=</span> defaultdict(<span class="bu">int</span>)</span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> kmer <span class="kw">in</span> generate_substrings(dna_sequence, kmer_length):</span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>        kmer_counts[kmer] <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> kmer_counts</span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> find_most_frequent(kmer_counts: Dict[<span class="bu">str</span>, <span class="bu">int</span>]) <span class="op">-&gt;</span> List[<span class="bu">str</span>]:</span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a>    max_count <span class="op">=</span> <span class="bu">max</span>(kmer_counts.values())</span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> [kmer <span class="cf">for</span> kmer, count <span class="kw">in</span> kmer_counts.items() <span class="cf">if</span> count <span class="op">==</span> max_count]</span>
<span id="cb27-20"><a href="#cb27-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-21"><a href="#cb27-21" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> generate_all_kmers(kmer_length: <span class="bu">int</span>) <span class="op">-&gt;</span> Iterator[<span class="bu">str</span>]:</span>
<span id="cb27-22"><a href="#cb27-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (<span class="st">""</span>.join(bases) <span class="cf">for</span> bases <span class="kw">in</span> product(<span class="st">"ACGT"</span>, repeat<span class="op">=</span>kmer_length))</span>
<span id="cb27-23"><a href="#cb27-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-24"><a href="#cb27-24" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> count_approximate_kmers(observed_kmers: Dict[<span class="bu">str</span>, <span class="bu">int</span>], max_mismatches: <span class="bu">int</span>, kmer_length: <span class="bu">int</span>) <span class="op">-&gt;</span> Iterator[Tuple[<span class="bu">str</span>, <span class="bu">int</span>]]:</span>
<span id="cb27-25"><a href="#cb27-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> potential_kmer <span class="kw">in</span> generate_all_kmers(kmer_length):</span>
<span id="cb27-26"><a href="#cb27-26" aria-hidden="true" tabindex="-1"></a>        count <span class="op">=</span> <span class="bu">sum</span>(observed_kmers[observed_kmer] </span>
<span id="cb27-27"><a href="#cb27-27" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">for</span> observed_kmer <span class="kw">in</span> observed_kmers </span>
<span id="cb27-28"><a href="#cb27-28" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> calculate_hamming_distance(potential_kmer, observed_kmer) <span class="op">&lt;=</span> max_mismatches)</span>
<span id="cb27-29"><a href="#cb27-29" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> count <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb27-30"><a href="#cb27-30" aria-hidden="true" tabindex="-1"></a>            <span class="cf">yield</span> (potential_kmer, count)</span>
<span id="cb27-31"><a href="#cb27-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-32"><a href="#cb27-32" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> parse_input(input_data: <span class="bu">str</span>) <span class="op">-&gt;</span> Tuple[<span class="bu">str</span>, <span class="bu">int</span>, <span class="bu">int</span>]:</span>
<span id="cb27-33"><a href="#cb27-33" aria-hidden="true" tabindex="-1"></a>    dna_sequence, params <span class="op">=</span> input_data.strip().split(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)</span>
<span id="cb27-34"><a href="#cb27-34" aria-hidden="true" tabindex="-1"></a>    kmer_length, max_mismatches <span class="op">=</span> <span class="bu">map</span>(<span class="bu">int</span>, params.split())</span>
<span id="cb27-35"><a href="#cb27-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> dna_sequence, kmer_length, max_mismatches</span>
<span id="cb27-36"><a href="#cb27-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-37"><a href="#cb27-37" aria-hidden="true" tabindex="-1"></a>sample_input <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb27-38"><a href="#cb27-38" aria-hidden="true" tabindex="-1"></a><span class="st">ACGTTGCATGTCGCATGATGCATGAGAGCT</span></span>
<span id="cb27-39"><a href="#cb27-39" aria-hidden="true" tabindex="-1"></a><span class="st">4 1</span></span>
<span id="cb27-40"><a href="#cb27-40" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb27-41"><a href="#cb27-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-42"><a href="#cb27-42" aria-hidden="true" tabindex="-1"></a>dna_sequence, kmer_length, max_mismatches <span class="op">=</span> parse_input(sample_input)</span>
<span id="cb27-43"><a href="#cb27-43" aria-hidden="true" tabindex="-1"></a>observed_kmers <span class="op">=</span> count_kmers(dna_sequence, kmer_length)</span>
<span id="cb27-44"><a href="#cb27-44" aria-hidden="true" tabindex="-1"></a>approximate_kmer_counts <span class="op">=</span> <span class="bu">dict</span>(count_approximate_kmers(observed_kmers, max_mismatches, kmer_length))</span>
<span id="cb27-45"><a href="#cb27-45" aria-hidden="true" tabindex="-1"></a>most_frequent_kmers <span class="op">=</span> find_most_frequent(approximate_kmer_counts)</span>
<span id="cb27-46"><a href="#cb27-46" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="op">*</span>most_frequent_kmers)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="find-frequent-words-with-mismatches-and-reverse-complements" class="level1" data-number="10">
<h1 data-number="10"><span class="header-section-number">10</span> Find Frequent Words with Mismatches and Reverse Complements</h1>
<p>Frequent Words with Mismatches and Reverse Complements Problem. Find the most frequent k-mers (with mismatches and reverse complements) in a DNA string.</p>
<p>Given:&nbsp;A DNA string&nbsp;<em>Text</em>&nbsp;as well as integers&nbsp;<em>k</em>&nbsp;and&nbsp;<em>d</em>.</p>
<p>Return:&nbsp;All&nbsp;<em>k</em>-mers&nbsp;<em>Pattern</em>&nbsp;maximizing the sum&nbsp;_Count__d_(<em>Text</em>,&nbsp;<span class="math inline">\(Pattern\)</span>) +&nbsp;_Count__d_(<em>Text</em>,&nbsp;<span class="math inline">\(\overline{Pattern}\)</span>}) over all possible&nbsp;<em>k</em>-mers.</p>
<section id="sample-dataset-9" class="level2" data-number="10.1">
<h2 data-number="10.1" class="anchored" data-anchor-id="sample-dataset-9"><span class="header-section-number">10.1</span> Sample Dataset</h2>
<pre><code>ACGTTGCATGTCGCATGATGCATGAGAGCT
4 1</code></pre>
</section>
<section id="sample-output-9" class="level2" data-number="10.2">
<h2 data-number="10.2" class="anchored" data-anchor-id="sample-output-9"><span class="header-section-number">10.2</span> Sample Output</h2>
<pre><code>ATGT ACAT</code></pre>
</section>
<section id="solution-9" class="level2" data-number="10.3">
<h2 data-number="10.3" class="anchored" data-anchor-id="solution-9"><span class="header-section-number">10.3</span> Solution</h2>
<div class="sourceCode" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> collections <span class="im">import</span> defaultdict</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> itertools <span class="im">import</span> product</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> typing <span class="im">import</span> Dict, List, Iterator, Tuple</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> reverse_complement(dna: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> dna[::<span class="op">-</span><span class="dv">1</span>].translate(<span class="bu">str</span>.maketrans(<span class="st">"ACGT"</span>, <span class="st">"TGCA"</span>))</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> hamming_distance(seq1: <span class="bu">str</span>, seq2: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="bu">int</span>:</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">sum</span>(base1 <span class="op">!=</span> base2 <span class="cf">for</span> base1, base2 <span class="kw">in</span> <span class="bu">zip</span>(seq1, seq2))</span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> generate_substrings(dna: <span class="bu">str</span>, length: <span class="bu">int</span>) <span class="op">-&gt;</span> Iterator[<span class="bu">str</span>]:</span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (dna[i:i <span class="op">+</span> length] <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(dna) <span class="op">-</span> length <span class="op">+</span> <span class="dv">1</span>))</span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> count_kmers(dna: <span class="bu">str</span>, kmer_length: <span class="bu">int</span>) <span class="op">-&gt;</span> Dict[<span class="bu">str</span>, <span class="bu">int</span>]:</span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a>    kmer_counts <span class="op">=</span> defaultdict(<span class="bu">int</span>)</span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> kmer <span class="kw">in</span> generate_substrings(dna, kmer_length):</span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a>        kmer_counts[kmer] <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> kmer_counts</span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-20"><a href="#cb30-20" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> find_most_frequent(kmer_counts: Dict[<span class="bu">str</span>, <span class="bu">int</span>]) <span class="op">-&gt;</span> List[<span class="bu">str</span>]:</span>
<span id="cb30-21"><a href="#cb30-21" aria-hidden="true" tabindex="-1"></a>    max_count <span class="op">=</span> <span class="bu">max</span>(kmer_counts.values())</span>
<span id="cb30-22"><a href="#cb30-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> [kmer <span class="cf">for</span> kmer, count <span class="kw">in</span> kmer_counts.items() <span class="cf">if</span> count <span class="op">==</span> max_count]</span>
<span id="cb30-23"><a href="#cb30-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-24"><a href="#cb30-24" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> generate_all_kmers(kmer_length: <span class="bu">int</span>) <span class="op">-&gt;</span> Iterator[<span class="bu">str</span>]:</span>
<span id="cb30-25"><a href="#cb30-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (<span class="st">""</span>.join(bases) <span class="cf">for</span> bases <span class="kw">in</span> product(<span class="st">"ACGT"</span>, repeat<span class="op">=</span>kmer_length))</span>
<span id="cb30-26"><a href="#cb30-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-27"><a href="#cb30-27" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> count_approximate_kmers(kmer_counts: Dict[<span class="bu">str</span>, <span class="bu">int</span>], max_mismatches: <span class="bu">int</span>, kmer_length: <span class="bu">int</span>) <span class="op">-&gt;</span> Iterator[Tuple[<span class="bu">str</span>, <span class="bu">int</span>]]:</span>
<span id="cb30-28"><a href="#cb30-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> potential_kmer <span class="kw">in</span> generate_all_kmers(kmer_length):</span>
<span id="cb30-29"><a href="#cb30-29" aria-hidden="true" tabindex="-1"></a>        count <span class="op">=</span> <span class="bu">sum</span>(kmer_counts[observed_kmer] <span class="cf">for</span> observed_kmer <span class="kw">in</span> kmer_counts </span>
<span id="cb30-30"><a href="#cb30-30" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> hamming_distance(potential_kmer, observed_kmer) <span class="op">&lt;=</span> max_mismatches)</span>
<span id="cb30-31"><a href="#cb30-31" aria-hidden="true" tabindex="-1"></a>        count <span class="op">+=</span> <span class="bu">sum</span>(kmer_counts[observed_kmer] <span class="cf">for</span> observed_kmer <span class="kw">in</span> kmer_counts </span>
<span id="cb30-32"><a href="#cb30-32" aria-hidden="true" tabindex="-1"></a>                     <span class="cf">if</span> hamming_distance(reverse_complement(potential_kmer), observed_kmer) <span class="op">&lt;=</span> max_mismatches)</span>
<span id="cb30-33"><a href="#cb30-33" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> count <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb30-34"><a href="#cb30-34" aria-hidden="true" tabindex="-1"></a>            <span class="cf">yield</span> (potential_kmer, count)</span>
<span id="cb30-35"><a href="#cb30-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-36"><a href="#cb30-36" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> parse_input(input_data: <span class="bu">str</span>) <span class="op">-&gt;</span> Tuple[<span class="bu">str</span>, <span class="bu">int</span>, <span class="bu">int</span>]:</span>
<span id="cb30-37"><a href="#cb30-37" aria-hidden="true" tabindex="-1"></a>    dna_sequence, params <span class="op">=</span> input_data.strip().split(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)</span>
<span id="cb30-38"><a href="#cb30-38" aria-hidden="true" tabindex="-1"></a>    kmer_length, max_mismatches <span class="op">=</span> <span class="bu">map</span>(<span class="bu">int</span>, params.split())</span>
<span id="cb30-39"><a href="#cb30-39" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> dna_sequence, kmer_length, max_mismatches</span>
<span id="cb30-40"><a href="#cb30-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-41"><a href="#cb30-41" aria-hidden="true" tabindex="-1"></a>sample_input <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb30-42"><a href="#cb30-42" aria-hidden="true" tabindex="-1"></a><span class="st">ACGTTGCATGTCGCATGATGCATGAGAGCT</span></span>
<span id="cb30-43"><a href="#cb30-43" aria-hidden="true" tabindex="-1"></a><span class="st">4 1</span></span>
<span id="cb30-44"><a href="#cb30-44" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb30-45"><a href="#cb30-45" aria-hidden="true" tabindex="-1"></a>dna_sequence, kmer_length, max_mismatches <span class="op">=</span> parse_input(sample_input)</span>
<span id="cb30-46"><a href="#cb30-46" aria-hidden="true" tabindex="-1"></a>kmer_counts <span class="op">=</span> count_kmers(dna_sequence, kmer_length)</span>
<span id="cb30-47"><a href="#cb30-47" aria-hidden="true" tabindex="-1"></a>approximate_kmer_counts <span class="op">=</span> <span class="bu">dict</span>(count_approximate_kmers(kmer_counts, max_mismatches, kmer_length))</span>
<span id="cb30-48"><a href="#cb30-48" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="op">*</span>find_most_frequent(approximate_kmer_counts))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="generate-the-frequency-array-of-a-string" class="level1" data-number="11">
<h1 data-number="11"><span class="header-section-number">11</span> Generate the Frequency Array of a String</h1>
<p>Computing a Frequency Array, Generate the frequency array of a DNA string.</p>
<p>Given:&nbsp;A&nbsp;<a href="https://rosalind.info/glossary/dna-string/">DNA string</a>&nbsp;<em>Text</em>&nbsp;and an integer&nbsp;<em>k</em>.</p>
<p>Return:&nbsp;The frequency array of&nbsp;<em>k</em>-mers in&nbsp;<em>Text</em>.</p>
<section id="sample-dataset-10" class="level2" data-number="11.1">
<h2 data-number="11.1" class="anchored" data-anchor-id="sample-dataset-10"><span class="header-section-number">11.1</span> Sample Dataset</h2>
<pre><code>ACGCGGCTCTGAAA
2</code></pre>
</section>
<section id="sample-output-10" class="level2" data-number="11.2">
<h2 data-number="11.2" class="anchored" data-anchor-id="sample-output-10"><span class="header-section-number">11.2</span> Sample Output</h2>
<pre><code>2 1 0 0 0 0 2 2 1 2 1 0 0 1 1 0</code></pre>
</section>
<section id="solution-10" class="level2" data-number="11.3">
<h2 data-number="11.3" class="anchored" data-anchor-id="solution-10"><span class="header-section-number">11.3</span> Solution</h2>
<div class="sourceCode" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> typing <span class="im">import</span> Iterator, List, Dict, Tuple</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> itertools <span class="im">import</span> product</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> generate_substrings(text: <span class="bu">str</span>, size: <span class="bu">int</span>) <span class="op">-&gt;</span> Iterator[<span class="bu">str</span>]:</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (text[i : i <span class="op">+</span> size] <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(text) <span class="op">-</span> size <span class="op">+</span> <span class="dv">1</span>))</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> count_pattern_occurrences(text: <span class="bu">str</span>, pattern: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="bu">int</span>:</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">sum</span>(pattern <span class="op">==</span> substring <span class="cf">for</span> substring <span class="kw">in</span> generate_substrings(text, <span class="bu">len</span>(pattern)))</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> calculate_hamming_distance(s1: <span class="bu">str</span>, s2: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="bu">int</span>:</span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">sum</span>(c1 <span class="op">!=</span> c2 <span class="cf">for</span> c1, c2 <span class="kw">in</span> <span class="bu">zip</span>(s1, s2))</span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> generate_kmers(k: <span class="bu">int</span>) <span class="op">-&gt;</span> Iterator[<span class="bu">str</span>]:</span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (<span class="st">""</span>.join(bases) <span class="cf">for</span> bases <span class="kw">in</span> product(<span class="st">"ACGT"</span>, repeat<span class="op">=</span>k))</span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> count_approximate_kmers(kmer_counts: Dict[<span class="bu">str</span>, <span class="bu">int</span>], max_mismatches: <span class="bu">int</span>, kmer_length: <span class="bu">int</span>) <span class="op">-&gt;</span> Iterator[Tuple[<span class="bu">str</span>, <span class="bu">int</span>]]:</span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> potential_kmer <span class="kw">in</span> generate_kmers(kmer_length):</span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a>        count <span class="op">=</span> <span class="bu">sum</span>(kmer_counts[observed_kmer] <span class="cf">for</span> observed_kmer <span class="kw">in</span> kmer_counts </span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> calculate_hamming_distance(potential_kmer, observed_kmer) <span class="op">&lt;=</span> max_mismatches)</span>
<span id="cb33-20"><a href="#cb33-20" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> count <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb33-21"><a href="#cb33-21" aria-hidden="true" tabindex="-1"></a>            <span class="cf">yield</span> (potential_kmer, count)</span>
<span id="cb33-22"><a href="#cb33-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-23"><a href="#cb33-23" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> calculate_kmer_frequencies(sequence: <span class="bu">str</span>, kmer_length: <span class="bu">int</span>) <span class="op">-&gt;</span> List[<span class="bu">int</span>]:</span>
<span id="cb33-24"><a href="#cb33-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> [count_pattern_occurrences(sequence, kmer) <span class="cf">for</span> kmer <span class="kw">in</span> generate_kmers(kmer_length)]</span>
<span id="cb33-25"><a href="#cb33-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-26"><a href="#cb33-26" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> parse_input(input_data: <span class="bu">str</span>) <span class="op">-&gt;</span> Tuple[<span class="bu">str</span>, <span class="bu">int</span>]:</span>
<span id="cb33-27"><a href="#cb33-27" aria-hidden="true" tabindex="-1"></a>    sequence, kmer_length <span class="op">=</span> input_data.strip().split(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)</span>
<span id="cb33-28"><a href="#cb33-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> sequence, <span class="bu">int</span>(kmer_length)</span>
<span id="cb33-29"><a href="#cb33-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-30"><a href="#cb33-30" aria-hidden="true" tabindex="-1"></a>sample_input <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb33-31"><a href="#cb33-31" aria-hidden="true" tabindex="-1"></a><span class="st">ACGCGGCTCTGAAA</span></span>
<span id="cb33-32"><a href="#cb33-32" aria-hidden="true" tabindex="-1"></a><span class="st">2</span></span>
<span id="cb33-33"><a href="#cb33-33" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb33-34"><a href="#cb33-34" aria-hidden="true" tabindex="-1"></a>sequence, kmer_length <span class="op">=</span> parse_input(sample_input)</span>
<span id="cb33-35"><a href="#cb33-35" aria-hidden="true" tabindex="-1"></a>kmer_frequencies <span class="op">=</span> calculate_kmer_frequencies(sequence, kmer_length)</span>
<span id="cb33-36"><a href="#cb33-36" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="op">*</span>kmer_frequencies</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="implement-patterntonumber" class="level1" data-number="12">
<h1 data-number="12"><span class="header-section-number">12</span> Implement PatternToNumber</h1>
<p>Implement PatternToNumber, Convert a DNA string to a number.</p>
<p>Given:&nbsp;A&nbsp;<a href="https://rosalind.info/glossary/dna-string/">DNA string</a>&nbsp;<em>Pattern</em>.</p>
<p>Return:&nbsp;<em>PatternToNumber</em>(<em>Pattern</em>).</p>
<section id="sample-dataset-11" class="level2" data-number="12.1">
<h2 data-number="12.1" class="anchored" data-anchor-id="sample-dataset-11"><span class="header-section-number">12.1</span> Sample Dataset</h2>
<pre><code>AGT</code></pre>
</section>
<section id="sample-output-11" class="level2" data-number="12.2">
<h2 data-number="12.2" class="anchored" data-anchor-id="sample-output-11"><span class="header-section-number">12.2</span> Sample Output</h2>
<pre><code>11</code></pre>
</section>
<section id="solution-11" class="level2" data-number="12.3">
<h2 data-number="12.3" class="anchored" data-anchor-id="solution-11"><span class="header-section-number">12.3</span> Solution</h2>
<div class="sourceCode" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> typing <span class="im">import</span> Dict, Tuple</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> create_nucleotide_to_number_map() <span class="op">-&gt;</span> Dict[<span class="bu">str</span>, <span class="bu">int</span>]:</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> {<span class="st">"A"</span>: <span class="dv">0</span>, <span class="st">"C"</span>: <span class="dv">1</span>, <span class="st">"G"</span>: <span class="dv">2</span>, <span class="st">"T"</span>: <span class="dv">3</span>}</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> convert_nucleotide_to_number(nucleotide: <span class="bu">str</span>, nucleotide_map: Dict[<span class="bu">str</span>, <span class="bu">int</span>]) <span class="op">-&gt;</span> <span class="bu">int</span>:</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> nucleotide_map[nucleotide]</span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> convert_dna_pattern_to_number(dna_pattern: <span class="bu">str</span>, nucleotide_map: Dict[<span class="bu">str</span>, <span class="bu">int</span>]) <span class="op">-&gt;</span> <span class="bu">int</span>:</span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> dna_pattern:</span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="dv">0</span></span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">4</span> <span class="op">*</span> convert_dna_pattern_to_number(dna_pattern[:<span class="op">-</span><span class="dv">1</span>], nucleotide_map) <span class="op">+</span> convert_nucleotide_to_number(dna_pattern[<span class="op">-</span><span class="dv">1</span>], nucleotide_map)</span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> parse_input(input_data: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> input_data.strip()</span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a>sample_input <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a><span class="st">AGT</span></span>
<span id="cb36-19"><a href="#cb36-19" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb36-20"><a href="#cb36-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-21"><a href="#cb36-21" aria-hidden="true" tabindex="-1"></a>dna_pattern <span class="op">=</span> parse_input(sample_input)</span>
<span id="cb36-22"><a href="#cb36-22" aria-hidden="true" tabindex="-1"></a>nucleotide_map <span class="op">=</span> create_nucleotide_to_number_map()</span>
<span id="cb36-23"><a href="#cb36-23" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> convert_dna_pattern_to_number(dna_pattern, nucleotide_map)</span>
<span id="cb36-24"><a href="#cb36-24" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(result)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="implement-numbertopattern" class="level1" data-number="13">
<h1 data-number="13"><span class="header-section-number">13</span> Implement NumberToPattern</h1>
<p>Implement NumberToPattern, Convert an integer to its corresponding DNA string.</p>
<p>Given:&nbsp;Integers&nbsp;<em>index</em>&nbsp;and&nbsp;<em>k</em>.</p>
<p>Return:&nbsp;<em>NumberToPattern</em>(<em>index</em>,&nbsp;<em>k</em>).</p>
<section id="sample-dataset-12" class="level2" data-number="13.1">
<h2 data-number="13.1" class="anchored" data-anchor-id="sample-dataset-12"><span class="header-section-number">13.1</span> Sample Dataset</h2>
<pre><code>45
4</code></pre>
</section>
<section id="sample-output-12" class="level2" data-number="13.2">
<h2 data-number="13.2" class="anchored" data-anchor-id="sample-output-12"><span class="header-section-number">13.2</span> Sample Output</h2>
<pre><code>AGTC</code></pre>
</section>
<section id="solution-12" class="level2" data-number="13.3">
<h2 data-number="13.3" class="anchored" data-anchor-id="solution-12"><span class="header-section-number">13.3</span> Solution</h2>
<div class="sourceCode" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> typing <span class="im">import</span> Tuple</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> number_to_nucleotide(index: <span class="bu">int</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>    nucleotides <span class="op">=</span> [<span class="st">"A"</span>, <span class="st">"C"</span>, <span class="st">"G"</span>, <span class="st">"T"</span>]</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> nucleotides[index]</span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> number_to_dna_pattern(index: <span class="bu">int</span>, length: <span class="bu">int</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> length <span class="op">==</span> <span class="dv">1</span>:</span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> number_to_nucleotide(index)</span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>    quotient, remainder <span class="op">=</span> <span class="bu">divmod</span>(index, <span class="dv">4</span>)</span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> number_to_dna_pattern(quotient, length <span class="op">-</span> <span class="dv">1</span>) <span class="op">+</span> number_to_nucleotide(remainder)</span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> parse_input(input_data: <span class="bu">str</span>) <span class="op">-&gt;</span> Tuple[<span class="bu">int</span>, <span class="bu">int</span>]:</span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a>    index_str, length_str <span class="op">=</span> input_data.strip().split(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)</span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">int</span>(index_str), <span class="bu">int</span>(length_str)</span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a>sample_input <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a><span class="st">45</span></span>
<span id="cb39-19"><a href="#cb39-19" aria-hidden="true" tabindex="-1"></a><span class="st">4</span></span>
<span id="cb39-20"><a href="#cb39-20" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb39-21"><a href="#cb39-21" aria-hidden="true" tabindex="-1"></a>index, length <span class="op">=</span> parse_input(sample_input)</span>
<span id="cb39-22"><a href="#cb39-22" aria-hidden="true" tabindex="-1"></a>dna_pattern <span class="op">=</span> number_to_dna_pattern(index, length)</span>
<span id="cb39-23"><a href="#cb39-23" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(dna_pattern)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="generate-the-d-neighborhood-of-a-string" class="level1" data-number="14">
<h1 data-number="14"><span class="header-section-number">14</span> Generate the d-Neighborhood of a String</h1>
<p>Generate the d-Neighborhood of a String Find all the neighbors of a pattern.</p>
<p>Given:&nbsp;A&nbsp;<a href="https://rosalind.info/glossary/dna-string/">DNA string</a>&nbsp;<em>Pattern</em>&nbsp;and an integer&nbsp;<em>d</em>.</p>
<p>Return:&nbsp;The collection of strings&nbsp;<em>Neighbors</em>(<em>Pattern</em>,&nbsp;<em>d</em>).</p>
<section id="sample-dataset-13" class="level2" data-number="14.1">
<h2 data-number="14.1" class="anchored" data-anchor-id="sample-dataset-13"><span class="header-section-number">14.1</span> Sample Dataset</h2>
<pre><code>ACG
1</code></pre>
</section>
<section id="sample-output-13" class="level2" data-number="14.2">
<h2 data-number="14.2" class="anchored" data-anchor-id="sample-output-13"><span class="header-section-number">14.2</span> Sample Output</h2>
<pre><code>CCG
TCG
GCG
AAG
ATG
AGG
ACA
ACC
ACT
ACG</code></pre>
</section>
<section id="solution-13" class="level2" data-number="14.3">
<h2 data-number="14.3" class="anchored" data-anchor-id="solution-13"><span class="header-section-number">14.3</span> Solution</h2>
<div class="sourceCode" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> typing <span class="im">import</span> Set, List, Tuple, Iterator</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> calculate_hamming_distance(seq1: <span class="bu">str</span>, seq2: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="bu">int</span>:</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">sum</span>(base1 <span class="op">!=</span> base2 <span class="cf">for</span> base1, base2 <span class="kw">in</span> <span class="bu">zip</span>(seq1, seq2))</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> generate_immediate_neighbors(sequence: <span class="bu">str</span>) <span class="op">-&gt;</span> Iterator[<span class="bu">str</span>]:</span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>    nucleotides <span class="op">=</span> [<span class="st">"A"</span>, <span class="st">"T"</span>, <span class="st">"G"</span>, <span class="st">"C"</span>]</span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, current_base <span class="kw">in</span> <span class="bu">enumerate</span>(sequence):</span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> new_base <span class="kw">in</span> nucleotides:</span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> new_base <span class="op">!=</span> current_base:</span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a>                <span class="cf">yield</span> sequence[:i] <span class="op">+</span> new_base <span class="op">+</span> sequence[i <span class="op">+</span> <span class="dv">1</span>:]</span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> generate_neighbors(sequence: <span class="bu">str</span>, max_distance: <span class="bu">int</span>) <span class="op">-&gt;</span> Set[<span class="bu">str</span>]:</span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a>    nucleotides <span class="op">=</span> [<span class="st">"A"</span>, <span class="st">"T"</span>, <span class="st">"G"</span>, <span class="st">"C"</span>]</span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> max_distance <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb42-16"><a href="#cb42-16" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> {sequence}</span>
<span id="cb42-17"><a href="#cb42-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(sequence) <span class="op">==</span> <span class="dv">1</span>:</span>
<span id="cb42-18"><a href="#cb42-18" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">set</span>(nucleotides)</span>
<span id="cb42-19"><a href="#cb42-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb42-20"><a href="#cb42-20" aria-hidden="true" tabindex="-1"></a>    neighbors <span class="op">=</span> <span class="bu">set</span>()</span>
<span id="cb42-21"><a href="#cb42-21" aria-hidden="true" tabindex="-1"></a>    suffix_neighbors <span class="op">=</span> generate_neighbors(sequence[<span class="dv">1</span>:], max_distance)</span>
<span id="cb42-22"><a href="#cb42-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> suffix <span class="kw">in</span> suffix_neighbors:</span>
<span id="cb42-23"><a href="#cb42-23" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> calculate_hamming_distance(sequence[<span class="dv">1</span>:], suffix) <span class="op">&lt;</span> max_distance:</span>
<span id="cb42-24"><a href="#cb42-24" aria-hidden="true" tabindex="-1"></a>            neighbors.update(base <span class="op">+</span> suffix <span class="cf">for</span> base <span class="kw">in</span> nucleotides)</span>
<span id="cb42-25"><a href="#cb42-25" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb42-26"><a href="#cb42-26" aria-hidden="true" tabindex="-1"></a>            neighbors.add(sequence[<span class="dv">0</span>] <span class="op">+</span> suffix)</span>
<span id="cb42-27"><a href="#cb42-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> neighbors</span>
<span id="cb42-28"><a href="#cb42-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-29"><a href="#cb42-29" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> parse_input(input_data: <span class="bu">str</span>) <span class="op">-&gt;</span> Tuple[<span class="bu">str</span>, <span class="bu">int</span>]:</span>
<span id="cb42-30"><a href="#cb42-30" aria-hidden="true" tabindex="-1"></a>    sequence, distance <span class="op">=</span> input_data.strip().split(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)</span>
<span id="cb42-31"><a href="#cb42-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> sequence, <span class="bu">int</span>(distance)</span>
<span id="cb42-32"><a href="#cb42-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-33"><a href="#cb42-33" aria-hidden="true" tabindex="-1"></a>sample_input <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb42-34"><a href="#cb42-34" aria-hidden="true" tabindex="-1"></a><span class="st">ACG</span></span>
<span id="cb42-35"><a href="#cb42-35" aria-hidden="true" tabindex="-1"></a><span class="st">1</span></span>
<span id="cb42-36"><a href="#cb42-36" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb42-37"><a href="#cb42-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-38"><a href="#cb42-38" aria-hidden="true" tabindex="-1"></a>sequence, max_distance <span class="op">=</span> parse_input(sample_input)</span>
<span id="cb42-39"><a href="#cb42-39" aria-hidden="true" tabindex="-1"></a>neighbor_sequences <span class="op">=</span> generate_neighbors(sequence, max_distance)</span>
<span id="cb42-40"><a href="#cb42-40" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="op">*</span><span class="bu">sorted</span>(neighbor_sequences), sep<span class="op">=</span><span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<hr>
</section>
</section>
<section id="compute-the-probability-of-a-hidden-path" class="level1" data-number="15">
<h1 data-number="15"><span class="header-section-number">15</span> Compute the Probability of a Hidden Path</h1>
<p>Given:&nbsp;A hidden path <span class="math inline">\(π\)</span> followed by the states&nbsp;<em>States</em>&nbsp;and transition matrix&nbsp;<em>Transition</em>&nbsp;of an HMM (<span class="math inline">\(Σ\)</span>,&nbsp;<em>States</em>,&nbsp;<em>Transition</em>,&nbsp;<em>Emission</em>).</p>
<p>Return:&nbsp;The probability of this path, <span class="math inline">\(Pr(π)\)</span>. You may assume that initial probabilities are equal.</p>
<section id="sample-dataset-14" class="level2" data-number="15.1">
<h2 data-number="15.1" class="anchored" data-anchor-id="sample-dataset-14"><span class="header-section-number">15.1</span> Sample Dataset</h2>
<pre><code>AABBBAABABAAAABBBBAABBABABBBAABBAAAABABAABBABABBAB
--------
A   B
--------
    A   B
A   0.194   0.806
B   0.273   0.727</code></pre>
</section>
<section id="sample-output-14" class="level2" data-number="15.2">
<h2 data-number="15.2" class="anchored" data-anchor-id="sample-output-14"><span class="header-section-number">15.2</span> Sample Output</h2>
<pre><code>5.01732865318e-19</code></pre>
</section>
<section id="solution-14" class="level2" data-number="15.3">
<h2 data-number="15.3" class="anchored" data-anchor-id="solution-14"><span class="header-section-number">15.3</span> Solution</h2>
<div class="sourceCode" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> math <span class="im">import</span> prod</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> io <span class="im">import</span> StringIO</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> parse_hidden_path_data(input_lines):</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>    hidden_path <span class="op">=</span> <span class="bu">next</span>(input_lines).strip()</span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>    <span class="bu">next</span>(input_lines)  <span class="co"># Skip separator</span></span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>    states <span class="op">=</span> <span class="bu">next</span>(input_lines).split()</span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>    <span class="bu">next</span>(input_lines)  <span class="co"># Skip separator</span></span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a>    <span class="bu">next</span>(input_lines)  <span class="co"># Skip column headers</span></span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a>    transition_probabilities <span class="op">=</span> {}</span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> line <span class="kw">in</span> input_lines:</span>
<span id="cb45-13"><a href="#cb45-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> line.strip():</span>
<span id="cb45-14"><a href="#cb45-14" aria-hidden="true" tabindex="-1"></a>            row_data <span class="op">=</span> line.split()</span>
<span id="cb45-15"><a href="#cb45-15" aria-hidden="true" tabindex="-1"></a>            current_state <span class="op">=</span> row_data[<span class="dv">0</span>]</span>
<span id="cb45-16"><a href="#cb45-16" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> next_state, probability <span class="kw">in</span> <span class="bu">zip</span>(states, row_data[<span class="dv">1</span>:]):</span>
<span id="cb45-17"><a href="#cb45-17" aria-hidden="true" tabindex="-1"></a>                transition_probabilities[(current_state, next_state)] <span class="op">=</span> <span class="bu">float</span>(probability)</span>
<span id="cb45-18"><a href="#cb45-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb45-19"><a href="#cb45-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> hidden_path, transition_probabilities</span>
<span id="cb45-20"><a href="#cb45-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-21"><a href="#cb45-21" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> calculate_hidden_path_probability(hidden_path, transition_probabilities):</span>
<span id="cb45-22"><a href="#cb45-22" aria-hidden="true" tabindex="-1"></a>    initial_probability <span class="op">=</span> <span class="fl">0.5</span></span>
<span id="cb45-23"><a href="#cb45-23" aria-hidden="true" tabindex="-1"></a>    path_probability <span class="op">=</span> initial_probability <span class="op">*</span> prod(</span>
<span id="cb45-24"><a href="#cb45-24" aria-hidden="true" tabindex="-1"></a>        transition_probabilities[state_pair] </span>
<span id="cb45-25"><a href="#cb45-25" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> state_pair <span class="kw">in</span> <span class="bu">zip</span>(hidden_path, hidden_path[<span class="dv">1</span>:])</span>
<span id="cb45-26"><a href="#cb45-26" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb45-27"><a href="#cb45-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> path_probability</span>
<span id="cb45-28"><a href="#cb45-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-29"><a href="#cb45-29" aria-hidden="true" tabindex="-1"></a>sample_input <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb45-30"><a href="#cb45-30" aria-hidden="true" tabindex="-1"></a><span class="st">AABBBAABABAAAABBBBAABBABABBBAABBAAAABABAABBABABBAB</span></span>
<span id="cb45-31"><a href="#cb45-31" aria-hidden="true" tabindex="-1"></a><span class="st">--------</span></span>
<span id="cb45-32"><a href="#cb45-32" aria-hidden="true" tabindex="-1"></a><span class="st">A B</span></span>
<span id="cb45-33"><a href="#cb45-33" aria-hidden="true" tabindex="-1"></a><span class="st">--------</span></span>
<span id="cb45-34"><a href="#cb45-34" aria-hidden="true" tabindex="-1"></a><span class="st">    A   B</span></span>
<span id="cb45-35"><a href="#cb45-35" aria-hidden="true" tabindex="-1"></a><span class="st">A   0.194   0.806</span></span>
<span id="cb45-36"><a href="#cb45-36" aria-hidden="true" tabindex="-1"></a><span class="st">B   0.273   0.727</span></span>
<span id="cb45-37"><a href="#cb45-37" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb45-38"><a href="#cb45-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-39"><a href="#cb45-39" aria-hidden="true" tabindex="-1"></a>input_lines <span class="op">=</span> <span class="bu">iter</span>(StringIO(sample_input.strip()).readlines())</span>
<span id="cb45-40"><a href="#cb45-40" aria-hidden="true" tabindex="-1"></a>hidden_path, transition_probabilities <span class="op">=</span> parse_hidden_path_data(input_lines)</span>
<span id="cb45-41"><a href="#cb45-41" aria-hidden="true" tabindex="-1"></a>result_probability <span class="op">=</span> calculate_hidden_path_probability(hidden_path, transition_probabilities)</span>
<span id="cb45-42"><a href="#cb45-42" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>result_probability<span class="sc">:e}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="compute-the-probability-of-an-outcome-given-a-hidden-path" class="level1" data-number="16">
<h1 data-number="16"><span class="header-section-number">16</span> Compute the Probability of an Outcome Given a Hidden Path</h1>
<p>Given:&nbsp;A string&nbsp;<em>x</em>, followed by the alphabet&nbsp;<em>Σ</em>&nbsp;from which&nbsp;<em>x</em>&nbsp;was constructed, followed by a hidden path&nbsp;<em>π</em>, followed by the states&nbsp;<em>States</em>&nbsp;and emission matrix&nbsp;<em>Emission</em>&nbsp;of an HMM (<em>Σ</em>,&nbsp;<em>States</em>,&nbsp;<em>Transition</em>,&nbsp;<em>Emission</em>).</p>
<p>Return:&nbsp;The conditional probability <span class="math inline">\(Pr(x|π)\)</span> that string&nbsp;<em>x</em>&nbsp;will be emitted by the HMM given the hidden path&nbsp;<em>π</em>.</p>
<section id="sample-dataset-15" class="level2" data-number="16.1">
<h2 data-number="16.1" class="anchored" data-anchor-id="sample-dataset-15"><span class="header-section-number">16.1</span> Sample Dataset</h2>
<pre><code>xxyzyxzzxzxyxyyzxxzzxxyyxxyxyzzxxyzyzxzxxyxyyzxxzx
--------
x   y   z
--------
BBBAAABABABBBBBBAAAAAABAAAABABABBBBBABAABABABABBBB
--------
A   B
--------
    x   y   z
A   0.612   0.314   0.074 
B   0.346   0.317   0.336</code></pre>
</section>
<section id="sample-output-15" class="level2" data-number="16.2">
<h2 data-number="16.2" class="anchored" data-anchor-id="sample-output-15"><span class="header-section-number">16.2</span> Sample Output</h2>
<pre><code>1.93157070893e-28</code></pre>
</section>
<section id="solution-15" class="level2" data-number="16.3">
<h2 data-number="16.3" class="anchored" data-anchor-id="solution-15"><span class="header-section-number">16.3</span> Solution</h2>
<div class="sourceCode" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> math <span class="im">import</span> prod</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> io <span class="im">import</span> StringIO</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> parse_emission_data(input_lines):</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>    emission_sequence <span class="op">=</span> <span class="bu">next</span>(input_lines).strip()</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>    <span class="bu">next</span>(input_lines)  <span class="co"># Skip separator</span></span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>    symbols <span class="op">=</span> <span class="bu">next</span>(input_lines).split()</span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>    <span class="bu">next</span>(input_lines)  <span class="co"># Skip separator</span></span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>    hidden_path <span class="op">=</span> <span class="bu">next</span>(input_lines).strip()</span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a>    <span class="bu">next</span>(input_lines)  <span class="co"># Skip separator</span></span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a>    states <span class="op">=</span> <span class="bu">next</span>(input_lines).split()</span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a>    <span class="bu">next</span>(input_lines)  <span class="co"># Skip separator</span></span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a>    <span class="bu">next</span>(input_lines)  <span class="co"># Skip column headers</span></span>
<span id="cb48-14"><a href="#cb48-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb48-15"><a href="#cb48-15" aria-hidden="true" tabindex="-1"></a>    emission_probabilities <span class="op">=</span> {}</span>
<span id="cb48-16"><a href="#cb48-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> line <span class="kw">in</span> input_lines:</span>
<span id="cb48-17"><a href="#cb48-17" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> line.strip():</span>
<span id="cb48-18"><a href="#cb48-18" aria-hidden="true" tabindex="-1"></a>            row_data <span class="op">=</span> line.split()</span>
<span id="cb48-19"><a href="#cb48-19" aria-hidden="true" tabindex="-1"></a>            state <span class="op">=</span> row_data[<span class="dv">0</span>]</span>
<span id="cb48-20"><a href="#cb48-20" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> symbol, probability <span class="kw">in</span> <span class="bu">zip</span>(symbols, row_data[<span class="dv">1</span>:]):</span>
<span id="cb48-21"><a href="#cb48-21" aria-hidden="true" tabindex="-1"></a>                emission_probabilities[(state, symbol)] <span class="op">=</span> <span class="bu">float</span>(probability)</span>
<span id="cb48-22"><a href="#cb48-22" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb48-23"><a href="#cb48-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> emission_sequence, hidden_path, emission_probabilities</span>
<span id="cb48-24"><a href="#cb48-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-25"><a href="#cb48-25" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> calculate_emission_probability(emission_sequence, hidden_path, emission_probabilities):</span>
<span id="cb48-26"><a href="#cb48-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> prod(emission_probabilities[state_symbol] <span class="cf">for</span> state_symbol <span class="kw">in</span> <span class="bu">zip</span>(hidden_path, emission_sequence))</span>
<span id="cb48-27"><a href="#cb48-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-28"><a href="#cb48-28" aria-hidden="true" tabindex="-1"></a>sample_input <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb48-29"><a href="#cb48-29" aria-hidden="true" tabindex="-1"></a><span class="st">xxyzyxzzxzxyxyyzxxzzxxyyxxyxyzzxxyzyzxzxxyxyyzxxzx</span></span>
<span id="cb48-30"><a href="#cb48-30" aria-hidden="true" tabindex="-1"></a><span class="st">--------</span></span>
<span id="cb48-31"><a href="#cb48-31" aria-hidden="true" tabindex="-1"></a><span class="st">x y z</span></span>
<span id="cb48-32"><a href="#cb48-32" aria-hidden="true" tabindex="-1"></a><span class="st">--------</span></span>
<span id="cb48-33"><a href="#cb48-33" aria-hidden="true" tabindex="-1"></a><span class="st">BBBAAABABABBBBBBAAAAAABAAAABABABBBBBABAABABABABBBB</span></span>
<span id="cb48-34"><a href="#cb48-34" aria-hidden="true" tabindex="-1"></a><span class="st">--------</span></span>
<span id="cb48-35"><a href="#cb48-35" aria-hidden="true" tabindex="-1"></a><span class="st">A B</span></span>
<span id="cb48-36"><a href="#cb48-36" aria-hidden="true" tabindex="-1"></a><span class="st">--------</span></span>
<span id="cb48-37"><a href="#cb48-37" aria-hidden="true" tabindex="-1"></a><span class="st">    x   y   z</span></span>
<span id="cb48-38"><a href="#cb48-38" aria-hidden="true" tabindex="-1"></a><span class="st">A   0.612   0.314   0.074 </span></span>
<span id="cb48-39"><a href="#cb48-39" aria-hidden="true" tabindex="-1"></a><span class="st">B   0.346   0.317   0.336</span></span>
<span id="cb48-40"><a href="#cb48-40" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb48-41"><a href="#cb48-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-42"><a href="#cb48-42" aria-hidden="true" tabindex="-1"></a>input_lines <span class="op">=</span> <span class="bu">iter</span>(StringIO(sample_input.strip()).readlines())</span>
<span id="cb48-43"><a href="#cb48-43" aria-hidden="true" tabindex="-1"></a>emission_sequence, hidden_path, emission_probabilities <span class="op">=</span> parse_emission_data(input_lines)</span>
<span id="cb48-44"><a href="#cb48-44" aria-hidden="true" tabindex="-1"></a>result_probability <span class="op">=</span> calculate_emission_probability(emission_sequence, hidden_path, emission_probabilities)</span>
<span id="cb48-45"><a href="#cb48-45" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>result_probability<span class="sc">:e}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="implement-the-viterbi-algorithm" class="level1" data-number="17">
<h1 data-number="17"><span class="header-section-number">17</span> Implement the Viterbi Algorithm</h1>
<p>Given:&nbsp;A string&nbsp;<em>x</em>, followed by the alphabet&nbsp;<em>Σ</em>&nbsp;from which&nbsp;<em>x</em>&nbsp;was constructed, followed by the states&nbsp;<em>States</em>, transition matrix&nbsp;<em>Transition</em>, and emission matrix&nbsp;<em>Emission</em>&nbsp;of an HMM (<em>Σ</em>,&nbsp;<em>States</em>,&nbsp;<em>Transition</em>,&nbsp;<em>Emission</em>).</p>
<p>Return:&nbsp;A path that maximizes the (unconditional) probability Pr(<em>x</em>,&nbsp;<em>π</em>) over all possible paths&nbsp;<em>π</em>.</p>
<section id="sample-dataset-16" class="level2" data-number="17.1">
<h2 data-number="17.1" class="anchored" data-anchor-id="sample-dataset-16"><span class="header-section-number">17.1</span> Sample Dataset</h2>
<pre><code>xyxzzxyxyy
--------
x   y   z
--------
A   B
--------
    A   B
A   0.641   0.359
B   0.729   0.271
--------
    x   y   z
A   0.117   0.691   0.192   
B   0.097   0.42    0.483</code></pre>
</section>
<section id="sample-output-16" class="level2" data-number="17.2">
<h2 data-number="17.2" class="anchored" data-anchor-id="sample-output-16"><span class="header-section-number">17.2</span> Sample Output</h2>
<pre><code>AAABBAAAAA</code></pre>
</section>
<section id="solution-16" class="level2" data-number="17.3">
<h2 data-number="17.3" class="anchored" data-anchor-id="solution-16"><span class="header-section-number">17.3</span> Solution</h2>
<div class="sourceCode" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> io <span class="im">import</span> StringIO</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> math <span class="im">import</span> log</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> typing <span class="im">import</span> List, Dict, Tuple, Iterator</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> parse_input(input_iterator: Iterator[<span class="bu">str</span>]) <span class="op">-&gt;</span> Tuple[<span class="bu">str</span>, List[<span class="bu">str</span>], Dict[Tuple[<span class="bu">str</span>, <span class="bu">str</span>], <span class="bu">float</span>], Dict[Tuple[<span class="bu">str</span>, <span class="bu">str</span>], <span class="bu">float</span>]]:</span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>    sequence <span class="op">=</span> <span class="bu">next</span>(input_iterator).rstrip()</span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a>    <span class="bu">next</span>(input_iterator)</span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a>    alphabet <span class="op">=</span> <span class="bu">next</span>(input_iterator).split()</span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a>    <span class="bu">next</span>(input_iterator)</span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a>    states <span class="op">=</span> <span class="bu">next</span>(input_iterator).split()</span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a>    <span class="bu">next</span>(input_iterator)</span>
<span id="cb51-13"><a href="#cb51-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb51-14"><a href="#cb51-14" aria-hidden="true" tabindex="-1"></a>    transition_lines <span class="op">=</span> [<span class="bu">next</span>(input_iterator) <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(states) <span class="op">+</span> <span class="dv">1</span>)]</span>
<span id="cb51-15"><a href="#cb51-15" aria-hidden="true" tabindex="-1"></a>    transition_matrix <span class="op">=</span> {</span>
<span id="cb51-16"><a href="#cb51-16" aria-hidden="true" tabindex="-1"></a>        (states[i], states[j]): <span class="bu">float</span>(value)</span>
<span id="cb51-17"><a href="#cb51-17" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i, row <span class="kw">in</span> <span class="bu">enumerate</span>(transition_lines[<span class="dv">1</span>:])</span>
<span id="cb51-18"><a href="#cb51-18" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> j, value <span class="kw">in</span> <span class="bu">enumerate</span>(row.split()[<span class="dv">1</span>:])</span>
<span id="cb51-19"><a href="#cb51-19" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb51-20"><a href="#cb51-20" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb51-21"><a href="#cb51-21" aria-hidden="true" tabindex="-1"></a>    <span class="bu">next</span>(input_iterator)</span>
<span id="cb51-22"><a href="#cb51-22" aria-hidden="true" tabindex="-1"></a>    emission_lines <span class="op">=</span> [<span class="bu">next</span>(input_iterator) <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(states) <span class="op">+</span> <span class="dv">1</span>)]</span>
<span id="cb51-23"><a href="#cb51-23" aria-hidden="true" tabindex="-1"></a>    emission_matrix <span class="op">=</span> {</span>
<span id="cb51-24"><a href="#cb51-24" aria-hidden="true" tabindex="-1"></a>        (states[i], alphabet[j]): <span class="bu">float</span>(value)</span>
<span id="cb51-25"><a href="#cb51-25" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i, row <span class="kw">in</span> <span class="bu">enumerate</span>(emission_lines[<span class="dv">1</span>:])</span>
<span id="cb51-26"><a href="#cb51-26" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> j, value <span class="kw">in</span> <span class="bu">enumerate</span>(row.split()[<span class="dv">1</span>:])</span>
<span id="cb51-27"><a href="#cb51-27" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb51-28"><a href="#cb51-28" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb51-29"><a href="#cb51-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> sequence, states, transition_matrix, emission_matrix</span>
<span id="cb51-30"><a href="#cb51-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-31"><a href="#cb51-31" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> viterbi(sequence: <span class="bu">str</span>, states: List[<span class="bu">str</span>], transition_matrix: Dict[Tuple[<span class="bu">str</span>, <span class="bu">str</span>], <span class="bu">float</span>], emission_matrix: Dict[Tuple[<span class="bu">str</span>, <span class="bu">str</span>], <span class="bu">float</span>]) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb51-32"><a href="#cb51-32" aria-hidden="true" tabindex="-1"></a>    num_states <span class="op">=</span> <span class="bu">len</span>(states)</span>
<span id="cb51-33"><a href="#cb51-33" aria-hidden="true" tabindex="-1"></a>    sequence_length <span class="op">=</span> <span class="bu">len</span>(sequence)</span>
<span id="cb51-34"><a href="#cb51-34" aria-hidden="true" tabindex="-1"></a>    viterbi_matrix <span class="op">=</span> np.zeros((sequence_length, num_states))</span>
<span id="cb51-35"><a href="#cb51-35" aria-hidden="true" tabindex="-1"></a>    backpointer <span class="op">=</span> np.zeros((sequence_length, num_states), dtype<span class="op">=</span><span class="bu">int</span>)</span>
<span id="cb51-36"><a href="#cb51-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-37"><a href="#cb51-37" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Initialize the first column of the viterbi matrix</span></span>
<span id="cb51-38"><a href="#cb51-38" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, state <span class="kw">in</span> <span class="bu">enumerate</span>(states):</span>
<span id="cb51-39"><a href="#cb51-39" aria-hidden="true" tabindex="-1"></a>        viterbi_matrix[<span class="dv">0</span>, i] <span class="op">=</span> log(emission_matrix[state, sequence[<span class="dv">0</span>]] <span class="op">/</span> num_states)</span>
<span id="cb51-40"><a href="#cb51-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-41"><a href="#cb51-41" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Fill in the rest of the viterbi matrix</span></span>
<span id="cb51-42"><a href="#cb51-42" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> t <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, sequence_length):</span>
<span id="cb51-43"><a href="#cb51-43" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> j, current_state <span class="kw">in</span> <span class="bu">enumerate</span>(states):</span>
<span id="cb51-44"><a href="#cb51-44" aria-hidden="true" tabindex="-1"></a>            probabilities <span class="op">=</span> [</span>
<span id="cb51-45"><a href="#cb51-45" aria-hidden="true" tabindex="-1"></a>                log(transition_matrix[previous_state, current_state]) <span class="op">+</span> </span>
<span id="cb51-46"><a href="#cb51-46" aria-hidden="true" tabindex="-1"></a>                log(emission_matrix[current_state, sequence[t]]) <span class="op">+</span> </span>
<span id="cb51-47"><a href="#cb51-47" aria-hidden="true" tabindex="-1"></a>                viterbi_matrix[t<span class="op">-</span><span class="dv">1</span>, k]</span>
<span id="cb51-48"><a href="#cb51-48" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> k, previous_state <span class="kw">in</span> <span class="bu">enumerate</span>(states)</span>
<span id="cb51-49"><a href="#cb51-49" aria-hidden="true" tabindex="-1"></a>            ]</span>
<span id="cb51-50"><a href="#cb51-50" aria-hidden="true" tabindex="-1"></a>            max_prob_index <span class="op">=</span> probabilities.index(<span class="bu">max</span>(probabilities))</span>
<span id="cb51-51"><a href="#cb51-51" aria-hidden="true" tabindex="-1"></a>            backpointer[t, j] <span class="op">=</span> max_prob_index</span>
<span id="cb51-52"><a href="#cb51-52" aria-hidden="true" tabindex="-1"></a>            viterbi_matrix[t, j] <span class="op">=</span> <span class="bu">max</span>(probabilities)</span>
<span id="cb51-53"><a href="#cb51-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-54"><a href="#cb51-54" aria-hidden="true" tabindex="-1"></a>    best_path_index <span class="op">=</span> np.argmax(viterbi_matrix[<span class="op">-</span><span class="dv">1</span>, :])</span>
<span id="cb51-55"><a href="#cb51-55" aria-hidden="true" tabindex="-1"></a>    best_path <span class="op">=</span> states[best_path_index]</span>
<span id="cb51-56"><a href="#cb51-56" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> t <span class="kw">in</span> <span class="bu">range</span>(sequence_length <span class="op">-</span> <span class="dv">1</span>, <span class="dv">0</span>, <span class="op">-</span><span class="dv">1</span>):</span>
<span id="cb51-57"><a href="#cb51-57" aria-hidden="true" tabindex="-1"></a>        best_path_index <span class="op">=</span> backpointer[t, best_path_index]</span>
<span id="cb51-58"><a href="#cb51-58" aria-hidden="true" tabindex="-1"></a>        best_path <span class="op">=</span> states[best_path_index] <span class="op">+</span> best_path</span>
<span id="cb51-59"><a href="#cb51-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-60"><a href="#cb51-60" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> best_path</span>
<span id="cb51-61"><a href="#cb51-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-62"><a href="#cb51-62" aria-hidden="true" tabindex="-1"></a><span class="co"># Example usage</span></span>
<span id="cb51-63"><a href="#cb51-63" aria-hidden="true" tabindex="-1"></a>sample_input <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb51-64"><a href="#cb51-64" aria-hidden="true" tabindex="-1"></a><span class="st">xyxzzxyxyy</span></span>
<span id="cb51-65"><a href="#cb51-65" aria-hidden="true" tabindex="-1"></a><span class="st">--------</span></span>
<span id="cb51-66"><a href="#cb51-66" aria-hidden="true" tabindex="-1"></a><span class="st">x   y   z</span></span>
<span id="cb51-67"><a href="#cb51-67" aria-hidden="true" tabindex="-1"></a><span class="st">--------</span></span>
<span id="cb51-68"><a href="#cb51-68" aria-hidden="true" tabindex="-1"></a><span class="st">A   B</span></span>
<span id="cb51-69"><a href="#cb51-69" aria-hidden="true" tabindex="-1"></a><span class="st">--------</span></span>
<span id="cb51-70"><a href="#cb51-70" aria-hidden="true" tabindex="-1"></a><span class="st">    A   B</span></span>
<span id="cb51-71"><a href="#cb51-71" aria-hidden="true" tabindex="-1"></a><span class="st">A   0.641   0.359</span></span>
<span id="cb51-72"><a href="#cb51-72" aria-hidden="true" tabindex="-1"></a><span class="st">B   0.729   0.271</span></span>
<span id="cb51-73"><a href="#cb51-73" aria-hidden="true" tabindex="-1"></a><span class="st">--------</span></span>
<span id="cb51-74"><a href="#cb51-74" aria-hidden="true" tabindex="-1"></a><span class="st">    x   y   z</span></span>
<span id="cb51-75"><a href="#cb51-75" aria-hidden="true" tabindex="-1"></a><span class="st">A   0.117   0.691   0.192   </span></span>
<span id="cb51-76"><a href="#cb51-76" aria-hidden="true" tabindex="-1"></a><span class="st">B   0.097   0.42    0.483</span></span>
<span id="cb51-77"><a href="#cb51-77" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb51-78"><a href="#cb51-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-79"><a href="#cb51-79" aria-hidden="true" tabindex="-1"></a>input_lines <span class="op">=</span> <span class="bu">iter</span>(StringIO(sample_input.strip()).readlines())</span>
<span id="cb51-80"><a href="#cb51-80" aria-hidden="true" tabindex="-1"></a>sequence, states, transition_matrix, emission_matrix <span class="op">=</span> parse_input(input_lines)</span>
<span id="cb51-81"><a href="#cb51-81" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> viterbi(sequence, states, transition_matrix, emission_matrix)</span>
<span id="cb51-82"><a href="#cb51-82" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(result)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="compute-the-probability-of-a-string-emitted-by-an-hmm" class="level1" data-number="18">
<h1 data-number="18"><span class="header-section-number">18</span> Compute the Probability of a String Emitted by an HMM</h1>
<p>Given:&nbsp;A string&nbsp;<em>x</em>, followed by the alphabet&nbsp;<em>Σ</em>&nbsp;from which&nbsp;<em>x</em>&nbsp;was constructed, followed by the states&nbsp;<em>States</em>, transition matrix&nbsp;<em>Transition</em>, and emission matrix&nbsp;<em>Emission</em>&nbsp;of an HMM (<em>Σ</em>,&nbsp;<em>States</em>,&nbsp;<em>Transition</em>,&nbsp;<em>Emission</em>).</p>
<p>Return:&nbsp;The probability Pr(<em>x</em>) that the HMM emits&nbsp;<em>x</em>.</p>
<section id="sample-dataset-17" class="level2" data-number="18.1">
<h2 data-number="18.1" class="anchored" data-anchor-id="sample-dataset-17"><span class="header-section-number">18.1</span> Sample Dataset</h2>
<pre><code>xzyyzzyzyy
--------
x   y   z
--------
A   B
--------
    A   B
A   0.303   0.697 
B   0.831   0.169 
--------
    x   y   z
A   0.533   0.065   0.402 
B   0.342   0.334   0.324</code></pre>
</section>
<section id="sample-output-17" class="level2" data-number="18.2">
<h2 data-number="18.2" class="anchored" data-anchor-id="sample-output-17"><span class="header-section-number">18.2</span> Sample Output</h2>
<pre><code>1.1005510319694847e-06</code></pre>
</section>
<section id="solution-17" class="level2" data-number="18.3">
<h2 data-number="18.3" class="anchored" data-anchor-id="solution-17"><span class="header-section-number">18.3</span> Solution</h2>
<div class="sourceCode" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> io <span class="im">import</span> StringIO</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> parse_hmm_input(input_iterator):</span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>    sequence <span class="op">=</span> <span class="bu">next</span>(input_iterator).rstrip()</span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>    <span class="bu">next</span>(input_iterator)</span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a>    alphabet <span class="op">=</span> <span class="bu">next</span>(input_iterator).split()</span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a>    <span class="bu">next</span>(input_iterator)</span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a>    states <span class="op">=</span> <span class="bu">next</span>(input_iterator).split()</span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a>    <span class="bu">next</span>(input_iterator)</span>
<span id="cb54-11"><a href="#cb54-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb54-12"><a href="#cb54-12" aria-hidden="true" tabindex="-1"></a>    transition_lines <span class="op">=</span> [<span class="bu">next</span>(input_iterator) <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(states) <span class="op">+</span> <span class="dv">1</span>)]</span>
<span id="cb54-13"><a href="#cb54-13" aria-hidden="true" tabindex="-1"></a>    transition_matrix <span class="op">=</span> {</span>
<span id="cb54-14"><a href="#cb54-14" aria-hidden="true" tabindex="-1"></a>        (states[i], states[j]): <span class="bu">float</span>(value)</span>
<span id="cb54-15"><a href="#cb54-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i, row <span class="kw">in</span> <span class="bu">enumerate</span>(transition_lines[<span class="dv">1</span>:])</span>
<span id="cb54-16"><a href="#cb54-16" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> j, value <span class="kw">in</span> <span class="bu">enumerate</span>(row.split()[<span class="dv">1</span>:])</span>
<span id="cb54-17"><a href="#cb54-17" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb54-18"><a href="#cb54-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb54-19"><a href="#cb54-19" aria-hidden="true" tabindex="-1"></a>    <span class="bu">next</span>(input_iterator)</span>
<span id="cb54-20"><a href="#cb54-20" aria-hidden="true" tabindex="-1"></a>    emission_lines <span class="op">=</span> [<span class="bu">next</span>(input_iterator) <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(states) <span class="op">+</span> <span class="dv">1</span>)]</span>
<span id="cb54-21"><a href="#cb54-21" aria-hidden="true" tabindex="-1"></a>    emission_matrix <span class="op">=</span> {</span>
<span id="cb54-22"><a href="#cb54-22" aria-hidden="true" tabindex="-1"></a>        (states[i], alphabet[j]): <span class="bu">float</span>(value)</span>
<span id="cb54-23"><a href="#cb54-23" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i, row <span class="kw">in</span> <span class="bu">enumerate</span>(emission_lines[<span class="dv">1</span>:])</span>
<span id="cb54-24"><a href="#cb54-24" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> j, value <span class="kw">in</span> <span class="bu">enumerate</span>(row.split()[<span class="dv">1</span>:])</span>
<span id="cb54-25"><a href="#cb54-25" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb54-26"><a href="#cb54-26" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb54-27"><a href="#cb54-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> sequence, states, transition_matrix, emission_matrix</span>
<span id="cb54-28"><a href="#cb54-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-29"><a href="#cb54-29" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> calculate_hmm_likelihood(sequence, states, transition_matrix, emission_matrix):</span>
<span id="cb54-30"><a href="#cb54-30" aria-hidden="true" tabindex="-1"></a>    probability_matrix <span class="op">=</span> np.ones((<span class="bu">len</span>(sequence) <span class="op">+</span> <span class="dv">1</span>, <span class="bu">len</span>(states)))</span>
<span id="cb54-31"><a href="#cb54-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-32"><a href="#cb54-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, state <span class="kw">in</span> <span class="bu">enumerate</span>(states):</span>
<span id="cb54-33"><a href="#cb54-33" aria-hidden="true" tabindex="-1"></a>        probability_matrix[<span class="dv">0</span>, i] <span class="op">=</span> emission_matrix[state, sequence[<span class="dv">0</span>]] <span class="op">/</span> <span class="bu">len</span>(states)</span>
<span id="cb54-34"><a href="#cb54-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-35"><a href="#cb54-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, emission <span class="kw">in</span> <span class="bu">enumerate</span>(sequence[<span class="dv">1</span>:], start<span class="op">=</span><span class="dv">1</span>):</span>
<span id="cb54-36"><a href="#cb54-36" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> j, current_state <span class="kw">in</span> <span class="bu">enumerate</span>(states):</span>
<span id="cb54-37"><a href="#cb54-37" aria-hidden="true" tabindex="-1"></a>            probability_matrix[i, j] <span class="op">=</span> <span class="bu">sum</span>(</span>
<span id="cb54-38"><a href="#cb54-38" aria-hidden="true" tabindex="-1"></a>                transition_matrix[previous_state, current_state] <span class="op">*</span> </span>
<span id="cb54-39"><a href="#cb54-39" aria-hidden="true" tabindex="-1"></a>                emission_matrix[current_state, emission] <span class="op">*</span> </span>
<span id="cb54-40"><a href="#cb54-40" aria-hidden="true" tabindex="-1"></a>                probability_matrix[i <span class="op">-</span> <span class="dv">1</span>, k]</span>
<span id="cb54-41"><a href="#cb54-41" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> k, previous_state <span class="kw">in</span> <span class="bu">enumerate</span>(states)</span>
<span id="cb54-42"><a href="#cb54-42" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb54-43"><a href="#cb54-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-44"><a href="#cb54-44" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">sum</span>(probability_matrix[i, :])</span>
<span id="cb54-45"><a href="#cb54-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-46"><a href="#cb54-46" aria-hidden="true" tabindex="-1"></a>sample_input <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb54-47"><a href="#cb54-47" aria-hidden="true" tabindex="-1"></a><span class="st">xzyyzzyzyy</span></span>
<span id="cb54-48"><a href="#cb54-48" aria-hidden="true" tabindex="-1"></a><span class="st">--------</span></span>
<span id="cb54-49"><a href="#cb54-49" aria-hidden="true" tabindex="-1"></a><span class="st">x   y   z</span></span>
<span id="cb54-50"><a href="#cb54-50" aria-hidden="true" tabindex="-1"></a><span class="st">--------</span></span>
<span id="cb54-51"><a href="#cb54-51" aria-hidden="true" tabindex="-1"></a><span class="st">A   B</span></span>
<span id="cb54-52"><a href="#cb54-52" aria-hidden="true" tabindex="-1"></a><span class="st">--------</span></span>
<span id="cb54-53"><a href="#cb54-53" aria-hidden="true" tabindex="-1"></a><span class="st">    A   B</span></span>
<span id="cb54-54"><a href="#cb54-54" aria-hidden="true" tabindex="-1"></a><span class="st">A   0.303   0.697 </span></span>
<span id="cb54-55"><a href="#cb54-55" aria-hidden="true" tabindex="-1"></a><span class="st">B   0.831   0.169 </span></span>
<span id="cb54-56"><a href="#cb54-56" aria-hidden="true" tabindex="-1"></a><span class="st">--------</span></span>
<span id="cb54-57"><a href="#cb54-57" aria-hidden="true" tabindex="-1"></a><span class="st">    x   y   z</span></span>
<span id="cb54-58"><a href="#cb54-58" aria-hidden="true" tabindex="-1"></a><span class="st">A   0.533   0.065   0.402 </span></span>
<span id="cb54-59"><a href="#cb54-59" aria-hidden="true" tabindex="-1"></a><span class="st">B   0.342   0.334   0.324</span></span>
<span id="cb54-60"><a href="#cb54-60" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb54-61"><a href="#cb54-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-62"><a href="#cb54-62" aria-hidden="true" tabindex="-1"></a>input_lines <span class="op">=</span> <span class="bu">iter</span>(StringIO(sample_input.strip()).readlines())</span>
<span id="cb54-63"><a href="#cb54-63" aria-hidden="true" tabindex="-1"></a>sequence, states, transition_matrix, emission_matrix <span class="op">=</span> parse_hmm_input(input_lines)</span>
<span id="cb54-64"><a href="#cb54-64" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> calculate_hmm_likelihood(sequence, states, transition_matrix, emission_matrix)</span>
<span id="cb54-65"><a href="#cb54-65" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(result)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="construct-a-profile-hmm" class="level1" data-number="19">
<h1 data-number="19"><span class="header-section-number">19</span> Construct a Profile HMM</h1>
<p>Given:&nbsp;A threshold&nbsp;<em>θ</em>, followed by an alphabet&nbsp;<em>Σ</em>, followed by a multiple alignment&nbsp;<em>Alignment</em>&nbsp;whose strings are formed from&nbsp;<em>Σ</em>.</p>
<p>Return:&nbsp;The transition and emission probabilities of the profile HMM&nbsp;<em>HMM</em>(<em>Alignment</em>,&nbsp;<em>θ</em>).</p>
<section id="sample-dataset-18" class="level2" data-number="19.1">
<h2 data-number="19.1" class="anchored" data-anchor-id="sample-dataset-18"><span class="header-section-number">19.1</span> Sample Dataset</h2>
<pre><code>0.289
--------
A   B   C   D   E
--------
EBA
EBD
EB-
EED
EBD
EBE
E-D
EBD</code></pre>
</section>
<section id="sample-output-18" class="level2" data-number="19.2">
<h2 data-number="19.2" class="anchored" data-anchor-id="sample-output-18"><span class="header-section-number">19.2</span> Sample Output</h2>
<pre><code>S   I0  M1  D1  I1  M2  D2  I2  M3  D3  I3  E
S   0   0   1.0 0   0   0   0   0   0   0   0   0
I0  0   0   0   0   0   0   0   0   0   0   0   0
M1  0   0   0   0   0   0.875   0.125   0   0   0   0   0
D1  0   0   0   0   0   0   0   0   0   0   0   0
I1  0   0   0   0   0   0   0   0   0   0   0   0
M2  0   0   0   0   0   0   0   0   0.857   0.143   0   0
D2  0   0   0   0   0   0   0   0   1.0 0   0   0
I2  0   0   0   0   0   0   0   0   0   0   0   0
M3  0   0   0   0   0   0   0   0   0   0   0   1.0
D3  0   0   0   0   0   0   0   0   0   0   0   1.0
I3  0   0   0   0   0   0   0   0   0   0   0   0
E   0   0   0   0   0   0   0   0   0   0   0   0
--------
    A   B   C   D   E
S   0   0   0   0   0
I0  0   0   0   0   0
M1  0   0   0   0   1.0
D1  0   0   0   0   0
I1  0   0   0   0   0
M2  0   0.857   0   0   0.143
D2  0   0   0   0   0
I2  0   0   0   0   0
M3  0.143   0   0   0.714   0.143
D3  0   0   0   0   0
I3  0   0   0   0   0
E   0   0   0   0   0</code></pre>
</section>
<section id="solution-18" class="level2" data-number="19.3">
<h2 data-number="19.3" class="anchored" data-anchor-id="solution-18"><span class="header-section-number">19.3</span> Solution</h2>
<div class="sourceCode" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> io <span class="im">import</span> StringIO</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> typing <span class="im">import</span> List, Tuple, Iterator</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> parse_hmm_input(input_iterator: Iterator[<span class="bu">str</span>]) <span class="op">-&gt;</span> Tuple[<span class="bu">float</span>, List[<span class="bu">str</span>], np.ndarray]:</span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>    threshold <span class="op">=</span> <span class="bu">float</span>(<span class="bu">next</span>(input_iterator).rstrip())</span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a>    <span class="bu">next</span>(input_iterator)</span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a>    alphabet <span class="op">=</span> <span class="bu">next</span>(input_iterator).split()</span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a>    <span class="bu">next</span>(input_iterator)</span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a>    alignment <span class="op">=</span> np.array([<span class="bu">list</span>(sequence.strip()) <span class="cf">for</span> sequence <span class="kw">in</span> input_iterator])</span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> threshold, alphabet, alignment</span>
<span id="cb57-12"><a href="#cb57-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-13"><a href="#cb57-13" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> calculate_state_index(position: <span class="bu">int</span>, state_type: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="bu">int</span>:</span>
<span id="cb57-14"><a href="#cb57-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> state_type <span class="op">==</span> <span class="st">"ins"</span>:</span>
<span id="cb57-15"><a href="#cb57-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> (position <span class="op">+</span> <span class="dv">1</span>) <span class="op">*</span> <span class="dv">3</span> <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb57-16"><a href="#cb57-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb57-17"><a href="#cb57-17" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> {<span class="st">"match"</span>: <span class="dv">0</span>, <span class="st">"del"</span>: <span class="dv">1</span>}[state_type] <span class="op">+</span> <span class="dv">3</span> <span class="op">*</span> position <span class="op">+</span> <span class="dv">2</span></span>
<span id="cb57-18"><a href="#cb57-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-19"><a href="#cb57-19" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> normalize_row(row: np.ndarray, include_zeros: <span class="bu">bool</span> <span class="op">=</span> <span class="va">False</span>, min_value: <span class="bu">float</span> <span class="op">=</span> <span class="fl">0.0</span>) <span class="op">-&gt;</span> np.ndarray:</span>
<span id="cb57-20"><a href="#cb57-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> include_zeros <span class="kw">and</span> <span class="bu">sum</span>(row) <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb57-21"><a href="#cb57-21" aria-hidden="true" tabindex="-1"></a>        row[:] <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb57-22"><a href="#cb57-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> np.errstate(divide<span class="op">=</span><span class="st">"ignore"</span>, invalid<span class="op">=</span><span class="st">"ignore"</span>):</span>
<span id="cb57-23"><a href="#cb57-23" aria-hidden="true" tabindex="-1"></a>        normalized <span class="op">=</span> row <span class="op">/</span> <span class="bu">sum</span>(row)</span>
<span id="cb57-24"><a href="#cb57-24" aria-hidden="true" tabindex="-1"></a>        normalized[row <span class="op">==</span> <span class="fl">0.0</span>] <span class="op">=</span> min_value</span>
<span id="cb57-25"><a href="#cb57-25" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> normalized</span>
<span id="cb57-26"><a href="#cb57-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-27"><a href="#cb57-27" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> normalize_matrix(matrix: np.ndarray, include_zeros: <span class="bu">bool</span> <span class="op">=</span> <span class="va">False</span>, min_value: <span class="bu">float</span> <span class="op">=</span> <span class="fl">0.0</span>) <span class="op">-&gt;</span> np.ndarray:</span>
<span id="cb57-28"><a href="#cb57-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> np.array([normalize_row(row, include_zeros<span class="op">=</span>include_zeros, min_value<span class="op">=</span>min_value) <span class="cf">for</span> row <span class="kw">in</span> matrix])</span>
<span id="cb57-29"><a href="#cb57-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-30"><a href="#cb57-30" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> print_matrix(matrix: np.ndarray, row_labels: List[<span class="bu">str</span>], column_labels: List[<span class="bu">str</span>]) <span class="op">-&gt;</span> <span class="va">None</span>:</span>
<span id="cb57-31"><a href="#cb57-31" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="op">*</span>column_labels, sep<span class="op">=</span><span class="st">"</span><span class="ch">\t</span><span class="st">"</span>)</span>
<span id="cb57-32"><a href="#cb57-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, row <span class="kw">in</span> <span class="bu">enumerate</span>(matrix):</span>
<span id="cb57-33"><a href="#cb57-33" aria-hidden="true" tabindex="-1"></a>        formatted_row <span class="op">=</span> [row_labels[i]] <span class="op">+</span> [<span class="bu">round</span>(x, <span class="dv">3</span>) <span class="cf">if</span> x <span class="op">&gt;</span> <span class="fl">0.0</span> <span class="cf">else</span> <span class="st">"0"</span> <span class="cf">for</span> x <span class="kw">in</span> row]</span>
<span id="cb57-34"><a href="#cb57-34" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="op">*</span>formatted_row, sep<span class="op">=</span><span class="st">"</span><span class="ch">\t</span><span class="st">"</span>)</span>
<span id="cb57-35"><a href="#cb57-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-36"><a href="#cb57-36" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> print_transition_probabilities(transition_matrix: np.ndarray) <span class="op">-&gt;</span> <span class="va">None</span>:</span>
<span id="cb57-37"><a href="#cb57-37" aria-hidden="true" tabindex="-1"></a>    n <span class="op">=</span> (transition_matrix.shape[<span class="dv">0</span>] <span class="op">-</span> <span class="dv">3</span>) <span class="op">//</span> <span class="dv">3</span></span>
<span id="cb57-38"><a href="#cb57-38" aria-hidden="true" tabindex="-1"></a>    print_matrix(transition_matrix, generate_state_labels(n), generate_state_labels(n))</span>
<span id="cb57-39"><a href="#cb57-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-40"><a href="#cb57-40" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> print_emission_probabilities(emission_matrix: np.ndarray, alphabet: List[<span class="bu">str</span>]) <span class="op">-&gt;</span> <span class="va">None</span>:</span>
<span id="cb57-41"><a href="#cb57-41" aria-hidden="true" tabindex="-1"></a>    n <span class="op">=</span> (emission_matrix.shape[<span class="dv">0</span>] <span class="op">-</span> <span class="dv">3</span>) <span class="op">//</span> <span class="dv">3</span></span>
<span id="cb57-42"><a href="#cb57-42" aria-hidden="true" tabindex="-1"></a>    print_matrix(emission_matrix, generate_state_labels(n), alphabet)</span>
<span id="cb57-43"><a href="#cb57-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-44"><a href="#cb57-44" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> generate_state_labels(n: <span class="bu">int</span>) <span class="op">-&gt;</span> List[<span class="bu">str</span>]:</span>
<span id="cb57-45"><a href="#cb57-45" aria-hidden="true" tabindex="-1"></a>    labels <span class="op">=</span> [<span class="st">"S"</span>, <span class="st">"I0"</span>]</span>
<span id="cb57-46"><a href="#cb57-46" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, n <span class="op">+</span> <span class="dv">1</span>):</span>
<span id="cb57-47"><a href="#cb57-47" aria-hidden="true" tabindex="-1"></a>        labels <span class="op">+=</span> [<span class="ss">f"M</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">"</span>, <span class="ss">f"D</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">"</span>, <span class="ss">f"I</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">"</span>]</span>
<span id="cb57-48"><a href="#cb57-48" aria-hidden="true" tabindex="-1"></a>    labels.append(<span class="st">"E"</span>)</span>
<span id="cb57-49"><a href="#cb57-49" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> labels</span>
<span id="cb57-50"><a href="#cb57-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-51"><a href="#cb57-51" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> create_transition_matrix(n: <span class="bu">int</span>) <span class="op">-&gt;</span> np.ndarray:</span>
<span id="cb57-52"><a href="#cb57-52" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> np.zeros((n <span class="op">*</span> <span class="dv">3</span> <span class="op">+</span> <span class="dv">3</span>, n <span class="op">*</span> <span class="dv">3</span> <span class="op">+</span> <span class="dv">3</span>), dtype<span class="op">=</span><span class="bu">float</span>)</span>
<span id="cb57-53"><a href="#cb57-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-54"><a href="#cb57-54" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> create_emission_matrix(n: <span class="bu">int</span>, m: <span class="bu">int</span>) <span class="op">-&gt;</span> np.ndarray:</span>
<span id="cb57-55"><a href="#cb57-55" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> np.zeros((n <span class="op">*</span> <span class="dv">3</span> <span class="op">+</span> <span class="dv">3</span>, m), dtype<span class="op">=</span><span class="bu">float</span>)</span>
<span id="cb57-56"><a href="#cb57-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-57"><a href="#cb57-57" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> build_profile_hmm(threshold: <span class="bu">float</span>, alphabet: List[<span class="bu">str</span>], alignment: np.ndarray) <span class="op">-&gt;</span> Tuple[np.ndarray, np.ndarray]:</span>
<span id="cb57-58"><a href="#cb57-58" aria-hidden="true" tabindex="-1"></a>    valid_columns <span class="op">=</span> np.mean(alignment <span class="op">==</span> <span class="st">"-"</span>, axis<span class="op">=</span><span class="dv">0</span>) <span class="op">&lt;</span> threshold</span>
<span id="cb57-59"><a href="#cb57-59" aria-hidden="true" tabindex="-1"></a>    valid_column_count <span class="op">=</span> <span class="bu">sum</span>(valid_columns)</span>
<span id="cb57-60"><a href="#cb57-60" aria-hidden="true" tabindex="-1"></a>    end_state <span class="op">=</span> valid_column_count <span class="op">*</span> <span class="dv">3</span> <span class="op">+</span> <span class="dv">2</span></span>
<span id="cb57-61"><a href="#cb57-61" aria-hidden="true" tabindex="-1"></a>    transition_probs <span class="op">=</span> create_transition_matrix(valid_column_count)</span>
<span id="cb57-62"><a href="#cb57-62" aria-hidden="true" tabindex="-1"></a>    emission_probs <span class="op">=</span> create_emission_matrix(valid_column_count, <span class="bu">len</span>(alphabet))</span>
<span id="cb57-63"><a href="#cb57-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-64"><a href="#cb57-64" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> sequence <span class="kw">in</span> alignment:</span>
<span id="cb57-65"><a href="#cb57-65" aria-hidden="true" tabindex="-1"></a>        prev_index <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb57-66"><a href="#cb57-66" aria-hidden="true" tabindex="-1"></a>        column_index <span class="op">=</span> <span class="op">-</span><span class="dv">1</span></span>
<span id="cb57-67"><a href="#cb57-67" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i, char <span class="kw">in</span> <span class="bu">enumerate</span>(sequence):</span>
<span id="cb57-68"><a href="#cb57-68" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> valid_columns[i]:</span>
<span id="cb57-69"><a href="#cb57-69" aria-hidden="true" tabindex="-1"></a>                column_index <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb57-70"><a href="#cb57-70" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> char <span class="op">==</span> <span class="st">"-"</span>:</span>
<span id="cb57-71"><a href="#cb57-71" aria-hidden="true" tabindex="-1"></a>                    current_index <span class="op">=</span> calculate_state_index(column_index, <span class="st">"del"</span>)</span>
<span id="cb57-72"><a href="#cb57-72" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb57-73"><a href="#cb57-73" aria-hidden="true" tabindex="-1"></a>                    current_index <span class="op">=</span> calculate_state_index(column_index, <span class="st">"match"</span>)</span>
<span id="cb57-74"><a href="#cb57-74" aria-hidden="true" tabindex="-1"></a>                transition_probs[prev_index, current_index] <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb57-75"><a href="#cb57-75" aria-hidden="true" tabindex="-1"></a>                prev_index <span class="op">=</span> current_index</span>
<span id="cb57-76"><a href="#cb57-76" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb57-77"><a href="#cb57-77" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> char <span class="op">!=</span> <span class="st">"-"</span>:</span>
<span id="cb57-78"><a href="#cb57-78" aria-hidden="true" tabindex="-1"></a>                    current_index <span class="op">=</span> calculate_state_index(column_index, <span class="st">"ins"</span>)</span>
<span id="cb57-79"><a href="#cb57-79" aria-hidden="true" tabindex="-1"></a>                    transition_probs[prev_index, current_index] <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb57-80"><a href="#cb57-80" aria-hidden="true" tabindex="-1"></a>                    prev_index <span class="op">=</span> current_index</span>
<span id="cb57-81"><a href="#cb57-81" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> char <span class="op">!=</span> <span class="st">"-"</span>:</span>
<span id="cb57-82"><a href="#cb57-82" aria-hidden="true" tabindex="-1"></a>                emission_probs[current_index, alphabet.index(char)] <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb57-83"><a href="#cb57-83" aria-hidden="true" tabindex="-1"></a>        transition_probs[prev_index, end_state] <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb57-84"><a href="#cb57-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-85"><a href="#cb57-85" aria-hidden="true" tabindex="-1"></a>    transition_probs <span class="op">=</span> normalize_matrix(transition_probs)</span>
<span id="cb57-86"><a href="#cb57-86" aria-hidden="true" tabindex="-1"></a>    emission_probs <span class="op">=</span> normalize_matrix(emission_probs)</span>
<span id="cb57-87"><a href="#cb57-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-88"><a href="#cb57-88" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> transition_probs, emission_probs</span>
<span id="cb57-89"><a href="#cb57-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-90"><a href="#cb57-90" aria-hidden="true" tabindex="-1"></a>sample_input <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb57-91"><a href="#cb57-91" aria-hidden="true" tabindex="-1"></a><span class="st">0.289</span></span>
<span id="cb57-92"><a href="#cb57-92" aria-hidden="true" tabindex="-1"></a><span class="st">--------</span></span>
<span id="cb57-93"><a href="#cb57-93" aria-hidden="true" tabindex="-1"></a><span class="st">A   B   C   D   E</span></span>
<span id="cb57-94"><a href="#cb57-94" aria-hidden="true" tabindex="-1"></a><span class="st">--------</span></span>
<span id="cb57-95"><a href="#cb57-95" aria-hidden="true" tabindex="-1"></a><span class="st">EBA</span></span>
<span id="cb57-96"><a href="#cb57-96" aria-hidden="true" tabindex="-1"></a><span class="st">EBD</span></span>
<span id="cb57-97"><a href="#cb57-97" aria-hidden="true" tabindex="-1"></a><span class="st">EB-</span></span>
<span id="cb57-98"><a href="#cb57-98" aria-hidden="true" tabindex="-1"></a><span class="st">EED</span></span>
<span id="cb57-99"><a href="#cb57-99" aria-hidden="true" tabindex="-1"></a><span class="st">EBD</span></span>
<span id="cb57-100"><a href="#cb57-100" aria-hidden="true" tabindex="-1"></a><span class="st">EBE</span></span>
<span id="cb57-101"><a href="#cb57-101" aria-hidden="true" tabindex="-1"></a><span class="st">E-D</span></span>
<span id="cb57-102"><a href="#cb57-102" aria-hidden="true" tabindex="-1"></a><span class="st">EBD</span></span>
<span id="cb57-103"><a href="#cb57-103" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb57-104"><a href="#cb57-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-105"><a href="#cb57-105" aria-hidden="true" tabindex="-1"></a>input_lines <span class="op">=</span> <span class="bu">iter</span>(StringIO(sample_input.strip()).readlines())</span>
<span id="cb57-106"><a href="#cb57-106" aria-hidden="true" tabindex="-1"></a>threshold, alphabet, alignment <span class="op">=</span> parse_hmm_input(input_lines)</span>
<span id="cb57-107"><a href="#cb57-107" aria-hidden="true" tabindex="-1"></a>transition_probs, emission_probs <span class="op">=</span> build_profile_hmm(threshold, alphabet, alignment)</span>
<span id="cb57-108"><a href="#cb57-108" aria-hidden="true" tabindex="-1"></a>print_transition_probabilities(transition_probs)</span>
<span id="cb57-109"><a href="#cb57-109" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"--------"</span>)</span>
<span id="cb57-110"><a href="#cb57-110" aria-hidden="true" tabindex="-1"></a>print_emission_probabilities(emission_probs, alphabet)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="construct-a-profile-hmm-with-pseudocounts" class="level1" data-number="20">
<h1 data-number="20"><span class="header-section-number">20</span> Construct a Profile HMM with Pseudocounts</h1>
<p>Given:&nbsp;A threshold&nbsp;<em>θ</em>&nbsp;and a pseudocount&nbsp;<em>σ</em>, followed by an alphabet&nbsp;<em>Σ</em>, followed by a multiple alignment&nbsp;<em>Alignment</em>&nbsp;whose strings are formed from&nbsp;<em>Σ</em>.</p>
<p>Return:&nbsp;The transition and emission probabilities of the profile HMM&nbsp;<em>HMM</em>(<em>Alignment</em>,&nbsp;<em>θ</em>,&nbsp;<em>σ</em>).</p>
<section id="sample-dataset-19" class="level2" data-number="20.1">
<h2 data-number="20.1" class="anchored" data-anchor-id="sample-dataset-19"><span class="header-section-number">20.1</span> Sample Dataset</h2>
<pre><code>0.358   0.01
--------
A   B   C   D   E
--------
ADA
ADA
AAA
ADC
-DA
D-A</code></pre>
</section>
<section id="sample-output-19" class="level2" data-number="20.2">
<h2 data-number="20.2" class="anchored" data-anchor-id="sample-output-19"><span class="header-section-number">20.2</span> Sample Output</h2>
<pre><code>S   I0  M1  D1  I1  M2  D2  I2  M3  D3  I3  E
S   0   0.01    0.819   0.172   0   0   0   0   0   0   0   0
I0  0   0.333   0.333   0.333   0   0   0   0   0   0   0   0
M1  0   0   0   0   0.01    0.786   0.204   0   0   0   0   0
D1  0   0   0   0   0.01    0.981   0.01    0   0   0   0   0
I1  0   0   0   0   0.333   0.333   0.333   0   0   0   0   0
M2  0   0   0   0   0   0   0   0.01    0.981   0.01    0   0
D2  0   0   0   0   0   0   0   0.01    0.981   0.01    0   0
I2  0   0   0   0   0   0   0   0.333   0.333   0.333   0   0
M3  0   0   0   0   0   0   0   0   0   0   0.01    0.99
D3  0   0   0   0   0   0   0   0   0   0   0.5 0.5
I3  0   0   0   0   0   0   0   0   0   0   0.5 0.5
E   0   0   0   0   0   0   0   0   0   0   0   0
--------
    A   B   C   D   E
S   0   0   0   0   0
I0  0.2 0.2 0.2 0.2 0.2
M1  0.771   0.01    0.01    0.2 0.01
D1  0   0   0   0   0
I1  0.2 0.2 0.2 0.2 0.2
M2  0.2 0.01    0.01    0.771   0.01
D2  0   0   0   0   0
I2  0.2 0.2 0.2 0.2 0.2
M3  0.803   0.01    0.168   0.01    0.01
D3  0   0   0   0   0
I3  0.2 0.2 0.2 0.2 0.2
E   0   0   0   0   0</code></pre>
</section>
<section id="solution-19" class="level2" data-number="20.3">
<h2 data-number="20.3" class="anchored" data-anchor-id="solution-19"><span class="header-section-number">20.3</span> Solution</h2>
<div class="sourceCode" id="cb60"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> io <span class="im">import</span> StringIO</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> typing <span class="im">import</span> List, Tuple</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> normalize_matrix(matrix: np.ndarray, include_zeros: <span class="bu">bool</span> <span class="op">=</span> <span class="va">False</span>, min_value: <span class="bu">float</span> <span class="op">=</span> <span class="fl">0.0</span>) <span class="op">-&gt;</span> np.ndarray:</span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> np.array([normalize_row(row, include_zeros<span class="op">=</span>include_zeros, min_value<span class="op">=</span>min_value) <span class="cf">for</span> row <span class="kw">in</span> matrix])</span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> normalize_row(row: np.ndarray, include_zeros: <span class="bu">bool</span> <span class="op">=</span> <span class="va">False</span>, min_value: <span class="bu">float</span> <span class="op">=</span> <span class="fl">0.0</span>) <span class="op">-&gt;</span> np.ndarray:</span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> include_zeros <span class="kw">and</span> <span class="bu">sum</span>(row) <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a>        row[:] <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb60-11"><a href="#cb60-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> np.errstate(divide<span class="op">=</span><span class="st">"ignore"</span>, invalid<span class="op">=</span><span class="st">"ignore"</span>):</span>
<span id="cb60-12"><a href="#cb60-12" aria-hidden="true" tabindex="-1"></a>        normalized <span class="op">=</span> row <span class="op">/</span> <span class="bu">sum</span>(row)</span>
<span id="cb60-13"><a href="#cb60-13" aria-hidden="true" tabindex="-1"></a>        normalized[row <span class="op">==</span> <span class="fl">0.0</span>] <span class="op">=</span> min_value</span>
<span id="cb60-14"><a href="#cb60-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> normalized</span>
<span id="cb60-15"><a href="#cb60-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-16"><a href="#cb60-16" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> print_matrix(matrix: np.ndarray, row_labels: List[<span class="bu">str</span>], col_labels: List[<span class="bu">str</span>]) <span class="op">-&gt;</span> <span class="va">None</span>:</span>
<span id="cb60-17"><a href="#cb60-17" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="op">*</span>col_labels, sep<span class="op">=</span><span class="st">"</span><span class="ch">\t</span><span class="st">"</span>)</span>
<span id="cb60-18"><a href="#cb60-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, row <span class="kw">in</span> <span class="bu">enumerate</span>(matrix):</span>
<span id="cb60-19"><a href="#cb60-19" aria-hidden="true" tabindex="-1"></a>        formatted_row <span class="op">=</span> [row_labels[i]] <span class="op">+</span> [<span class="bu">round</span>(x, <span class="dv">3</span>) <span class="cf">if</span> x <span class="op">&gt;</span> <span class="fl">0.0</span> <span class="cf">else</span> <span class="st">"0"</span> <span class="cf">for</span> x <span class="kw">in</span> row]</span>
<span id="cb60-20"><a href="#cb60-20" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="op">*</span>formatted_row, sep<span class="op">=</span><span class="st">"</span><span class="ch">\t</span><span class="st">"</span>)</span>
<span id="cb60-21"><a href="#cb60-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-22"><a href="#cb60-22" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> print_transition_probs(transition_matrix: np.ndarray) <span class="op">-&gt;</span> <span class="va">None</span>:</span>
<span id="cb60-23"><a href="#cb60-23" aria-hidden="true" tabindex="-1"></a>    n <span class="op">=</span> (transition_matrix.shape[<span class="dv">0</span>] <span class="op">-</span> <span class="dv">3</span>) <span class="op">//</span> <span class="dv">3</span></span>
<span id="cb60-24"><a href="#cb60-24" aria-hidden="true" tabindex="-1"></a>    print_matrix(transition_matrix, generate_state_labels(n), generate_state_labels(n))</span>
<span id="cb60-25"><a href="#cb60-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-26"><a href="#cb60-26" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> print_emission_probs(emission_matrix: np.ndarray, alphabet: List[<span class="bu">str</span>]) <span class="op">-&gt;</span> <span class="va">None</span>:</span>
<span id="cb60-27"><a href="#cb60-27" aria-hidden="true" tabindex="-1"></a>    n <span class="op">=</span> (emission_matrix.shape[<span class="dv">0</span>] <span class="op">-</span> <span class="dv">3</span>) <span class="op">//</span> <span class="dv">3</span></span>
<span id="cb60-28"><a href="#cb60-28" aria-hidden="true" tabindex="-1"></a>    print_matrix(emission_matrix, generate_state_labels(n), alphabet)</span>
<span id="cb60-29"><a href="#cb60-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-30"><a href="#cb60-30" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> generate_state_labels(n: <span class="bu">int</span>) <span class="op">-&gt;</span> List[<span class="bu">str</span>]:</span>
<span id="cb60-31"><a href="#cb60-31" aria-hidden="true" tabindex="-1"></a>    labels <span class="op">=</span> [<span class="st">"S"</span>, <span class="st">"I0"</span>]</span>
<span id="cb60-32"><a href="#cb60-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, n <span class="op">+</span> <span class="dv">1</span>):</span>
<span id="cb60-33"><a href="#cb60-33" aria-hidden="true" tabindex="-1"></a>        labels <span class="op">+=</span> [<span class="ss">f"M</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">"</span>, <span class="ss">f"D</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">"</span>, <span class="ss">f"I</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">"</span>]</span>
<span id="cb60-34"><a href="#cb60-34" aria-hidden="true" tabindex="-1"></a>    labels.append(<span class="st">"E"</span>)</span>
<span id="cb60-35"><a href="#cb60-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> labels</span>
<span id="cb60-36"><a href="#cb60-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-37"><a href="#cb60-37" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> create_transition_matrix(n: <span class="bu">int</span>) <span class="op">-&gt;</span> np.ndarray:</span>
<span id="cb60-38"><a href="#cb60-38" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> np.zeros((n <span class="op">*</span> <span class="dv">3</span> <span class="op">+</span> <span class="dv">3</span>, n <span class="op">*</span> <span class="dv">3</span> <span class="op">+</span> <span class="dv">3</span>), dtype<span class="op">=</span><span class="bu">float</span>)</span>
<span id="cb60-39"><a href="#cb60-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-40"><a href="#cb60-40" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> create_emission_matrix(n: <span class="bu">int</span>, m: <span class="bu">int</span>) <span class="op">-&gt;</span> np.ndarray:</span>
<span id="cb60-41"><a href="#cb60-41" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> np.zeros((n <span class="op">*</span> <span class="dv">3</span> <span class="op">+</span> <span class="dv">3</span>, m), dtype<span class="op">=</span><span class="bu">float</span>)</span>
<span id="cb60-42"><a href="#cb60-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-43"><a href="#cb60-43" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> calculate_state_index(position: <span class="bu">int</span>, state_type: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="bu">int</span>:</span>
<span id="cb60-44"><a href="#cb60-44" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> state_type <span class="op">==</span> <span class="st">"ins"</span>:</span>
<span id="cb60-45"><a href="#cb60-45" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> (position <span class="op">+</span> <span class="dv">1</span>) <span class="op">*</span> <span class="dv">3</span> <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb60-46"><a href="#cb60-46" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb60-47"><a href="#cb60-47" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> {<span class="st">"match"</span>: <span class="dv">0</span>, <span class="st">"del"</span>: <span class="dv">1</span>}[state_type] <span class="op">+</span> <span class="dv">3</span> <span class="op">*</span> position <span class="op">+</span> <span class="dv">2</span></span>
<span id="cb60-48"><a href="#cb60-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-49"><a href="#cb60-49" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> build_profile_hmm(threshold: <span class="bu">float</span>, alphabet: List[<span class="bu">str</span>], alignment: np.ndarray) <span class="op">-&gt;</span> Tuple[np.ndarray, np.ndarray]:</span>
<span id="cb60-50"><a href="#cb60-50" aria-hidden="true" tabindex="-1"></a>    valid_columns <span class="op">=</span> np.mean(alignment <span class="op">==</span> <span class="st">"-"</span>, axis<span class="op">=</span><span class="dv">0</span>) <span class="op">&lt;</span> threshold</span>
<span id="cb60-51"><a href="#cb60-51" aria-hidden="true" tabindex="-1"></a>    valid_column_count <span class="op">=</span> <span class="bu">sum</span>(valid_columns)</span>
<span id="cb60-52"><a href="#cb60-52" aria-hidden="true" tabindex="-1"></a>    end_state <span class="op">=</span> valid_column_count <span class="op">*</span> <span class="dv">3</span> <span class="op">+</span> <span class="dv">2</span></span>
<span id="cb60-53"><a href="#cb60-53" aria-hidden="true" tabindex="-1"></a>    transition_probs <span class="op">=</span> create_transition_matrix(valid_column_count)</span>
<span id="cb60-54"><a href="#cb60-54" aria-hidden="true" tabindex="-1"></a>    emission_probs <span class="op">=</span> create_emission_matrix(valid_column_count, <span class="bu">len</span>(alphabet))</span>
<span id="cb60-55"><a href="#cb60-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-56"><a href="#cb60-56" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> sequence <span class="kw">in</span> alignment:</span>
<span id="cb60-57"><a href="#cb60-57" aria-hidden="true" tabindex="-1"></a>        prev_index <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb60-58"><a href="#cb60-58" aria-hidden="true" tabindex="-1"></a>        column_index <span class="op">=</span> <span class="op">-</span><span class="dv">1</span></span>
<span id="cb60-59"><a href="#cb60-59" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i, char <span class="kw">in</span> <span class="bu">enumerate</span>(sequence):</span>
<span id="cb60-60"><a href="#cb60-60" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> valid_columns[i]:</span>
<span id="cb60-61"><a href="#cb60-61" aria-hidden="true" tabindex="-1"></a>                column_index <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb60-62"><a href="#cb60-62" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> char <span class="op">==</span> <span class="st">"-"</span>:</span>
<span id="cb60-63"><a href="#cb60-63" aria-hidden="true" tabindex="-1"></a>                    current_index <span class="op">=</span> calculate_state_index(column_index, <span class="st">"del"</span>)</span>
<span id="cb60-64"><a href="#cb60-64" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb60-65"><a href="#cb60-65" aria-hidden="true" tabindex="-1"></a>                    current_index <span class="op">=</span> calculate_state_index(column_index, <span class="st">"match"</span>)</span>
<span id="cb60-66"><a href="#cb60-66" aria-hidden="true" tabindex="-1"></a>                transition_probs[prev_index, current_index] <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb60-67"><a href="#cb60-67" aria-hidden="true" tabindex="-1"></a>                prev_index <span class="op">=</span> current_index</span>
<span id="cb60-68"><a href="#cb60-68" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb60-69"><a href="#cb60-69" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> char <span class="op">!=</span> <span class="st">"-"</span>:</span>
<span id="cb60-70"><a href="#cb60-70" aria-hidden="true" tabindex="-1"></a>                    current_index <span class="op">=</span> calculate_state_index(column_index, <span class="st">"ins"</span>)</span>
<span id="cb60-71"><a href="#cb60-71" aria-hidden="true" tabindex="-1"></a>                    transition_probs[prev_index, current_index] <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb60-72"><a href="#cb60-72" aria-hidden="true" tabindex="-1"></a>                    prev_index <span class="op">=</span> current_index</span>
<span id="cb60-73"><a href="#cb60-73" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> char <span class="op">!=</span> <span class="st">"-"</span>:</span>
<span id="cb60-74"><a href="#cb60-74" aria-hidden="true" tabindex="-1"></a>                emission_probs[current_index, alphabet.index(char)] <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb60-75"><a href="#cb60-75" aria-hidden="true" tabindex="-1"></a>        transition_probs[prev_index, end_state] <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb60-76"><a href="#cb60-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-77"><a href="#cb60-77" aria-hidden="true" tabindex="-1"></a>    transition_probs <span class="op">=</span> normalize_matrix(transition_probs)</span>
<span id="cb60-78"><a href="#cb60-78" aria-hidden="true" tabindex="-1"></a>    emission_probs <span class="op">=</span> normalize_matrix(emission_probs)</span>
<span id="cb60-79"><a href="#cb60-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-80"><a href="#cb60-80" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> transition_probs, emission_probs</span>
<span id="cb60-81"><a href="#cb60-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-82"><a href="#cb60-82" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> parse_input(input_handle: Iterator[<span class="bu">str</span>]) <span class="op">-&gt;</span> Tuple[<span class="bu">float</span>, <span class="bu">float</span>, List[<span class="bu">str</span>], np.ndarray]:</span>
<span id="cb60-83"><a href="#cb60-83" aria-hidden="true" tabindex="-1"></a>    threshold, pseudocount <span class="op">=</span> <span class="bu">map</span>(<span class="bu">float</span>, <span class="bu">next</span>(input_handle).rstrip().split())</span>
<span id="cb60-84"><a href="#cb60-84" aria-hidden="true" tabindex="-1"></a>    <span class="bu">next</span>(input_handle)</span>
<span id="cb60-85"><a href="#cb60-85" aria-hidden="true" tabindex="-1"></a>    alphabet <span class="op">=</span> <span class="bu">next</span>(input_handle).split()</span>
<span id="cb60-86"><a href="#cb60-86" aria-hidden="true" tabindex="-1"></a>    <span class="bu">next</span>(input_handle)</span>
<span id="cb60-87"><a href="#cb60-87" aria-hidden="true" tabindex="-1"></a>    alignment <span class="op">=</span> np.array([<span class="bu">list</span>(sequence.strip()) <span class="cf">for</span> sequence <span class="kw">in</span> input_handle])</span>
<span id="cb60-88"><a href="#cb60-88" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> threshold, pseudocount, alphabet, alignment</span>
<span id="cb60-89"><a href="#cb60-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-90"><a href="#cb60-90" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> add_transition_pseudocounts(transition_matrix: np.ndarray, pseudocount: <span class="bu">float</span>) <span class="op">-&gt;</span> np.ndarray:</span>
<span id="cb60-91"><a href="#cb60-91" aria-hidden="true" tabindex="-1"></a>    n <span class="op">=</span> (transition_matrix.shape[<span class="dv">0</span>] <span class="op">-</span> <span class="dv">3</span>) <span class="op">//</span> <span class="dv">3</span></span>
<span id="cb60-92"><a href="#cb60-92" aria-hidden="true" tabindex="-1"></a>    transition_matrix[<span class="dv">0</span>, <span class="dv">1</span>:<span class="dv">4</span>] <span class="op">+=</span> pseudocount</span>
<span id="cb60-93"><a href="#cb60-93" aria-hidden="true" tabindex="-1"></a>    transition_matrix[<span class="dv">1</span>, <span class="dv">1</span>:<span class="dv">4</span>] <span class="op">+=</span> pseudocount</span>
<span id="cb60-94"><a href="#cb60-94" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(n):</span>
<span id="cb60-95"><a href="#cb60-95" aria-hidden="true" tabindex="-1"></a>        transition_matrix[i <span class="op">*</span> <span class="dv">3</span> <span class="op">+</span> <span class="dv">2</span> : i <span class="op">*</span> <span class="dv">3</span> <span class="op">+</span> <span class="dv">5</span>, (i <span class="op">+</span> <span class="dv">1</span>) <span class="op">*</span> <span class="dv">3</span> <span class="op">+</span> <span class="dv">1</span> : (i <span class="op">+</span> <span class="dv">1</span>) <span class="op">*</span> <span class="dv">3</span> <span class="op">+</span> <span class="dv">4</span>] <span class="op">+=</span> pseudocount</span>
<span id="cb60-96"><a href="#cb60-96" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> normalize_matrix(transition_matrix)</span>
<span id="cb60-97"><a href="#cb60-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-98"><a href="#cb60-98" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> add_emission_pseudocounts(emission_matrix: np.ndarray, pseudocount: <span class="bu">float</span>) <span class="op">-&gt;</span> np.ndarray:</span>
<span id="cb60-99"><a href="#cb60-99" aria-hidden="true" tabindex="-1"></a>    n <span class="op">=</span> (emission_matrix.shape[<span class="dv">0</span>] <span class="op">-</span> <span class="dv">3</span>) <span class="op">//</span> <span class="dv">3</span></span>
<span id="cb60-100"><a href="#cb60-100" aria-hidden="true" tabindex="-1"></a>    emission_matrix[<span class="dv">1</span>, :] <span class="op">+=</span> pseudocount</span>
<span id="cb60-101"><a href="#cb60-101" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(n):</span>
<span id="cb60-102"><a href="#cb60-102" aria-hidden="true" tabindex="-1"></a>        emission_matrix[i <span class="op">*</span> <span class="dv">3</span> <span class="op">+</span> <span class="dv">2</span>, :] <span class="op">+=</span> pseudocount</span>
<span id="cb60-103"><a href="#cb60-103" aria-hidden="true" tabindex="-1"></a>        emission_matrix[i <span class="op">*</span> <span class="dv">3</span> <span class="op">+</span> <span class="dv">4</span>, :] <span class="op">+=</span> pseudocount</span>
<span id="cb60-104"><a href="#cb60-104" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> normalize_matrix(emission_matrix)</span>
<span id="cb60-105"><a href="#cb60-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-106"><a href="#cb60-106" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> build_pseudocount_profile_hmm(threshold: <span class="bu">float</span>, pseudocount: <span class="bu">float</span>, alphabet: List[<span class="bu">str</span>], alignment: np.ndarray) <span class="op">-&gt;</span> Tuple[np.ndarray, np.ndarray]:</span>
<span id="cb60-107"><a href="#cb60-107" aria-hidden="true" tabindex="-1"></a>    transition_probs, emission_probs <span class="op">=</span> build_profile_hmm(threshold, alphabet, alignment)</span>
<span id="cb60-108"><a href="#cb60-108" aria-hidden="true" tabindex="-1"></a>    transition_probs <span class="op">=</span> add_transition_pseudocounts(transition_probs, pseudocount)</span>
<span id="cb60-109"><a href="#cb60-109" aria-hidden="true" tabindex="-1"></a>    emission_probs <span class="op">=</span> add_emission_pseudocounts(emission_probs, pseudocount)</span>
<span id="cb60-110"><a href="#cb60-110" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> transition_probs, emission_probs</span>
<span id="cb60-111"><a href="#cb60-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-112"><a href="#cb60-112" aria-hidden="true" tabindex="-1"></a>sample_input <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb60-113"><a href="#cb60-113" aria-hidden="true" tabindex="-1"></a><span class="st">0.358   0.01</span></span>
<span id="cb60-114"><a href="#cb60-114" aria-hidden="true" tabindex="-1"></a><span class="st">--------</span></span>
<span id="cb60-115"><a href="#cb60-115" aria-hidden="true" tabindex="-1"></a><span class="st">A   B   C   D   E</span></span>
<span id="cb60-116"><a href="#cb60-116" aria-hidden="true" tabindex="-1"></a><span class="st">--------</span></span>
<span id="cb60-117"><a href="#cb60-117" aria-hidden="true" tabindex="-1"></a><span class="st">ADA</span></span>
<span id="cb60-118"><a href="#cb60-118" aria-hidden="true" tabindex="-1"></a><span class="st">ADA</span></span>
<span id="cb60-119"><a href="#cb60-119" aria-hidden="true" tabindex="-1"></a><span class="st">AAA</span></span>
<span id="cb60-120"><a href="#cb60-120" aria-hidden="true" tabindex="-1"></a><span class="st">ADC</span></span>
<span id="cb60-121"><a href="#cb60-121" aria-hidden="true" tabindex="-1"></a><span class="st">-DA</span></span>
<span id="cb60-122"><a href="#cb60-122" aria-hidden="true" tabindex="-1"></a><span class="st">D-A</span></span>
<span id="cb60-123"><a href="#cb60-123" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb60-124"><a href="#cb60-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-125"><a href="#cb60-125" aria-hidden="true" tabindex="-1"></a>input_lines <span class="op">=</span> <span class="bu">iter</span>(StringIO(sample_input.strip()).readlines())</span>
<span id="cb60-126"><a href="#cb60-126" aria-hidden="true" tabindex="-1"></a>threshold, pseudocount, alphabet, alignment <span class="op">=</span> parse_input(input_lines)</span>
<span id="cb60-127"><a href="#cb60-127" aria-hidden="true" tabindex="-1"></a>transition_probs, emission_probs <span class="op">=</span> build_pseudocount_profile_hmm(threshold, pseudocount, alphabet, alignment)</span>
<span id="cb60-128"><a href="#cb60-128" aria-hidden="true" tabindex="-1"></a>print_transition_probs(transition_probs)</span>
<span id="cb60-129"><a href="#cb60-129" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"--------"</span>)</span>
<span id="cb60-130"><a href="#cb60-130" aria-hidden="true" tabindex="-1"></a>print_emission_probs(emission_probs, alphabet)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="perform-a-multiple-sequence-alignment-with-a-profile-hmm" class="level1" data-number="21">
<h1 data-number="21"><span class="header-section-number">21</span> Perform a Multiple Sequence Alignment with a Profile HMM</h1>
<p>Given:&nbsp;A string Text, a multiple alignment Alignment, a threshold θ, and a pseudocount σ.</p>
<p>Return:&nbsp;An optimal hidden path emitting Text in HMM(Alignment,θ,σ).</p>
<section id="sample-dataset-20" class="level2" data-number="21.1">
<h2 data-number="21.1" class="anchored" data-anchor-id="sample-dataset-20"><span class="header-section-number">21.1</span> Sample Dataset</h2>
<pre><code>AEFDFDC
--------
0.4 0.01
--------
A   B   C   D   E   F
--------
ACDEFACADF
AFDA---CCF
A--EFD-FDC
ACAEF--A-C
ADDEFAAADF</code></pre>
</section>
<section id="sample-output-20" class="level2" data-number="21.2">
<h2 data-number="21.2" class="anchored" data-anchor-id="sample-output-20"><span class="header-section-number">21.2</span> Sample Output</h2>
<pre><code>M1 D2 D3 M4 M5 I5 M6 M7 M8</code></pre>
</section>
<section id="solution-20" class="level2" data-number="21.3">
<h2 data-number="21.3" class="anchored" data-anchor-id="solution-20"><span class="header-section-number">21.3</span> Solution</h2>
<div class="sourceCode" id="cb63"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> io <span class="im">import</span> StringIO</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> collections <span class="im">import</span> defaultdict</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> typing <span class="im">import</span> List, Tuple, Dict, Iterator</span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> math <span class="im">import</span> inf, log</span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> generate_state_labels(num_states: <span class="bu">int</span>) <span class="op">-&gt;</span> List[<span class="bu">str</span>]:</span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a>    labels <span class="op">=</span> [<span class="st">"S"</span>, <span class="st">"I0"</span>]</span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, num_states <span class="op">+</span> <span class="dv">1</span>):</span>
<span id="cb63-10"><a href="#cb63-10" aria-hidden="true" tabindex="-1"></a>        labels.extend([<span class="ss">f"M</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">"</span>, <span class="ss">f"D</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">"</span>, <span class="ss">f"I</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">"</span>])</span>
<span id="cb63-11"><a href="#cb63-11" aria-hidden="true" tabindex="-1"></a>    labels.append(<span class="st">"E"</span>)</span>
<span id="cb63-12"><a href="#cb63-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> labels</span>
<span id="cb63-13"><a href="#cb63-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-14"><a href="#cb63-14" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> normalize_row(row: np.ndarray, include_zeros: <span class="bu">bool</span> <span class="op">=</span> <span class="va">False</span>, minimum_value: <span class="bu">float</span> <span class="op">=</span> <span class="fl">0.0</span>) <span class="op">-&gt;</span> np.ndarray:</span>
<span id="cb63-15"><a href="#cb63-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> include_zeros <span class="kw">and</span> <span class="bu">sum</span>(row) <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb63-16"><a href="#cb63-16" aria-hidden="true" tabindex="-1"></a>        row[:] <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb63-17"><a href="#cb63-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> np.errstate(divide<span class="op">=</span><span class="st">"ignore"</span>, invalid<span class="op">=</span><span class="st">"ignore"</span>):</span>
<span id="cb63-18"><a href="#cb63-18" aria-hidden="true" tabindex="-1"></a>        normalized <span class="op">=</span> row <span class="op">/</span> <span class="bu">sum</span>(row)</span>
<span id="cb63-19"><a href="#cb63-19" aria-hidden="true" tabindex="-1"></a>        normalized[row <span class="op">==</span> <span class="fl">0.0</span>] <span class="op">=</span> minimum_value</span>
<span id="cb63-20"><a href="#cb63-20" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> normalized</span>
<span id="cb63-21"><a href="#cb63-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-22"><a href="#cb63-22" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> normalize_matrix(matrix: np.ndarray, include_zeros: <span class="bu">bool</span> <span class="op">=</span> <span class="va">False</span>, minimum_value: <span class="bu">float</span> <span class="op">=</span> <span class="fl">0.0</span>) <span class="op">-&gt;</span> np.ndarray:</span>
<span id="cb63-23"><a href="#cb63-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> np.array([normalize_row(r, include_zeros<span class="op">=</span>include_zeros, minimum_value<span class="op">=</span>minimum_value) <span class="cf">for</span> r <span class="kw">in</span> matrix])</span>
<span id="cb63-24"><a href="#cb63-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-25"><a href="#cb63-25" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> create_transition_matrix(num_states: <span class="bu">int</span>) <span class="op">-&gt;</span> np.ndarray:</span>
<span id="cb63-26"><a href="#cb63-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> np.zeros((num_states <span class="op">*</span> <span class="dv">3</span> <span class="op">+</span> <span class="dv">3</span>, num_states <span class="op">*</span> <span class="dv">3</span> <span class="op">+</span> <span class="dv">3</span>), dtype<span class="op">=</span><span class="bu">float</span>)</span>
<span id="cb63-27"><a href="#cb63-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-28"><a href="#cb63-28" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> create_emission_matrix(num_states: <span class="bu">int</span>, num_symbols: <span class="bu">int</span>) <span class="op">-&gt;</span> np.ndarray:</span>
<span id="cb63-29"><a href="#cb63-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> np.zeros((num_states <span class="op">*</span> <span class="dv">3</span> <span class="op">+</span> <span class="dv">3</span>, num_symbols), dtype<span class="op">=</span><span class="bu">float</span>)</span>
<span id="cb63-30"><a href="#cb63-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-31"><a href="#cb63-31" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> calculate_index(state_num: <span class="bu">int</span>, state_type: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="bu">int</span>:</span>
<span id="cb63-32"><a href="#cb63-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> state_type <span class="op">==</span> <span class="st">"ins"</span>:</span>
<span id="cb63-33"><a href="#cb63-33" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> (state_num <span class="op">+</span> <span class="dv">1</span>) <span class="op">*</span> <span class="dv">3</span> <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb63-34"><a href="#cb63-34" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb63-35"><a href="#cb63-35" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> {<span class="st">"match"</span>: <span class="dv">0</span>, <span class="st">"del"</span>: <span class="dv">1</span>}[state_type] <span class="op">+</span> <span class="dv">3</span> <span class="op">*</span> state_num <span class="op">+</span> <span class="dv">2</span></span>
<span id="cb63-36"><a href="#cb63-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-37"><a href="#cb63-37" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> build_profile_hmm(threshold: <span class="bu">float</span>, alphabet: List[<span class="bu">str</span>], alignment: np.ndarray) <span class="op">-&gt;</span> Tuple[np.ndarray, np.ndarray]:</span>
<span id="cb63-38"><a href="#cb63-38" aria-hidden="true" tabindex="-1"></a>    valid_columns <span class="op">=</span> np.mean(alignment <span class="op">==</span> <span class="st">"-"</span>, axis<span class="op">=</span><span class="dv">0</span>) <span class="op">&lt;</span> threshold</span>
<span id="cb63-39"><a href="#cb63-39" aria-hidden="true" tabindex="-1"></a>    valid_length <span class="op">=</span> <span class="bu">sum</span>(valid_columns)</span>
<span id="cb63-40"><a href="#cb63-40" aria-hidden="true" tabindex="-1"></a>    end_state <span class="op">=</span> valid_length <span class="op">*</span> <span class="dv">3</span> <span class="op">+</span> <span class="dv">2</span></span>
<span id="cb63-41"><a href="#cb63-41" aria-hidden="true" tabindex="-1"></a>    transition_probs <span class="op">=</span> create_transition_matrix(valid_length)</span>
<span id="cb63-42"><a href="#cb63-42" aria-hidden="true" tabindex="-1"></a>    emission_probs <span class="op">=</span> create_emission_matrix(valid_length, <span class="bu">len</span>(alphabet))</span>
<span id="cb63-43"><a href="#cb63-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-44"><a href="#cb63-44" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> sequence <span class="kw">in</span> alignment:</span>
<span id="cb63-45"><a href="#cb63-45" aria-hidden="true" tabindex="-1"></a>        prev_index <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb63-46"><a href="#cb63-46" aria-hidden="true" tabindex="-1"></a>        valid_col_count <span class="op">=</span> <span class="op">-</span><span class="dv">1</span></span>
<span id="cb63-47"><a href="#cb63-47" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> col, char <span class="kw">in</span> <span class="bu">enumerate</span>(sequence):</span>
<span id="cb63-48"><a href="#cb63-48" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> valid_columns[col]:</span>
<span id="cb63-49"><a href="#cb63-49" aria-hidden="true" tabindex="-1"></a>                valid_col_count <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb63-50"><a href="#cb63-50" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> char <span class="op">==</span> <span class="st">"-"</span>:</span>
<span id="cb63-51"><a href="#cb63-51" aria-hidden="true" tabindex="-1"></a>                    current_index <span class="op">=</span> calculate_index(valid_col_count, <span class="st">"del"</span>)</span>
<span id="cb63-52"><a href="#cb63-52" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb63-53"><a href="#cb63-53" aria-hidden="true" tabindex="-1"></a>                    current_index <span class="op">=</span> calculate_index(valid_col_count, <span class="st">"match"</span>)</span>
<span id="cb63-54"><a href="#cb63-54" aria-hidden="true" tabindex="-1"></a>                transition_probs[prev_index, current_index] <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb63-55"><a href="#cb63-55" aria-hidden="true" tabindex="-1"></a>                prev_index <span class="op">=</span> current_index</span>
<span id="cb63-56"><a href="#cb63-56" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb63-57"><a href="#cb63-57" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> char <span class="op">!=</span> <span class="st">"-"</span>:</span>
<span id="cb63-58"><a href="#cb63-58" aria-hidden="true" tabindex="-1"></a>                    current_index <span class="op">=</span> calculate_index(valid_col_count, <span class="st">"ins"</span>)</span>
<span id="cb63-59"><a href="#cb63-59" aria-hidden="true" tabindex="-1"></a>                    transition_probs[prev_index, current_index] <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb63-60"><a href="#cb63-60" aria-hidden="true" tabindex="-1"></a>                    prev_index <span class="op">=</span> current_index</span>
<span id="cb63-61"><a href="#cb63-61" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> char <span class="op">!=</span> <span class="st">"-"</span>:</span>
<span id="cb63-62"><a href="#cb63-62" aria-hidden="true" tabindex="-1"></a>                emission_probs[current_index, alphabet.index(char)] <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb63-63"><a href="#cb63-63" aria-hidden="true" tabindex="-1"></a>        transition_probs[prev_index, end_state] <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb63-64"><a href="#cb63-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-65"><a href="#cb63-65" aria-hidden="true" tabindex="-1"></a>    transition_probs <span class="op">=</span> normalize_matrix(transition_probs)</span>
<span id="cb63-66"><a href="#cb63-66" aria-hidden="true" tabindex="-1"></a>    emission_probs <span class="op">=</span> normalize_matrix(emission_probs)</span>
<span id="cb63-67"><a href="#cb63-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-68"><a href="#cb63-68" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> transition_probs, emission_probs</span>
<span id="cb63-69"><a href="#cb63-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-70"><a href="#cb63-70" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> add_pseudocounts_to_transitions(matrix: np.ndarray, pseudocount: <span class="bu">float</span>) <span class="op">-&gt;</span> np.ndarray:</span>
<span id="cb63-71"><a href="#cb63-71" aria-hidden="true" tabindex="-1"></a>    num_states <span class="op">=</span> (matrix.shape[<span class="dv">0</span>] <span class="op">-</span> <span class="dv">3</span>) <span class="op">//</span> <span class="dv">3</span></span>
<span id="cb63-72"><a href="#cb63-72" aria-hidden="true" tabindex="-1"></a>    matrix[<span class="dv">0</span>, <span class="dv">1</span>:<span class="dv">4</span>] <span class="op">+=</span> pseudocount</span>
<span id="cb63-73"><a href="#cb63-73" aria-hidden="true" tabindex="-1"></a>    matrix[<span class="dv">1</span>, <span class="dv">1</span>:<span class="dv">4</span>] <span class="op">+=</span> pseudocount</span>
<span id="cb63-74"><a href="#cb63-74" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(num_states):</span>
<span id="cb63-75"><a href="#cb63-75" aria-hidden="true" tabindex="-1"></a>        matrix[i<span class="op">*</span><span class="dv">3</span><span class="op">+</span><span class="dv">2</span>:i<span class="op">*</span><span class="dv">3</span><span class="op">+</span><span class="dv">5</span>, (i<span class="op">+</span><span class="dv">1</span>)<span class="op">*</span><span class="dv">3</span><span class="op">+</span><span class="dv">1</span>:(i<span class="op">+</span><span class="dv">1</span>)<span class="op">*</span><span class="dv">3</span><span class="op">+</span><span class="dv">4</span>] <span class="op">+=</span> pseudocount</span>
<span id="cb63-76"><a href="#cb63-76" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> normalize_matrix(matrix)</span>
<span id="cb63-77"><a href="#cb63-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-78"><a href="#cb63-78" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> add_pseudocounts_to_emissions(matrix: np.ndarray, pseudocount: <span class="bu">float</span>) <span class="op">-&gt;</span> np.ndarray:</span>
<span id="cb63-79"><a href="#cb63-79" aria-hidden="true" tabindex="-1"></a>    num_states <span class="op">=</span> (matrix.shape[<span class="dv">0</span>] <span class="op">-</span> <span class="dv">3</span>) <span class="op">//</span> <span class="dv">3</span></span>
<span id="cb63-80"><a href="#cb63-80" aria-hidden="true" tabindex="-1"></a>    matrix[<span class="dv">1</span>, :] <span class="op">+=</span> pseudocount</span>
<span id="cb63-81"><a href="#cb63-81" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(num_states):</span>
<span id="cb63-82"><a href="#cb63-82" aria-hidden="true" tabindex="-1"></a>        matrix[i<span class="op">*</span><span class="dv">3</span><span class="op">+</span><span class="dv">2</span>, :] <span class="op">+=</span> pseudocount</span>
<span id="cb63-83"><a href="#cb63-83" aria-hidden="true" tabindex="-1"></a>        matrix[i<span class="op">*</span><span class="dv">3</span><span class="op">+</span><span class="dv">4</span>, :] <span class="op">+=</span> pseudocount</span>
<span id="cb63-84"><a href="#cb63-84" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> normalize_matrix(matrix)</span>
<span id="cb63-85"><a href="#cb63-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-86"><a href="#cb63-86" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> build_profile_hmm_with_pseudocounts(threshold: <span class="bu">float</span>, pseudocount: <span class="bu">float</span>, alphabet: List[<span class="bu">str</span>], alignment: np.ndarray) <span class="op">-&gt;</span> Tuple[np.ndarray, np.ndarray]:</span>
<span id="cb63-87"><a href="#cb63-87" aria-hidden="true" tabindex="-1"></a>    transition_probs, emission_probs <span class="op">=</span> build_profile_hmm(threshold, alphabet, alignment)</span>
<span id="cb63-88"><a href="#cb63-88" aria-hidden="true" tabindex="-1"></a>    transition_probs <span class="op">=</span> add_pseudocounts_to_transitions(transition_probs, pseudocount)</span>
<span id="cb63-89"><a href="#cb63-89" aria-hidden="true" tabindex="-1"></a>    emission_probs <span class="op">=</span> add_pseudocounts_to_emissions(emission_probs, pseudocount)</span>
<span id="cb63-90"><a href="#cb63-90" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> transition_probs, emission_probs</span>
<span id="cb63-91"><a href="#cb63-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-92"><a href="#cb63-92" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> parse_input_data(input_iterator: Iterator[<span class="bu">str</span>]) <span class="op">-&gt;</span> Tuple[<span class="bu">str</span>, <span class="bu">float</span>, <span class="bu">float</span>, List[<span class="bu">str</span>], np.ndarray]:</span>
<span id="cb63-93"><a href="#cb63-93" aria-hidden="true" tabindex="-1"></a>    sequence <span class="op">=</span> <span class="bu">next</span>(input_iterator).rstrip()</span>
<span id="cb63-94"><a href="#cb63-94" aria-hidden="true" tabindex="-1"></a>    <span class="bu">next</span>(input_iterator)</span>
<span id="cb63-95"><a href="#cb63-95" aria-hidden="true" tabindex="-1"></a>    threshold, pseudocount <span class="op">=</span> <span class="bu">map</span>(<span class="bu">float</span>, <span class="bu">next</span>(input_iterator).rstrip().split())</span>
<span id="cb63-96"><a href="#cb63-96" aria-hidden="true" tabindex="-1"></a>    <span class="bu">next</span>(input_iterator)</span>
<span id="cb63-97"><a href="#cb63-97" aria-hidden="true" tabindex="-1"></a>    alphabet <span class="op">=</span> <span class="bu">next</span>(input_iterator).split()</span>
<span id="cb63-98"><a href="#cb63-98" aria-hidden="true" tabindex="-1"></a>    <span class="bu">next</span>(input_iterator)</span>
<span id="cb63-99"><a href="#cb63-99" aria-hidden="true" tabindex="-1"></a>    alignment <span class="op">=</span> np.array([<span class="bu">list</span>(x.strip()) <span class="cf">for</span> x <span class="kw">in</span> input_iterator])</span>
<span id="cb63-100"><a href="#cb63-100" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> sequence, threshold, pseudocount, alphabet, alignment</span>
<span id="cb63-101"><a href="#cb63-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-102"><a href="#cb63-102" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> convert_transition_probs_to_dict(matrix: np.ndarray) <span class="op">-&gt;</span> Dict[Tuple[<span class="bu">str</span>, <span class="bu">str</span>], <span class="bu">float</span>]:</span>
<span id="cb63-103"><a href="#cb63-103" aria-hidden="true" tabindex="-1"></a>    prob_dict <span class="op">=</span> defaultdict(<span class="bu">float</span>)</span>
<span id="cb63-104"><a href="#cb63-104" aria-hidden="true" tabindex="-1"></a>    num_states <span class="op">=</span> (matrix.shape[<span class="dv">0</span>] <span class="op">-</span> <span class="dv">3</span>) <span class="op">//</span> <span class="dv">3</span></span>
<span id="cb63-105"><a href="#cb63-105" aria-hidden="true" tabindex="-1"></a>    labels <span class="op">=</span> generate_state_labels(num_states)</span>
<span id="cb63-106"><a href="#cb63-106" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(matrix.shape[<span class="dv">0</span>]):</span>
<span id="cb63-107"><a href="#cb63-107" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(matrix.shape[<span class="dv">0</span>]):</span>
<span id="cb63-108"><a href="#cb63-108" aria-hidden="true" tabindex="-1"></a>            prob_dict[labels[i], labels[j]] <span class="op">=</span> matrix[i][j]</span>
<span id="cb63-109"><a href="#cb63-109" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> prob_dict</span>
<span id="cb63-110"><a href="#cb63-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-111"><a href="#cb63-111" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> convert_emission_probs_to_dict(matrix: np.ndarray, alphabet: List[<span class="bu">str</span>]) <span class="op">-&gt;</span> Dict[Tuple[<span class="bu">str</span>, <span class="bu">str</span>], <span class="bu">float</span>]:</span>
<span id="cb63-112"><a href="#cb63-112" aria-hidden="true" tabindex="-1"></a>    prob_dict <span class="op">=</span> defaultdict(<span class="bu">float</span>)</span>
<span id="cb63-113"><a href="#cb63-113" aria-hidden="true" tabindex="-1"></a>    num_states <span class="op">=</span> (matrix.shape[<span class="dv">0</span>] <span class="op">-</span> <span class="dv">3</span>) <span class="op">//</span> <span class="dv">3</span></span>
<span id="cb63-114"><a href="#cb63-114" aria-hidden="true" tabindex="-1"></a>    labels <span class="op">=</span> generate_state_labels(num_states)</span>
<span id="cb63-115"><a href="#cb63-115" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(matrix.shape[<span class="dv">0</span>]):</span>
<span id="cb63-116"><a href="#cb63-116" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> j, symbol <span class="kw">in</span> <span class="bu">enumerate</span>(alphabet):</span>
<span id="cb63-117"><a href="#cb63-117" aria-hidden="true" tabindex="-1"></a>            prob_dict[labels[i], symbol] <span class="op">=</span> matrix[i][j]</span>
<span id="cb63-118"><a href="#cb63-118" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> prob_dict</span>
<span id="cb63-119"><a href="#cb63-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-120"><a href="#cb63-120" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> build_hmm_graph(transition_probs: Dict[Tuple[<span class="bu">str</span>, <span class="bu">str</span>], <span class="bu">float</span>], num_states: <span class="bu">int</span>) <span class="op">-&gt;</span> Dict[<span class="bu">str</span>, List[Dict[<span class="bu">str</span>, <span class="bu">float</span>]]]:</span>
<span id="cb63-121"><a href="#cb63-121" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> add_edge(source: <span class="bu">str</span>, target: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="va">None</span>:</span>
<span id="cb63-122"><a href="#cb63-122" aria-hidden="true" tabindex="-1"></a>        graph[source].append({<span class="st">"node"</span>: target, <span class="st">"weight"</span>: transition_probs[source, target]})</span>
<span id="cb63-123"><a href="#cb63-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-124"><a href="#cb63-124" aria-hidden="true" tabindex="-1"></a>    graph <span class="op">=</span> defaultdict(<span class="bu">list</span>)</span>
<span id="cb63-125"><a href="#cb63-125" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> target <span class="kw">in</span> [<span class="st">"I0"</span>, <span class="st">"M1"</span>, <span class="st">"D1"</span>]:</span>
<span id="cb63-126"><a href="#cb63-126" aria-hidden="true" tabindex="-1"></a>        add_edge(<span class="st">"S"</span>, target)</span>
<span id="cb63-127"><a href="#cb63-127" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(num_states):</span>
<span id="cb63-128"><a href="#cb63-128" aria-hidden="true" tabindex="-1"></a>        source <span class="op">=</span> <span class="ss">f"I</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb63-129"><a href="#cb63-129" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> target <span class="kw">in</span> [source, <span class="ss">f"M</span><span class="sc">{</span>i<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss">"</span>, <span class="ss">f"D</span><span class="sc">{</span>i<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss">"</span>]:</span>
<span id="cb63-130"><a href="#cb63-130" aria-hidden="true" tabindex="-1"></a>            add_edge(source, target)</span>
<span id="cb63-131"><a href="#cb63-131" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, num_states):</span>
<span id="cb63-132"><a href="#cb63-132" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> source <span class="kw">in</span> [<span class="ss">f"M</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">"</span>, <span class="ss">f"D</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">"</span>]:</span>
<span id="cb63-133"><a href="#cb63-133" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> target <span class="kw">in</span> [<span class="ss">f"M</span><span class="sc">{</span>i<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss">"</span>, <span class="ss">f"I</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">"</span>, <span class="ss">f"D</span><span class="sc">{</span>i<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss">"</span>]:</span>
<span id="cb63-134"><a href="#cb63-134" aria-hidden="true" tabindex="-1"></a>                add_edge(source, target)</span>
<span id="cb63-135"><a href="#cb63-135" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> source <span class="kw">in</span> [<span class="ss">f"I</span><span class="sc">{</span>num_states<span class="sc">}</span><span class="ss">"</span>, <span class="ss">f"M</span><span class="sc">{</span>num_states<span class="sc">}</span><span class="ss">"</span>, <span class="ss">f"D</span><span class="sc">{</span>num_states<span class="sc">}</span><span class="ss">"</span>]:</span>
<span id="cb63-136"><a href="#cb63-136" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> target <span class="kw">in</span> [<span class="ss">f"I</span><span class="sc">{</span>num_states<span class="sc">}</span><span class="ss">"</span>, <span class="st">"E"</span>]:</span>
<span id="cb63-137"><a href="#cb63-137" aria-hidden="true" tabindex="-1"></a>            add_edge(source, target)</span>
<span id="cb63-138"><a href="#cb63-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-139"><a href="#cb63-139" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> graph</span>
<span id="cb63-140"><a href="#cb63-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-141"><a href="#cb63-141" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> generate_topological_order(num_states: <span class="bu">int</span>, seq_length: <span class="bu">int</span>) <span class="op">-&gt;</span> Iterator[Tuple[<span class="bu">str</span>, <span class="bu">int</span>]]:</span>
<span id="cb63-142"><a href="#cb63-142" aria-hidden="true" tabindex="-1"></a>    <span class="cf">yield</span> (<span class="st">"S"</span>, <span class="dv">0</span>)</span>
<span id="cb63-143"><a href="#cb63-143" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(num_states):</span>
<span id="cb63-144"><a href="#cb63-144" aria-hidden="true" tabindex="-1"></a>        <span class="cf">yield</span> (<span class="ss">f"D</span><span class="sc">{</span>j<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss">"</span>, <span class="dv">0</span>)</span>
<span id="cb63-145"><a href="#cb63-145" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(seq_length):</span>
<span id="cb63-146"><a href="#cb63-146" aria-hidden="true" tabindex="-1"></a>        <span class="cf">yield</span> (<span class="st">"I0"</span>, i <span class="op">+</span> <span class="dv">1</span>)</span>
<span id="cb63-147"><a href="#cb63-147" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(num_states):</span>
<span id="cb63-148"><a href="#cb63-148" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> state_type <span class="kw">in</span> [<span class="st">"M"</span>, <span class="st">"D"</span>, <span class="st">"I"</span>]:</span>
<span id="cb63-149"><a href="#cb63-149" aria-hidden="true" tabindex="-1"></a>                <span class="cf">yield</span> (<span class="ss">f"</span><span class="sc">{</span>state_type<span class="sc">}{</span>j<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss">"</span>, i <span class="op">+</span> <span class="dv">1</span>)</span>
<span id="cb63-150"><a href="#cb63-150" aria-hidden="true" tabindex="-1"></a>    <span class="cf">yield</span> (<span class="st">"E"</span>, seq_length <span class="op">+</span> <span class="dv">1</span>)</span>
<span id="cb63-151"><a href="#cb63-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-152"><a href="#cb63-152" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_previous_nodes(current_node: <span class="bu">str</span>, current_col: <span class="bu">int</span>, num_states: <span class="bu">int</span>, seq_length: <span class="bu">int</span>) <span class="op">-&gt;</span> List[Tuple[<span class="bu">str</span>, <span class="bu">int</span>]]:</span>
<span id="cb63-153"><a href="#cb63-153" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> current_node[<span class="dv">0</span>] <span class="op">==</span> <span class="st">"E"</span>:</span>
<span id="cb63-154"><a href="#cb63-154" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> [(<span class="ss">f"D</span><span class="sc">{</span>num_states<span class="sc">}</span><span class="ss">"</span>, seq_length), (<span class="ss">f"M</span><span class="sc">{</span>num_states<span class="sc">}</span><span class="ss">"</span>, seq_length), (<span class="ss">f"I</span><span class="sc">{</span>num_states<span class="sc">}</span><span class="ss">"</span>, seq_length)]</span>
<span id="cb63-155"><a href="#cb63-155" aria-hidden="true" tabindex="-1"></a>    state_num <span class="op">=</span> <span class="bu">int</span>(current_node[<span class="dv">1</span>:])</span>
<span id="cb63-156"><a href="#cb63-156" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> current_col <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb63-157"><a href="#cb63-157" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> [(<span class="st">"S"</span>, <span class="dv">0</span>)] <span class="cf">if</span> state_num <span class="op">==</span> <span class="dv">1</span> <span class="cf">else</span> [(<span class="ss">f"D</span><span class="sc">{</span>state_num<span class="op">-</span><span class="dv">1</span><span class="sc">}</span><span class="ss">"</span>, <span class="dv">0</span>)]</span>
<span id="cb63-158"><a href="#cb63-158" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> current_node <span class="op">==</span> <span class="st">"I0"</span>:</span>
<span id="cb63-159"><a href="#cb63-159" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> [(<span class="st">"S"</span>, <span class="dv">0</span>)] <span class="cf">if</span> current_col <span class="op">==</span> <span class="dv">1</span> <span class="cf">else</span> [(<span class="st">"I0"</span>, current_col <span class="op">-</span> <span class="dv">1</span>)]</span>
<span id="cb63-160"><a href="#cb63-160" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> current_node <span class="op">==</span> <span class="st">"M1"</span>:</span>
<span id="cb63-161"><a href="#cb63-161" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> [(<span class="st">"S"</span>, <span class="dv">0</span>)] <span class="cf">if</span> current_col <span class="op">==</span> <span class="dv">1</span> <span class="cf">else</span> [(<span class="st">"I0"</span>, current_col <span class="op">-</span> <span class="dv">1</span>)]</span>
<span id="cb63-162"><a href="#cb63-162" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> current_node[<span class="dv">0</span>] <span class="op">==</span> <span class="st">"I"</span>:</span>
<span id="cb63-163"><a href="#cb63-163" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> [(<span class="ss">f"D</span><span class="sc">{</span>state_num<span class="sc">}</span><span class="ss">"</span>, <span class="dv">0</span>)] <span class="cf">if</span> current_col <span class="op">==</span> <span class="dv">1</span> <span class="cf">else</span> [(<span class="ss">f"D</span><span class="sc">{</span>state_num<span class="sc">}</span><span class="ss">"</span>, current_col <span class="op">-</span> <span class="dv">1</span>), (<span class="ss">f"M</span><span class="sc">{</span>state_num<span class="sc">}</span><span class="ss">"</span>, current_col <span class="op">-</span> <span class="dv">1</span>), (<span class="ss">f"I</span><span class="sc">{</span>state_num<span class="sc">}</span><span class="ss">"</span>, current_col <span class="op">-</span> <span class="dv">1</span>)]</span>
<span id="cb63-164"><a href="#cb63-164" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> current_node[<span class="dv">0</span>] <span class="op">==</span> <span class="st">"M"</span>:</span>
<span id="cb63-165"><a href="#cb63-165" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> [(<span class="ss">f"D</span><span class="sc">{</span>state_num<span class="op">-</span><span class="dv">1</span><span class="sc">}</span><span class="ss">"</span>, <span class="dv">0</span>)] <span class="cf">if</span> current_col <span class="op">==</span> <span class="dv">1</span> <span class="cf">else</span> [(<span class="ss">f"D</span><span class="sc">{</span>state_num<span class="op">-</span><span class="dv">1</span><span class="sc">}</span><span class="ss">"</span>, current_col <span class="op">-</span> <span class="dv">1</span>), (<span class="ss">f"M</span><span class="sc">{</span>state_num<span class="op">-</span><span class="dv">1</span><span class="sc">}</span><span class="ss">"</span>, current_col <span class="op">-</span> <span class="dv">1</span>), (<span class="ss">f"I</span><span class="sc">{</span>state_num<span class="op">-</span><span class="dv">1</span><span class="sc">}</span><span class="ss">"</span>, current_col <span class="op">-</span> <span class="dv">1</span>)]</span>
<span id="cb63-166"><a href="#cb63-166" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> current_node[<span class="dv">0</span>] <span class="op">==</span> <span class="st">"D"</span>:</span>
<span id="cb63-167"><a href="#cb63-167" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> [(<span class="st">"I0"</span>, current_col)] <span class="cf">if</span> state_num <span class="op">==</span> <span class="dv">1</span> <span class="cf">else</span> [(<span class="ss">f"D</span><span class="sc">{</span>state_num<span class="op">-</span><span class="dv">1</span><span class="sc">}</span><span class="ss">"</span>, current_col), (<span class="ss">f"M</span><span class="sc">{</span>state_num<span class="op">-</span><span class="dv">1</span><span class="sc">}</span><span class="ss">"</span>, current_col), (<span class="ss">f"I</span><span class="sc">{</span>state_num<span class="op">-</span><span class="dv">1</span><span class="sc">}</span><span class="ss">"</span>, current_col)]</span>
<span id="cb63-168"><a href="#cb63-168" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb63-169"><a href="#cb63-169" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Unhandled node: </span><span class="sc">{</span>current_node<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb63-170"><a href="#cb63-170" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> []</span>
<span id="cb63-171"><a href="#cb63-171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-172"><a href="#cb63-172" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> simplify_graph(graph: Dict[<span class="bu">str</span>, List[Dict[<span class="bu">str</span>, <span class="bu">float</span>]]]) <span class="op">-&gt;</span> Dict[<span class="bu">str</span>, Dict[<span class="bu">str</span>, <span class="bu">float</span>]]:</span>
<span id="cb63-173"><a href="#cb63-173" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> {k: {x[<span class="st">"node"</span>]: x[<span class="st">"weight"</span>] <span class="cf">for</span> x <span class="kw">in</span> v} <span class="cf">for</span> k, v <span class="kw">in</span> graph.items()}</span>
<span id="cb63-174"><a href="#cb63-174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-175"><a href="#cb63-175" aria-hidden="true" tabindex="-1"></a><span class="co"># Main execution</span></span>
<span id="cb63-176"><a href="#cb63-176" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> main(sample_input):</span>
<span id="cb63-177"><a href="#cb63-177" aria-hidden="true" tabindex="-1"></a>    input_lines <span class="op">=</span> <span class="bu">iter</span>(StringIO(sample_input.strip()).readlines())</span>
<span id="cb63-178"><a href="#cb63-178" aria-hidden="true" tabindex="-1"></a>    sequence, threshold, pseudocount, alphabet, alignment <span class="op">=</span> parse_input_data(input_lines)</span>
<span id="cb63-179"><a href="#cb63-179" aria-hidden="true" tabindex="-1"></a>    transition_probs, emission_probs <span class="op">=</span> build_profile_hmm_with_pseudocounts(threshold, pseudocount, alphabet, alignment)</span>
<span id="cb63-180"><a href="#cb63-180" aria-hidden="true" tabindex="-1"></a>    num_states <span class="op">=</span> (transition_probs.shape[<span class="dv">0</span>] <span class="op">-</span> <span class="dv">3</span>) <span class="op">//</span> <span class="dv">3</span></span>
<span id="cb63-181"><a href="#cb63-181" aria-hidden="true" tabindex="-1"></a>    transition_probs_dict <span class="op">=</span> convert_transition_probs_to_dict(transition_probs)</span>
<span id="cb63-182"><a href="#cb63-182" aria-hidden="true" tabindex="-1"></a>    emission_probs_dict <span class="op">=</span> convert_emission_probs_to_dict(emission_probs, alphabet)</span>
<span id="cb63-183"><a href="#cb63-183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-184"><a href="#cb63-184" aria-hidden="true" tabindex="-1"></a>    graph <span class="op">=</span> build_hmm_graph(transition_probs_dict, num_states)</span>
<span id="cb63-185"><a href="#cb63-185" aria-hidden="true" tabindex="-1"></a>    topological_order <span class="op">=</span> generate_topological_order(num_states, <span class="bu">len</span>(sequence))</span>
<span id="cb63-186"><a href="#cb63-186" aria-hidden="true" tabindex="-1"></a>    simplified_graph <span class="op">=</span> simplify_graph(graph)</span>
<span id="cb63-187"><a href="#cb63-187" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-188"><a href="#cb63-188" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Dynamic programming to find the most probable path</span></span>
<span id="cb63-189"><a href="#cb63-189" aria-hidden="true" tabindex="-1"></a>    previous_node <span class="op">=</span> <span class="bu">next</span>(topological_order)</span>
<span id="cb63-190"><a href="#cb63-190" aria-hidden="true" tabindex="-1"></a>    scores <span class="op">=</span> {previous_node: <span class="dv">0</span>}</span>
<span id="cb63-191"><a href="#cb63-191" aria-hidden="true" tabindex="-1"></a>    backpointers <span class="op">=</span> {previous_node: (<span class="va">None</span>, <span class="va">None</span>)}</span>
<span id="cb63-192"><a href="#cb63-192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-193"><a href="#cb63-193" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> current_node, current_col <span class="kw">in</span> topological_order:</span>
<span id="cb63-194"><a href="#cb63-194" aria-hidden="true" tabindex="-1"></a>        backpointers[(current_node, current_col)] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb63-195"><a href="#cb63-195" aria-hidden="true" tabindex="-1"></a>        scores[(current_node, current_col)] <span class="op">=</span> <span class="op">-</span>inf</span>
<span id="cb63-196"><a href="#cb63-196" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> prev_node, prev_col <span class="kw">in</span> get_previous_nodes(current_node, current_col, num_states, <span class="bu">len</span>(sequence)):</span>
<span id="cb63-197"><a href="#cb63-197" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> prev_col <span class="op">&lt;</span> current_col <span class="kw">and</span> current_node <span class="op">!=</span> <span class="st">"E"</span>:</span>
<span id="cb63-198"><a href="#cb63-198" aria-hidden="true" tabindex="-1"></a>                emission_prob <span class="op">=</span> emission_probs_dict[current_node, sequence[current_col <span class="op">-</span> <span class="dv">1</span>]]</span>
<span id="cb63-199"><a href="#cb63-199" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb63-200"><a href="#cb63-200" aria-hidden="true" tabindex="-1"></a>                emission_prob <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb63-201"><a href="#cb63-201" aria-hidden="true" tabindex="-1"></a>            log_prob <span class="op">=</span> log(simplified_graph[prev_node][current_node]) <span class="op">+</span> log(emission_prob) <span class="op">+</span> scores[(prev_node, prev_col)]</span>
<span id="cb63-202"><a href="#cb63-202" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> log_prob <span class="op">&gt;</span> scores[(current_node, current_col)]:</span>
<span id="cb63-203"><a href="#cb63-203" aria-hidden="true" tabindex="-1"></a>                scores[(current_node, current_col)] <span class="op">=</span> log_prob</span>
<span id="cb63-204"><a href="#cb63-204" aria-hidden="true" tabindex="-1"></a>                backpointers[(current_node, current_col)] <span class="op">=</span> (prev_node, prev_col)</span>
<span id="cb63-205"><a href="#cb63-205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-206"><a href="#cb63-206" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Traceback to find the path</span></span>
<span id="cb63-207"><a href="#cb63-207" aria-hidden="true" tabindex="-1"></a>    path <span class="op">=</span> []</span>
<span id="cb63-208"><a href="#cb63-208" aria-hidden="true" tabindex="-1"></a>    position <span class="op">=</span> (<span class="st">"E"</span>, <span class="bu">len</span>(sequence) <span class="op">+</span> <span class="dv">1</span>)</span>
<span id="cb63-209"><a href="#cb63-209" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> position[<span class="dv">0</span>]:</span>
<span id="cb63-210"><a href="#cb63-210" aria-hidden="true" tabindex="-1"></a>        path.append(backpointers[position][<span class="dv">0</span>])</span>
<span id="cb63-211"><a href="#cb63-211" aria-hidden="true" tabindex="-1"></a>        position <span class="op">=</span> backpointers[position]</span>
<span id="cb63-212"><a href="#cb63-212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-213"><a href="#cb63-213" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="op">*</span>path[::<span class="op">-</span><span class="dv">1</span>][<span class="dv">2</span>:])</span>
<span id="cb63-214"><a href="#cb63-214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-215"><a href="#cb63-215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-216"><a href="#cb63-216" aria-hidden="true" tabindex="-1"></a>sample_input <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb63-217"><a href="#cb63-217" aria-hidden="true" tabindex="-1"></a><span class="st">AEFDFDC</span></span>
<span id="cb63-218"><a href="#cb63-218" aria-hidden="true" tabindex="-1"></a><span class="st">--------</span></span>
<span id="cb63-219"><a href="#cb63-219" aria-hidden="true" tabindex="-1"></a><span class="st">0.4 0.01</span></span>
<span id="cb63-220"><a href="#cb63-220" aria-hidden="true" tabindex="-1"></a><span class="st">--------</span></span>
<span id="cb63-221"><a href="#cb63-221" aria-hidden="true" tabindex="-1"></a><span class="st">A   B   C   D   E   F</span></span>
<span id="cb63-222"><a href="#cb63-222" aria-hidden="true" tabindex="-1"></a><span class="st">--------</span></span>
<span id="cb63-223"><a href="#cb63-223" aria-hidden="true" tabindex="-1"></a><span class="st">ACDEFACADF</span></span>
<span id="cb63-224"><a href="#cb63-224" aria-hidden="true" tabindex="-1"></a><span class="st">AFDA---CCF</span></span>
<span id="cb63-225"><a href="#cb63-225" aria-hidden="true" tabindex="-1"></a><span class="st">A--EFD-FDC</span></span>
<span id="cb63-226"><a href="#cb63-226" aria-hidden="true" tabindex="-1"></a><span class="st">ACAEF--A-C</span></span>
<span id="cb63-227"><a href="#cb63-227" aria-hidden="true" tabindex="-1"></a><span class="st">ADDEFAAADF</span></span>
<span id="cb63-228"><a href="#cb63-228" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb63-229"><a href="#cb63-229" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-230"><a href="#cb63-230" aria-hidden="true" tabindex="-1"></a>main(sample_input)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="estimate-the-parameters-of-an-hmm" class="level1" data-number="22">
<h1 data-number="22"><span class="header-section-number">22</span> Estimate the Parameters of an HMM</h1>
<p>Given:&nbsp;A sequence of emitted symbols x = x1 . . . xn in an alphabet ∑ and a path <span class="math inline">\(π = π_1 . . . π_n\)</span> generated by a k-state HMM with unknown transition and emission probabilities.</p>
<p>Return:&nbsp;A matrix of transition probabilities Transition and a matrix of emission probabilities Emission that maximize <span class="math inline">\(Pr(x,π)\)</span> over all possible matrices of transition and emission probabilities.</p>
<section id="sample-dataset-21" class="level2" data-number="22.1">
<h2 data-number="22.1" class="anchored" data-anchor-id="sample-dataset-21"><span class="header-section-number">22.1</span> Sample Dataset</h2>
<pre><code>yzzzyxzxxx
--------
x   y   z
--------
BBABABABAB
--------
A   B   C</code></pre>
</section>
<section id="sample-output-21" class="level2" data-number="22.2">
<h2 data-number="22.2" class="anchored" data-anchor-id="sample-output-21"><span class="header-section-number">22.2</span> Sample Output</h2>
<pre><code>A   B   C
A   0.0 1.0 0.0
B   0.8 0.2 0.0
C   0.333   0.333   0.333
--------
    x   y   z
A   0.25    0.25    0.5
B   0.5 0.167   0.333
C   0.333   0.333   0.333</code></pre>
</section>
<section id="solution-21" class="level2" data-number="22.3">
<h2 data-number="22.3" class="anchored" data-anchor-id="solution-21"><span class="header-section-number">22.3</span> Solution</h2>
<div class="sourceCode" id="cb66"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> io <span class="im">import</span> StringIO</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> collections <span class="im">import</span> defaultdict</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> typing <span class="im">import</span> List, Tuple, Dict, Iterator, Union</span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> normalize_row(row: np.ndarray, include_zeros: <span class="bu">bool</span> <span class="op">=</span> <span class="va">False</span>, minimum_value: <span class="bu">float</span> <span class="op">=</span> <span class="fl">0.0</span>) <span class="op">-&gt;</span> np.ndarray:</span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> include_zeros <span class="kw">and</span> <span class="bu">sum</span>(row) <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a>        row[:] <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> np.errstate(divide<span class="op">=</span><span class="st">"ignore"</span>, invalid<span class="op">=</span><span class="st">"ignore"</span>):</span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true" tabindex="-1"></a>        normalized <span class="op">=</span> row <span class="op">/</span> <span class="bu">sum</span>(row)</span>
<span id="cb66-11"><a href="#cb66-11" aria-hidden="true" tabindex="-1"></a>        normalized[row <span class="op">==</span> <span class="fl">0.0</span>] <span class="op">=</span> minimum_value</span>
<span id="cb66-12"><a href="#cb66-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> normalized</span>
<span id="cb66-13"><a href="#cb66-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-14"><a href="#cb66-14" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> normalize_matrix(matrix: np.ndarray, include_zeros: <span class="bu">bool</span> <span class="op">=</span> <span class="va">False</span>, minimum_value: <span class="bu">float</span> <span class="op">=</span> <span class="fl">0.0</span>) <span class="op">-&gt;</span> np.ndarray:</span>
<span id="cb66-15"><a href="#cb66-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> np.array([normalize_row(r, include_zeros<span class="op">=</span>include_zeros, minimum_value<span class="op">=</span>minimum_value) <span class="cf">for</span> r <span class="kw">in</span> matrix])</span>
<span id="cb66-16"><a href="#cb66-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-17"><a href="#cb66-17" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> print_matrix(matrix: np.ndarray, row_labels: List[<span class="bu">str</span>], column_labels: List[<span class="bu">str</span>]) <span class="op">-&gt;</span> <span class="va">None</span>:</span>
<span id="cb66-18"><a href="#cb66-18" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="op">*</span>column_labels, sep<span class="op">=</span><span class="st">"</span><span class="ch">\t</span><span class="st">"</span>)</span>
<span id="cb66-19"><a href="#cb66-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, row <span class="kw">in</span> <span class="bu">enumerate</span>(matrix):</span>
<span id="cb66-20"><a href="#cb66-20" aria-hidden="true" tabindex="-1"></a>        r <span class="op">=</span> [row_labels[i]] <span class="op">+</span> [<span class="bu">round</span>(x, <span class="dv">3</span>) <span class="cf">if</span> x <span class="op">&gt;</span> <span class="fl">0.0</span> <span class="cf">else</span> <span class="st">"0"</span> <span class="cf">for</span> x <span class="kw">in</span> row]</span>
<span id="cb66-21"><a href="#cb66-21" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="op">*</span>r, sep<span class="op">=</span><span class="st">"</span><span class="ch">\t</span><span class="st">"</span>)</span>
<span id="cb66-22"><a href="#cb66-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-23"><a href="#cb66-23" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> parse_input(handle: Iterator[<span class="bu">str</span>]) <span class="op">-&gt;</span> Tuple[<span class="bu">str</span>, List[<span class="bu">str</span>], <span class="bu">str</span>, List[<span class="bu">str</span>]]:</span>
<span id="cb66-24"><a href="#cb66-24" aria-hidden="true" tabindex="-1"></a>    sequence <span class="op">=</span> <span class="bu">next</span>(handle).rstrip()</span>
<span id="cb66-25"><a href="#cb66-25" aria-hidden="true" tabindex="-1"></a>    <span class="bu">next</span>(handle)</span>
<span id="cb66-26"><a href="#cb66-26" aria-hidden="true" tabindex="-1"></a>    alphabet <span class="op">=</span> <span class="bu">next</span>(handle).split()</span>
<span id="cb66-27"><a href="#cb66-27" aria-hidden="true" tabindex="-1"></a>    <span class="bu">next</span>(handle)</span>
<span id="cb66-28"><a href="#cb66-28" aria-hidden="true" tabindex="-1"></a>    path <span class="op">=</span> <span class="bu">next</span>(handle).rstrip()</span>
<span id="cb66-29"><a href="#cb66-29" aria-hidden="true" tabindex="-1"></a>    <span class="bu">next</span>(handle)</span>
<span id="cb66-30"><a href="#cb66-30" aria-hidden="true" tabindex="-1"></a>    states <span class="op">=</span> <span class="bu">next</span>(handle).split()</span>
<span id="cb66-31"><a href="#cb66-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> sequence, alphabet, path, states</span>
<span id="cb66-32"><a href="#cb66-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-33"><a href="#cb66-33" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> convert_to_dict(matrix: np.ndarray, row_labels: List[<span class="bu">str</span>], column_labels: List[<span class="bu">str</span>]) <span class="op">-&gt;</span> Dict[Tuple[<span class="bu">str</span>, <span class="bu">str</span>], <span class="bu">float</span>]:</span>
<span id="cb66-34"><a href="#cb66-34" aria-hidden="true" tabindex="-1"></a>    result <span class="op">=</span> defaultdict(<span class="bu">float</span>)</span>
<span id="cb66-35"><a href="#cb66-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(matrix.shape[<span class="dv">0</span>]):</span>
<span id="cb66-36"><a href="#cb66-36" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(matrix.shape[<span class="dv">1</span>]):</span>
<span id="cb66-37"><a href="#cb66-37" aria-hidden="true" tabindex="-1"></a>            result[row_labels[i], column_labels[j]] <span class="op">=</span> matrix[i][j]</span>
<span id="cb66-38"><a href="#cb66-38" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> result</span>
<span id="cb66-39"><a href="#cb66-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-40"><a href="#cb66-40" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> estimate_transition_matrix(path: <span class="bu">str</span>, states: List[<span class="bu">str</span>], to_dict: <span class="bu">bool</span> <span class="op">=</span> <span class="va">False</span>) <span class="op">-&gt;</span> Union[np.ndarray, Dict[Tuple[<span class="bu">str</span>, <span class="bu">str</span>], <span class="bu">float</span>]]:</span>
<span id="cb66-41"><a href="#cb66-41" aria-hidden="true" tabindex="-1"></a>    transition_matrix <span class="op">=</span> np.zeros((<span class="bu">len</span>(states), <span class="bu">len</span>(states)), dtype<span class="op">=</span><span class="bu">float</span>)</span>
<span id="cb66-42"><a href="#cb66-42" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> current_state, next_state <span class="kw">in</span> <span class="bu">zip</span>(path, path[<span class="dv">1</span>:]):</span>
<span id="cb66-43"><a href="#cb66-43" aria-hidden="true" tabindex="-1"></a>        transition_matrix[states.index(current_state)][states.index(next_state)] <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb66-44"><a href="#cb66-44" aria-hidden="true" tabindex="-1"></a>    transition_matrix <span class="op">=</span> normalize_matrix(transition_matrix, include_zeros<span class="op">=</span><span class="va">True</span>, minimum_value<span class="op">=</span><span class="fl">1e-16</span>)</span>
<span id="cb66-45"><a href="#cb66-45" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> to_dict:</span>
<span id="cb66-46"><a href="#cb66-46" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> convert_to_dict(transition_matrix, states, states)</span>
<span id="cb66-47"><a href="#cb66-47" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb66-48"><a href="#cb66-48" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> transition_matrix</span>
<span id="cb66-49"><a href="#cb66-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-50"><a href="#cb66-50" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> estimate_emission_matrix(sequence: <span class="bu">str</span>, alphabet: List[<span class="bu">str</span>], path: <span class="bu">str</span>, states: List[<span class="bu">str</span>], to_dict: <span class="bu">bool</span> <span class="op">=</span> <span class="va">False</span>) <span class="op">-&gt;</span> Union[np.ndarray, Dict[Tuple[<span class="bu">str</span>, <span class="bu">str</span>], <span class="bu">float</span>]]:</span>
<span id="cb66-51"><a href="#cb66-51" aria-hidden="true" tabindex="-1"></a>    emission_matrix <span class="op">=</span> np.zeros((<span class="bu">len</span>(states), <span class="bu">len</span>(alphabet)), dtype<span class="op">=</span><span class="bu">float</span>)</span>
<span id="cb66-52"><a href="#cb66-52" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> state, symbol <span class="kw">in</span> <span class="bu">zip</span>(path, sequence):</span>
<span id="cb66-53"><a href="#cb66-53" aria-hidden="true" tabindex="-1"></a>        emission_matrix[states.index(state)][alphabet.index(symbol)] <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb66-54"><a href="#cb66-54" aria-hidden="true" tabindex="-1"></a>    emission_matrix <span class="op">=</span> normalize_matrix(emission_matrix, include_zeros<span class="op">=</span><span class="va">True</span>, minimum_value<span class="op">=</span><span class="fl">1e-16</span>)</span>
<span id="cb66-55"><a href="#cb66-55" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> to_dict:</span>
<span id="cb66-56"><a href="#cb66-56" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> convert_to_dict(emission_matrix, states, alphabet)</span>
<span id="cb66-57"><a href="#cb66-57" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb66-58"><a href="#cb66-58" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> emission_matrix</span>
<span id="cb66-59"><a href="#cb66-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-60"><a href="#cb66-60" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> main(sample_input: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="va">None</span>:</span>
<span id="cb66-61"><a href="#cb66-61" aria-hidden="true" tabindex="-1"></a>    input_lines <span class="op">=</span> <span class="bu">iter</span>(StringIO(sample_input.strip()).readlines())</span>
<span id="cb66-62"><a href="#cb66-62" aria-hidden="true" tabindex="-1"></a>    sequence, alphabet, path, states <span class="op">=</span> parse_input(input_lines)</span>
<span id="cb66-63"><a href="#cb66-63" aria-hidden="true" tabindex="-1"></a>    transition_matrix <span class="op">=</span> estimate_transition_matrix(path, states)</span>
<span id="cb66-64"><a href="#cb66-64" aria-hidden="true" tabindex="-1"></a>    emission_matrix <span class="op">=</span> estimate_emission_matrix(sequence, alphabet, path, states)</span>
<span id="cb66-65"><a href="#cb66-65" aria-hidden="true" tabindex="-1"></a>    print_matrix(transition_matrix, states, states)</span>
<span id="cb66-66"><a href="#cb66-66" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"--------"</span>)</span>
<span id="cb66-67"><a href="#cb66-67" aria-hidden="true" tabindex="-1"></a>    print_matrix(emission_matrix, states, alphabet)</span>
<span id="cb66-68"><a href="#cb66-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-69"><a href="#cb66-69" aria-hidden="true" tabindex="-1"></a>sample_input <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb66-70"><a href="#cb66-70" aria-hidden="true" tabindex="-1"></a><span class="st">yzzzyxzxxx</span></span>
<span id="cb66-71"><a href="#cb66-71" aria-hidden="true" tabindex="-1"></a><span class="st">--------</span></span>
<span id="cb66-72"><a href="#cb66-72" aria-hidden="true" tabindex="-1"></a><span class="st">x   y   z</span></span>
<span id="cb66-73"><a href="#cb66-73" aria-hidden="true" tabindex="-1"></a><span class="st">--------</span></span>
<span id="cb66-74"><a href="#cb66-74" aria-hidden="true" tabindex="-1"></a><span class="st">BBABABABAB</span></span>
<span id="cb66-75"><a href="#cb66-75" aria-hidden="true" tabindex="-1"></a><span class="st">--------</span></span>
<span id="cb66-76"><a href="#cb66-76" aria-hidden="true" tabindex="-1"></a><span class="st">A   B   C</span></span>
<span id="cb66-77"><a href="#cb66-77" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb66-78"><a href="#cb66-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-79"><a href="#cb66-79" aria-hidden="true" tabindex="-1"></a>main(sample_input)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="implement-viterbi-learning" class="level1" data-number="23">
<h1 data-number="23"><span class="header-section-number">23</span> Implement Viterbi Learning</h1>
<p>Given:&nbsp;A sequence of emitted symbols&nbsp;<span class="math inline">\(x=x_1 ... x_n\)</span>&nbsp;in an alphabet&nbsp;<em>A</em>, generated by a&nbsp;<em>k</em>-state HMM with unknown transition and emission probabilities, initial&nbsp;<em>Transition</em>&nbsp;and&nbsp;<em>Emission</em>&nbsp;matrices and a number of iterations&nbsp;<em>i</em>.</p>
<p>Return:&nbsp;A matrix of transition probabilities&nbsp;<em>Transition</em>&nbsp;and a matrix of emission probabilities&nbsp;<em>Emission</em>&nbsp;that maximizes <span class="math inline">\(Pr(x,π)\)</span> over all possible transition and emission matrices and over all hidden paths&nbsp;<em>π</em>.</p>
<section id="sample-dataset-22" class="level2" data-number="23.1">
<h2 data-number="23.1" class="anchored" data-anchor-id="sample-dataset-22"><span class="header-section-number">23.1</span> Sample Dataset</h2>
<pre><code>100
--------
xxxzyzzxxzxyzxzxyxxzyzyzyyyyzzxxxzzxzyzzzxyxzzzxyzzxxxxzzzxyyxzzzzzyzzzxxzzxxxyxyzzyxzxxxyxzyxxyzyxz
--------
x   y   z
--------
A   B
--------
    A   B
A   0.582   0.418
B   0.272   0.728
--------
    x   y   z
A   0.129   0.35    0.52
B   0.422   0.151   0.426</code></pre>
</section>
<section id="sample-output-22" class="level2" data-number="23.2">
<h2 data-number="23.2" class="anchored" data-anchor-id="sample-output-22"><span class="header-section-number">23.2</span> Sample Output</h2>
<pre><code>A   B
A   0.875   0.125
B   0.011   0.989
--------
    x   y   z
A   0.0 0.75    0.25
B   0.402   0.174   0.424</code></pre>
</section>
<section id="solution-22" class="level2" data-number="23.3">
<h2 data-number="23.3" class="anchored" data-anchor-id="solution-22"><span class="header-section-number">23.3</span> Solution</h2>
<div class="sourceCode" id="cb69"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> io <span class="im">import</span> StringIO</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> typing <span class="im">import</span> List, Dict, Tuple</span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> math <span class="im">import</span> log</span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> viterbi(sequence: <span class="bu">str</span>, states: List[<span class="bu">str</span>], transition_matrix: Dict[Tuple[<span class="bu">str</span>, <span class="bu">str</span>], <span class="bu">float</span>], emission_matrix: Dict[Tuple[<span class="bu">str</span>, <span class="bu">str</span>], <span class="bu">float</span>]) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a>    mat <span class="op">=</span> np.zeros((<span class="bu">len</span>(sequence), <span class="bu">len</span>(states)))</span>
<span id="cb69-8"><a href="#cb69-8" aria-hidden="true" tabindex="-1"></a>    ptr <span class="op">=</span> np.zeros((<span class="bu">len</span>(sequence), <span class="bu">len</span>(states)), dtype<span class="op">=</span><span class="bu">int</span>)</span>
<span id="cb69-9"><a href="#cb69-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-10"><a href="#cb69-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, state <span class="kw">in</span> <span class="bu">enumerate</span>(states):</span>
<span id="cb69-11"><a href="#cb69-11" aria-hidden="true" tabindex="-1"></a>        mat[<span class="dv">0</span>, i] <span class="op">=</span> log(emission_matrix[state, sequence[<span class="dv">0</span>]] <span class="op">/</span> <span class="bu">len</span>(states))</span>
<span id="cb69-12"><a href="#cb69-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-13"><a href="#cb69-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, emission <span class="kw">in</span> <span class="bu">enumerate</span>(sequence[<span class="dv">1</span>:], start<span class="op">=</span><span class="dv">1</span>):</span>
<span id="cb69-14"><a href="#cb69-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> j, state <span class="kw">in</span> <span class="bu">enumerate</span>(states):</span>
<span id="cb69-15"><a href="#cb69-15" aria-hidden="true" tabindex="-1"></a>            opt <span class="op">=</span> [</span>
<span id="cb69-16"><a href="#cb69-16" aria-hidden="true" tabindex="-1"></a>                log(transition_matrix[prev, state]) <span class="op">+</span> log(emission_matrix[state, emission]) <span class="op">+</span> mat[i <span class="op">-</span> <span class="dv">1</span>, k]</span>
<span id="cb69-17"><a href="#cb69-17" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> k, prev <span class="kw">in</span> <span class="bu">enumerate</span>(states)</span>
<span id="cb69-18"><a href="#cb69-18" aria-hidden="true" tabindex="-1"></a>            ]</span>
<span id="cb69-19"><a href="#cb69-19" aria-hidden="true" tabindex="-1"></a>            p <span class="op">=</span> opt.index(<span class="bu">max</span>(opt))</span>
<span id="cb69-20"><a href="#cb69-20" aria-hidden="true" tabindex="-1"></a>            ptr[i, j] <span class="op">=</span> p</span>
<span id="cb69-21"><a href="#cb69-21" aria-hidden="true" tabindex="-1"></a>            mat[i, j] <span class="op">=</span> <span class="bu">max</span>(opt)</span>
<span id="cb69-22"><a href="#cb69-22" aria-hidden="true" tabindex="-1"></a>    ind <span class="op">=</span> np.argmax(mat[i, :])</span>
<span id="cb69-23"><a href="#cb69-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-24"><a href="#cb69-24" aria-hidden="true" tabindex="-1"></a>    state_sequence <span class="op">=</span> states[ind]</span>
<span id="cb69-25"><a href="#cb69-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> i <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb69-26"><a href="#cb69-26" aria-hidden="true" tabindex="-1"></a>        state_sequence <span class="op">=</span> states[ptr[i, ind]] <span class="op">+</span> state_sequence</span>
<span id="cb69-27"><a href="#cb69-27" aria-hidden="true" tabindex="-1"></a>        ind <span class="op">=</span> ptr[i, ind]</span>
<span id="cb69-28"><a href="#cb69-28" aria-hidden="true" tabindex="-1"></a>        i <span class="op">-=</span> <span class="dv">1</span></span>
<span id="cb69-29"><a href="#cb69-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> state_sequence</span>
<span id="cb69-30"><a href="#cb69-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-31"><a href="#cb69-31" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> print_matrix(matrix: np.ndarray, row_labels: List[<span class="bu">str</span>], column_labels: List[<span class="bu">str</span>]) <span class="op">-&gt;</span> <span class="va">None</span>:</span>
<span id="cb69-32"><a href="#cb69-32" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="op">*</span>column_labels, sep<span class="op">=</span><span class="st">"</span><span class="ch">\t</span><span class="st">"</span>)</span>
<span id="cb69-33"><a href="#cb69-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, row <span class="kw">in</span> <span class="bu">enumerate</span>(matrix):</span>
<span id="cb69-34"><a href="#cb69-34" aria-hidden="true" tabindex="-1"></a>        r <span class="op">=</span> [row_labels[i]] <span class="op">+</span> [<span class="bu">round</span>(x, <span class="dv">3</span>) <span class="cf">if</span> x <span class="op">&gt;</span> <span class="fl">0.0</span> <span class="cf">else</span> <span class="st">"0"</span> <span class="cf">for</span> x <span class="kw">in</span> row]</span>
<span id="cb69-35"><a href="#cb69-35" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="op">*</span>r, sep<span class="op">=</span><span class="st">"</span><span class="ch">\t</span><span class="st">"</span>)</span>
<span id="cb69-36"><a href="#cb69-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-37"><a href="#cb69-37" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> normalize_matrix(matrix: np.ndarray, include_zeros: <span class="bu">bool</span> <span class="op">=</span> <span class="va">True</span>, min_val: <span class="bu">float</span> <span class="op">=</span> <span class="fl">1e-16</span>) <span class="op">-&gt;</span> np.ndarray:</span>
<span id="cb69-38"><a href="#cb69-38" aria-hidden="true" tabindex="-1"></a>    normalized <span class="op">=</span> matrix <span class="op">/</span> matrix.<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">1</span>, keepdims<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb69-39"><a href="#cb69-39" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> include_zeros:</span>
<span id="cb69-40"><a href="#cb69-40" aria-hidden="true" tabindex="-1"></a>        normalized[normalized <span class="op">==</span> <span class="dv">0</span>] <span class="op">=</span> min_val</span>
<span id="cb69-41"><a href="#cb69-41" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> normalized</span>
<span id="cb69-42"><a href="#cb69-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-43"><a href="#cb69-43" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> estimate_transition_matrix(path: <span class="bu">str</span>, states: List[<span class="bu">str</span>], to_dict: <span class="bu">bool</span> <span class="op">=</span> <span class="va">False</span>) <span class="op">-&gt;</span> Dict[Tuple[<span class="bu">str</span>, <span class="bu">str</span>], <span class="bu">float</span>]:</span>
<span id="cb69-44"><a href="#cb69-44" aria-hidden="true" tabindex="-1"></a>    tmat <span class="op">=</span> np.zeros((<span class="bu">len</span>(states), <span class="bu">len</span>(states)), dtype<span class="op">=</span><span class="bu">float</span>)</span>
<span id="cb69-45"><a href="#cb69-45" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> a, b <span class="kw">in</span> <span class="bu">zip</span>(path, path[<span class="dv">1</span>:]):</span>
<span id="cb69-46"><a href="#cb69-46" aria-hidden="true" tabindex="-1"></a>        tmat[states.index(a)][states.index(b)] <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb69-47"><a href="#cb69-47" aria-hidden="true" tabindex="-1"></a>    tmat <span class="op">=</span> normalize_matrix(tmat)</span>
<span id="cb69-48"><a href="#cb69-48" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> to_dict:</span>
<span id="cb69-49"><a href="#cb69-49" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> {(states[i], states[j]): tmat[i, j] <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(states)) <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(states))}</span>
<span id="cb69-50"><a href="#cb69-50" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> tmat</span>
<span id="cb69-51"><a href="#cb69-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-52"><a href="#cb69-52" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> estimate_emission_matrix(sequence: <span class="bu">str</span>, alphabet: List[<span class="bu">str</span>], path: <span class="bu">str</span>, states: List[<span class="bu">str</span>], to_dict: <span class="bu">bool</span> <span class="op">=</span> <span class="va">False</span>) <span class="op">-&gt;</span> Dict[Tuple[<span class="bu">str</span>, <span class="bu">str</span>], <span class="bu">float</span>]:</span>
<span id="cb69-53"><a href="#cb69-53" aria-hidden="true" tabindex="-1"></a>    emat <span class="op">=</span> np.zeros((<span class="bu">len</span>(states), <span class="bu">len</span>(alphabet)), dtype<span class="op">=</span><span class="bu">float</span>)</span>
<span id="cb69-54"><a href="#cb69-54" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> a, b <span class="kw">in</span> <span class="bu">zip</span>(path, sequence):</span>
<span id="cb69-55"><a href="#cb69-55" aria-hidden="true" tabindex="-1"></a>        emat[states.index(a)][alphabet.index(b)] <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb69-56"><a href="#cb69-56" aria-hidden="true" tabindex="-1"></a>    emat <span class="op">=</span> normalize_matrix(emat)</span>
<span id="cb69-57"><a href="#cb69-57" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> to_dict:</span>
<span id="cb69-58"><a href="#cb69-58" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> {(states[i], alphabet[j]): emat[i, j] <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(states)) <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(alphabet))}</span>
<span id="cb69-59"><a href="#cb69-59" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> emat</span>
<span id="cb69-60"><a href="#cb69-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-61"><a href="#cb69-61" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> print_dict(d: Dict[Tuple[<span class="bu">str</span>, <span class="bu">str</span>], <span class="bu">float</span>], row_labels: List[<span class="bu">str</span>], column_labels: List[<span class="bu">str</span>]) <span class="op">-&gt;</span> <span class="va">None</span>:</span>
<span id="cb69-62"><a href="#cb69-62" aria-hidden="true" tabindex="-1"></a>    mat <span class="op">=</span> np.zeros((<span class="bu">len</span>(row_labels), <span class="bu">len</span>(column_labels)), dtype<span class="op">=</span><span class="bu">float</span>)</span>
<span id="cb69-63"><a href="#cb69-63" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, r <span class="kw">in</span> <span class="bu">enumerate</span>(row_labels):</span>
<span id="cb69-64"><a href="#cb69-64" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> j, c <span class="kw">in</span> <span class="bu">enumerate</span>(column_labels):</span>
<span id="cb69-65"><a href="#cb69-65" aria-hidden="true" tabindex="-1"></a>            mat[i, j] <span class="op">=</span> d[r, c]</span>
<span id="cb69-66"><a href="#cb69-66" aria-hidden="true" tabindex="-1"></a>    print_matrix(mat, row_labels, column_labels)</span>
<span id="cb69-67"><a href="#cb69-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-68"><a href="#cb69-68" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> parse_input(handle: StringIO) <span class="op">-&gt;</span> Tuple[<span class="bu">int</span>, <span class="bu">str</span>, List[<span class="bu">str</span>], List[<span class="bu">str</span>], Dict[Tuple[<span class="bu">str</span>, <span class="bu">str</span>], <span class="bu">float</span>], Dict[Tuple[<span class="bu">str</span>, <span class="bu">str</span>], <span class="bu">float</span>]]:</span>
<span id="cb69-69"><a href="#cb69-69" aria-hidden="true" tabindex="-1"></a>    niter <span class="op">=</span> <span class="bu">int</span>(<span class="bu">next</span>(handle).rstrip())</span>
<span id="cb69-70"><a href="#cb69-70" aria-hidden="true" tabindex="-1"></a>    <span class="bu">next</span>(handle)</span>
<span id="cb69-71"><a href="#cb69-71" aria-hidden="true" tabindex="-1"></a>    sequence <span class="op">=</span> <span class="bu">next</span>(handle).rstrip()</span>
<span id="cb69-72"><a href="#cb69-72" aria-hidden="true" tabindex="-1"></a>    <span class="bu">next</span>(handle)</span>
<span id="cb69-73"><a href="#cb69-73" aria-hidden="true" tabindex="-1"></a>    alphabet <span class="op">=</span> <span class="bu">next</span>(handle).split()</span>
<span id="cb69-74"><a href="#cb69-74" aria-hidden="true" tabindex="-1"></a>    <span class="bu">next</span>(handle)</span>
<span id="cb69-75"><a href="#cb69-75" aria-hidden="true" tabindex="-1"></a>    states <span class="op">=</span> <span class="bu">next</span>(handle).split()</span>
<span id="cb69-76"><a href="#cb69-76" aria-hidden="true" tabindex="-1"></a>    <span class="bu">next</span>(handle)</span>
<span id="cb69-77"><a href="#cb69-77" aria-hidden="true" tabindex="-1"></a>    lines <span class="op">=</span> [<span class="bu">next</span>(handle) <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(states) <span class="op">+</span> <span class="dv">1</span>)]</span>
<span id="cb69-78"><a href="#cb69-78" aria-hidden="true" tabindex="-1"></a>    transition_matrix <span class="op">=</span> {</span>
<span id="cb69-79"><a href="#cb69-79" aria-hidden="true" tabindex="-1"></a>        (states[i], states[j]): <span class="bu">float</span>(v)</span>
<span id="cb69-80"><a href="#cb69-80" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i, x <span class="kw">in</span> <span class="bu">enumerate</span>(lines[<span class="dv">1</span>:])</span>
<span id="cb69-81"><a href="#cb69-81" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> j, v <span class="kw">in</span> <span class="bu">enumerate</span>(x.split()[<span class="dv">1</span>:])</span>
<span id="cb69-82"><a href="#cb69-82" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb69-83"><a href="#cb69-83" aria-hidden="true" tabindex="-1"></a>    <span class="bu">next</span>(handle)</span>
<span id="cb69-84"><a href="#cb69-84" aria-hidden="true" tabindex="-1"></a>    lines <span class="op">=</span> [<span class="bu">next</span>(handle) <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(states) <span class="op">+</span> <span class="dv">1</span>)]</span>
<span id="cb69-85"><a href="#cb69-85" aria-hidden="true" tabindex="-1"></a>    emission_matrix <span class="op">=</span> {</span>
<span id="cb69-86"><a href="#cb69-86" aria-hidden="true" tabindex="-1"></a>        (states[i], alphabet[j]): <span class="bu">float</span>(v)</span>
<span id="cb69-87"><a href="#cb69-87" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i, x <span class="kw">in</span> <span class="bu">enumerate</span>(lines[<span class="dv">1</span>:])</span>
<span id="cb69-88"><a href="#cb69-88" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> j, v <span class="kw">in</span> <span class="bu">enumerate</span>(x.split()[<span class="dv">1</span>:])</span>
<span id="cb69-89"><a href="#cb69-89" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb69-90"><a href="#cb69-90" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> niter, sequence, states, alphabet, transition_matrix, emission_matrix</span>
<span id="cb69-91"><a href="#cb69-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-92"><a href="#cb69-92" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> main(sample_input: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="va">None</span>:</span>
<span id="cb69-93"><a href="#cb69-93" aria-hidden="true" tabindex="-1"></a>    input_lines <span class="op">=</span> StringIO(sample_input.strip())</span>
<span id="cb69-94"><a href="#cb69-94" aria-hidden="true" tabindex="-1"></a>    niter, sequence, states, alphabet, transition_matrix, emission_matrix <span class="op">=</span> parse_input(input_lines)</span>
<span id="cb69-95"><a href="#cb69-95" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(niter):</span>
<span id="cb69-96"><a href="#cb69-96" aria-hidden="true" tabindex="-1"></a>        path <span class="op">=</span> viterbi(sequence, states, transition_matrix, emission_matrix)</span>
<span id="cb69-97"><a href="#cb69-97" aria-hidden="true" tabindex="-1"></a>        transition_matrix <span class="op">=</span> estimate_transition_matrix(path, states, to_dict<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb69-98"><a href="#cb69-98" aria-hidden="true" tabindex="-1"></a>        emission_matrix <span class="op">=</span> estimate_emission_matrix(sequence, alphabet, path, states, to_dict<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb69-99"><a href="#cb69-99" aria-hidden="true" tabindex="-1"></a>    print_dict(transition_matrix, states, states)</span>
<span id="cb69-100"><a href="#cb69-100" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"--------"</span>)</span>
<span id="cb69-101"><a href="#cb69-101" aria-hidden="true" tabindex="-1"></a>    print_dict(emission_matrix, states, alphabet)</span>
<span id="cb69-102"><a href="#cb69-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-103"><a href="#cb69-103" aria-hidden="true" tabindex="-1"></a>sample_input <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb69-104"><a href="#cb69-104" aria-hidden="true" tabindex="-1"></a><span class="st">100</span></span>
<span id="cb69-105"><a href="#cb69-105" aria-hidden="true" tabindex="-1"></a><span class="st">--------</span></span>
<span id="cb69-106"><a href="#cb69-106" aria-hidden="true" tabindex="-1"></a><span class="st">xxxzyzzxxzxyzxzxyxxzyzyzyyyyzzxxxzzxzyzzzxyxzzzxyzzxxxxzzzxyyxzzzzzyzzzxxzzxxxyxyzzyxzxxxyxzyxxyzyxz</span></span>
<span id="cb69-107"><a href="#cb69-107" aria-hidden="true" tabindex="-1"></a><span class="st">--------</span></span>
<span id="cb69-108"><a href="#cb69-108" aria-hidden="true" tabindex="-1"></a><span class="st">x   y   z</span></span>
<span id="cb69-109"><a href="#cb69-109" aria-hidden="true" tabindex="-1"></a><span class="st">--------</span></span>
<span id="cb69-110"><a href="#cb69-110" aria-hidden="true" tabindex="-1"></a><span class="st">A   B</span></span>
<span id="cb69-111"><a href="#cb69-111" aria-hidden="true" tabindex="-1"></a><span class="st">--------</span></span>
<span id="cb69-112"><a href="#cb69-112" aria-hidden="true" tabindex="-1"></a><span class="st">    A   B</span></span>
<span id="cb69-113"><a href="#cb69-113" aria-hidden="true" tabindex="-1"></a><span class="st">A   0.582   0.418</span></span>
<span id="cb69-114"><a href="#cb69-114" aria-hidden="true" tabindex="-1"></a><span class="st">B   0.272   0.728</span></span>
<span id="cb69-115"><a href="#cb69-115" aria-hidden="true" tabindex="-1"></a><span class="st">--------</span></span>
<span id="cb69-116"><a href="#cb69-116" aria-hidden="true" tabindex="-1"></a><span class="st">    x   y   z</span></span>
<span id="cb69-117"><a href="#cb69-117" aria-hidden="true" tabindex="-1"></a><span class="st">A   0.129   0.35    0.52</span></span>
<span id="cb69-118"><a href="#cb69-118" aria-hidden="true" tabindex="-1"></a><span class="st">B   0.422   0.151   0.426</span></span>
<span id="cb69-119"><a href="#cb69-119" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb69-120"><a href="#cb69-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-121"><a href="#cb69-121" aria-hidden="true" tabindex="-1"></a>main(sample_input)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="solve-the-soft-decoding-problem" class="level1" data-number="24">
<h1 data-number="24"><span class="header-section-number">24</span> Solve the Soft Decoding Problem</h1>
<p>Given:&nbsp;A string&nbsp;<em>x</em>, followed by the alphabet&nbsp;<em>Σ</em>&nbsp;from which&nbsp;<em>x</em>&nbsp;was constructed, followed by the states&nbsp;<em>States</em>, transition matrix&nbsp;<em>Transition</em>, and emission matrix&nbsp;<em>Emission</em>&nbsp;of an HMM (<em>Σ</em>,&nbsp;<em>States</em>,&nbsp;<em>Transition</em>,&nbsp;<em>Emission</em>).</p>
<p>Return:&nbsp;The probability <span class="math inline">\(Pr(π_i=k|x)\)</span> that the HMM was in state k at step i (for each state k and each step i).</p>
<section id="sample-dataset-23" class="level2" data-number="24.1">
<h2 data-number="24.1" class="anchored" data-anchor-id="sample-dataset-23"><span class="header-section-number">24.1</span> Sample Dataset</h2>
<pre><code>zyxxxxyxzz
--------
x   y   z
--------
A   B
--------
    A   B
A   0.911   0.089
B   0.228   0.772
--------
    x   y   z
A   0.356   0.191   0.453 
B   0.04    0.467   0.493</code></pre>
</section>
<section id="sample-output-23" class="level2" data-number="24.2">
<h2 data-number="24.2" class="anchored" data-anchor-id="sample-output-23"><span class="header-section-number">24.2</span> Sample Output</h2>
<pre><code>A   B 
0.5438  0.4562 
0.6492  0.3508 
0.9647  0.0353 
0.9936  0.0064 
0.9957  0.0043 
0.9891  0.0109 
0.9154  0.0846 
0.964   0.036 
0.8737  0.1263 
0.8167  0.1833</code></pre>
</section>
<section id="solution-23" class="level2" data-number="24.3">
<h2 data-number="24.3" class="anchored" data-anchor-id="solution-23"><span class="header-section-number">24.3</span> Solution</h2>
<div class="sourceCode" id="cb72"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> typing <span class="im">import</span> List, Dict, Tuple, Iterator</span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> io <span class="im">import</span> StringIO</span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> parse_input(handle: Iterator[<span class="bu">str</span>]) <span class="op">-&gt;</span> Tuple[<span class="bu">str</span>, List[<span class="bu">str</span>], Dict[Tuple[<span class="bu">str</span>, <span class="bu">str</span>], <span class="bu">float</span>], Dict[Tuple[<span class="bu">str</span>, <span class="bu">str</span>], <span class="bu">float</span>]]:</span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a>    seq: <span class="bu">str</span> <span class="op">=</span> <span class="bu">next</span>(handle).rstrip()</span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a>    <span class="bu">next</span>(handle)</span>
<span id="cb72-8"><a href="#cb72-8" aria-hidden="true" tabindex="-1"></a>    alphabet: List[<span class="bu">str</span>] <span class="op">=</span> <span class="bu">next</span>(handle).split()</span>
<span id="cb72-9"><a href="#cb72-9" aria-hidden="true" tabindex="-1"></a>    <span class="bu">next</span>(handle)</span>
<span id="cb72-10"><a href="#cb72-10" aria-hidden="true" tabindex="-1"></a>    states: List[<span class="bu">str</span>] <span class="op">=</span> <span class="bu">next</span>(handle).split()</span>
<span id="cb72-11"><a href="#cb72-11" aria-hidden="true" tabindex="-1"></a>    <span class="bu">next</span>(handle)</span>
<span id="cb72-12"><a href="#cb72-12" aria-hidden="true" tabindex="-1"></a>    lines: List[<span class="bu">str</span>] <span class="op">=</span> [<span class="bu">next</span>(handle) <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(states) <span class="op">+</span> <span class="dv">1</span>)]</span>
<span id="cb72-13"><a href="#cb72-13" aria-hidden="true" tabindex="-1"></a>    tmat: Dict[Tuple[<span class="bu">str</span>, <span class="bu">str</span>], <span class="bu">float</span>] <span class="op">=</span> {</span>
<span id="cb72-14"><a href="#cb72-14" aria-hidden="true" tabindex="-1"></a>        (states[i], states[j]): <span class="bu">float</span>(v)</span>
<span id="cb72-15"><a href="#cb72-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i, x <span class="kw">in</span> <span class="bu">enumerate</span>(lines[<span class="dv">1</span>:])</span>
<span id="cb72-16"><a href="#cb72-16" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> j, v <span class="kw">in</span> <span class="bu">enumerate</span>(x.split()[<span class="dv">1</span>:])</span>
<span id="cb72-17"><a href="#cb72-17" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb72-18"><a href="#cb72-18" aria-hidden="true" tabindex="-1"></a>    <span class="bu">next</span>(handle)</span>
<span id="cb72-19"><a href="#cb72-19" aria-hidden="true" tabindex="-1"></a>    lines <span class="op">=</span> [<span class="bu">next</span>(handle) <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(states) <span class="op">+</span> <span class="dv">1</span>)]</span>
<span id="cb72-20"><a href="#cb72-20" aria-hidden="true" tabindex="-1"></a>    emat: Dict[Tuple[<span class="bu">str</span>, <span class="bu">str</span>], <span class="bu">float</span>] <span class="op">=</span> {</span>
<span id="cb72-21"><a href="#cb72-21" aria-hidden="true" tabindex="-1"></a>        (states[i], alphabet[j]): <span class="bu">float</span>(v)</span>
<span id="cb72-22"><a href="#cb72-22" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i, x <span class="kw">in</span> <span class="bu">enumerate</span>(lines[<span class="dv">1</span>:])</span>
<span id="cb72-23"><a href="#cb72-23" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> j, v <span class="kw">in</span> <span class="bu">enumerate</span>(x.split()[<span class="dv">1</span>:])</span>
<span id="cb72-24"><a href="#cb72-24" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb72-25"><a href="#cb72-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> seq, states, tmat, emat</span>
<span id="cb72-26"><a href="#cb72-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-27"><a href="#cb72-27" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> forward(seq: <span class="bu">str</span>, states: List[<span class="bu">str</span>], tmat: Dict[Tuple[<span class="bu">str</span>, <span class="bu">str</span>], <span class="bu">float</span>], emat: Dict[Tuple[<span class="bu">str</span>, <span class="bu">str</span>], <span class="bu">float</span>]) <span class="op">-&gt;</span> np.ndarray:</span>
<span id="cb72-28"><a href="#cb72-28" aria-hidden="true" tabindex="-1"></a>    mat: np.ndarray <span class="op">=</span> np.ones((<span class="bu">len</span>(seq), <span class="bu">len</span>(states)))</span>
<span id="cb72-29"><a href="#cb72-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-30"><a href="#cb72-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, state <span class="kw">in</span> <span class="bu">enumerate</span>(states):</span>
<span id="cb72-31"><a href="#cb72-31" aria-hidden="true" tabindex="-1"></a>        mat[<span class="dv">0</span>, i] <span class="op">=</span> emat[state, seq[<span class="dv">0</span>]]</span>
<span id="cb72-32"><a href="#cb72-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, emission <span class="kw">in</span> <span class="bu">enumerate</span>(seq[<span class="dv">1</span>:], start<span class="op">=</span><span class="dv">1</span>):</span>
<span id="cb72-33"><a href="#cb72-33" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> j, state <span class="kw">in</span> <span class="bu">enumerate</span>(states):</span>
<span id="cb72-34"><a href="#cb72-34" aria-hidden="true" tabindex="-1"></a>            mat[i, j] <span class="op">=</span> <span class="bu">sum</span>(</span>
<span id="cb72-35"><a href="#cb72-35" aria-hidden="true" tabindex="-1"></a>                tmat[prev, state] <span class="op">*</span> emat[state, emission] <span class="op">*</span> mat[i <span class="op">-</span> <span class="dv">1</span>, k]</span>
<span id="cb72-36"><a href="#cb72-36" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> k, prev <span class="kw">in</span> <span class="bu">enumerate</span>(states)</span>
<span id="cb72-37"><a href="#cb72-37" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb72-38"><a href="#cb72-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-39"><a href="#cb72-39" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> mat</span>
<span id="cb72-40"><a href="#cb72-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-41"><a href="#cb72-41" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> backward(seq: <span class="bu">str</span>, states: List[<span class="bu">str</span>], tmat: Dict[Tuple[<span class="bu">str</span>, <span class="bu">str</span>], <span class="bu">float</span>], emat: Dict[Tuple[<span class="bu">str</span>, <span class="bu">str</span>], <span class="bu">float</span>]) <span class="op">-&gt;</span> np.ndarray:</span>
<span id="cb72-42"><a href="#cb72-42" aria-hidden="true" tabindex="-1"></a>    mat: np.ndarray <span class="op">=</span> np.ones((<span class="bu">len</span>(seq), <span class="bu">len</span>(states)))</span>
<span id="cb72-43"><a href="#cb72-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-44"><a href="#cb72-44" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, emission <span class="kw">in</span> <span class="bu">enumerate</span>(seq[::<span class="op">-</span><span class="dv">1</span>][:<span class="op">-</span><span class="dv">1</span>], start<span class="op">=</span><span class="dv">1</span>):</span>
<span id="cb72-45"><a href="#cb72-45" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> j, state <span class="kw">in</span> <span class="bu">enumerate</span>(states):</span>
<span id="cb72-46"><a href="#cb72-46" aria-hidden="true" tabindex="-1"></a>            mat[<span class="bu">len</span>(seq) <span class="op">-</span> i <span class="op">-</span> <span class="dv">1</span>, j] <span class="op">=</span> <span class="bu">sum</span>(</span>
<span id="cb72-47"><a href="#cb72-47" aria-hidden="true" tabindex="-1"></a>                tmat[state, prev] <span class="op">*</span> emat[prev, emission] <span class="op">*</span> mat[<span class="bu">len</span>(seq) <span class="op">-</span> i, k]</span>
<span id="cb72-48"><a href="#cb72-48" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> k, prev <span class="kw">in</span> <span class="bu">enumerate</span>(states)</span>
<span id="cb72-49"><a href="#cb72-49" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb72-50"><a href="#cb72-50" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> mat</span>
<span id="cb72-51"><a href="#cb72-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-52"><a href="#cb72-52" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> soft_decode(seq: <span class="bu">str</span>, states: List[<span class="bu">str</span>], tmat: Dict[Tuple[<span class="bu">str</span>, <span class="bu">str</span>], <span class="bu">float</span>], emat: Dict[Tuple[<span class="bu">str</span>, <span class="bu">str</span>], <span class="bu">float</span>], normalise: <span class="bu">bool</span> <span class="op">=</span> <span class="va">True</span>) <span class="op">-&gt;</span> np.ndarray:</span>
<span id="cb72-53"><a href="#cb72-53" aria-hidden="true" tabindex="-1"></a>    tot: np.ndarray <span class="op">=</span> forward(seq, states, tmat, emat) <span class="op">*</span> backward(seq, states, tmat, emat)</span>
<span id="cb72-54"><a href="#cb72-54" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> normalise:</span>
<span id="cb72-55"><a href="#cb72-55" aria-hidden="true" tabindex="-1"></a>        tot <span class="op">=</span> tot <span class="op">/</span> np.<span class="bu">sum</span>(tot, axis<span class="op">=</span><span class="dv">1</span>, keepdims<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb72-56"><a href="#cb72-56" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> tot</span>
<span id="cb72-57"><a href="#cb72-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-58"><a href="#cb72-58" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> main(sample_input: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="va">None</span>:</span>
<span id="cb72-59"><a href="#cb72-59" aria-hidden="true" tabindex="-1"></a>    input_lines: Iterator[<span class="bu">str</span>] <span class="op">=</span> StringIO(sample_input.strip())</span>
<span id="cb72-60"><a href="#cb72-60" aria-hidden="true" tabindex="-1"></a>    seq, states, tmat, emat <span class="op">=</span> parse_input(input_lines)</span>
<span id="cb72-61"><a href="#cb72-61" aria-hidden="true" tabindex="-1"></a>    tot: np.ndarray <span class="op">=</span> soft_decode(seq, states, tmat, emat)</span>
<span id="cb72-62"><a href="#cb72-62" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="op">*</span>states, sep<span class="op">=</span><span class="st">"</span><span class="ch">\t</span><span class="st">"</span>)</span>
<span id="cb72-63"><a href="#cb72-63" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> r <span class="kw">in</span> np.<span class="bu">round</span>(tot, <span class="dv">4</span>):</span>
<span id="cb72-64"><a href="#cb72-64" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="op">*</span>r, sep<span class="op">=</span><span class="st">"</span><span class="ch">\t</span><span class="st">"</span>)</span>
<span id="cb72-65"><a href="#cb72-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-66"><a href="#cb72-66" aria-hidden="true" tabindex="-1"></a>sample_input: <span class="bu">str</span> <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb72-67"><a href="#cb72-67" aria-hidden="true" tabindex="-1"></a><span class="st">zyxxxxyxzz</span></span>
<span id="cb72-68"><a href="#cb72-68" aria-hidden="true" tabindex="-1"></a><span class="st">--------</span></span>
<span id="cb72-69"><a href="#cb72-69" aria-hidden="true" tabindex="-1"></a><span class="st">x   y   z</span></span>
<span id="cb72-70"><a href="#cb72-70" aria-hidden="true" tabindex="-1"></a><span class="st">--------</span></span>
<span id="cb72-71"><a href="#cb72-71" aria-hidden="true" tabindex="-1"></a><span class="st">A   B</span></span>
<span id="cb72-72"><a href="#cb72-72" aria-hidden="true" tabindex="-1"></a><span class="st">--------</span></span>
<span id="cb72-73"><a href="#cb72-73" aria-hidden="true" tabindex="-1"></a><span class="st">    A   B</span></span>
<span id="cb72-74"><a href="#cb72-74" aria-hidden="true" tabindex="-1"></a><span class="st">A   0.911   0.089</span></span>
<span id="cb72-75"><a href="#cb72-75" aria-hidden="true" tabindex="-1"></a><span class="st">B   0.228   0.772</span></span>
<span id="cb72-76"><a href="#cb72-76" aria-hidden="true" tabindex="-1"></a><span class="st">--------</span></span>
<span id="cb72-77"><a href="#cb72-77" aria-hidden="true" tabindex="-1"></a><span class="st">    x   y   z</span></span>
<span id="cb72-78"><a href="#cb72-78" aria-hidden="true" tabindex="-1"></a><span class="st">A   0.356   0.191   0.453 </span></span>
<span id="cb72-79"><a href="#cb72-79" aria-hidden="true" tabindex="-1"></a><span class="st">B   0.04    0.467   0.493</span></span>
<span id="cb72-80"><a href="#cb72-80" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb72-81"><a href="#cb72-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-82"><a href="#cb72-82" aria-hidden="true" tabindex="-1"></a>main(sample_input)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="implement-baum-welch-learning" class="level1" data-number="25">
<h1 data-number="25"><span class="header-section-number">25</span> Implement Baum-Welch Learning</h1>
<p>Given:&nbsp;A sequence of emitted symbols <span class="math inline">\(x=x_1...x_n\)</span> in an alphabet A, generated by a k-state HMM with unknown transition and emission probabilities, initial Transition and Emission matrices and a number of iterations I.</p>
<p>Return:&nbsp;A matrix of transition probabilities Transition and a matrix of emission probabilities Emission that maximizes <span class="math inline">\(Pr(x,π)\)</span> over all possible transition and emission matrices and over all hidden paths π.</p>
<section id="sample-dataset-24" class="level2" data-number="25.1">
<h2 data-number="25.1" class="anchored" data-anchor-id="sample-dataset-24"><span class="header-section-number">25.1</span> Sample Dataset</h2>
<pre><code>10
--------
xzyyzyzyxy
--------
x   y   z
--------
A   B
--------
    A   B
A   0.019   0.981 
B   0.668   0.332 
--------
x   y   z
A   0.175   0.003   0.821 
B   0.196   0.512   0.293</code></pre>
</section>
<section id="sample-output-24" class="level2" data-number="25.2">
<h2 data-number="25.2" class="anchored" data-anchor-id="sample-output-24"><span class="header-section-number">25.2</span> Sample Output</h2>
<pre><code>A   B
A   0.000   1.000   
B   0.786   0.214   
--------
    x   y   z
A   0.242   0.000   0.758   
B   0.172   0.828   0.000</code></pre>
</section>
<section id="solution-24" class="level2" data-number="25.3">
<h2 data-number="25.3" class="anchored" data-anchor-id="solution-24"><span class="header-section-number">25.3</span> Solution</h2>
<div class="sourceCode" id="cb75"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> typing <span class="im">import</span> List, Dict, Tuple, Iterator</span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> io <span class="im">import</span> StringIO</span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> collections <span class="im">import</span> defaultdict</span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> print_matrix(matrix: np.ndarray, row_labels: List[<span class="bu">str</span>], col_labels: List[<span class="bu">str</span>]) <span class="op">-&gt;</span> <span class="va">None</span>:</span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="op">*</span>col_labels, sep<span class="op">=</span><span class="st">"</span><span class="ch">\t</span><span class="st">"</span>)</span>
<span id="cb75-8"><a href="#cb75-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, row <span class="kw">in</span> <span class="bu">enumerate</span>(matrix):</span>
<span id="cb75-9"><a href="#cb75-9" aria-hidden="true" tabindex="-1"></a>        r <span class="op">=</span> [row_labels[i]] <span class="op">+</span> [<span class="bu">round</span>(x, <span class="dv">3</span>) <span class="cf">if</span> x <span class="op">&gt;</span> <span class="fl">0.0</span> <span class="cf">else</span> <span class="st">"0"</span> <span class="cf">for</span> x <span class="kw">in</span> row]</span>
<span id="cb75-10"><a href="#cb75-10" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="op">*</span>r, sep<span class="op">=</span><span class="st">"</span><span class="ch">\t</span><span class="st">"</span>)</span>
<span id="cb75-11"><a href="#cb75-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-12"><a href="#cb75-12" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> print_dict(d: Dict[Tuple[<span class="bu">str</span>, <span class="bu">str</span>], <span class="bu">float</span>], row_labels: List[<span class="bu">str</span>], col_labels: List[<span class="bu">str</span>]) <span class="op">-&gt;</span> <span class="va">None</span>:</span>
<span id="cb75-13"><a href="#cb75-13" aria-hidden="true" tabindex="-1"></a>    mat <span class="op">=</span> np.zeros((<span class="bu">len</span>(row_labels), <span class="bu">len</span>(col_labels)), dtype<span class="op">=</span><span class="bu">float</span>)</span>
<span id="cb75-14"><a href="#cb75-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, r <span class="kw">in</span> <span class="bu">enumerate</span>(row_labels):</span>
<span id="cb75-15"><a href="#cb75-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> j, c <span class="kw">in</span> <span class="bu">enumerate</span>(col_labels):</span>
<span id="cb75-16"><a href="#cb75-16" aria-hidden="true" tabindex="-1"></a>            mat[i, j] <span class="op">=</span> d[r, c]</span>
<span id="cb75-17"><a href="#cb75-17" aria-hidden="true" tabindex="-1"></a>    print_matrix(mat, row_labels, col_labels)</span>
<span id="cb75-18"><a href="#cb75-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-19"><a href="#cb75-19" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> parse_input(handle: Iterator[<span class="bu">str</span>]) <span class="op">-&gt;</span> Tuple[<span class="bu">int</span>, <span class="bu">str</span>, List[<span class="bu">str</span>], List[<span class="bu">str</span>], Dict[Tuple[<span class="bu">str</span>, <span class="bu">str</span>], <span class="bu">float</span>], Dict[Tuple[<span class="bu">str</span>, <span class="bu">str</span>], <span class="bu">float</span>]]:</span>
<span id="cb75-20"><a href="#cb75-20" aria-hidden="true" tabindex="-1"></a>    niter <span class="op">=</span> <span class="bu">int</span>(<span class="bu">next</span>(handle).rstrip())</span>
<span id="cb75-21"><a href="#cb75-21" aria-hidden="true" tabindex="-1"></a>    <span class="bu">next</span>(handle)</span>
<span id="cb75-22"><a href="#cb75-22" aria-hidden="true" tabindex="-1"></a>    seq <span class="op">=</span> <span class="bu">next</span>(handle).rstrip()</span>
<span id="cb75-23"><a href="#cb75-23" aria-hidden="true" tabindex="-1"></a>    <span class="bu">next</span>(handle)</span>
<span id="cb75-24"><a href="#cb75-24" aria-hidden="true" tabindex="-1"></a>    alphabet <span class="op">=</span> <span class="bu">next</span>(handle).split()</span>
<span id="cb75-25"><a href="#cb75-25" aria-hidden="true" tabindex="-1"></a>    <span class="bu">next</span>(handle)</span>
<span id="cb75-26"><a href="#cb75-26" aria-hidden="true" tabindex="-1"></a>    states <span class="op">=</span> <span class="bu">next</span>(handle).split()</span>
<span id="cb75-27"><a href="#cb75-27" aria-hidden="true" tabindex="-1"></a>    <span class="bu">next</span>(handle)</span>
<span id="cb75-28"><a href="#cb75-28" aria-hidden="true" tabindex="-1"></a>    lines <span class="op">=</span> [<span class="bu">next</span>(handle) <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(states) <span class="op">+</span> <span class="dv">1</span>)]</span>
<span id="cb75-29"><a href="#cb75-29" aria-hidden="true" tabindex="-1"></a>    tmat <span class="op">=</span> {</span>
<span id="cb75-30"><a href="#cb75-30" aria-hidden="true" tabindex="-1"></a>        (states[i], states[j]): <span class="bu">float</span>(v)</span>
<span id="cb75-31"><a href="#cb75-31" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i, x <span class="kw">in</span> <span class="bu">enumerate</span>(lines[<span class="dv">1</span>:])</span>
<span id="cb75-32"><a href="#cb75-32" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> j, v <span class="kw">in</span> <span class="bu">enumerate</span>(x.split()[<span class="dv">1</span>:])</span>
<span id="cb75-33"><a href="#cb75-33" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb75-34"><a href="#cb75-34" aria-hidden="true" tabindex="-1"></a>    <span class="bu">next</span>(handle)</span>
<span id="cb75-35"><a href="#cb75-35" aria-hidden="true" tabindex="-1"></a>    lines <span class="op">=</span> [<span class="bu">next</span>(handle) <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(states) <span class="op">+</span> <span class="dv">1</span>)]</span>
<span id="cb75-36"><a href="#cb75-36" aria-hidden="true" tabindex="-1"></a>    emat <span class="op">=</span> {</span>
<span id="cb75-37"><a href="#cb75-37" aria-hidden="true" tabindex="-1"></a>        (states[i], alphabet[j]): <span class="bu">float</span>(v)</span>
<span id="cb75-38"><a href="#cb75-38" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i, x <span class="kw">in</span> <span class="bu">enumerate</span>(lines[<span class="dv">1</span>:])</span>
<span id="cb75-39"><a href="#cb75-39" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> j, v <span class="kw">in</span> <span class="bu">enumerate</span>(x.split()[<span class="dv">1</span>:])</span>
<span id="cb75-40"><a href="#cb75-40" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb75-41"><a href="#cb75-41" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> niter, seq, states, alphabet, tmat, emat</span>
<span id="cb75-42"><a href="#cb75-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-43"><a href="#cb75-43" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> forward(seq: <span class="bu">str</span>, states: List[<span class="bu">str</span>], tmat: Dict[Tuple[<span class="bu">str</span>, <span class="bu">str</span>], <span class="bu">float</span>], emat: Dict[Tuple[<span class="bu">str</span>, <span class="bu">str</span>], <span class="bu">float</span>]) <span class="op">-&gt;</span> np.ndarray:</span>
<span id="cb75-44"><a href="#cb75-44" aria-hidden="true" tabindex="-1"></a>    mat <span class="op">=</span> np.ones((<span class="bu">len</span>(seq), <span class="bu">len</span>(states)))</span>
<span id="cb75-45"><a href="#cb75-45" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, state <span class="kw">in</span> <span class="bu">enumerate</span>(states):</span>
<span id="cb75-46"><a href="#cb75-46" aria-hidden="true" tabindex="-1"></a>        mat[<span class="dv">0</span>, i] <span class="op">=</span> emat[state, seq[<span class="dv">0</span>]]</span>
<span id="cb75-47"><a href="#cb75-47" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, emission <span class="kw">in</span> <span class="bu">enumerate</span>(seq[<span class="dv">1</span>:], start<span class="op">=</span><span class="dv">1</span>):</span>
<span id="cb75-48"><a href="#cb75-48" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> j, state <span class="kw">in</span> <span class="bu">enumerate</span>(states):</span>
<span id="cb75-49"><a href="#cb75-49" aria-hidden="true" tabindex="-1"></a>            mat[i, j] <span class="op">=</span> <span class="bu">sum</span>(</span>
<span id="cb75-50"><a href="#cb75-50" aria-hidden="true" tabindex="-1"></a>                tmat[prev, state] <span class="op">*</span> emat[state, emission] <span class="op">*</span> mat[i <span class="op">-</span> <span class="dv">1</span>, k]</span>
<span id="cb75-51"><a href="#cb75-51" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> k, prev <span class="kw">in</span> <span class="bu">enumerate</span>(states)</span>
<span id="cb75-52"><a href="#cb75-52" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb75-53"><a href="#cb75-53" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> mat</span>
<span id="cb75-54"><a href="#cb75-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-55"><a href="#cb75-55" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> backward(seq: <span class="bu">str</span>, states: List[<span class="bu">str</span>], tmat: Dict[Tuple[<span class="bu">str</span>, <span class="bu">str</span>], <span class="bu">float</span>], emat: Dict[Tuple[<span class="bu">str</span>, <span class="bu">str</span>], <span class="bu">float</span>]) <span class="op">-&gt;</span> np.ndarray:</span>
<span id="cb75-56"><a href="#cb75-56" aria-hidden="true" tabindex="-1"></a>    mat <span class="op">=</span> np.ones((<span class="bu">len</span>(seq), <span class="bu">len</span>(states)))</span>
<span id="cb75-57"><a href="#cb75-57" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, emission <span class="kw">in</span> <span class="bu">enumerate</span>(seq[::<span class="op">-</span><span class="dv">1</span>][:<span class="op">-</span><span class="dv">1</span>], start<span class="op">=</span><span class="dv">1</span>):</span>
<span id="cb75-58"><a href="#cb75-58" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> j, state <span class="kw">in</span> <span class="bu">enumerate</span>(states):</span>
<span id="cb75-59"><a href="#cb75-59" aria-hidden="true" tabindex="-1"></a>            mat[<span class="bu">len</span>(seq) <span class="op">-</span> i <span class="op">-</span> <span class="dv">1</span>, j] <span class="op">=</span> <span class="bu">sum</span>(</span>
<span id="cb75-60"><a href="#cb75-60" aria-hidden="true" tabindex="-1"></a>                tmat[state, prev] <span class="op">*</span> emat[prev, emission] <span class="op">*</span> mat[<span class="bu">len</span>(seq) <span class="op">-</span> i, k]</span>
<span id="cb75-61"><a href="#cb75-61" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> k, prev <span class="kw">in</span> <span class="bu">enumerate</span>(states)</span>
<span id="cb75-62"><a href="#cb75-62" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb75-63"><a href="#cb75-63" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> mat</span>
<span id="cb75-64"><a href="#cb75-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-65"><a href="#cb75-65" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> soft_decode(seq: <span class="bu">str</span>, states: List[<span class="bu">str</span>], tmat: Dict[Tuple[<span class="bu">str</span>, <span class="bu">str</span>], <span class="bu">float</span>], emat: Dict[Tuple[<span class="bu">str</span>, <span class="bu">str</span>], <span class="bu">float</span>], normalise: <span class="bu">bool</span> <span class="op">=</span> <span class="va">True</span>) <span class="op">-&gt;</span> np.ndarray:</span>
<span id="cb75-66"><a href="#cb75-66" aria-hidden="true" tabindex="-1"></a>    tot <span class="op">=</span> forward(seq, states, tmat, emat) <span class="op">*</span> backward(seq, states, tmat, emat)</span>
<span id="cb75-67"><a href="#cb75-67" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> normalise:</span>
<span id="cb75-68"><a href="#cb75-68" aria-hidden="true" tabindex="-1"></a>        tot <span class="op">=</span> tot <span class="op">/</span> np.<span class="bu">sum</span>(tot, axis<span class="op">=</span><span class="dv">1</span>, keepdims<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb75-69"><a href="#cb75-69" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> tot</span>
<span id="cb75-70"><a href="#cb75-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-71"><a href="#cb75-71" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> as_dict(x: np.ndarray, r: List[<span class="bu">str</span>], c: List[<span class="bu">str</span>]) <span class="op">-&gt;</span> Dict[Tuple[<span class="bu">str</span>, <span class="bu">str</span>], <span class="bu">float</span>]:</span>
<span id="cb75-72"><a href="#cb75-72" aria-hidden="true" tabindex="-1"></a>    g <span class="op">=</span> defaultdict(<span class="bu">float</span>)</span>
<span id="cb75-73"><a href="#cb75-73" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(x.shape[<span class="dv">0</span>]):</span>
<span id="cb75-74"><a href="#cb75-74" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(x.shape[<span class="dv">1</span>]):</span>
<span id="cb75-75"><a href="#cb75-75" aria-hidden="true" tabindex="-1"></a>            g[r[i], c[j]] <span class="op">=</span> x[i][j]</span>
<span id="cb75-76"><a href="#cb75-76" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> g</span>
<span id="cb75-77"><a href="#cb75-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-78"><a href="#cb75-78" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> estimate_pi2(seq: <span class="bu">str</span>, fwd: np.ndarray, bak: np.ndarray, tmat: Dict[Tuple[<span class="bu">str</span>, <span class="bu">str</span>], <span class="bu">float</span>], emat: Dict[Tuple[<span class="bu">str</span>, <span class="bu">str</span>], <span class="bu">float</span>], states: List[<span class="bu">str</span>]) <span class="op">-&gt;</span> np.ndarray:</span>
<span id="cb75-79"><a href="#cb75-79" aria-hidden="true" tabindex="-1"></a>    rep_mat <span class="op">=</span> np.zeros((fwd.shape[<span class="dv">0</span>] <span class="op">-</span> <span class="dv">1</span>, <span class="bu">len</span>(states), <span class="bu">len</span>(states)), dtype<span class="op">=</span><span class="bu">float</span>)</span>
<span id="cb75-80"><a href="#cb75-80" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>, fwd.shape[<span class="dv">0</span>] <span class="op">-</span> <span class="dv">1</span>):</span>
<span id="cb75-81"><a href="#cb75-81" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> j, s1 <span class="kw">in</span> <span class="bu">enumerate</span>(states):</span>
<span id="cb75-82"><a href="#cb75-82" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> k, s2 <span class="kw">in</span> <span class="bu">enumerate</span>(states):</span>
<span id="cb75-83"><a href="#cb75-83" aria-hidden="true" tabindex="-1"></a>                weight <span class="op">=</span> tmat[s1, s2] <span class="op">*</span> emat[s2, seq[i <span class="op">+</span> <span class="dv">1</span>]]</span>
<span id="cb75-84"><a href="#cb75-84" aria-hidden="true" tabindex="-1"></a>                rep_mat[i, j, k] <span class="op">=</span> (</span>
<span id="cb75-85"><a href="#cb75-85" aria-hidden="true" tabindex="-1"></a>                    fwd[i, j] <span class="op">*</span> bak[i <span class="op">+</span> <span class="dv">1</span>, k] <span class="op">*</span> weight <span class="op">/</span> <span class="bu">sum</span>(fwd[i, :] <span class="op">*</span> bak[i, :])</span>
<span id="cb75-86"><a href="#cb75-86" aria-hidden="true" tabindex="-1"></a>                )</span>
<span id="cb75-87"><a href="#cb75-87" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> rep_mat</span>
<span id="cb75-88"><a href="#cb75-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-89"><a href="#cb75-89" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> estimate_tmat(seq: <span class="bu">str</span>, st: List[<span class="bu">str</span>], tmat: Dict[Tuple[<span class="bu">str</span>, <span class="bu">str</span>], <span class="bu">float</span>], emat: Dict[Tuple[<span class="bu">str</span>, <span class="bu">str</span>], <span class="bu">float</span>]) <span class="op">-&gt;</span> Dict[Tuple[<span class="bu">str</span>, <span class="bu">str</span>], <span class="bu">float</span>]:</span>
<span id="cb75-90"><a href="#cb75-90" aria-hidden="true" tabindex="-1"></a>    fwd <span class="op">=</span> forward(seq, st, tmat, emat)</span>
<span id="cb75-91"><a href="#cb75-91" aria-hidden="true" tabindex="-1"></a>    bak <span class="op">=</span> backward(seq, st, tmat, emat)</span>
<span id="cb75-92"><a href="#cb75-92" aria-hidden="true" tabindex="-1"></a>    pi2 <span class="op">=</span> estimate_pi2(seq, fwd, bak, tmat, emat, st)</span>
<span id="cb75-93"><a href="#cb75-93" aria-hidden="true" tabindex="-1"></a>    tmat_new <span class="op">=</span> np.<span class="bu">sum</span>(pi2, <span class="dv">0</span>)</span>
<span id="cb75-94"><a href="#cb75-94" aria-hidden="true" tabindex="-1"></a>    tmat_new <span class="op">=</span> tmat_new <span class="op">/</span> np.<span class="bu">sum</span>(tmat_new, axis<span class="op">=</span><span class="dv">1</span>, keepdims<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb75-95"><a href="#cb75-95" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> as_dict(tmat_new, st, st)</span>
<span id="cb75-96"><a href="#cb75-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-97"><a href="#cb75-97" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> estimate_emat(seq: <span class="bu">str</span>, al: List[<span class="bu">str</span>], st: List[<span class="bu">str</span>], tmat: Dict[Tuple[<span class="bu">str</span>, <span class="bu">str</span>], <span class="bu">float</span>], emat: Dict[Tuple[<span class="bu">str</span>, <span class="bu">str</span>], <span class="bu">float</span>]) <span class="op">-&gt;</span> Dict[Tuple[<span class="bu">str</span>, <span class="bu">str</span>], <span class="bu">float</span>]:</span>
<span id="cb75-98"><a href="#cb75-98" aria-hidden="true" tabindex="-1"></a>    pi1 <span class="op">=</span> soft_decode(seq, st, tmat, emat)</span>
<span id="cb75-99"><a href="#cb75-99" aria-hidden="true" tabindex="-1"></a>    emat_new <span class="op">=</span> np.zeros((<span class="bu">len</span>(st), <span class="bu">len</span>(al)), dtype<span class="op">=</span><span class="bu">float</span>)</span>
<span id="cb75-100"><a href="#cb75-100" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, emission <span class="kw">in</span> <span class="bu">enumerate</span>(al):</span>
<span id="cb75-101"><a href="#cb75-101" aria-hidden="true" tabindex="-1"></a>        ind <span class="op">=</span> np.array(<span class="bu">list</span>(seq)) <span class="op">==</span> emission</span>
<span id="cb75-102"><a href="#cb75-102" aria-hidden="true" tabindex="-1"></a>        emat_new[:, i] <span class="op">=</span> np.<span class="bu">sum</span>(pi1[ind, :], <span class="dv">0</span>)</span>
<span id="cb75-103"><a href="#cb75-103" aria-hidden="true" tabindex="-1"></a>    emat_new <span class="op">=</span> emat_new <span class="op">/</span> np.<span class="bu">sum</span>(emat_new, axis<span class="op">=</span><span class="dv">1</span>, keepdims<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb75-104"><a href="#cb75-104" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> as_dict(emat_new, st, al)</span>
<span id="cb75-105"><a href="#cb75-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-106"><a href="#cb75-106" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> main(sample_input: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="va">None</span>:</span>
<span id="cb75-107"><a href="#cb75-107" aria-hidden="true" tabindex="-1"></a>    input_lines <span class="op">=</span> StringIO(sample_input.strip())</span>
<span id="cb75-108"><a href="#cb75-108" aria-hidden="true" tabindex="-1"></a>    niter, seq, st, al, tmat, emat <span class="op">=</span> parse_input(input_lines)</span>
<span id="cb75-109"><a href="#cb75-109" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(niter):</span>
<span id="cb75-110"><a href="#cb75-110" aria-hidden="true" tabindex="-1"></a>        tmat2 <span class="op">=</span> estimate_tmat(seq, st, tmat, emat)</span>
<span id="cb75-111"><a href="#cb75-111" aria-hidden="true" tabindex="-1"></a>        emat2 <span class="op">=</span> estimate_emat(seq, al, st, tmat, emat)</span>
<span id="cb75-112"><a href="#cb75-112" aria-hidden="true" tabindex="-1"></a>        emat, tmat <span class="op">=</span> emat2, tmat2</span>
<span id="cb75-113"><a href="#cb75-113" aria-hidden="true" tabindex="-1"></a>    print_dict(tmat, st, st)</span>
<span id="cb75-114"><a href="#cb75-114" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"--------"</span>)</span>
<span id="cb75-115"><a href="#cb75-115" aria-hidden="true" tabindex="-1"></a>    print_dict(emat, st, al)</span>
<span id="cb75-116"><a href="#cb75-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-117"><a href="#cb75-117" aria-hidden="true" tabindex="-1"></a>sample_input: <span class="bu">str</span> <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb75-118"><a href="#cb75-118" aria-hidden="true" tabindex="-1"></a><span class="st">10</span></span>
<span id="cb75-119"><a href="#cb75-119" aria-hidden="true" tabindex="-1"></a><span class="st">--------</span></span>
<span id="cb75-120"><a href="#cb75-120" aria-hidden="true" tabindex="-1"></a><span class="st">xzyyzyzyxy</span></span>
<span id="cb75-121"><a href="#cb75-121" aria-hidden="true" tabindex="-1"></a><span class="st">--------</span></span>
<span id="cb75-122"><a href="#cb75-122" aria-hidden="true" tabindex="-1"></a><span class="st">x   y   z</span></span>
<span id="cb75-123"><a href="#cb75-123" aria-hidden="true" tabindex="-1"></a><span class="st">--------</span></span>
<span id="cb75-124"><a href="#cb75-124" aria-hidden="true" tabindex="-1"></a><span class="st">A   B</span></span>
<span id="cb75-125"><a href="#cb75-125" aria-hidden="true" tabindex="-1"></a><span class="st">--------</span></span>
<span id="cb75-126"><a href="#cb75-126" aria-hidden="true" tabindex="-1"></a><span class="st">    A   B</span></span>
<span id="cb75-127"><a href="#cb75-127" aria-hidden="true" tabindex="-1"></a><span class="st">A   0.019   0.981 </span></span>
<span id="cb75-128"><a href="#cb75-128" aria-hidden="true" tabindex="-1"></a><span class="st">B   0.668   0.332 </span></span>
<span id="cb75-129"><a href="#cb75-129" aria-hidden="true" tabindex="-1"></a><span class="st">--------</span></span>
<span id="cb75-130"><a href="#cb75-130" aria-hidden="true" tabindex="-1"></a><span class="st">x   y   z</span></span>
<span id="cb75-131"><a href="#cb75-131" aria-hidden="true" tabindex="-1"></a><span class="st">A   0.175   0.003   0.821 </span></span>
<span id="cb75-132"><a href="#cb75-132" aria-hidden="true" tabindex="-1"></a><span class="st">B   0.196   0.512   0.293</span></span>
<span id="cb75-133"><a href="#cb75-133" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb75-134"><a href="#cb75-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-135"><a href="#cb75-135" aria-hidden="true" tabindex="-1"></a>main(sample_input)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="construct-the-graph-of-a-spectrum" class="level1" data-number="26">
<h1 data-number="26"><span class="header-section-number">26</span> Construct the Graph of a Spectrum</h1>
<section id="spectrum-graph-construction" class="level2" data-number="26.1">
<h2 data-number="26.1" class="anchored" data-anchor-id="spectrum-graph-construction"><span class="header-section-number">26.1</span> Spectrum Graph Construction</h2>
<p>Construct the graph of a spectrum.</p>
<p>Given:&nbsp;A space-delimited list of integers&nbsp;<em>Spectrum</em>.</p>
<p>Return:&nbsp;<em>Graph(Spectrum)</em>.</p>
<p><strong>Note:</strong>&nbsp;In this chapter, all dataset problems implicitly use the standard integer-valued mass table for the regular twenty amino acids. Examples sometimes use imaginary amino acids X and Z having respective integer masses 4 and 5.</p>
</section>
<section id="sample-dataset-25" class="level2" data-number="26.2">
<h2 data-number="26.2" class="anchored" data-anchor-id="sample-dataset-25"><span class="header-section-number">26.2</span> Sample Dataset</h2>
<pre><code>57 71 154 185 301 332 415 429 486</code></pre>
</section>
<section id="sample-output-25" class="level2" data-number="26.3">
<h2 data-number="26.3" class="anchored" data-anchor-id="sample-output-25"><span class="header-section-number">26.3</span> Sample Output</h2>
<pre><code>0-&gt;57:G
0-&gt;71:A
57-&gt;154:P
57-&gt;185:K
71-&gt;185:N
154-&gt;301:F
185-&gt;332:F
301-&gt;415:N
301-&gt;429:K
332-&gt;429:P
415-&gt;486:A
429-&gt;486:G</code></pre>
</section>
<section id="solution-25" class="level2" data-number="26.4">
<h2 data-number="26.4" class="anchored" data-anchor-id="solution-25"><span class="header-section-number">26.4</span> Solution</h2>
<div class="sourceCode" id="cb78"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> collections <span class="im">import</span> defaultdict</span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Amino acid weights dictionary</span></span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a>amino_acid_weights <span class="op">=</span> {</span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">'G'</span>: <span class="dv">57</span>, <span class="st">'A'</span>: <span class="dv">71</span>, <span class="st">'S'</span>: <span class="dv">87</span>, <span class="st">'P'</span>: <span class="dv">97</span>, <span class="st">'V'</span>: <span class="dv">99</span>,</span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">'T'</span>: <span class="dv">101</span>, <span class="st">'C'</span>: <span class="dv">103</span>, <span class="st">'I'</span>: <span class="dv">113</span>, <span class="st">'L'</span>: <span class="dv">113</span>, <span class="st">'N'</span>: <span class="dv">114</span>,</span>
<span id="cb78-7"><a href="#cb78-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">'D'</span>: <span class="dv">115</span>, <span class="st">'K'</span>: <span class="dv">128</span>, <span class="st">'Q'</span>: <span class="dv">128</span>, <span class="st">'E'</span>: <span class="dv">129</span>, <span class="st">'M'</span>: <span class="dv">131</span>,</span>
<span id="cb78-8"><a href="#cb78-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">'H'</span>: <span class="dv">137</span>, <span class="st">'F'</span>: <span class="dv">147</span>, <span class="st">'R'</span>: <span class="dv">156</span>, <span class="st">'Y'</span>: <span class="dv">163</span>, <span class="st">'W'</span>: <span class="dv">186</span></span>
<span id="cb78-9"><a href="#cb78-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb78-10"><a href="#cb78-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-11"><a href="#cb78-11" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> spectrum_graph(masses):</span>
<span id="cb78-12"><a href="#cb78-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Reverse mapping of weights to amino acids</span></span>
<span id="cb78-13"><a href="#cb78-13" aria-hidden="true" tabindex="-1"></a>    weight_to_amino_acid <span class="op">=</span> {weight: aa <span class="cf">for</span> aa, weight <span class="kw">in</span> amino_acid_weights.items()}</span>
<span id="cb78-14"><a href="#cb78-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb78-15"><a href="#cb78-15" aria-hidden="true" tabindex="-1"></a>    graph <span class="op">=</span> defaultdict(<span class="bu">list</span>)</span>
<span id="cb78-16"><a href="#cb78-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb78-17"><a href="#cb78-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create graph based on mass differences</span></span>
<span id="cb78-18"><a href="#cb78-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(masses)):</span>
<span id="cb78-19"><a href="#cb78-19" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(i <span class="op">+</span> <span class="dv">1</span>, <span class="bu">len</span>(masses)):</span>
<span id="cb78-20"><a href="#cb78-20" aria-hidden="true" tabindex="-1"></a>            difference <span class="op">=</span> masses[j] <span class="op">-</span> masses[i]</span>
<span id="cb78-21"><a href="#cb78-21" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> difference <span class="kw">in</span> weight_to_amino_acid:</span>
<span id="cb78-22"><a href="#cb78-22" aria-hidden="true" tabindex="-1"></a>                graph[masses[i]].append({<span class="st">"n"</span>: masses[j], <span class="st">"l"</span>: weight_to_amino_acid[difference]})</span>
<span id="cb78-23"><a href="#cb78-23" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb78-24"><a href="#cb78-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> graph</span>
<span id="cb78-25"><a href="#cb78-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-26"><a href="#cb78-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Sample input</span></span>
<span id="cb78-27"><a href="#cb78-27" aria-hidden="true" tabindex="-1"></a>sample_input <span class="op">=</span> <span class="st">"57 71 154 185 301 332 415 429 486"</span></span>
<span id="cb78-28"><a href="#cb78-28" aria-hidden="true" tabindex="-1"></a>masses <span class="op">=</span> [<span class="dv">0</span>] <span class="op">+</span> <span class="bu">list</span>(<span class="bu">map</span>(<span class="bu">int</span>, sample_input.split()))</span>
<span id="cb78-29"><a href="#cb78-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-30"><a href="#cb78-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the spectrum graph</span></span>
<span id="cb78-31"><a href="#cb78-31" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> start_mass, edges <span class="kw">in</span> spectrum_graph(masses).items():</span>
<span id="cb78-32"><a href="#cb78-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> edge <span class="kw">in</span> edges:</span>
<span id="cb78-33"><a href="#cb78-33" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>start_mass<span class="sc">}</span><span class="ss">-&gt;</span><span class="sc">{</span>edge[<span class="st">'n'</span>]<span class="sc">}</span><span class="ss">:</span><span class="sc">{</span>edge[<span class="st">'l'</span>]<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="implement-motifenumeration" class="level1" data-number="27">
<h1 data-number="27"><span class="header-section-number">27</span> Implement MotifEnumeration</h1>
<p>Implanted Motif Problem. Implement MotifEnumeration (shown above) to find all (k, d)-motifs in a collection of strings.</p>
<p>Given:&nbsp;Integers&nbsp;<em>k</em>&nbsp;and&nbsp;<em>d</em>, followed by a collection of strings&nbsp;<em>Dna</em>.</p>
<p>Return:&nbsp;All (<em>k</em>,&nbsp;<em>d</em>)-motifs in&nbsp;<em>Dna</em>.</p>
<section id="sample-dataset-26" class="level2" data-number="27.1">
<h2 data-number="27.1" class="anchored" data-anchor-id="sample-dataset-26"><span class="header-section-number">27.1</span> Sample Dataset</h2>
<pre><code>3 1
ATTTGGC
TGCCTTA
CGGTATC
GAAAATT</code></pre>
</section>
<section id="sample-output-26" class="level2" data-number="27.2">
<h2 data-number="27.2" class="anchored" data-anchor-id="sample-output-26"><span class="header-section-number">27.2</span> Sample Output</h2>
<pre><code>ATA ATT GTT TTT</code></pre>
</section>
<section id="solution-26" class="level2" data-number="27.3">
<h2 data-number="27.3" class="anchored" data-anchor-id="solution-26"><span class="header-section-number">27.3</span> Solution</h2>
<div class="sourceCode" id="cb81"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> typing <span class="im">import</span> List, Set, Iterator</span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> calculate_hamming_distance(sequence1: <span class="bu">str</span>, sequence2: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="bu">int</span>:</span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">sum</span>(c1 <span class="op">!=</span> c2 <span class="cf">for</span> c1, c2 <span class="kw">in</span> <span class="bu">zip</span>(sequence1, sequence2))</span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> generate_neighbors(sequence: <span class="bu">str</span>, max_distance: <span class="bu">int</span>) <span class="op">-&gt;</span> Set[<span class="bu">str</span>]:</span>
<span id="cb81-7"><a href="#cb81-7" aria-hidden="true" tabindex="-1"></a>    nucleotides <span class="op">=</span> [<span class="st">"A"</span>, <span class="st">"T"</span>, <span class="st">"G"</span>, <span class="st">"C"</span>]</span>
<span id="cb81-8"><a href="#cb81-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> max_distance <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb81-9"><a href="#cb81-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> {sequence}</span>
<span id="cb81-10"><a href="#cb81-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(sequence) <span class="op">==</span> <span class="dv">1</span>:</span>
<span id="cb81-11"><a href="#cb81-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">set</span>(nucleotides)</span>
<span id="cb81-12"><a href="#cb81-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb81-13"><a href="#cb81-13" aria-hidden="true" tabindex="-1"></a>    neighbor_set <span class="op">=</span> <span class="bu">set</span>()</span>
<span id="cb81-14"><a href="#cb81-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> neighbor <span class="kw">in</span> generate_neighbors(sequence[<span class="dv">1</span>:], max_distance):</span>
<span id="cb81-15"><a href="#cb81-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> calculate_hamming_distance(sequence[<span class="dv">1</span>:], neighbor) <span class="op">&lt;</span> max_distance:</span>
<span id="cb81-16"><a href="#cb81-16" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> nucleotide <span class="kw">in</span> nucleotides:</span>
<span id="cb81-17"><a href="#cb81-17" aria-hidden="true" tabindex="-1"></a>                neighbor_set.add(nucleotide <span class="op">+</span> neighbor)</span>
<span id="cb81-18"><a href="#cb81-18" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb81-19"><a href="#cb81-19" aria-hidden="true" tabindex="-1"></a>            neighbor_set.add(sequence[<span class="dv">0</span>] <span class="op">+</span> neighbor)</span>
<span id="cb81-20"><a href="#cb81-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> neighbor_set</span>
<span id="cb81-21"><a href="#cb81-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-22"><a href="#cb81-22" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> generate_substrings(text: <span class="bu">str</span>, substring_length: <span class="bu">int</span>) <span class="op">-&gt;</span> Iterator[<span class="bu">str</span>]:</span>
<span id="cb81-23"><a href="#cb81-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(text) <span class="op">-</span> substring_length <span class="op">+</span> <span class="dv">1</span>):</span>
<span id="cb81-24"><a href="#cb81-24" aria-hidden="true" tabindex="-1"></a>        <span class="cf">yield</span> text[i : i <span class="op">+</span> substring_length]</span>
<span id="cb81-25"><a href="#cb81-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-26"><a href="#cb81-26" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_all_kmers(dna_sequences: List[<span class="bu">str</span>], kmer_length: <span class="bu">int</span>) <span class="op">-&gt;</span> Set[<span class="bu">str</span>]:</span>
<span id="cb81-27"><a href="#cb81-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">set</span>(kmer <span class="cf">for</span> sequence <span class="kw">in</span> dna_sequences <span class="cf">for</span> kmer <span class="kw">in</span> generate_substrings(sequence, kmer_length))</span>
<span id="cb81-28"><a href="#cb81-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-29"><a href="#cb81-29" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> contains_approximate_match(pattern: <span class="bu">str</span>, text: <span class="bu">str</span>, max_distance: <span class="bu">int</span>) <span class="op">-&gt;</span> <span class="bu">bool</span>:</span>
<span id="cb81-30"><a href="#cb81-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">any</span>(calculate_hamming_distance(substring, pattern) <span class="op">&lt;=</span> max_distance </span>
<span id="cb81-31"><a href="#cb81-31" aria-hidden="true" tabindex="-1"></a>               <span class="cf">for</span> substring <span class="kw">in</span> generate_substrings(text, <span class="bu">len</span>(pattern)))</span>
<span id="cb81-32"><a href="#cb81-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-33"><a href="#cb81-33" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> enumerate_motifs(dna_sequences: List[<span class="bu">str</span>], kmer_length: <span class="bu">int</span>, max_distance: <span class="bu">int</span>) <span class="op">-&gt;</span> Set[<span class="bu">str</span>]:</span>
<span id="cb81-34"><a href="#cb81-34" aria-hidden="true" tabindex="-1"></a>    motif_patterns <span class="op">=</span> <span class="bu">set</span>()</span>
<span id="cb81-35"><a href="#cb81-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> kmer <span class="kw">in</span> get_all_kmers(dna_sequences, kmer_length):</span>
<span id="cb81-36"><a href="#cb81-36" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> neighbor_kmer <span class="kw">in</span> generate_neighbors(kmer, max_distance):</span>
<span id="cb81-37"><a href="#cb81-37" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">all</span>(contains_approximate_match(neighbor_kmer, sequence, max_distance) <span class="cf">for</span> sequence <span class="kw">in</span> dna_sequences):</span>
<span id="cb81-38"><a href="#cb81-38" aria-hidden="true" tabindex="-1"></a>                motif_patterns.add(neighbor_kmer)</span>
<span id="cb81-39"><a href="#cb81-39" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> motif_patterns</span>
<span id="cb81-40"><a href="#cb81-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-41"><a href="#cb81-41" aria-hidden="true" tabindex="-1"></a><span class="co"># Sample input</span></span>
<span id="cb81-42"><a href="#cb81-42" aria-hidden="true" tabindex="-1"></a>sample_input <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb81-43"><a href="#cb81-43" aria-hidden="true" tabindex="-1"></a><span class="st">3 1</span></span>
<span id="cb81-44"><a href="#cb81-44" aria-hidden="true" tabindex="-1"></a><span class="st">ATTTGGC</span></span>
<span id="cb81-45"><a href="#cb81-45" aria-hidden="true" tabindex="-1"></a><span class="st">TGCCTTA</span></span>
<span id="cb81-46"><a href="#cb81-46" aria-hidden="true" tabindex="-1"></a><span class="st">CGGTATC</span></span>
<span id="cb81-47"><a href="#cb81-47" aria-hidden="true" tabindex="-1"></a><span class="st">GAAAATT</span></span>
<span id="cb81-48"><a href="#cb81-48" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb81-49"><a href="#cb81-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-50"><a href="#cb81-50" aria-hidden="true" tabindex="-1"></a>input_params, <span class="op">*</span>dna_sequences <span class="op">=</span> sample_input.strip().split(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)</span>
<span id="cb81-51"><a href="#cb81-51" aria-hidden="true" tabindex="-1"></a>kmer_length, max_distance <span class="op">=</span> <span class="bu">map</span>(<span class="bu">int</span>, input_params.split())</span>
<span id="cb81-52"><a href="#cb81-52" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="op">*</span><span class="bu">sorted</span>(enumerate_motifs(dna_sequences, kmer_length, max_distance)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="find-a-median-string" class="level1" data-number="28">
<h1 data-number="28"><span class="header-section-number">28</span> Find a Median String</h1>
<p>Median String Problem, Find a median string.</p>
<p>Given:&nbsp;An integer&nbsp;<em>k</em>&nbsp;and a collection of strings&nbsp;<em>Dna</em>.</p>
<p>Return:&nbsp;A&nbsp;<em>k</em>-mer&nbsp;<em>Pattern</em>&nbsp;that minimizes&nbsp;<em>d</em>(<em>Pattern</em>,&nbsp;<em>Dna</em>) over all&nbsp;<em>k</em>-mers&nbsp;<em>Pattern</em>. (If multiple answers exist, you may return any one.)</p>
<section id="sample-dataset-27" class="level2" data-number="28.1">
<h2 data-number="28.1" class="anchored" data-anchor-id="sample-dataset-27"><span class="header-section-number">28.1</span> Sample Dataset</h2>
<pre><code>3
AAATTGACGCAT
GACGACCACGTT
CGTCAGCGCCTG
GCTGAGCACCGG
AGTACGGGACAG</code></pre>
</section>
<section id="sample-output-27" class="level2" data-number="28.2">
<h2 data-number="28.2" class="anchored" data-anchor-id="sample-output-27"><span class="header-section-number">28.2</span> Sample Output</h2>
<pre><code>ACG</code></pre>
</section>
<section id="solution-27" class="level2" data-number="28.3">
<h2 data-number="28.3" class="anchored" data-anchor-id="solution-27"><span class="header-section-number">28.3</span> Solution</h2>
<div class="sourceCode" id="cb84"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> typing <span class="im">import</span> Iterator, List</span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> itertools <span class="im">import</span> product</span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> math</span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> generate_substrings(text: <span class="bu">str</span>, substring_length: <span class="bu">int</span>) <span class="op">-&gt;</span> Iterator[<span class="bu">str</span>]:</span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(text) <span class="op">-</span> substring_length <span class="op">+</span> <span class="dv">1</span>):</span>
<span id="cb84-7"><a href="#cb84-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">yield</span> text[i : i <span class="op">+</span> substring_length]</span>
<span id="cb84-8"><a href="#cb84-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-9"><a href="#cb84-9" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> generate_kmers(kmer_length: <span class="bu">int</span>) <span class="op">-&gt;</span> Iterator[<span class="bu">str</span>]:</span>
<span id="cb84-10"><a href="#cb84-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (<span class="st">""</span>.join(nucleotides) <span class="cf">for</span> nucleotides <span class="kw">in</span> product(<span class="st">"ACGT"</span>, repeat<span class="op">=</span>kmer_length))</span>
<span id="cb84-11"><a href="#cb84-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-12"><a href="#cb84-12" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> calculate_hamming_distance(sequence1: <span class="bu">str</span>, sequence2: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="bu">int</span>:</span>
<span id="cb84-13"><a href="#cb84-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">sum</span>(nucleotide1 <span class="op">!=</span> nucleotide2 <span class="cf">for</span> nucleotide1, nucleotide2 <span class="kw">in</span> <span class="bu">zip</span>(sequence1, sequence2))</span>
<span id="cb84-14"><a href="#cb84-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-15"><a href="#cb84-15" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> find_minimum_distance(pattern: <span class="bu">str</span>, text: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="bu">int</span>:</span>
<span id="cb84-16"><a href="#cb84-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">min</span>(calculate_hamming_distance(substring, pattern) <span class="cf">for</span> substring <span class="kw">in</span> generate_substrings(text, <span class="bu">len</span>(pattern)))</span>
<span id="cb84-17"><a href="#cb84-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-18"><a href="#cb84-18" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> calculate_total_distance(pattern: <span class="bu">str</span>, dna_sequences: List[<span class="bu">str</span>]) <span class="op">-&gt;</span> <span class="bu">int</span>:</span>
<span id="cb84-19"><a href="#cb84-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">sum</span>(find_minimum_distance(pattern, sequence) <span class="cf">for</span> sequence <span class="kw">in</span> dna_sequences)</span>
<span id="cb84-20"><a href="#cb84-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-21"><a href="#cb84-21" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> find_median_string(dna_sequences: List[<span class="bu">str</span>], kmer_length: <span class="bu">int</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb84-22"><a href="#cb84-22" aria-hidden="true" tabindex="-1"></a>    min_distance <span class="op">=</span> math.inf</span>
<span id="cb84-23"><a href="#cb84-23" aria-hidden="true" tabindex="-1"></a>    median_kmer <span class="op">=</span> <span class="st">""</span></span>
<span id="cb84-24"><a href="#cb84-24" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb84-25"><a href="#cb84-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> kmer <span class="kw">in</span> generate_kmers(kmer_length):</span>
<span id="cb84-26"><a href="#cb84-26" aria-hidden="true" tabindex="-1"></a>        current_distance <span class="op">=</span> calculate_total_distance(kmer, dna_sequences)</span>
<span id="cb84-27"><a href="#cb84-27" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> current_distance <span class="op">&lt;</span> min_distance:</span>
<span id="cb84-28"><a href="#cb84-28" aria-hidden="true" tabindex="-1"></a>            min_distance <span class="op">=</span> current_distance</span>
<span id="cb84-29"><a href="#cb84-29" aria-hidden="true" tabindex="-1"></a>            median_kmer <span class="op">=</span> kmer</span>
<span id="cb84-30"><a href="#cb84-30" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb84-31"><a href="#cb84-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> median_kmer</span>
<span id="cb84-32"><a href="#cb84-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-33"><a href="#cb84-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Sample input</span></span>
<span id="cb84-34"><a href="#cb84-34" aria-hidden="true" tabindex="-1"></a>sample_input <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb84-35"><a href="#cb84-35" aria-hidden="true" tabindex="-1"></a><span class="st">3</span></span>
<span id="cb84-36"><a href="#cb84-36" aria-hidden="true" tabindex="-1"></a><span class="st">AAATTGACGCAT</span></span>
<span id="cb84-37"><a href="#cb84-37" aria-hidden="true" tabindex="-1"></a><span class="st">GACGACCACGTT</span></span>
<span id="cb84-38"><a href="#cb84-38" aria-hidden="true" tabindex="-1"></a><span class="st">CGTCAGCGCCTG</span></span>
<span id="cb84-39"><a href="#cb84-39" aria-hidden="true" tabindex="-1"></a><span class="st">GCTGAGCACCGG</span></span>
<span id="cb84-40"><a href="#cb84-40" aria-hidden="true" tabindex="-1"></a><span class="st">AGTACGGGACAG</span></span>
<span id="cb84-41"><a href="#cb84-41" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb84-42"><a href="#cb84-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-43"><a href="#cb84-43" aria-hidden="true" tabindex="-1"></a>kmer_length, <span class="op">*</span>dna_sequences <span class="op">=</span> sample_input.strip().split(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)</span>
<span id="cb84-44"><a href="#cb84-44" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> find_median_string(dna_sequences, <span class="bu">int</span>(kmer_length))</span>
<span id="cb84-45"><a href="#cb84-45" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(result)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="find-a-profile-most-probable-k-mer-in-a-string" class="level1" data-number="29">
<h1 data-number="29"><span class="header-section-number">29</span> Find a Profile-most Probable k-mer in a String</h1>
<p>Profile-most Probable&nbsp;<em>k</em>-mer Problem, Find a Profile-most probable k-mer in a string.</p>
<p>Given:&nbsp;A string&nbsp;<em>Text</em>, an integer&nbsp;<em>k</em>, and a 4 ×&nbsp;<em>k</em>&nbsp;matrix&nbsp;<em>Profile</em>.</p>
<p>Return:&nbsp;A&nbsp;<em>Profile</em>-most probable&nbsp;<em>k</em>-mer in&nbsp;<em>Text</em>. (If multiple answers exist, you may return any one.)</p>
<section id="sample-dataset-28" class="level2" data-number="29.1">
<h2 data-number="29.1" class="anchored" data-anchor-id="sample-dataset-28"><span class="header-section-number">29.1</span> Sample Dataset</h2>
<pre><code>ACCTGTTTATTGCCTAAGTTCCGAACAAACCCAATATAGCCCGAGGGCCT
5
0.2 0.2 0.3 0.2 0.3
0.4 0.3 0.1 0.5 0.1
0.3 0.3 0.5 0.2 0.4
0.1 0.2 0.1 0.1 0.2</code></pre>
</section>
<section id="sample-output-28" class="level2" data-number="29.2">
<h2 data-number="29.2" class="anchored" data-anchor-id="sample-output-28"><span class="header-section-number">29.2</span> Sample Output</h2>
<pre><code>CCGAG</code></pre>
</section>
<section id="solution-28" class="level2" data-number="29.3">
<h2 data-number="29.3" class="anchored" data-anchor-id="solution-28"><span class="header-section-number">29.3</span> Solution</h2>
<div class="sourceCode" id="cb87"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> typing <span class="im">import</span> Iterator, List</span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> math</span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> generate_substrings(text: <span class="bu">str</span>, substring_length: <span class="bu">int</span>) <span class="op">-&gt;</span> Iterator[<span class="bu">str</span>]:</span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(text) <span class="op">-</span> substring_length <span class="op">+</span> <span class="dv">1</span>):</span>
<span id="cb87-6"><a href="#cb87-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">yield</span> text[i : i <span class="op">+</span> substring_length]</span>
<span id="cb87-7"><a href="#cb87-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-8"><a href="#cb87-8" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> find_profile_most_probable_kmer(sequence: <span class="bu">str</span>, kmer_length: <span class="bu">int</span>, profile_matrix: List[List[<span class="bu">float</span>]]) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb87-9"><a href="#cb87-9" aria-hidden="true" tabindex="-1"></a>    nucleotide_index <span class="op">=</span> {<span class="st">"A"</span>: <span class="dv">0</span>, <span class="st">"C"</span>: <span class="dv">1</span>, <span class="st">"G"</span>: <span class="dv">2</span>, <span class="st">"T"</span>: <span class="dv">3</span>}</span>
<span id="cb87-10"><a href="#cb87-10" aria-hidden="true" tabindex="-1"></a>    max_probability <span class="op">=</span> <span class="op">-</span><span class="dv">1</span></span>
<span id="cb87-11"><a href="#cb87-11" aria-hidden="true" tabindex="-1"></a>    most_probable_kmer <span class="op">=</span> <span class="st">""</span></span>
<span id="cb87-12"><a href="#cb87-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-13"><a href="#cb87-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> kmer <span class="kw">in</span> generate_substrings(sequence, kmer_length):</span>
<span id="cb87-14"><a href="#cb87-14" aria-hidden="true" tabindex="-1"></a>        kmer_probability <span class="op">=</span> math.prod(profile_matrix[nucleotide_index[kmer[j]]][j] <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(kmer_length))</span>
<span id="cb87-15"><a href="#cb87-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> kmer_probability <span class="op">&gt;</span> max_probability:</span>
<span id="cb87-16"><a href="#cb87-16" aria-hidden="true" tabindex="-1"></a>            max_probability <span class="op">=</span> kmer_probability</span>
<span id="cb87-17"><a href="#cb87-17" aria-hidden="true" tabindex="-1"></a>            most_probable_kmer <span class="op">=</span> kmer</span>
<span id="cb87-18"><a href="#cb87-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-19"><a href="#cb87-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> most_probable_kmer</span>
<span id="cb87-20"><a href="#cb87-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-21"><a href="#cb87-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Sample input</span></span>
<span id="cb87-22"><a href="#cb87-22" aria-hidden="true" tabindex="-1"></a>sample_input <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb87-23"><a href="#cb87-23" aria-hidden="true" tabindex="-1"></a><span class="st">ACCTGTTTATTGCCTAAGTTCCGAACAAACCCAATATAGCCCGAGGGCCT</span></span>
<span id="cb87-24"><a href="#cb87-24" aria-hidden="true" tabindex="-1"></a><span class="st">5</span></span>
<span id="cb87-25"><a href="#cb87-25" aria-hidden="true" tabindex="-1"></a><span class="st">0.2 0.2 0.3 0.2 0.3</span></span>
<span id="cb87-26"><a href="#cb87-26" aria-hidden="true" tabindex="-1"></a><span class="st">0.4 0.3 0.1 0.5 0.1</span></span>
<span id="cb87-27"><a href="#cb87-27" aria-hidden="true" tabindex="-1"></a><span class="st">0.3 0.3 0.5 0.2 0.4</span></span>
<span id="cb87-28"><a href="#cb87-28" aria-hidden="true" tabindex="-1"></a><span class="st">0.1 0.2 0.1 0.1 0.2</span></span>
<span id="cb87-29"><a href="#cb87-29" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb87-30"><a href="#cb87-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-31"><a href="#cb87-31" aria-hidden="true" tabindex="-1"></a>dna_sequence, kmer_length, <span class="op">*</span>profile_rows <span class="op">=</span> sample_input.strip().split(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)</span>
<span id="cb87-32"><a href="#cb87-32" aria-hidden="true" tabindex="-1"></a>profile_matrix <span class="op">=</span> [<span class="bu">list</span>(<span class="bu">map</span>(<span class="bu">float</span>, row.split())) <span class="cf">for</span> row <span class="kw">in</span> profile_rows]</span>
<span id="cb87-33"><a href="#cb87-33" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> find_profile_most_probable_kmer(dna_sequence, <span class="bu">int</span>(kmer_length), profile_matrix)</span>
<span id="cb87-34"><a href="#cb87-34" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(result)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="implement-greedymotifsearch" class="level1" data-number="30">
<h1 data-number="30"><span class="header-section-number">30</span> Implement GreedyMotifSearch</h1>
<p>Implement, GreedyMotifSearch.</p>
<p>Given:&nbsp;Integers&nbsp;<em>k</em>&nbsp;and&nbsp;<em>t</em>, followed by a collection of strings&nbsp;<em>Dna</em>.</p>
<p>Return:&nbsp;A collection of strings&nbsp;<em>BestMotifs</em>&nbsp;resulting from running&nbsp;<em>GreedyMotifSearch</em>(<em>Dna</em>,&nbsp;<em>k</em>,&nbsp;<em>t</em>). If at any step you find more than one&nbsp;<em>Profile</em>-most probable&nbsp;<em>k</em>-mer in a given string, use the one occurring first.</p>
<section id="sample-dataset-29" class="level2" data-number="30.1">
<h2 data-number="30.1" class="anchored" data-anchor-id="sample-dataset-29"><span class="header-section-number">30.1</span> Sample Dataset</h2>
<pre><code>3 5
GGCGTTCAGGCA
AAGAATCAGTCA
CAAGGAGTTCGC
CACGTCAATCAC
CAATAATATTCG</code></pre>
</section>
<section id="sample-output-29" class="level2" data-number="30.2">
<h2 data-number="30.2" class="anchored" data-anchor-id="sample-output-29"><span class="header-section-number">30.2</span> Sample Output</h2>
<pre><code>CAG
CAG
CAA
CAA
CAA</code></pre>
</section>
<section id="solution-29" class="level2" data-number="30.3">
<h2 data-number="30.3" class="anchored" data-anchor-id="solution-29"><span class="header-section-number">30.3</span> Solution</h2>
<div class="sourceCode" id="cb90"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> typing <span class="im">import</span> Iterator, List, Dict</span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> collections <span class="im">import</span> Counter</span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> math</span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> generate_kmers(sequence: <span class="bu">str</span>, kmer_length: <span class="bu">int</span>) <span class="op">-&gt;</span> Iterator[<span class="bu">str</span>]:</span>
<span id="cb90-6"><a href="#cb90-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(sequence) <span class="op">-</span> kmer_length <span class="op">+</span> <span class="dv">1</span>):</span>
<span id="cb90-7"><a href="#cb90-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">yield</span> sequence[i : i <span class="op">+</span> kmer_length]</span>
<span id="cb90-8"><a href="#cb90-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-9"><a href="#cb90-9" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> find_most_probable_kmer(sequence: <span class="bu">str</span>, kmer_length: <span class="bu">int</span>, profile: List[List[<span class="bu">float</span>]]) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb90-10"><a href="#cb90-10" aria-hidden="true" tabindex="-1"></a>    nucleotide_to_index: Dict[<span class="bu">str</span>, <span class="bu">int</span>] <span class="op">=</span> {<span class="st">"A"</span>: <span class="dv">0</span>, <span class="st">"C"</span>: <span class="dv">1</span>, <span class="st">"G"</span>: <span class="dv">2</span>, <span class="st">"T"</span>: <span class="dv">3</span>}</span>
<span id="cb90-11"><a href="#cb90-11" aria-hidden="true" tabindex="-1"></a>    max_probability: <span class="bu">float</span> <span class="op">=</span> <span class="op">-</span><span class="dv">1</span></span>
<span id="cb90-12"><a href="#cb90-12" aria-hidden="true" tabindex="-1"></a>    most_probable_kmer: <span class="bu">str</span> <span class="op">=</span> <span class="st">""</span></span>
<span id="cb90-13"><a href="#cb90-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-14"><a href="#cb90-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> kmer <span class="kw">in</span> generate_kmers(sequence, kmer_length):</span>
<span id="cb90-15"><a href="#cb90-15" aria-hidden="true" tabindex="-1"></a>        kmer_probability: <span class="bu">float</span> <span class="op">=</span> math.prod(profile[nucleotide_to_index[kmer[j]]][j] <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(kmer_length))</span>
<span id="cb90-16"><a href="#cb90-16" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> kmer_probability <span class="op">&gt;</span> max_probability:</span>
<span id="cb90-17"><a href="#cb90-17" aria-hidden="true" tabindex="-1"></a>            max_probability <span class="op">=</span> kmer_probability</span>
<span id="cb90-18"><a href="#cb90-18" aria-hidden="true" tabindex="-1"></a>            most_probable_kmer <span class="op">=</span> kmer</span>
<span id="cb90-19"><a href="#cb90-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-20"><a href="#cb90-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> most_probable_kmer</span>
<span id="cb90-21"><a href="#cb90-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-22"><a href="#cb90-22" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> create_profile(sequences: List[<span class="bu">str</span>], pseudocount: <span class="bu">int</span> <span class="op">=</span> <span class="dv">0</span>) <span class="op">-&gt;</span> List[List[<span class="bu">float</span>]]:</span>
<span id="cb90-23"><a href="#cb90-23" aria-hidden="true" tabindex="-1"></a>    nucleotides: List[<span class="bu">str</span>] <span class="op">=</span> [<span class="st">"A"</span>, <span class="st">"C"</span>, <span class="st">"G"</span>, <span class="st">"T"</span>]</span>
<span id="cb90-24"><a href="#cb90-24" aria-hidden="true" tabindex="-1"></a>    profile: List[List[<span class="bu">float</span>]] <span class="op">=</span> [[] <span class="cf">for</span> _ <span class="kw">in</span> nucleotides]</span>
<span id="cb90-25"><a href="#cb90-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, nucleotide <span class="kw">in</span> <span class="bu">enumerate</span>(nucleotides):</span>
<span id="cb90-26"><a href="#cb90-26" aria-hidden="true" tabindex="-1"></a>        profile[i] <span class="op">=</span> [</span>
<span id="cb90-27"><a href="#cb90-27" aria-hidden="true" tabindex="-1"></a>            (<span class="bu">sum</span>(seq[j] <span class="op">==</span> nucleotide <span class="cf">for</span> seq <span class="kw">in</span> sequences) <span class="op">+</span> pseudocount) <span class="op">/</span> <span class="bu">len</span>(sequences)</span>
<span id="cb90-28"><a href="#cb90-28" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(sequences[<span class="dv">0</span>]))</span>
<span id="cb90-29"><a href="#cb90-29" aria-hidden="true" tabindex="-1"></a>        ]</span>
<span id="cb90-30"><a href="#cb90-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> profile</span>
<span id="cb90-31"><a href="#cb90-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-32"><a href="#cb90-32" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> calculate_score(motifs: List[<span class="bu">str</span>]) <span class="op">-&gt;</span> <span class="bu">int</span>:</span>
<span id="cb90-33"><a href="#cb90-33" aria-hidden="true" tabindex="-1"></a>    score: <span class="bu">int</span> <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb90-34"><a href="#cb90-34" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(motifs[<span class="dv">0</span>])):</span>
<span id="cb90-35"><a href="#cb90-35" aria-hidden="true" tabindex="-1"></a>        column: List[<span class="bu">str</span>] <span class="op">=</span> [motif[i] <span class="cf">for</span> motif <span class="kw">in</span> motifs]</span>
<span id="cb90-36"><a href="#cb90-36" aria-hidden="true" tabindex="-1"></a>        most_common: <span class="bu">str</span> <span class="op">=</span> Counter(column).most_common()[<span class="dv">0</span>][<span class="dv">0</span>]</span>
<span id="cb90-37"><a href="#cb90-37" aria-hidden="true" tabindex="-1"></a>        score <span class="op">+=</span> <span class="bu">sum</span>(nucleotide <span class="op">!=</span> most_common <span class="cf">for</span> nucleotide <span class="kw">in</span> column)</span>
<span id="cb90-38"><a href="#cb90-38" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> score</span>
<span id="cb90-39"><a href="#cb90-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-40"><a href="#cb90-40" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> greedy_motif_search(dna_sequences: List[<span class="bu">str</span>], kmer_length: <span class="bu">int</span>, pseudocount: <span class="bu">int</span> <span class="op">=</span> <span class="dv">0</span>) <span class="op">-&gt;</span> List[<span class="bu">str</span>]:</span>
<span id="cb90-41"><a href="#cb90-41" aria-hidden="true" tabindex="-1"></a>    best_motifs: List[<span class="bu">str</span>] <span class="op">=</span> [seq[:kmer_length] <span class="cf">for</span> seq <span class="kw">in</span> dna_sequences]</span>
<span id="cb90-42"><a href="#cb90-42" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> kmer <span class="kw">in</span> generate_kmers(dna_sequences[<span class="dv">0</span>], kmer_length):</span>
<span id="cb90-43"><a href="#cb90-43" aria-hidden="true" tabindex="-1"></a>        current_motifs: List[<span class="bu">str</span>] <span class="op">=</span> [kmer]</span>
<span id="cb90-44"><a href="#cb90-44" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, <span class="bu">len</span>(dna_sequences)):</span>
<span id="cb90-45"><a href="#cb90-45" aria-hidden="true" tabindex="-1"></a>            current_profile: List[List[<span class="bu">float</span>]] <span class="op">=</span> create_profile(current_motifs, pseudocount<span class="op">=</span>pseudocount)</span>
<span id="cb90-46"><a href="#cb90-46" aria-hidden="true" tabindex="-1"></a>            current_motifs.append(find_most_probable_kmer(dna_sequences[i], kmer_length, current_profile))</span>
<span id="cb90-47"><a href="#cb90-47" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> calculate_score(current_motifs) <span class="op">&lt;</span> calculate_score(best_motifs):</span>
<span id="cb90-48"><a href="#cb90-48" aria-hidden="true" tabindex="-1"></a>            best_motifs <span class="op">=</span> current_motifs</span>
<span id="cb90-49"><a href="#cb90-49" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> best_motifs</span>
<span id="cb90-50"><a href="#cb90-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-51"><a href="#cb90-51" aria-hidden="true" tabindex="-1"></a><span class="co"># Sample input</span></span>
<span id="cb90-52"><a href="#cb90-52" aria-hidden="true" tabindex="-1"></a>sample_input: <span class="bu">str</span> <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb90-53"><a href="#cb90-53" aria-hidden="true" tabindex="-1"></a><span class="st">3 5</span></span>
<span id="cb90-54"><a href="#cb90-54" aria-hidden="true" tabindex="-1"></a><span class="st">GGCGTTCAGGCA</span></span>
<span id="cb90-55"><a href="#cb90-55" aria-hidden="true" tabindex="-1"></a><span class="st">AAGAATCAGTCA</span></span>
<span id="cb90-56"><a href="#cb90-56" aria-hidden="true" tabindex="-1"></a><span class="st">CAAGGAGTTCGC</span></span>
<span id="cb90-57"><a href="#cb90-57" aria-hidden="true" tabindex="-1"></a><span class="st">CACGTCAATCAC</span></span>
<span id="cb90-58"><a href="#cb90-58" aria-hidden="true" tabindex="-1"></a><span class="st">CAATAATATTCG</span></span>
<span id="cb90-59"><a href="#cb90-59" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb90-60"><a href="#cb90-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-61"><a href="#cb90-61" aria-hidden="true" tabindex="-1"></a>ints, <span class="op">*</span>dna <span class="op">=</span> sample_input.strip().split(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)</span>
<span id="cb90-62"><a href="#cb90-62" aria-hidden="true" tabindex="-1"></a>k, t <span class="op">=</span> <span class="bu">map</span>(<span class="bu">int</span>, ints.split())</span>
<span id="cb90-63"><a href="#cb90-63" aria-hidden="true" tabindex="-1"></a>result: List[<span class="bu">str</span>] <span class="op">=</span> greedy_motif_search(dna, k)</span>
<span id="cb90-64"><a href="#cb90-64" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="op">*</span>result, sep<span class="op">=</span><span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="implement-greedymotifsearch-with-pseudocounts" class="level1" data-number="31">
<h1 data-number="31"><span class="header-section-number">31</span> Implement GreedyMotifSearch with Pseudocounts</h1>
<p>Implement.&nbsp;<em>GreedyMotifSearch</em>&nbsp;with Pseudocounts.</p>
<p>Given:&nbsp;Integers&nbsp;<em>k</em>&nbsp;and&nbsp;<em>t</em>, followed by a collection of strings&nbsp;<em>Dna</em>.</p>
<p>Return:&nbsp;A collection of strings&nbsp;<em>BestMotifs</em>&nbsp;resulting from running&nbsp;<em>GreedyMotifSearch</em>(<em>Dna</em>,&nbsp;<em>k</em>,&nbsp;<em>t</em>) with pseudocounts. If at any step you find more than one&nbsp;<em>Profile</em>-most probable&nbsp;<em>k</em>-mer in a given string, use the one occurring first.</p>
<section id="sample-dataset-30" class="level2" data-number="31.1">
<h2 data-number="31.1" class="anchored" data-anchor-id="sample-dataset-30"><span class="header-section-number">31.1</span> Sample Dataset</h2>
<pre><code>3 5
GGCGTTCAGGCA
AAGAATCAGTCA
CAAGGAGTTCGC
CACGTCAATCAC
CAATAATATTCG</code></pre>
</section>
<section id="sample-output-30" class="level2" data-number="31.2">
<h2 data-number="31.2" class="anchored" data-anchor-id="sample-output-30"><span class="header-section-number">31.2</span> Sample Output</h2>
<pre><code>TTC
ATC
TTC
ATC
TTC</code></pre>
</section>
<section id="solution-30" class="level2" data-number="31.3">
<h2 data-number="31.3" class="anchored" data-anchor-id="solution-30"><span class="header-section-number">31.3</span> Solution</h2>
<div class="sourceCode" id="cb93"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> typing <span class="im">import</span> Iterator, List, Dict</span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> collections <span class="im">import</span> Counter</span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> math</span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-5"><a href="#cb93-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> generate_kmers(sequence: <span class="bu">str</span>, kmer_length: <span class="bu">int</span>) <span class="op">-&gt;</span> Iterator[<span class="bu">str</span>]:</span>
<span id="cb93-6"><a href="#cb93-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(sequence) <span class="op">-</span> kmer_length <span class="op">+</span> <span class="dv">1</span>):</span>
<span id="cb93-7"><a href="#cb93-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">yield</span> sequence[i : i <span class="op">+</span> kmer_length]</span>
<span id="cb93-8"><a href="#cb93-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-9"><a href="#cb93-9" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> find_most_probable_kmer(sequence: <span class="bu">str</span>, kmer_length: <span class="bu">int</span>, profile: List[List[<span class="bu">float</span>]]) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb93-10"><a href="#cb93-10" aria-hidden="true" tabindex="-1"></a>    nucleotide_to_index: Dict[<span class="bu">str</span>, <span class="bu">int</span>] <span class="op">=</span> {<span class="st">"A"</span>: <span class="dv">0</span>, <span class="st">"C"</span>: <span class="dv">1</span>, <span class="st">"G"</span>: <span class="dv">2</span>, <span class="st">"T"</span>: <span class="dv">3</span>}</span>
<span id="cb93-11"><a href="#cb93-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">max</span>(</span>
<span id="cb93-12"><a href="#cb93-12" aria-hidden="true" tabindex="-1"></a>        generate_kmers(sequence, kmer_length),</span>
<span id="cb93-13"><a href="#cb93-13" aria-hidden="true" tabindex="-1"></a>        key<span class="op">=</span><span class="kw">lambda</span> kmer: math.prod(profile[nucleotide_to_index[nucleotide]][position] </span>
<span id="cb93-14"><a href="#cb93-14" aria-hidden="true" tabindex="-1"></a>                                   <span class="cf">for</span> position, nucleotide <span class="kw">in</span> <span class="bu">enumerate</span>(kmer))</span>
<span id="cb93-15"><a href="#cb93-15" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb93-16"><a href="#cb93-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-17"><a href="#cb93-17" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> create_profile(motifs: List[<span class="bu">str</span>], pseudocount: <span class="bu">int</span> <span class="op">=</span> <span class="dv">0</span>) <span class="op">-&gt;</span> List[List[<span class="bu">float</span>]]:</span>
<span id="cb93-18"><a href="#cb93-18" aria-hidden="true" tabindex="-1"></a>    nucleotides: List[<span class="bu">str</span>] <span class="op">=</span> [<span class="st">"A"</span>, <span class="st">"C"</span>, <span class="st">"G"</span>, <span class="st">"T"</span>]</span>
<span id="cb93-19"><a href="#cb93-19" aria-hidden="true" tabindex="-1"></a>    motif_count: <span class="bu">int</span> <span class="op">=</span> <span class="bu">len</span>(motifs)</span>
<span id="cb93-20"><a href="#cb93-20" aria-hidden="true" tabindex="-1"></a>    motif_length: <span class="bu">int</span> <span class="op">=</span> <span class="bu">len</span>(motifs[<span class="dv">0</span>])</span>
<span id="cb93-21"><a href="#cb93-21" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb93-22"><a href="#cb93-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> [</span>
<span id="cb93-23"><a href="#cb93-23" aria-hidden="true" tabindex="-1"></a>        [(<span class="bu">sum</span>(motif[position] <span class="op">==</span> nucleotide <span class="cf">for</span> motif <span class="kw">in</span> motifs) <span class="op">+</span> pseudocount) <span class="op">/</span> motif_count </span>
<span id="cb93-24"><a href="#cb93-24" aria-hidden="true" tabindex="-1"></a>         <span class="cf">for</span> position <span class="kw">in</span> <span class="bu">range</span>(motif_length)]</span>
<span id="cb93-25"><a href="#cb93-25" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> nucleotide <span class="kw">in</span> nucleotides</span>
<span id="cb93-26"><a href="#cb93-26" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb93-27"><a href="#cb93-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-28"><a href="#cb93-28" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> calculate_score(motifs: List[<span class="bu">str</span>]) <span class="op">-&gt;</span> <span class="bu">int</span>:</span>
<span id="cb93-29"><a href="#cb93-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">sum</span>(</span>
<span id="cb93-30"><a href="#cb93-30" aria-hidden="true" tabindex="-1"></a>        <span class="bu">sum</span>(nucleotide <span class="op">!=</span> Counter(column).most_common(<span class="dv">1</span>)[<span class="dv">0</span>][<span class="dv">0</span>] <span class="cf">for</span> nucleotide <span class="kw">in</span> column)</span>
<span id="cb93-31"><a href="#cb93-31" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> column <span class="kw">in</span> <span class="bu">zip</span>(<span class="op">*</span>motifs)</span>
<span id="cb93-32"><a href="#cb93-32" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb93-33"><a href="#cb93-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-34"><a href="#cb93-34" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> greedy_motif_search(dna_sequences: List[<span class="bu">str</span>], kmer_length: <span class="bu">int</span>, pseudocount: <span class="bu">int</span> <span class="op">=</span> <span class="dv">0</span>) <span class="op">-&gt;</span> List[<span class="bu">str</span>]:</span>
<span id="cb93-35"><a href="#cb93-35" aria-hidden="true" tabindex="-1"></a>    best_motifs: List[<span class="bu">str</span>] <span class="op">=</span> [sequence[:kmer_length] <span class="cf">for</span> sequence <span class="kw">in</span> dna_sequences]</span>
<span id="cb93-36"><a href="#cb93-36" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb93-37"><a href="#cb93-37" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> kmer <span class="kw">in</span> generate_kmers(dna_sequences[<span class="dv">0</span>], kmer_length):</span>
<span id="cb93-38"><a href="#cb93-38" aria-hidden="true" tabindex="-1"></a>        current_motifs: List[<span class="bu">str</span>] <span class="op">=</span> [kmer]</span>
<span id="cb93-39"><a href="#cb93-39" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> sequence <span class="kw">in</span> dna_sequences[<span class="dv">1</span>:]:</span>
<span id="cb93-40"><a href="#cb93-40" aria-hidden="true" tabindex="-1"></a>            profile: List[List[<span class="bu">float</span>]] <span class="op">=</span> create_profile(current_motifs, pseudocount)</span>
<span id="cb93-41"><a href="#cb93-41" aria-hidden="true" tabindex="-1"></a>            current_motifs.append(find_most_probable_kmer(sequence, kmer_length, profile))</span>
<span id="cb93-42"><a href="#cb93-42" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb93-43"><a href="#cb93-43" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> calculate_score(current_motifs) <span class="op">&lt;</span> calculate_score(best_motifs):</span>
<span id="cb93-44"><a href="#cb93-44" aria-hidden="true" tabindex="-1"></a>            best_motifs <span class="op">=</span> current_motifs</span>
<span id="cb93-45"><a href="#cb93-45" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb93-46"><a href="#cb93-46" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> best_motifs</span>
<span id="cb93-47"><a href="#cb93-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-48"><a href="#cb93-48" aria-hidden="true" tabindex="-1"></a><span class="co"># Sample input</span></span>
<span id="cb93-49"><a href="#cb93-49" aria-hidden="true" tabindex="-1"></a>sample_input: <span class="bu">str</span> <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb93-50"><a href="#cb93-50" aria-hidden="true" tabindex="-1"></a><span class="st">3 5</span></span>
<span id="cb93-51"><a href="#cb93-51" aria-hidden="true" tabindex="-1"></a><span class="st">GGCGTTCAGGCA</span></span>
<span id="cb93-52"><a href="#cb93-52" aria-hidden="true" tabindex="-1"></a><span class="st">AAGAATCAGTCA</span></span>
<span id="cb93-53"><a href="#cb93-53" aria-hidden="true" tabindex="-1"></a><span class="st">CAAGGAGTTCGC</span></span>
<span id="cb93-54"><a href="#cb93-54" aria-hidden="true" tabindex="-1"></a><span class="st">CACGTCAATCAC</span></span>
<span id="cb93-55"><a href="#cb93-55" aria-hidden="true" tabindex="-1"></a><span class="st">CAATAATATTCG</span></span>
<span id="cb93-56"><a href="#cb93-56" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb93-57"><a href="#cb93-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-58"><a href="#cb93-58" aria-hidden="true" tabindex="-1"></a>k_value, _, <span class="op">*</span>dna_sequences <span class="op">=</span> sample_input.strip().split()</span>
<span id="cb93-59"><a href="#cb93-59" aria-hidden="true" tabindex="-1"></a>k_value <span class="op">=</span> <span class="bu">int</span>(k_value)</span>
<span id="cb93-60"><a href="#cb93-60" aria-hidden="true" tabindex="-1"></a>result: List[<span class="bu">str</span>] <span class="op">=</span> greedy_motif_search(dna_sequences, k_value, pseudocount<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb93-61"><a href="#cb93-61" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="op">*</span>result, sep<span class="op">=</span><span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="implement-randomizedmotifsearch" class="level1" data-number="32">
<h1 data-number="32"><span class="header-section-number">32</span> Implement RandomizedMotifSearch</h1>
<p>Implement&nbsp;<em>RandomizedMotifSearch</em>.</p>
<p>Given:&nbsp;Positive integers&nbsp;<em>k</em>&nbsp;and&nbsp;<em>t</em>, followed by a collection of strings&nbsp;<em>Dna</em>.</p>
<p>Return:&nbsp;A collection&nbsp;<em>BestMotifs</em>&nbsp;resulting from running&nbsp;<em>RandomizedMotifSearch</em>(<em>Dna</em>,&nbsp;<em>k</em>,&nbsp;<em>t</em>) 1000 times. Remember to use pseudocounts!</p>
<section id="sample-dataset-31" class="level2" data-number="32.1">
<h2 data-number="32.1" class="anchored" data-anchor-id="sample-dataset-31"><span class="header-section-number">32.1</span> Sample Dataset</h2>
<pre><code>8 5
CGCCCCTCTCGGGGGTGTTCAGTAAACGGCCA
GGGCGAGGTATGTGTAAGTGCCAAGGTGCCAG
TAGTACCGAGACCGAAAGAAGTATACAGGCGT
TAGATCAAGTTTCAGGTGCACGTCGGTGAACC
AATCCACCAGCTCCACGTGCAATGTTGGCCTA</code></pre>
</section>
<section id="sample-output-31" class="level2" data-number="32.2">
<h2 data-number="32.2" class="anchored" data-anchor-id="sample-output-31"><span class="header-section-number">32.2</span> Sample Output</h2>
<pre><code>AACGGCCA
AAGTGCCA
TAGTACCG
AAGTTTCA
ACGTGCAA</code></pre>
</section>
<section id="solution-31" class="level2" data-number="32.3">
<h2 data-number="32.3" class="anchored" data-anchor-id="solution-31"><span class="header-section-number">32.3</span> Solution</h2>
<div class="sourceCode" id="cb96"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> typing <span class="im">import</span> List, Tuple, Callable</span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> collections <span class="im">import</span> Counter</span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> random <span class="im">import</span> randint</span>
<span id="cb96-4"><a href="#cb96-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> math</span>
<span id="cb96-5"><a href="#cb96-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-6"><a href="#cb96-6" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> generate_kmers(sequence: <span class="bu">str</span>, kmer_length: <span class="bu">int</span>) <span class="op">-&gt;</span> List[<span class="bu">str</span>]:</span>
<span id="cb96-7"><a href="#cb96-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> [sequence[i:i<span class="op">+</span>kmer_length] <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(sequence) <span class="op">-</span> kmer_length <span class="op">+</span> <span class="dv">1</span>)]</span>
<span id="cb96-8"><a href="#cb96-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-9"><a href="#cb96-9" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> find_most_probable_kmer(sequence: <span class="bu">str</span>, kmer_length: <span class="bu">int</span>, profile: List[List[<span class="bu">float</span>]]) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb96-10"><a href="#cb96-10" aria-hidden="true" tabindex="-1"></a>    nucleotide_to_index <span class="op">=</span> {<span class="st">"A"</span>: <span class="dv">0</span>, <span class="st">"C"</span>: <span class="dv">1</span>, <span class="st">"G"</span>: <span class="dv">2</span>, <span class="st">"T"</span>: <span class="dv">3</span>}</span>
<span id="cb96-11"><a href="#cb96-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">max</span>(</span>
<span id="cb96-12"><a href="#cb96-12" aria-hidden="true" tabindex="-1"></a>        generate_kmers(sequence, kmer_length),</span>
<span id="cb96-13"><a href="#cb96-13" aria-hidden="true" tabindex="-1"></a>        key<span class="op">=</span><span class="kw">lambda</span> kmer: math.prod(profile[nucleotide_to_index[nucleotide]][j] <span class="cf">for</span> j, nucleotide <span class="kw">in</span> <span class="bu">enumerate</span>(kmer))</span>
<span id="cb96-14"><a href="#cb96-14" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb96-15"><a href="#cb96-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-16"><a href="#cb96-16" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> create_profile(motifs: List[<span class="bu">str</span>], pseudocount: <span class="bu">int</span> <span class="op">=</span> <span class="dv">0</span>) <span class="op">-&gt;</span> List[List[<span class="bu">float</span>]]:</span>
<span id="cb96-17"><a href="#cb96-17" aria-hidden="true" tabindex="-1"></a>    nucleotides <span class="op">=</span> [<span class="st">"A"</span>, <span class="st">"C"</span>, <span class="st">"G"</span>, <span class="st">"T"</span>]</span>
<span id="cb96-18"><a href="#cb96-18" aria-hidden="true" tabindex="-1"></a>    profile <span class="op">=</span> []</span>
<span id="cb96-19"><a href="#cb96-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> nucleotide <span class="kw">in</span> nucleotides:</span>
<span id="cb96-20"><a href="#cb96-20" aria-hidden="true" tabindex="-1"></a>        profile.append([</span>
<span id="cb96-21"><a href="#cb96-21" aria-hidden="true" tabindex="-1"></a>            (<span class="bu">sum</span>(seq[j] <span class="op">==</span> nucleotide <span class="cf">for</span> seq <span class="kw">in</span> motifs) <span class="op">+</span> pseudocount) <span class="op">/</span> (<span class="bu">len</span>(motifs) <span class="op">+</span> <span class="dv">4</span> <span class="op">*</span> pseudocount)</span>
<span id="cb96-22"><a href="#cb96-22" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(motifs[<span class="dv">0</span>]))</span>
<span id="cb96-23"><a href="#cb96-23" aria-hidden="true" tabindex="-1"></a>        ])</span>
<span id="cb96-24"><a href="#cb96-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> profile</span>
<span id="cb96-25"><a href="#cb96-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-26"><a href="#cb96-26" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> calculate_score(motifs: List[<span class="bu">str</span>]) <span class="op">-&gt;</span> <span class="bu">int</span>:</span>
<span id="cb96-27"><a href="#cb96-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">sum</span>(</span>
<span id="cb96-28"><a href="#cb96-28" aria-hidden="true" tabindex="-1"></a>        <span class="bu">sum</span>(nucleotide <span class="op">!=</span> Counter(column).most_common(<span class="dv">1</span>)[<span class="dv">0</span>][<span class="dv">0</span>] <span class="cf">for</span> nucleotide <span class="kw">in</span> column)</span>
<span id="cb96-29"><a href="#cb96-29" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> column <span class="kw">in</span> <span class="bu">zip</span>(<span class="op">*</span>motifs)</span>
<span id="cb96-30"><a href="#cb96-30" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb96-31"><a href="#cb96-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-32"><a href="#cb96-32" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> generate_random_kmer(sequence: <span class="bu">str</span>, kmer_length: <span class="bu">int</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb96-33"><a href="#cb96-33" aria-hidden="true" tabindex="-1"></a>    start <span class="op">=</span> randint(<span class="dv">0</span>, <span class="bu">len</span>(sequence) <span class="op">-</span> kmer_length)</span>
<span id="cb96-34"><a href="#cb96-34" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> sequence[start : start <span class="op">+</span> kmer_length]</span>
<span id="cb96-35"><a href="#cb96-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-36"><a href="#cb96-36" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> find_motifs(profile: List[List[<span class="bu">float</span>]], dna_sequences: List[<span class="bu">str</span>]) <span class="op">-&gt;</span> List[<span class="bu">str</span>]:</span>
<span id="cb96-37"><a href="#cb96-37" aria-hidden="true" tabindex="-1"></a>    kmer_length <span class="op">=</span> <span class="bu">len</span>(profile[<span class="dv">0</span>])</span>
<span id="cb96-38"><a href="#cb96-38" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> [find_most_probable_kmer(seq, kmer_length, profile) <span class="cf">for</span> seq <span class="kw">in</span> dna_sequences]</span>
<span id="cb96-39"><a href="#cb96-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-40"><a href="#cb96-40" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> randomized_motif_search(dna_sequences: List[<span class="bu">str</span>], kmer_length: <span class="bu">int</span>) <span class="op">-&gt;</span> Tuple[<span class="bu">int</span>, List[<span class="bu">str</span>]]:</span>
<span id="cb96-41"><a href="#cb96-41" aria-hidden="true" tabindex="-1"></a>    motifs <span class="op">=</span> [generate_random_kmer(seq, kmer_length) <span class="cf">for</span> seq <span class="kw">in</span> dna_sequences]</span>
<span id="cb96-42"><a href="#cb96-42" aria-hidden="true" tabindex="-1"></a>    best_score <span class="op">=</span> math.inf</span>
<span id="cb96-43"><a href="#cb96-43" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb96-44"><a href="#cb96-44" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="va">True</span>:</span>
<span id="cb96-45"><a href="#cb96-45" aria-hidden="true" tabindex="-1"></a>        profile <span class="op">=</span> create_profile(motifs, pseudocount<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb96-46"><a href="#cb96-46" aria-hidden="true" tabindex="-1"></a>        motifs <span class="op">=</span> find_motifs(profile, dna_sequences)</span>
<span id="cb96-47"><a href="#cb96-47" aria-hidden="true" tabindex="-1"></a>        current_score <span class="op">=</span> calculate_score(motifs)</span>
<span id="cb96-48"><a href="#cb96-48" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb96-49"><a href="#cb96-49" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> current_score <span class="op">&gt;=</span> best_score:</span>
<span id="cb96-50"><a href="#cb96-50" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> best_score, motifs</span>
<span id="cb96-51"><a href="#cb96-51" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb96-52"><a href="#cb96-52" aria-hidden="true" tabindex="-1"></a>        best_score <span class="op">=</span> current_score</span>
<span id="cb96-53"><a href="#cb96-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-54"><a href="#cb96-54" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> find_best_motifs(search_function: Callable, iterations: <span class="bu">int</span>, <span class="op">*</span>args) <span class="op">-&gt;</span> List[<span class="bu">str</span>]:</span>
<span id="cb96-55"><a href="#cb96-55" aria-hidden="true" tabindex="-1"></a>    best_score, best_motifs <span class="op">=</span> search_function(<span class="op">*</span>args)</span>
<span id="cb96-56"><a href="#cb96-56" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb96-57"><a href="#cb96-57" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(iterations <span class="op">-</span> <span class="dv">1</span>):</span>
<span id="cb96-58"><a href="#cb96-58" aria-hidden="true" tabindex="-1"></a>        score, motifs <span class="op">=</span> search_function(<span class="op">*</span>args)</span>
<span id="cb96-59"><a href="#cb96-59" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> score <span class="op">&lt;</span> best_score:</span>
<span id="cb96-60"><a href="#cb96-60" aria-hidden="true" tabindex="-1"></a>            best_score, best_motifs <span class="op">=</span> score, motifs</span>
<span id="cb96-61"><a href="#cb96-61" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb96-62"><a href="#cb96-62" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> best_motifs</span>
<span id="cb96-63"><a href="#cb96-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-64"><a href="#cb96-64" aria-hidden="true" tabindex="-1"></a><span class="co"># Sample input</span></span>
<span id="cb96-65"><a href="#cb96-65" aria-hidden="true" tabindex="-1"></a>sample_input <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb96-66"><a href="#cb96-66" aria-hidden="true" tabindex="-1"></a><span class="st">8 5</span></span>
<span id="cb96-67"><a href="#cb96-67" aria-hidden="true" tabindex="-1"></a><span class="st">CGCCCCTCTCGGGGGTGTTCAGTAAACGGCCA</span></span>
<span id="cb96-68"><a href="#cb96-68" aria-hidden="true" tabindex="-1"></a><span class="st">GGGCGAGGTATGTGTAAGTGCCAAGGTGCCAG</span></span>
<span id="cb96-69"><a href="#cb96-69" aria-hidden="true" tabindex="-1"></a><span class="st">TAGTACCGAGACCGAAAGAAGTATACAGGCGT</span></span>
<span id="cb96-70"><a href="#cb96-70" aria-hidden="true" tabindex="-1"></a><span class="st">TAGATCAAGTTTCAGGTGCACGTCGGTGAACC</span></span>
<span id="cb96-71"><a href="#cb96-71" aria-hidden="true" tabindex="-1"></a><span class="st">AATCCACCAGCTCCACGTGCAATGTTGGCCTA</span></span>
<span id="cb96-72"><a href="#cb96-72" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb96-73"><a href="#cb96-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-74"><a href="#cb96-74" aria-hidden="true" tabindex="-1"></a>kmer_length, _, <span class="op">*</span>dna_sequences <span class="op">=</span> sample_input.strip().split()</span>
<span id="cb96-75"><a href="#cb96-75" aria-hidden="true" tabindex="-1"></a>kmer_length <span class="op">=</span> <span class="bu">int</span>(kmer_length)</span>
<span id="cb96-76"><a href="#cb96-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-77"><a href="#cb96-77" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> find_best_motifs(randomized_motif_search, <span class="dv">1000</span>, dna_sequences, kmer_length)</span>
<span id="cb96-78"><a href="#cb96-78" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="op">*</span>result, sep<span class="op">=</span><span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="implement-gibbssampler" class="level1" data-number="33">
<h1 data-number="33"><span class="header-section-number">33</span> Implement GibbsSampler</h1>
<p>Implement,&nbsp;<em>GibbsSampler</em>.</p>
<p>Given:&nbsp;Integers&nbsp;<em>k</em>,&nbsp;<em>t</em>, and&nbsp;<em>N</em>, followed by a collection of strings&nbsp;<em>Dna</em>.</p>
<p>Return:&nbsp;The strings&nbsp;<em>BestMotifs</em>&nbsp;resulting from running&nbsp;<em>GibbsSampler</em>(<em>Dna</em>,&nbsp;<em>k</em>,&nbsp;<em>t</em>,&nbsp;<em>N</em>) with 20 random starts. Remember to use pseudocounts!</p>
<section id="sample-dataset-32" class="level2" data-number="33.1">
<h2 data-number="33.1" class="anchored" data-anchor-id="sample-dataset-32"><span class="header-section-number">33.1</span> Sample Dataset</h2>
<pre><code>8 5 100
CGCCCCTCTCGGGGGTGTTCAGTAAACGGCCA
GGGCGAGGTATGTGTAAGTGCCAAGGTGCCAG
TAGTACCGAGACCGAAAGAAGTATACAGGCGT
TAGATCAAGTTTCAGGTGCACGTCGGTGAACC
AATCCACCAGCTCCACGTGCAATGTTGGCCTA</code></pre>
</section>
<section id="sample-output-32" class="level2" data-number="33.2">
<h2 data-number="33.2" class="anchored" data-anchor-id="sample-output-32"><span class="header-section-number">33.2</span> Sample Output</h2>
<pre><code>TCTCGGGG
CCAAGGTG
TACAGGCG
TTCAGGTG
TCCACGTG</code></pre>
</section>
<section id="solution-32" class="level2" data-number="33.3">
<h2 data-number="33.3" class="anchored" data-anchor-id="solution-32"><span class="header-section-number">33.3</span> Solution</h2>
<div class="sourceCode" id="cb99"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> typing <span class="im">import</span> List, Iterator, Tuple, Callable</span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> collections <span class="im">import</span> Counter</span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> math</span>
<span id="cb99-4"><a href="#cb99-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> random</span>
<span id="cb99-5"><a href="#cb99-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-6"><a href="#cb99-6" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> generate_kmers(sequence: <span class="bu">str</span>, kmer_length: <span class="bu">int</span>) <span class="op">-&gt;</span> Iterator[<span class="bu">str</span>]:</span>
<span id="cb99-7"><a href="#cb99-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(sequence) <span class="op">-</span> kmer_length <span class="op">+</span> <span class="dv">1</span>):</span>
<span id="cb99-8"><a href="#cb99-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">yield</span> sequence[i : i <span class="op">+</span> kmer_length]</span>
<span id="cb99-9"><a href="#cb99-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-10"><a href="#cb99-10" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> create_profile(motifs: List[<span class="bu">str</span>], pseudocount: <span class="bu">int</span> <span class="op">=</span> <span class="dv">0</span>) <span class="op">-&gt;</span> List[List[<span class="bu">float</span>]]:</span>
<span id="cb99-11"><a href="#cb99-11" aria-hidden="true" tabindex="-1"></a>    nucleotides: List[<span class="bu">str</span>] <span class="op">=</span> [<span class="st">"A"</span>, <span class="st">"C"</span>, <span class="st">"G"</span>, <span class="st">"T"</span>]</span>
<span id="cb99-12"><a href="#cb99-12" aria-hidden="true" tabindex="-1"></a>    motif_count: <span class="bu">int</span> <span class="op">=</span> <span class="bu">len</span>(motifs)</span>
<span id="cb99-13"><a href="#cb99-13" aria-hidden="true" tabindex="-1"></a>    motif_length: <span class="bu">int</span> <span class="op">=</span> <span class="bu">len</span>(motifs[<span class="dv">0</span>])</span>
<span id="cb99-14"><a href="#cb99-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb99-15"><a href="#cb99-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> [</span>
<span id="cb99-16"><a href="#cb99-16" aria-hidden="true" tabindex="-1"></a>        [(<span class="bu">sum</span>(motif[position] <span class="op">==</span> nucleotide <span class="cf">for</span> motif <span class="kw">in</span> motifs) <span class="op">+</span> pseudocount) <span class="op">/</span> (motif_count <span class="op">+</span> <span class="dv">4</span><span class="op">*</span>pseudocount)</span>
<span id="cb99-17"><a href="#cb99-17" aria-hidden="true" tabindex="-1"></a>         <span class="cf">for</span> position <span class="kw">in</span> <span class="bu">range</span>(motif_length)]</span>
<span id="cb99-18"><a href="#cb99-18" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> nucleotide <span class="kw">in</span> nucleotides</span>
<span id="cb99-19"><a href="#cb99-19" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb99-20"><a href="#cb99-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-21"><a href="#cb99-21" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> calculate_score(motifs: List[<span class="bu">str</span>]) <span class="op">-&gt;</span> <span class="bu">int</span>:</span>
<span id="cb99-22"><a href="#cb99-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">sum</span>(</span>
<span id="cb99-23"><a href="#cb99-23" aria-hidden="true" tabindex="-1"></a>        <span class="bu">sum</span>(nucleotide <span class="op">!=</span> Counter(column).most_common(<span class="dv">1</span>)[<span class="dv">0</span>][<span class="dv">0</span>] <span class="cf">for</span> nucleotide <span class="kw">in</span> column)</span>
<span id="cb99-24"><a href="#cb99-24" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> column <span class="kw">in</span> <span class="bu">zip</span>(<span class="op">*</span>motifs)</span>
<span id="cb99-25"><a href="#cb99-25" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb99-26"><a href="#cb99-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-27"><a href="#cb99-27" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> generate_random_kmer(sequence: <span class="bu">str</span>, kmer_length: <span class="bu">int</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb99-28"><a href="#cb99-28" aria-hidden="true" tabindex="-1"></a>    start_index <span class="op">=</span> random.randint(<span class="dv">0</span>, <span class="bu">len</span>(sequence) <span class="op">-</span> kmer_length)</span>
<span id="cb99-29"><a href="#cb99-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> sequence[start_index : start_index <span class="op">+</span> kmer_length]</span>
<span id="cb99-30"><a href="#cb99-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-31"><a href="#cb99-31" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> find_best_motifs(search_function: Callable, iterations: <span class="bu">int</span>, <span class="op">*</span>args) <span class="op">-&gt;</span> List[<span class="bu">str</span>]:</span>
<span id="cb99-32"><a href="#cb99-32" aria-hidden="true" tabindex="-1"></a>    best_score, best_motifs <span class="op">=</span> search_function(<span class="op">*</span>args)</span>
<span id="cb99-33"><a href="#cb99-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(iterations <span class="op">-</span> <span class="dv">1</span>):</span>
<span id="cb99-34"><a href="#cb99-34" aria-hidden="true" tabindex="-1"></a>        score, motifs <span class="op">=</span> search_function(<span class="op">*</span>args)</span>
<span id="cb99-35"><a href="#cb99-35" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> score <span class="op">&lt;</span> best_score:</span>
<span id="cb99-36"><a href="#cb99-36" aria-hidden="true" tabindex="-1"></a>            best_score, best_motifs <span class="op">=</span> score, motifs</span>
<span id="cb99-37"><a href="#cb99-37" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> best_motifs</span>
<span id="cb99-38"><a href="#cb99-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-39"><a href="#cb99-39" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> calculate_kmer_probabilities(sequence: <span class="bu">str</span>, kmer_length: <span class="bu">int</span>, profile: List[List[<span class="bu">float</span>]]) <span class="op">-&gt;</span> List[<span class="bu">float</span>]:</span>
<span id="cb99-40"><a href="#cb99-40" aria-hidden="true" tabindex="-1"></a>    nucleotide_to_index: Dict[<span class="bu">str</span>, <span class="bu">int</span>] <span class="op">=</span> {<span class="st">"A"</span>: <span class="dv">0</span>, <span class="st">"C"</span>: <span class="dv">1</span>, <span class="st">"G"</span>: <span class="dv">2</span>, <span class="st">"T"</span>: <span class="dv">3</span>}</span>
<span id="cb99-41"><a href="#cb99-41" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> [</span>
<span id="cb99-42"><a href="#cb99-42" aria-hidden="true" tabindex="-1"></a>        math.prod(profile[nucleotide_to_index[kmer[j]]][j] <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(kmer_length))</span>
<span id="cb99-43"><a href="#cb99-43" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> kmer <span class="kw">in</span> generate_kmers(sequence, kmer_length)</span>
<span id="cb99-44"><a href="#cb99-44" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb99-45"><a href="#cb99-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-46"><a href="#cb99-46" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> select_random_kmer(sequence: <span class="bu">str</span>, kmer_length: <span class="bu">int</span>, profile: List[List[<span class="bu">float</span>]]) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb99-47"><a href="#cb99-47" aria-hidden="true" tabindex="-1"></a>    probabilities <span class="op">=</span> calculate_kmer_probabilities(sequence, kmer_length, profile)</span>
<span id="cb99-48"><a href="#cb99-48" aria-hidden="true" tabindex="-1"></a>    start_index <span class="op">=</span> random.choices(<span class="bu">range</span>(<span class="bu">len</span>(probabilities)), probabilities)[<span class="dv">0</span>]</span>
<span id="cb99-49"><a href="#cb99-49" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> sequence[start_index : start_index <span class="op">+</span> kmer_length]</span>
<span id="cb99-50"><a href="#cb99-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-51"><a href="#cb99-51" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> gibbs_sampler(dna_sequences: List[<span class="bu">str</span>], kmer_length: <span class="bu">int</span>, num_iterations: <span class="bu">int</span>) <span class="op">-&gt;</span> Tuple[<span class="bu">int</span>, List[<span class="bu">str</span>]]:</span>
<span id="cb99-52"><a href="#cb99-52" aria-hidden="true" tabindex="-1"></a>    motifs <span class="op">=</span> [generate_random_kmer(seq, kmer_length) <span class="cf">for</span> seq <span class="kw">in</span> dna_sequences]</span>
<span id="cb99-53"><a href="#cb99-53" aria-hidden="true" tabindex="-1"></a>    best_motifs <span class="op">=</span> motifs.copy()</span>
<span id="cb99-54"><a href="#cb99-54" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(num_iterations):</span>
<span id="cb99-55"><a href="#cb99-55" aria-hidden="true" tabindex="-1"></a>        i <span class="op">=</span> random.randint(<span class="dv">0</span>, <span class="bu">len</span>(dna_sequences) <span class="op">-</span> <span class="dv">1</span>)</span>
<span id="cb99-56"><a href="#cb99-56" aria-hidden="true" tabindex="-1"></a>        profile <span class="op">=</span> create_profile(motifs[:i] <span class="op">+</span> motifs[i <span class="op">+</span> <span class="dv">1</span> :], pseudocount<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb99-57"><a href="#cb99-57" aria-hidden="true" tabindex="-1"></a>        motifs[i] <span class="op">=</span> select_random_kmer(dna_sequences[i], kmer_length, profile)</span>
<span id="cb99-58"><a href="#cb99-58" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> calculate_score(motifs) <span class="op">&lt;</span> calculate_score(best_motifs):</span>
<span id="cb99-59"><a href="#cb99-59" aria-hidden="true" tabindex="-1"></a>            best_motifs <span class="op">=</span> motifs.copy()</span>
<span id="cb99-60"><a href="#cb99-60" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> calculate_score(best_motifs), best_motifs</span>
<span id="cb99-61"><a href="#cb99-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-62"><a href="#cb99-62" aria-hidden="true" tabindex="-1"></a><span class="co"># Sample input</span></span>
<span id="cb99-63"><a href="#cb99-63" aria-hidden="true" tabindex="-1"></a>sample_input <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb99-64"><a href="#cb99-64" aria-hidden="true" tabindex="-1"></a><span class="st">8 5 100</span></span>
<span id="cb99-65"><a href="#cb99-65" aria-hidden="true" tabindex="-1"></a><span class="st">TCTCGGGG</span></span>
<span id="cb99-66"><a href="#cb99-66" aria-hidden="true" tabindex="-1"></a><span class="st">CCAAGGTG</span></span>
<span id="cb99-67"><a href="#cb99-67" aria-hidden="true" tabindex="-1"></a><span class="st">TACAGGCG</span></span>
<span id="cb99-68"><a href="#cb99-68" aria-hidden="true" tabindex="-1"></a><span class="st">TTCAGGTG</span></span>
<span id="cb99-69"><a href="#cb99-69" aria-hidden="true" tabindex="-1"></a><span class="st">TCCACGTG</span></span>
<span id="cb99-70"><a href="#cb99-70" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb99-71"><a href="#cb99-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-72"><a href="#cb99-72" aria-hidden="true" tabindex="-1"></a>kmer_length, num_sequences, num_iterations, <span class="op">*</span>dna_sequences <span class="op">=</span> sample_input.strip().split()</span>
<span id="cb99-73"><a href="#cb99-73" aria-hidden="true" tabindex="-1"></a>kmer_length <span class="op">=</span> <span class="bu">int</span>(kmer_length)</span>
<span id="cb99-74"><a href="#cb99-74" aria-hidden="true" tabindex="-1"></a>num_iterations <span class="op">=</span> <span class="bu">int</span>(num_iterations)</span>
<span id="cb99-75"><a href="#cb99-75" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> find_best_motifs(gibbs_sampler, <span class="dv">20</span>, dna_sequences, kmer_length, num_iterations)</span>
<span id="cb99-76"><a href="#cb99-76" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="op">*</span>result, sep<span class="op">=</span><span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="implement-distancebetweenpatternandstrings" class="level1" data-number="34">
<h1 data-number="34"><span class="header-section-number">34</span> Implement DistanceBetweenPatternAndStrings</h1>
<p>Compute DistanceBetweenPatternAndStrings. <em>Find the distance between a pattern and a set of strings.</em>.</p>
<p>Given:&nbsp;A&nbsp;<a href="https://rosalind.info/glossary/dna-string/">DNA string</a>&nbsp;<em>Pattern</em>&nbsp;and a collection of DNA strings&nbsp;<em>Dna</em>.</p>
<p>Return:&nbsp;<em>DistanceBetweenPatternAndStrings</em>(<em>Pattern</em>,&nbsp;<em>Dna</em>).</p>
<section id="sample-dataset-33" class="level2" data-number="34.1">
<h2 data-number="34.1" class="anchored" data-anchor-id="sample-dataset-33"><span class="header-section-number">34.1</span> Sample Dataset</h2>
<pre><code>AAA
TTACCTTAAC GATATCTGTC ACGGCGTTCG CCCTAAAGAG CGTCAGAGGT</code></pre>
</section>
<section id="sample-output-33" class="level2" data-number="34.2">
<h2 data-number="34.2" class="anchored" data-anchor-id="sample-output-33"><span class="header-section-number">34.2</span> Sample Output</h2>
<pre><code>5</code></pre>
</section>
<section id="solution-33" class="level2" data-number="34.3">
<h2 data-number="34.3" class="anchored" data-anchor-id="solution-33"><span class="header-section-number">34.3</span> Solution</h2>
<div class="sourceCode" id="cb102"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> typing <span class="im">import</span> List, Iterator</span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> math</span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-4"><a href="#cb102-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> generate_kmers(sequence: <span class="bu">str</span>, kmer_length: <span class="bu">int</span>) <span class="op">-&gt;</span> Iterator[<span class="bu">str</span>]:</span>
<span id="cb102-5"><a href="#cb102-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(sequence) <span class="op">-</span> kmer_length <span class="op">+</span> <span class="dv">1</span>):</span>
<span id="cb102-6"><a href="#cb102-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">yield</span> sequence[i : i <span class="op">+</span> kmer_length]</span>
<span id="cb102-7"><a href="#cb102-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-8"><a href="#cb102-8" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> calculate_hamming_distance(seq1: <span class="bu">str</span>, seq2: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="bu">int</span>:</span>
<span id="cb102-9"><a href="#cb102-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">sum</span>(base1 <span class="op">!=</span> base2 <span class="cf">for</span> base1, base2 <span class="kw">in</span> <span class="bu">zip</span>(seq1, seq2))</span>
<span id="cb102-10"><a href="#cb102-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-11"><a href="#cb102-11" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> find_minimum_distance(pattern: <span class="bu">str</span>, text: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="bu">int</span>:</span>
<span id="cb102-12"><a href="#cb102-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">min</span>(calculate_hamming_distance(kmer, pattern) <span class="cf">for</span> kmer <span class="kw">in</span> generate_kmers(text, <span class="bu">len</span>(pattern)))</span>
<span id="cb102-13"><a href="#cb102-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-14"><a href="#cb102-14" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> calculate_pattern_distance_to_strings(pattern: <span class="bu">str</span>, dna_strings: List[<span class="bu">str</span>]) <span class="op">-&gt;</span> <span class="bu">int</span>:</span>
<span id="cb102-15"><a href="#cb102-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">sum</span>(find_minimum_distance(pattern, dna_string) <span class="cf">for</span> dna_string <span class="kw">in</span> dna_strings)</span>
<span id="cb102-16"><a href="#cb102-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-17"><a href="#cb102-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Sample input</span></span>
<span id="cb102-18"><a href="#cb102-18" aria-hidden="true" tabindex="-1"></a>sample_input <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb102-19"><a href="#cb102-19" aria-hidden="true" tabindex="-1"></a><span class="st">AAA</span></span>
<span id="cb102-20"><a href="#cb102-20" aria-hidden="true" tabindex="-1"></a><span class="st">TTACCTTAAC GATATCTGTC ACGGCGTTCG CCCTAAAGAG CGTCAGAGGT</span></span>
<span id="cb102-21"><a href="#cb102-21" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb102-22"><a href="#cb102-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-23"><a href="#cb102-23" aria-hidden="true" tabindex="-1"></a>pattern, dna_strings_raw <span class="op">=</span> sample_input.strip().split(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)</span>
<span id="cb102-24"><a href="#cb102-24" aria-hidden="true" tabindex="-1"></a>dna_strings <span class="op">=</span> dna_strings_raw.split()</span>
<span id="cb102-25"><a href="#cb102-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-26"><a href="#cb102-26" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> calculate_pattern_distance_to_strings(pattern, dna_strings)</span>
<span id="cb102-27"><a href="#cb102-27" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(result)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/tomorrow-lab\.github\.io\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">

<div class="cookie-consent-footer"><a href="#" id="open_preferences_center">Cookie Preferences</a></div></div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




</body></html>